<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½è‰¯è¯±æ•å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Heiti SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            overflow: hidden;
            background: linear-gradient(135deg, #fff3e6, #fde9f1);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        #game-header {
            height: 60px;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 5;
        }
        
        #game-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ff6b8b;
            text-shadow: 1px 1px 2px rgba(255,107,139,0.2);
        }
        
        #menu-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
        }
        
        /* Stats Bar */
        #stats-bar {
            height: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            font-size: 0.9rem;
            z-index: 5;
        }
        
        .stat {
            display: flex;
            align-items: center;
        }
        
        .stat-icon {
            margin-right: 5px;
            font-size: 1.2rem;
        }
        
        /* Main Game Area */
        #game-scene {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #bg-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #character-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80%;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        
        #character-image {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }
        
        /* Dialog Box */
        #dialog-box {
            position: absolute;
            bottom: 60px; /* é¢„ç•™åº•éƒ¨æ“ä½œæ çš„é«˜åº¦ */
            left: 0;
            width: 100%;
            min-height: 100px;
            max-height: 180px;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 10;
            overflow-y: auto;
        }
        
        #character-name {
            font-weight: bold;
            color: #ff6b8b;
            margin-bottom: 5px;
        }
        
        #dialog-text {
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .choice-button {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .choice-button:hover {
            background-color: #f0f7ff;
            border-color: #b8daff;
        }
        
        /* Bottom Action Bar */
        #action-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #eee;
            z-index: 15; /* ç¡®ä¿åœ¨å¯¹è¯æ¡†ä¹‹ä¸Š */
        }
        
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 50px;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 0.7rem;
        }
        
        .action-icon {
            font-size: 1.3rem;
            margin-bottom: 2px;
        }
        
        /* Menu Overlay */
        #menu-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 20;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        
        .menu-item {
            width: 200px;
            padding: 12px;
            background-color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* System Windows */
        .system-window {
            position: absolute;
            top: 60px;
            left: 5%;
            width: 90%;
            height: calc(100% - 120px);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 15;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .window-header {
            height: 50px;
            background-color: #ff6b8b;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }
        
        .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .window-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        /* Inventory Window */
        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .item {
            background-color: #f8f9fa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .item-image {
            width: 60px;
            height: 60px;
            background-color: #eee;
            border-radius: 8px;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #aaa;
        }
        
        .item-name {
            font-size: 0.8rem;
            text-align: center;
        }
        
        /* Shop Window */
        .shop-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .shop-item-details {
            flex: 1;
            margin-left: 10px;
        }
        
        .shop-item-name {
            font-weight: bold;
        }
        
        .shop-item-description {
            font-size: 0.8rem;
            color: #666;
            margin: 5px 0;
        }
        
        .shop-item-price {
            color: #ff6b8b;
            font-weight: bold;
        }
        
        .buy-button {
            background-color: #ff6b8b;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 15px;
            cursor: pointer;
        }
        
        /* Profile Window */
        .profile-section {
            margin-bottom: 20px;
        }
        
        .profile-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff6b8b;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .relationship-bar-container {
            width: 100%;
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .relationship-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b8b, #ff9eb5);
            width: 30%;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Loading Screen */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        #loading-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b8b;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #ff6b8b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal */
        #modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 30;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        #modal-content {
            width: 90%;
            max-width: 400px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
        }
        
        #modal-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #ff6b8b;
        }
        
        #modal-text {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        #modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-button {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        
        #modal-cancel {
            background-color: #f8f9fa;
            color: #666;
        }
        
        #modal-confirm {
            background-color: #ff6b8b;
            color: white;
        }
        
        /* Achievement Notification */
        #achievement {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 25;
            display: none;
        }
        
        /* Thought Bubble */
        .thought-bubble {
            font-style: italic;
            color: #666;
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 5px 10px;
            margin: 5px 0;
            display: inline-block;
        }
        
        /* Mini-game elements */
        #minigame-container {
            position: absolute;
            top: 100px;
            left: 5%;
            width: 90%;
            height: calc(100% - 260px);
            background-color: white;
            border-radius: 10px;
            z-index: 16;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Special event modal */
        #special-event {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 40;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        #special-event-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff6b8b;
        }
        
        #special-event-text {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        #special-event-button {
            background-color: #ff6b8b;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Schedule Window */
        #schedule-window {
            position: absolute;
            top: 60px;
            left: 5%;
            width: 90%;
            height: calc(100% - 120px);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 15;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .schedule-day {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .schedule-day-header {
            font-weight: bold;
            color: #ff6b8b;
            margin-bottom: 5px;
        }
        
        .schedule-events {
            margin-left: 10px;
        }
        
        .schedule-event {
            display: flex;
            margin-bottom: 5px;
        }
        
        .schedule-time {
            width: 80px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Loading Screen -->
        <div id="loading-screen">
            <div id="loading-title">å›½è‰¯è¯±æ•å™¨</div>
            <div class="loading-spinner"></div>
            <div>æ­£åœ¨è½½å…¥æ‹çˆ±å…»æˆæ¸¸æˆ...</div>
        </div>
        
        <!-- Game Header -->
        <div id="game-header">
            <div id="game-title">å›½è‰¯è¯±æ•å™¨</div>
            <button id="menu-button">â˜°</button>
        </div>
        
        <!-- Stats Bar -->
        <div id="stats-bar">
            <div class="stat">
                <span class="stat-icon">ğŸ’°</span>
                <span id="money">1000</span>
            </div>
            <div class="stat">
                <span class="stat-icon">â¤ï¸</span>
                <span id="affection">10</span>
            </div>
            <div class="stat">
                <span class="stat-icon">ğŸ˜Š</span>
                <span id="mood">æ™®é€š</span>
            </div>
            <div class="stat">
                <span class="stat-icon">ğŸ“…</span>
                <span id="day">ç¬¬1å¤©</span>
            </div>
        </div>
        
        <!-- Main Game Scene -->
        <div id="game-scene">
            <img id="bg-image" src="https://pic.imgdb.cn/item/66e85ca3d9c307b7e9cdc5df.jpg" alt="èƒŒæ™¯">
            <div id="character-container">
                <img id="character-image" src="https://pic1.imgdb.cn/item/66e8589dd9c307b7e9c3b0b4.jpg" alt="è§’è‰²">
            </div>
        </div>
        
        <!-- Dialog Box -->
        <div id="dialog-box">
            <div id="character-name">ç»“åŸå¤å¥ˆ</div>
            <div id="dialog-text">æ¬¢è¿æ¥åˆ°"å›½è‰¯è¯±æ•å™¨"ï¼åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä½ å°†æ‰®æ¼”ç»“åŸå¤å¥ˆï¼Œä¸€ä¸ªå¯¹å¤§å­¦ç¯®çƒé˜Ÿæ•™ç»ƒæå›½è‰¯ç—´è¿·çš„å¥³å­©ã€‚ä½ çš„ç›®æ ‡æ˜¯èµ¢å¾—ä»–çš„å¿ƒï¼</div>
            <div id="choices-container">
                <button class="choice-button" onclick="makeChoice(0)">å¼€å§‹æ¸¸æˆ</button>
                <button class="choice-button" onclick="showHelp()">æ¸¸æˆè¯´æ˜</button>
            </div>
        </div>
        
        <!-- Action Bar -->
        <div id="action-bar">
            <button class="action-button" onclick="showProfile()">
                <span class="action-icon">ğŸ‘¤</span>
                ä¸ªäºº
            </button>
            <button class="action-button" onclick="showInventory()">
                <span class="action-icon">ğŸ’</span>
                ç‰©å“
            </button>
            <button class="action-button" onclick="showShop()">
                <span class="action-icon">ğŸ›ï¸</span>
                å•†åº—
            </button>
            <button class="action-button" onclick="showMap()">
                <span class="action-icon">ğŸ—ºï¸</span>
                åœ°ç‚¹
            </button>
            <button class="action-button" onclick="nextDay()">
                <span class="action-icon">â­ï¸</span>
                ä¸‹ä¸€å¤©
            </button>
        </div>
        
        <!-- Menu Overlay -->
        <div id="menu-overlay">
            <div class="menu-item" onclick="resumeGame()">ç»§ç»­æ¸¸æˆ</div>
            <div class="menu-item" onclick="saveGame()">ä¿å­˜æ¸¸æˆ</div>
            <div class="menu-item" onclick="loadGame()">è¯»å–æ¸¸æˆ</div>
            <div class="menu-item" onclick="showHelp()">æ¸¸æˆå¸®åŠ©</div>
            <div class="menu-item" onclick="showSettings()">è®¾ç½®</div>
        </div>
        
        <!-- System Windows -->
        <!-- Profile Window -->
        <div id="profile-window" class="system-window">
            <div class="window-header">
                <div>ä¸ªäººèµ„æ–™</div>
                <button class="close-button" onclick="closeWindow('profile-window')">Ã—</button>
            </div>
            <div class="window-content">
                <div class="profile-section">
                    <div class="profile-header">åŸºæœ¬èµ„æ–™</div>
                    <div>å§“åï¼šç»“åŸå¤å¥ˆ</div>
                    <div>èº«ä»½ï¼šå¤§å­¦äºŒå¹´çº§å•†å­¦é™¢å­¦ç”Ÿ</div>
                    <div>çˆ±å¥½ï¼šå•†æ³•ç ”ç©¶ã€çƒ¹é¥ªã€æ‘„å½±</div>
                    <div>ç‰¹é•¿ï¼šå•†æ³•ä¸æ³•åŠ¡åˆ†æ</div>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">ä¸ªäººå±æ€§</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span>é­…åŠ›</span>
                            <span id="charm-stat">35</span>
                        </div>
                        <div class="stat-item">
                            <span>æ™ºæ…§</span>
                            <span id="intel-stat">42</span>
                        </div>
                        <div class="stat-item">
                            <span>ä½“åŠ›</span>
                            <span id="energy-stat">38</span>
                        </div>
                        <div class="stat-item">
                            <span>çƒ¹é¥ª</span>
                            <span id="cooking-stat">28</span>
                        </div>
                        <div class="stat-item">
                            <span>ç¯®çƒ</span>
                            <span id="basketball-stat">15</span>
                        </div>
                        <div class="stat-item">
                            <span>å•†æ³•</span>
                            <span id="law-stat">65</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">å…³ç³»</div>
                    <div>æå›½è‰¯ (ç¯®çƒæ•™ç»ƒ)</div>
                    <div class="relationship-bar-container">
                        <div id="guoliang-relationship" class="relationship-bar" style="width:10%"></div>
                    </div>
                    <div>å¥½æ„Ÿåº¦ï¼š<span id="guoliang-affection">10</span>/100</div>
                    <div>å½“å‰çŠ¶æ€ï¼š<span id="relationship-status">é™Œç”Ÿäºº</span></div>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">è®°å¿†ç¢ç‰‡</div>
                    <div id="memory-fragments">å°šæœªæ‰¾åˆ°ä»»ä½•è®°å¿†ç¢ç‰‡...</div>
                </div>
            </div>
        </div>
        
        <!-- Inventory Window -->
        <div id="inventory-window" class="system-window">
            <div class="window-header">
                <div>ç‰©å“æ </div>
                <button class="close-button" onclick="closeWindow('inventory-window')">Ã—</button>
            </div>
            <div class="window-content">
                <div id="items-container" class="item-grid">
                    <!-- Items will be added here by JS -->
                </div>
            </div>
        </div>
        
        <!-- Shop Window -->
        <div id="shop-window" class="system-window">
            <div class="window-header">
                <div>å•†åº—</div>
                <button class="close-button" onclick="closeWindow('shop-window')">Ã—</button>
            </div>
            <div class="window-content">
                <div class="shop-item">
                    <div class="item-image">ğŸ€</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">ç¯®çƒ</div>
                        <div class="shop-item-description">é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+5ï¼Œç‰¹åˆ«é€‚åˆåˆæœŸäº’åŠ¨ã€‚</div>
                        <div class="shop-item-price">300 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('basketball')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">âŒš</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">è¿åŠ¨æ‰‹è¡¨</div>
                        <div class="shop-item-description">é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+10ï¼Œé€‚åˆå…³ç³»æ›´è¿›ä¸€æ­¥æ—¶èµ é€ã€‚</div>
                        <div class="shop-item-price">800 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('sportswatch')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸª</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">æ‰‹å·¥é¥¼å¹²</div>
                        <div class="shop-item-description">é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+3ï¼Œæ˜¯è¡¨è¾¾å…³å¿ƒçš„å°ç¤¼ç‰©ã€‚</div>
                        <div class="shop-item-price">100 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('cookies')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ“–</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">ç¯®çƒæˆ˜æœ¯ä¹¦</div>
                        <div class="shop-item-description">é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+15ï¼Œå±•ç¤ºä½ å¯¹ä»–å·¥ä½œçš„ç†è§£ä¸æ”¯æŒã€‚</div>
                        <div class="shop-item-price">1200 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('tacticsbook')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ‘š</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">æ—¶å°šæœè£…</div>
                        <div class="shop-item-description">æå‡é­…åŠ›å±æ€§+5ï¼Œå¢åŠ çº¦ä¼šæˆåŠŸç‡ã€‚</div>
                        <div class="shop-item-price">500 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('fashionclothes')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ“š</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">ç¯®çƒè§„åˆ™ä¹¦</div>
                        <div class="shop-item-description">æå‡ç¯®çƒçŸ¥è¯†+5ï¼Œè®©ä½ æ›´æ‡‚ææ•™ç»ƒçš„ä¸–ç•Œã€‚</div>
                        <div class="shop-item-price">300 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('basketballbook')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ“</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">å•†æ³•ç¬”è®°</div>
                        <div class="shop-item-description">ä½ çš„å•†æ³•ä¸“ä¸šç¬”è®°ï¼Œç²¾ç¾æ•´ç†åå¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚</div>
                        <div class="shop-item-price">200 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('lawnotes')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ¶</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">èƒ½é‡é¥®æ–™</div>
                        <div class="shop-item-description">å¬è¯´ææ•™ç»ƒè®­ç»ƒåä¼šå–è¿™ä¸ªï¼Œä¹Ÿè®¸å¯ä»¥å€Ÿæœºæ¥è¿‘ä»–ã€‚</div>
                        <div class="shop-item-price">50 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('energydrink')">è´­ä¹°</button>
                </div>
                <div class="shop-item">
                    <div class="item-image">ğŸ”</div>
                    <div class="shop-item-details">
                        <div class="shop-item-name">æ ¡å‹å½•</div>
                        <div class="shop-item-description">ä»¥å¾€æ¯•ä¸šç”Ÿçš„èµ„æ–™æ±‡æ€»ï¼Œä¹Ÿè®¸èƒ½æ‰¾åˆ°å…³äºè¿‡å»çš„çº¿ç´¢ã€‚</div>
                        <div class="shop-item-price">350 å…ƒ</div>
                    </div>
                    <button class="buy-button" onclick="buyItem('alumnibook')">è´­ä¹°</button>
                </div>
            </div>
        </div>
        
        <!-- Map Window -->
        <div id="map-window" class="system-window">
            <div class="window-header">
                <div>åœ°ç‚¹</div>
                <button class="close-button" onclick="closeWindow('map-window')">Ã—</button>
            </div>
            <div class="window-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="item" onclick="visitLocation('basketball_court')">
                        <div class="item-image">ğŸ€</div>
                        <div class="item-name">ç¯®çƒåœº</div>
                    </div>
                    <div class="item" onclick="visitLocation('library')">
                        <div class="item-image">ğŸ“š</div>
                        <div class="item-name">å›¾ä¹¦é¦†</div>
                    </div>
                    <div class="item" onclick="visitLocation('cafe')">
                        <div class="item-image">â˜•</div>
                        <div class="item-name">å’–å•¡å…</div>
                    </div>
                    <div class="item" onclick="visitLocation('park')">
                        <div class="item-image">ğŸŒ³</div>
                        <div class="item-name">å…¬å›­</div>
                    </div>
                    <div class="item" onclick="visitLocation('gym')">
                        <div class="item-image">ğŸ’ª</div>
                        <div class="item-name">å¥èº«æˆ¿</div>
                    </div>
                    <div class="item" onclick="visitLocation('classroom')">
                        <div class="item-image">ğŸ«</div>
                        <div class="item-name">æ•™å®¤</div>
                    </div>
                    <div class="item" onclick="visitLocation('office')">
                        <div class="item-image">ğŸ–‹ï¸</div>
                        <div class="item-name">æ•™å¸ˆåŠå…¬å®¤</div>
                    </div>
                    <div class="item" onclick="visitLocation('home')">
                        <div class="item-image">ğŸ </div>
                        <div class="item-name">å…¬å¯“</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Schedule Window -->
        <div id="schedule-window" class="system-window">
            <div class="window-header">
                <div>ææ•™ç»ƒçš„è¯¾è¡¨</div>
                <button class="close-button" onclick="closeWindow('schedule-window')">Ã—</button>
            </div>
            <div class="window-content" id="schedule-content">
                <!-- Schedule will be populated by JS -->
            </div>
        </div>
        
        <!-- Modal -->
        <div id="modal">
            <div id="modal-content">
                <div id="modal-title">æç¤º</div>
                <div id="modal-text">å†…å®¹</div>
                <div id="modal-buttons">
                    <button id="modal-cancel" class="modal-button" onclick="closeModal()">å–æ¶ˆ</button>
                    <button id="modal-confirm" class="modal-button" onclick="confirmModal()">ç¡®å®š</button>
                </div>
            </div>
        </div>
        
        <!-- Achievement Notification -->
        <div id="achievement">
            ğŸ† è§£é”æˆå°±ï¼šåˆæ¬¡è§é¢
        </div>
        
        <!-- Special Event Overlay -->
        <div id="special-event">
            <div id="special-event-title">ç‰¹æ®Šäº‹ä»¶</div>
            <div id="special-event-text">å‘ç”Ÿäº†ä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…...</div>
            <button id="special-event-button" onclick="closeSpecialEvent()">ç»§ç»­</button>
        </div>
        
        <!-- Mini-game Container -->
        <div id="minigame-container">
            <!-- Mini-games will be loaded here dynamically -->
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            day: 1,
            money: 1000,
            affection: 10,
            mood: "æ™®é€š",
            currentScene: "intro",
            stats: {
                charm: 35,
                intelligence: 42,
                energy: 38,
                cooking: 28,
                basketball: 15,
                law: 65,
                luck: 25
            },
            flags: {
                metGuoliang: false,
                firstGift: false,
                firstDate: false,
                discoveredHint: false,
                basketballMatch: false,
                memoryTrigger: false,
                discoveredLawConnection: false,
                helpedWithContract: false,
                visitedCafe: false,
                foundOldPhoto: false,
                knowsSchedule: false,
                taughtBasketball: false,
                specialEncounter: false,
                rivalAppeared: false
            },
            inventory: [],
            visitedLocations: [],
            currentLocation: "home",
            relationshipStatus: "é™Œç”Ÿäºº",
            achievements: [],
            memoryFragments: [],
            guoliangSchedule: {
                monday: [
                    { time: "08:00-10:00", activity: "çƒé˜Ÿæ™¨ç»ƒ" },
                    { time: "13:00-15:00", activity: "ä¸ªäººè®­ç»ƒ" },
                    { time: "16:00-18:00", activity: "çƒé˜Ÿè®­ç»ƒ" }
                ],
                tuesday: [
                    { time: "09:00-11:00", activity: "æˆ˜æœ¯ç ”ç©¶" },
                    { time: "15:00-17:00", activity: "çƒé˜Ÿè®­ç»ƒ" }
                ],
                wednesday: [
                    { time: "08:00-10:00", activity: "çƒé˜Ÿæ™¨ç»ƒ" },
                    { time: "14:00-16:00", activity: "æ•™ç»ƒä¼šè®®" }
                ],
                thursday: [
                    { time: "10:00-12:00", activity: "ä¸ªäººè®­ç»ƒ" },
                    { time: "15:00-17:00", activity: "çƒé˜Ÿè®­ç»ƒ" }
                ],
                friday: [
                    { time: "08:00-10:00", activity: "çƒé˜Ÿæ™¨ç»ƒ" },
                    { time: "16:00-18:00", activity: "æˆ˜æœ¯è®­ç»ƒ" }
                ],
                saturday: [
                    { time: "09:00-12:00", activity: "æ¯”èµ›æ—¥" }
                ],
                sunday: [
                    { time: "è‡ªç”±æ´»åŠ¨", activity: "ä¼‘æ¯æ—¥" }
                ]
            },
            currentWeekDay: 1 // 1 = å‘¨ä¸€ï¼Œ2 = å‘¨äºŒï¼Œä»¥æ­¤ç±»æ¨
        };

        // Current modal callback
        let modalCallback = null;
        let specialEventCallback = null;

        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const menuOverlay = document.getElementById('menu-overlay');
        const dialogBox = document.getElementById('dialog-box');
        const characterName = document.getElementById('character-name');
        const dialogText = document.getElementById('dialog-text');
        const choicesContainer = document.getElementById('choices-container');
        const characterImage = document.getElementById('character-image');
        const bgImage = document.getElementById('bg-image');
        const moneyDisplay = document.getElementById('money');
        const affectionDisplay = document.getElementById('affection');
        const moodDisplay = document.getElementById('mood');
        const dayDisplay = document.getElementById('day');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const achievementNotification = document.getElementById('achievement');
        const specialEvent = document.getElementById('special-event');
        const specialEventTitle = document.getElementById('special-event-title');
        const specialEventText = document.getElementById('special-event-text');

        // Background images for locations
        const backgrounds = {
            home: "https://pic1.imgdb.cn/item/66e85ca3d9c307b7e9cdc5df.jpg",
            basketball_court: "https://pic1.imgdb.cn/item/67c46c2dd0e0a243d40a2fd3.jpg",
            library: "https://pic.imgdb.cn/item/66e6d194d9c307b7e9c131d3.png",
            cafe: "https://pic1.imgdb.cn/item/67bc94a8d0e0a243d403bc7f.png",
            park: "https://pic.imgdb.cn/item/66cc8f01d9c307b7e9c6d2e8.png",
            gym: "https://pic1.imgdb.cn/item/66e8589dd9c307b7e9c3b0b4.jpg",
            classroom: "https://pic.imgdb.cn/item/66d071cbd9c307b7e9344927.png",
            office: "https://pic.imgdb.cn/item/66e85ca3d9c307b7e9cdc5df.jpg"
        };

        // Character images
        const characters = {
            natsu: "https://pic1.imgdb.cn/item/66e8589dd9c307b7e9c3b0b4.jpg",
            guoliang: "https://pic1.imgdb.cn/item/66be21a1d9c307b7e9cc9c98.jpg",
            professor: "https://pic1.imgdb.cn/item/66eadcbdf21886ccc0e7f787.png",
            classmate: "https://pic1.imgdb.cn/item/66eadcbdf21886ccc0e7f762.png",
            rival: "https://pic1.imgdb.cn/item/66d7f116d9c307b7e9a009b9.jpg"
        };

        // Items data
const itemsData = {
    basketball: { 
        name: "ç¯®çƒ", 
        icon: "ğŸ€", 
        description: "é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+5", 
        price: 300, 
        effect: { affection: 5 } 
    },
    sportswatch: { 
        name: "è¿åŠ¨æ‰‹è¡¨", 
        icon: "âŒš", 
        description: "é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+10", 
        price: 800, 
        effect: { affection: 10 } 
    },
    cookies: { 
        name: "æ‰‹å·¥é¥¼å¹²", 
        icon: "ğŸª", 
        description: "é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+3", 
        price: 100, 
        effect: { affection: 3 } 
    },
    tacticsbook: { 
        name: "ç¯®çƒæˆ˜æœ¯ä¹¦", 
        icon: "ğŸ“–", 
        description: "é€ç»™ææ•™ç»ƒï¼Œå¯¹æ–¹å¥½æ„Ÿåº¦+15", 
        price: 1200, 
        effect: { affection: 15 } 
    },
    fashionclothes: { 
        name: "æ—¶å°šæœè£…", 
        icon: "ğŸ‘š", 
        description: "æå‡é­…åŠ›å±æ€§+5", 
        price: 500, 
        effect: { charm: 5 } 
    },
    basketballbook: { 
        name: "ç¯®çƒè§„åˆ™ä¹¦", 
        icon: "ğŸ“š", 
        description: "æå‡ç¯®çƒçŸ¥è¯†+5", 
        price: 300, 
        effect: { basketball: 5 } 
    },
    lawnotes: { 
        name: "å•†æ³•ç¬”è®°", 
        icon: "ğŸ“", 
        description: "ä½ ç²¾å¿ƒæ•´ç†çš„å•†æ³•ç¬”è®°ï¼Œä¹Ÿè®¸ä¼šæ´¾ä¸Šç”¨åœº", 
        price: 200, 
        effect: { law: 3 } 
    },
    energydrink: { 
        name: "èƒ½é‡é¥®æ–™", 
        icon: "ğŸ¶", 
        description: "ææ•™ç»ƒå–œæ¬¢çš„é¥®æ–™", 
        price: 50, 
        effect: { affection: 2 } 
    },
    alumnibook: { 
        name: "æ ¡å‹å½•", 
        icon: "ğŸ”", 
        description: "å¯èƒ½åŒ…å«è¿‡å»çš„çº¿ç´¢", 
        price: 350, 
        effect: {} 
    },
    studyNotes: { 
        name: "ä½“è‚²ç®¡ç†ç¬”è®°", 
        icon: "ğŸ“", 
        description: "ä½ åšçš„ä½“è‚²ç®¡ç†è¯¾ç¬”è®°ï¼Œå¯èƒ½å¯¹æå›½è‰¯çš„å­¦ä¹ æœ‰å¸®åŠ©", 
        price: 0, // æ— éœ€è´­ä¹°ï¼Œé€šè¿‡ç‰¹å®šäº‹ä»¶è·å¾—
        effect: { affection: 4 } 
    },
    recoveryTape: { 
        name: "è¿åŠ¨è´´å¸ƒ", 
        icon: "ğŸ©¹", 
        description: "é«˜è´¨é‡çš„è¿åŠ¨è‚Œè‚‰è´´å¸ƒï¼Œå¯¹è†ç›–æ¢å¤æœ‰å¸®åŠ©", 
        price: 250, 
        effect: { affection: 4 } 
    },
    nutritionBar: { 
        name: "è›‹ç™½èƒ½é‡æ£’", 
        icon: "ğŸ«", 
        description: "è®­ç»ƒåè¡¥å……èƒ½é‡çš„ä½³å“ï¼Œå¥èº«çˆ±å¥½è€…çš„æœ€çˆ±", 
        price: 80, 
        effect: { affection: 2, energy: 10 } 
    },
    tacticsApp: { 
        name: "ç¯®çƒæˆ˜æœ¯APPä¼šå‘˜", 
        icon: "ğŸ“±", 
        description: "æœ€æ–°çš„ç¯®çƒæˆ˜æœ¯åˆ†æAPPä¼šå‘˜ï¼Œå†…å«ä¸“ä¸šæˆ˜æœ¯åº“", 
        price: 600, 
        effect: { affection: 8 } 
    },
    studyGuide: { 
        name: "æœŸæœ«è€ƒè¯•å¤ä¹ èµ„æ–™", 
        icon: "ğŸ“š", 
        description: "ä½ æ•´ç†çš„è¯¦å°½å¤ä¹ èµ„æ–™ï¼Œå¯¹åŒä¸ºå­¦ç”Ÿçš„æå›½è‰¯å¾ˆæœ‰ç”¨", 
        price: 0, // é€šè¿‡ç‰¹å®šäº‹ä»¶è·å¾—
        effect: { affection: 6 } 
    }
}; // ä¿®å¤ï¼šæ·»åŠ äº†ç¼ºå¤±çš„å³å¤§æ‹¬å·
        
        // Memory fragments data
        const memoryFragmentsData = [
            { id: "fragment1", title: "æ¨¡ç³Šçš„ç¬‘å®¹", text: "é‚£ä¸ªåœ¨æ¨±èŠ±æ ‘ä¸‹å¾®ç¬‘çš„äººå½±ï¼Œä¸ºä»€ä¹ˆæ„Ÿè§‰å¦‚æ­¤ç†Ÿæ‚‰ï¼Ÿ" },
            { id: "fragment2", title: "ç¯®çƒåœºçš„çº¦å®š", text: "è®°å¾—å¥½åƒåœ¨ä¸€å¹´çº§çš„æ—¶å€™ï¼Œåœ¨ç¯®çƒåœºä¸Šæ›¾ç»æœ‰è¿‡ä¸€æ®µå¯¹è¯..." },
            { id: "fragment3", title: "å•†æ³•è¯¾ä¸Šçš„äº‰è®º", text: "é‚£å ‚å•†æ³•è¯¾ä¸Šï¼Œä»–ä¼¼ä¹ä¸ºäº†æŸä¸ªæ¡ˆä¾‹å’Œæ•™æˆäº‰è®ºå¾—å¾ˆæ¿€çƒˆ..." },
            { id: "fragment4", title: "å…±åŒçš„é¡¹ç›®", text: "å¥½åƒæ›¾ç»ä¸€èµ·å‚ä¸è¿‡ä¸€ä¸ªå­¦æ ¡é¡¹ç›®ï¼Ÿéš¾é“é‚£æ—¶å°±è®¤è¯†ä»–äº†ï¼Ÿ" },
            { id: "fragment5", title: "åŒ»é™¢çš„å›å¿†", text: "ä¸ºä»€ä¹ˆæƒ³èµ·åŒ»é™¢çš„ç™½è‰²èµ°å»Šä¼šè®©æˆ‘å¿ƒè·³åŠ é€Ÿï¼Ÿ" },
            { id: "fragment6", title: "è¢«é—å¿˜çš„çº¦å®š", text: "ä»–å½“æ—¶è¯´è¿‡çš„è¯æ˜¯ä»€ä¹ˆï¼Ÿ'å¦‚æœæˆ‘æˆä¸º...'ï¼Œåé¢æ˜¯ä»€ä¹ˆï¼Ÿ" },
            { id: "fragment7", title: "åˆåŒçº çº·", text: "æˆ‘å¥½åƒæ›¾ç»å¸®ä»–å¤„ç†è¿‡ä¸€ä»½åˆåŒï¼Ÿå…³äºä»€ä¹ˆçš„ï¼Ÿ" }
        ];

// æ›´æ–°æå›½è‰¯è§’è‰²å½¢è±¡è®¾å®š
const characterProfiles = {
    guoliang: {
        name: "æå›½è‰¯",
        age: 20,
        year: "å¤§ä¸‰",
        major: "ä½“è‚²æ•™è‚²å­¦",
        position: "ç¯®çƒé˜Ÿå­¦ç”Ÿæ•™ç»ƒ",
        personality: "è®¤çœŸã€ä¸¥æ ¼ã€å¯¹ç¯®çƒå……æ»¡çƒ­æƒ…ã€æœ‰äº›å†…å‘ã€ä¸å–„è¨€è¾",
        background: "å¤§ä¸€æ—¶æ˜¯æ ¡é˜Ÿä¸»åŠ›ï¼Œå› å‡ºè‰²çš„æˆ˜æœ¯åˆ†æèƒ½åŠ›è¢«å­¦æ ¡ç‰¹åˆ«ä»»å‘½ä¸ºå­¦ç”Ÿæ•™ç»ƒï¼ŒåŒæ—¶ç»§ç»­è‡ªå·±çš„å­¦ä¸š",
        likes: ["ç¯®çƒæˆ˜æœ¯ç ”ç©¶", "é»‘å’–å•¡", "è¿åŠ¨ç§‘å­¦ä¹¦ç±", "å¥èº«"],
        dislikes: ["è™šä¼ªçš„äºº", "ä¸å®ˆæ—¶", "æ”¾å¼ƒç²¾ç¥"]
    },
    natsu: {
        name: "ç»“åŸå¤å¥ˆ",
        age: 19,
        year: "å¤§äºŒ",
        major: "å•†æ³•",
        personality: "èªæ˜ã€è®¤çœŸã€æœ‰äº›å®³ç¾ä½†é‡åˆ°ç†Ÿæ‚‰çš„äº‹ç‰©ä¼šå˜å¾—è‡ªä¿¡",
        background: "ä»å°å¯¹æ³•å¾‹æœ‰å…´è¶£ï¼Œé«˜ä¸­æ—¶å‚åŠ è¿‡æ¨¡æ‹Ÿæ³•åº­æ¯”èµ›è·å¥–ï¼Œç°åœ¨æ˜¯å•†æ³•ç¤¾å›¢çš„æ´»è·ƒæˆå‘˜",
        likes: ["å•†æ³•æ¡ˆä¾‹åˆ†æ", "æ•´ç†ç¬”è®°", "çƒ¹é¥ª", "æ‘„å½±"],
        dislikes: ["ä¸è®²é“ç†çš„äºº", "æ··ä¹±çš„ç¯å¢ƒ"]
    },
    rival: {
        name: "ç›¸æ³½ç¾å’²",
        age: 22,
        year: "å¤§å››",
        major: "ä½“è‚²ç®¡ç†",
        position: "å­¦ç”Ÿä¼šä½“è‚²éƒ¨éƒ¨é•¿",
        personality: "è‡ªä¿¡ã€å¼ºåŠ¿ã€æœ‰é¢†å¯¼åŠ›ã€æœ‰äº›éª„å‚²",
        background: "ä¸æå›½è‰¯åŒå±ŠåŒå­¦ï¼Œå›½ä¸­æ—¶æ›¾æ˜¯ç¯®çƒæ ¡é˜Ÿï¼Œç°åœ¨æ˜¯æ ¡å›­é£äº‘äººç‰©",
        likes: ["æŒæ§å±€é¢", "ç»„ç»‡æ´»åŠ¨", "èµ¢å¾—æ¯”èµ›"],
        dislikes: ["è¢«å¿½è§†", "èƒ½åŠ›ä¸è¶³çš„äºº"]
    }
};

// æ·»åŠ æ–°çš„è®°å¿†ç¢ç‰‡
const newMemoryFragments = [
    { id: "fragment8", title: "è¯¾å ‚è¾©è®º", text: "å•†æ³•è¯¾ä¸Šï¼Œæå›½è‰¯ä¸ä½ å°±ä½“è‚²èµåŠ©åˆåŒæ¡ˆä¾‹è¿›è¡Œæ¿€çƒˆè¾©è®ºï¼Œæ•™æˆå¯¹ä½ ä»¬çš„è¡¨ç°èµèµæœ‰åŠ ã€‚" },
    { id: "fragment9", title: "åˆé¤é‚€çº¦", text: "æŸä¸ªé˜³å…‰æ˜åªšçš„ä¸­åˆï¼Œæå›½è‰¯å®³ç¾åœ°é‚€è¯·ä½ ä¸€èµ·åƒåˆé¤ï¼ŒèŠèµ·äº†ä»–å¯¹ç¯®çƒæˆ˜æœ¯çš„ç‹¬ç‰¹è§è§£ã€‚" },
    { id: "fragment10", title: "å—ä¼¤çš„è†ç›–", text: "ä¸€åœºé‡è¦æ¯”èµ›ä¸­ï¼Œæå›½è‰¯ä¸ºæ•‘çƒå†²å‡ºåœºå¤–ï¼Œè†ç›–ä¸¥é‡å—ä¼¤ã€‚ä½ ç¬¬ä¸€ä¸ªå†²åˆ°ä»–èº«è¾¹ï¼Œæ»¡è„¸æ‹…å¿§ã€‚" },
    { id: "fragment11", title: "åŒ»é™¢çš„çº¦å®š", text: "åŒ»é™¢ç—…æˆ¿é‡Œï¼Œæå›½è‰¯æ¡ç€ä½ çš„æ‰‹ï¼Œçœ¼ç¥åšå®šï¼š'ç­‰æˆ‘åº·å¤ï¼Œæˆ‘ä¸€å®šä¼šæˆä¸ºæœ€å¥½çš„æ•™ç»ƒ...'" },
    { id: "fragment12", title: "é—å¿˜çš„åŸå› ", text: "é‚£æ¬¡æ„å¤–åï¼Œä½ è½¬å­¦ä¸€å¹´ã€‚å›æ¥æ—¶å‘ç°æå›½è‰¯å·²æˆä¸ºæ•™ç»ƒï¼Œè€Œä½ å› äº‹æ•…å¤±å»äº†éƒ¨åˆ†è®°å¿†ã€‚" }
];

// å°†æ–°çš„è®°å¿†ç¢ç‰‡æ·»åŠ åˆ°åŸæœ‰æ•°ç»„
function updateMemoryFragments() {
    // å°†æ–°çš„è®°å¿†ç¢ç‰‡ä¸åŸæœ‰æ•°ç»„åˆå¹¶
    memoryFragmentsData = [...memoryFragmentsData, ...newMemoryFragments];
}

// æ·»åŠ æ–°çš„å‰§æƒ…åœºæ™¯
const newScenes = {
    // æå›½è‰¯ä½œä¸ºå­¦ç”Ÿæ•™ç»ƒçš„æ—¥å¸¸
    "student_coach_practice": function() {
        characterImage.src = characters.guoliang;
        bgImage.src = backgrounds.basketball_court;
        showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°ç¯®çƒåœºï¼Œæå›½è‰¯æ­£åœ¨æŒ‡å¯¼çƒå‘˜ä»¬è®­ç»ƒã€‚è™½ç„¶ä»–æ¯”é˜Ÿå‘˜ä»¬å¤§ä¸äº†å¤šå°‘ï¼Œä½†ä»–çš„ä¸“ä¸šçŸ¥è¯†å’Œä¸¥è‚ƒæ€åº¦è®©æ‰€æœ‰äººéƒ½å¿ƒæœå£æœã€‚");
        setTimeout(() => {
            showDialog("é˜Ÿå‘˜", "ææ•™ç»ƒï¼Œè¿™ä¸ªæˆ˜æœ¯é…åˆæˆ‘ä»¬è¿˜ä¸å¤ªç†Ÿç»ƒï¼Œèƒ½å†ç¤ºèŒƒä¸€ä¸‹å—ï¼Ÿ");
            setTimeout(() => {
                showDialog("æå›½è‰¯", "å¥½ã€‚ï¼ˆæ”¾ä¸‹æˆ˜æœ¯æ¿ï¼Œèµ°ä¸Šçƒåœºï¼‰è¦è¿™æ ·ç§»åŠ¨ï¼Œç„¶å...");
                setTimeout(() => {
                    showDialog("ç³»ç»Ÿ", "æå›½è‰¯äº²è‡ªä¸‹åœºç¤ºèŒƒï¼Œä»–çš„åŠ¨ä½œå¹²è„†åˆ©è½ï¼ŒæŠ€æœ¯å¨´ç†Ÿï¼Œå’Œå…¶ä»–é˜Ÿå‘˜é…åˆé»˜å¥‘ã€‚è¿™ä¸€åˆ»çš„ä»–å……æ»¡æ´»åŠ›å’Œè‡ªä¿¡ï¼Œä¸å¹³æ—¶ä¸¥è‚ƒçš„æ ·å­åˆ¤è‹¥ä¸¤äººã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–æ‰“çƒçš„æ ·å­çœŸè¿·äºº...å®Œå…¨ä¸åƒå¹³æ—¶é‚£æ ·æ²‰é»˜å¯¡è¨€ã€‚", [
                            { text: "ç»§ç»­è§‚çœ‹è®­ç»ƒ", next: "continue_watching" },
                            { text: "é¼“èµ·å‹‡æ°”æ‰“æ‹›å‘¼", next: "greet_during_practice" }
                        ]);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è§‚çœ‹è®­ç»ƒ
    "continue_watching": function() {
        showDialog("ç³»ç»Ÿ", "ä½ é€‰æ‹©å®‰é™åœ°è§‚çœ‹è®­ç»ƒã€‚æå›½è‰¯å¶å°”ä¼šæ‰«è§†åœºè¾¹ï¼Œå½“ä»–æ³¨æ„åˆ°ä½ æ—¶ï¼Œä¼¼ä¹ç•¥å¾®ç‚¹äº†ç‚¹å¤´ã€‚");
        setTimeout(() => {
            showDialog("ç³»ç»Ÿ", "è®­ç»ƒç»“æŸåï¼Œé˜Ÿå‘˜ä»¬ä¸‰ä¸‰ä¸¤ä¸¤åœ°ç¦»å¼€ã€‚æå›½è‰¯ç•™ä¸‹æ¥æ•´ç†å™¨æã€‚");
            setTimeout(() => {
                showDialog("æå›½è‰¯", "ï¼ˆèµ°è¿‘ä½ ï¼‰ä½ ä¸€ç›´åœ¨çœ‹ï¼Ÿ");
                setTimeout(() => {
                    showDialog("ç»“åŸå¤å¥ˆ", "å—¯...ä½ çš„è®­ç»ƒæ–¹å¼å¾ˆä¸“ä¸šï¼Œé˜Ÿå‘˜ä»¬éƒ½å¾ˆå°Šæ•¬ä½ ã€‚", [
                        { text: "è¯¢é—®ä»–çš„æˆ˜æœ¯ç†å¿µ", next: "ask_tactics" },
                        { text: "æåŠä»–çš„çƒæŠ€", next: "mention_skills" }
                    ]);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è®­ç»ƒä¸­æ‰“æ‹›å‘¼
    "greet_during_practice": function() {
        showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼ŒåŠ æ²¹ï¼");
        setTimeout(() => {
            showDialog("ç³»ç»Ÿ", "ä½ çš„å£°éŸ³å¼•èµ·äº†åœºä¸Šäººçš„æ³¨æ„ã€‚æå›½è‰¯è½¬å¤´çœ‹ä½ ï¼Œæœ‰äº›æ„å¤–ä½†æ²¡æœ‰ä¸æ»¡ã€‚");
            setTimeout(() => {
                showDialog("æå›½è‰¯", "ï¼ˆå¯¹é˜Ÿå‘˜ä»¬ï¼‰ç»§ç»­ç»ƒä¹ é‚£ä¸ªé…åˆï¼Œæˆ‘çœ‹åˆ°é—®é¢˜åœ¨å“ªäº†ã€‚");
                setTimeout(() => {
                    showDialog("ç³»ç»Ÿ", "ä»–èµ°åˆ°åœºè¾¹ï¼Œç«™åœ¨ä½ æ—è¾¹ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ç»“åŸåŒå­¦...æœ‰ä»€ä¹ˆäº‹å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æ²¡ä»€ä¹ˆç‰¹åˆ«çš„äº‹ï¼Œå°±æ˜¯...æƒ³çœ‹çœ‹ç¯®çƒè®­ç»ƒæ˜¯æ€ä¹ˆæ ·çš„ã€‚ä½ ä½œä¸ºå­¦ç”Ÿæ•™ç»ƒï¼Œä¸€å®šå‹åŠ›å¾ˆå¤§å§ï¼Ÿ", [
                                { text: "è¡¨è¾¾å¯¹ä»–èƒ½åŠ›çš„é’¦ä½©", next: "express_admiration_skills" },
                                { text: "è¯¢é—®å¦‚ä½•å¹³è¡¡å­¦ä¸šå’Œæ•™ç»ƒå·¥ä½œ", next: "ask_about_balance" }
                            ]);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è¯¢é—®æˆ˜æœ¯ç†å¿µ
    "ask_tactics": function() {
        showDialog("ç»“åŸå¤å¥ˆ", "ä½ çš„æˆ˜æœ¯å®‰æ’å¾ˆæœ‰æ¡ç†ï¼Œèƒ½å‘Šè¯‰æˆ‘ä½ æ˜¯æ€ä¹ˆè®¾è®¡è¿™äº›æˆ˜æœ¯çš„å—ï¼Ÿ");
        setTimeout(() => {
            showDialog("æå›½è‰¯", "ï¼ˆçœ¼ç›äº®èµ·æ¥ï¼‰æ¯ä¸ªæˆ˜æœ¯éƒ½è¦è€ƒè™‘é˜Ÿå‘˜ç‰¹ç‚¹å’Œå¯¹æ‰‹åˆ†æ...");
            setTimeout(() => {
                showDialog("ç³»ç»Ÿ", "æå›½è‰¯å¼€å§‹çƒ­æƒ…åœ°è®²è§£ç¯®çƒæˆ˜æœ¯ï¼Œä»–çš„è¨€è¯­ä¸­å……æ»¡äº†ä¸“ä¸šæœ¯è¯­å’Œç‹¬åˆ°è§è§£ã€‚ä½ å‘ç°å¹³æ—¶æ²‰é»˜çš„ä»–åœ¨è°ˆè®ºç¯®çƒæ—¶å¦‚æ­¤å¥è°ˆã€‚");
                setTimeout(() => {
                    showDialog("æå›½è‰¯", "ï¼ˆçªç„¶åœä¸‹ï¼‰æŠ±æ­‰...è¯´å¤ªå¤šäº†ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ä¸ï¼Œå¾ˆæœ‰è¶£ï¼ä½ å¯¹ç¯®çƒçš„çƒ­æƒ…çœŸçš„å¾ˆæ‰“åŠ¨äººã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆå¾®å¾®ä¸€ç¬‘ï¼‰è°¢è°¢ç†è§£ã€‚å¤§å¤šæ•°äººå¬ä¸æ‡‚å°±èµ°ç¥äº†ã€‚");
                            setTimeout(() => {
                                gameState.affection += 5;
                                updateStatsDisplay();
                                showDialog("ç³»ç»Ÿ", "ä½ ä»¬æœ‰äº†ä¸€æ¬¡å…³äºç¯®çƒçš„æ·±å…¥äº¤æµï¼Œæå›½è‰¯å¯¹ä½ çš„å°è±¡æ˜æ˜¾æ”¹å–„ã€‚å¥½æ„Ÿåº¦+5");
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // æåŠä»–çš„çƒæŠ€
    "mention_skills": function() {
        showDialog("ç»“åŸå¤å¥ˆ", "åˆšæ‰çœ‹ä½ ç¤ºèŒƒåŠ¨ä½œï¼ŒçƒæŠ€çœŸçš„å¾ˆå‰å®³ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©å½“æ•™ç»ƒè€Œä¸æ˜¯ç»§ç»­å½“çƒå‘˜å‘¢ï¼Ÿ");
        setTimeout(() => {
            showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ç•¥å¾®é»¯æ·¡ï¼‰è†ç›–ä¼¤åŠ¿...ä¸èƒ½é«˜å¼ºåº¦æ¯”èµ›äº†ã€‚");
            setTimeout(() => {
                showDialog("ç»“åŸå¤å¥ˆ", "å•Šï¼Œå¯¹ä¸èµ·ï¼æˆ‘ä¸æ˜¯æ•…æ„æèµ·ä¸æ„‰å¿«çš„äº‹ã€‚");
                setTimeout(() => {
                    showDialog("æå›½è‰¯", "æ²¡å…³ç³»ã€‚ï¼ˆç•¥å¾®æ”¾æ¾ï¼‰åšæ•™ç»ƒä¹Ÿæœ‰æ„ä¹‰ï¼Œèƒ½æŠŠçŸ¥è¯†ä¼ æˆç»™ä»–ä»¬ã€‚");
                    setTimeout(() => {
                        showDialog("ç³»ç»Ÿ", "æå›½è‰¯çš„ç›®å…‰å˜å¾—æŸ”å’Œï¼Œä¼¼ä¹åœ¨å›å¿†ä»€ä¹ˆã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "æœ‰äººæ›¾å‘Šè¯‰æˆ‘ï¼Œå¦‚æœä¸èƒ½ä¸Šåœºæ¯”èµ›ï¼Œå°±ç”¨å…¶ä»–æ–¹å¼å®ç°ç¯®çƒæ¢¦æƒ³ã€‚");
                            setTimeout(() => {
                                if (!gameState.memoryFragments.includes('fragment11')) {
                                    gameState.memoryFragments.push('fragment11');
                                }
                                gameState.affection += 4;
                                updateStatsDisplay();
                                showDialog("ç³»ç»Ÿ", "æå›½è‰¯éš¾å¾—åˆ†äº«äº†ä¸ªäººæ•…äº‹ï¼Œä½ ä»¬çš„è·ç¦»æ‹‰è¿‘äº†ã€‚å¥½æ„Ÿåº¦+4");
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è¡¨è¾¾å¯¹èƒ½åŠ›çš„é’¦ä½©
    "express_admiration_skills": function() {
        showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘çœŸçš„å¾ˆä½©æœä½ ï¼Œä¸ä»…æ˜¯æ ¡é˜Ÿçš„å­¦ç”Ÿæ•™ç»ƒï¼Œè¿˜èƒ½å…¼é¡¾è‡ªå·±çš„å­¦ä¸šã€‚è¿™ç§èƒ½åŠ›å’Œè´£ä»»æ„Ÿå¾ˆå°‘è§ã€‚");
        setTimeout(() => {
            showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾ä¸å¥½æ„æ€ï¼‰åªæ˜¯...ä¹ æƒ¯äº†é«˜æ•ˆå®‰æ’æ—¶é—´ã€‚è€Œä¸”ï¼Œç¯®çƒå¯¹æˆ‘æ¥è¯´ä¸åªæ˜¯æ´»åŠ¨ï¼Œæ˜¯çƒ­çˆ±ã€‚");
            setTimeout(() => {
                showDialog("ç»“åŸå¤å¥ˆ", "è¿™ç§å¯¹çƒ­çˆ±çš„åšæŒå¾ˆä»¤äººæ•¬ä½©ã€‚æˆ‘å­¦å•†æ³•ä¹Ÿæ˜¯å› ä¸ºçœŸå¿ƒå–œæ¬¢ã€‚");
                setTimeout(() => {
                    showDialog("æå›½è‰¯", "ï¼ˆè®¤çœŸåœ°çœ‹ç€ä½ ï¼‰åšæŒçƒ­çˆ±çš„äºº...å€¼å¾—å°Šæ•¬ã€‚");
                    setTimeout(() => {
                        gameState.affection += 6;
                        updateStatsDisplay();
                        showDialog("ç³»ç»Ÿ", "ä½ ä»¬æ‰¾åˆ°äº†å…±åŒç‚¹ï¼Œæå›½è‰¯å¯¹ä½ çš„è¯„ä»·æé«˜äº†ã€‚å¥½æ„Ÿåº¦+6");
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è¯¢é—®å¦‚ä½•å¹³è¡¡å­¦ä¸šå’Œå·¥ä½œ
    "ask_about_balance": function() {
        showDialog("ç»“åŸå¤å¥ˆ", "ä½ æ˜¯æ€ä¹ˆå¹³è¡¡å­¦ä¸šå’Œæ•™ç»ƒå·¥ä½œçš„ï¼Ÿä¸€å®šå¾ˆè¾›è‹¦å§ï¼Ÿ");
        setTimeout(() => {
            showDialog("æå›½è‰¯", "æ—¶é—´ç®¡ç†å¾ˆé‡è¦ã€‚ï¼ˆç¨ä½œæ€è€ƒï¼‰å®é™…ä¸Šï¼Œç¯®çƒå’Œå­¦ä¹ å¯¹æˆ‘æ¥è¯´ç›¸è¾…ç›¸æˆã€‚");
            setTimeout(() => {
                showDialog("ç»“åŸå¤å¥ˆ", "ç›¸è¾…ç›¸æˆï¼Ÿæ€ä¹ˆè¯´ï¼Ÿ");
                setTimeout(() => {
                    showDialog("æå›½è‰¯", "ä½“è‚²æ•™è‚²ä¸“ä¸šçš„ç†è®ºåœ¨å®è·µä¸­éªŒè¯ï¼Œå®è·µåˆä¿ƒè¿›ç†è®ºç†è§£ã€‚ä½ çš„å•†æ³•ï¼Œä¹Ÿæœ‰ç±»ä¼¼åº”ç”¨å§ï¼Ÿ");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ç¡®å®ï¼æ¡ˆä¾‹åˆ†æå’Œå®é™…æ³•åŠ¡å·¥ä½œæ˜¯ç›¸é€šçš„ã€‚æ²¡æƒ³åˆ°æˆ‘ä»¬çš„å­¦ä¹ æ–¹å¼æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚");
                        setTimeout(() => {
                            gameState.affection += 5;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "æå›½è‰¯ä¼¼ä¹æ¬£èµä½ å¯¹å­¦ä¹ çš„è®¤çœŸæ€åº¦ï¼Œä½ ä»¬è¾¾æˆäº†æŸç§å…±é¸£ã€‚å¥½æ„Ÿåº¦+5");
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è¯¾å ‚åˆé‡ - è®°å¿†æ¢å¤å…³é”®å‰§æƒ…
    "classroom_first_meeting": function() {
        characterImage.src = characters.natsu;
        bgImage.src = backgrounds.classroom;
        showDialog("ç³»ç»Ÿ", "ä½ ååœ¨å•†æ³•é€‰ä¿®è¯¾æ•™å®¤é‡Œï¼Œæ­£åœ¨æ•´ç†è®²ä¹‰ã€‚çªç„¶ï¼Œæ•™å®¤é—¨å£å‡ºç°äº†ä¸€ä¸ªé«˜å¤§çš„èº«å½±ã€‚");
        setTimeout(() => {
            characterImage.src = characters.guoliang;
            showDialog("ç³»ç»Ÿ", "ä¸€ä¸ªç¯®çƒé˜Ÿæœè£…çš„å­¦ç”Ÿèµ°è¿›æ•™å®¤ï¼Œç¯é¡¾å››å‘¨åï¼Œåœ¨ä½ æ—è¾¹çš„ç©ºä½åä¸‹ã€‚ä»–èº«æé«˜å¤§ï¼Œçœ‹èµ·æ¥æœ‰äº›æ ¼æ ¼ä¸å…¥ã€‚");
            setTimeout(() => {
                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¥½å¥‡ï¼‰ä½ ä¹Ÿé€‰äº†è¿™é—¨è¯¾ï¼Ÿ");
                setTimeout(() => {
                    showDialog("æå›½è‰¯", "ï¼ˆç‚¹å¤´ï¼‰å—¯ï¼Œä½“è‚²æ•™è‚²ä¸“ä¸šä¹Ÿéœ€è¦äº†è§£åˆåŒæ³•å¾‹ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "å“¦ï¼Œæˆ‘æ˜¯å•†æ³•ä¸“ä¸šçš„ã€‚å¦‚æœæœ‰ä¸æ‡‚çš„åœ°æ–¹ï¼Œå¯ä»¥é—®æˆ‘ã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾æƒŠè®¶ï¼‰è°¢è°¢...æˆ‘å«æå›½è‰¯ã€‚");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ˜¯ç»“åŸå¤å¥ˆã€‚ï¼ˆå¾®ç¬‘ï¼‰");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "è¿™æ˜¯ä½ ä»¬ç¬¬ä¸€æ¬¡ç›¸é‡çš„å›å¿†ã€‚åæ¥çš„è¯¾å ‚è¾©è®ºï¼Œå…±åŒå­¦ä¹ ï¼Œåˆé¤çº¦ä¼š...é‚£äº›è¢«é—å¿˜çš„è®°å¿†ç¢ç‰‡å¼€å§‹ä¸²è”èµ·æ¥ã€‚");
                                    setTimeout(() => {
                                        if (!gameState.memoryFragments.includes('fragment8')) {
                                            gameState.memoryFragments.push('fragment8');
                                        }
                                        if (!gameState.memoryFragments.includes('fragment9')) {
                                            gameState.memoryFragments.push('fragment9');
                                        }
                                        gameState.flags.rememberedFirstMeeting = true;
                                        updateStatsDisplay();
                                        showDialog("ç³»ç»Ÿ", "ä½ æƒ³èµ·äº†ä¸æå›½è‰¯åˆæ¬¡ç›¸è¯†çš„åœºæ™¯ã€‚ä¸ºä»€ä¹ˆè¿™äº›è®°å¿†ä¼šè¢«é—å¿˜ï¼Ÿè€Œä»–ä¸ºä»€ä¹ˆä¸æèµ·ä»å‰çš„å…³ç³»ï¼Ÿ");
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // è†ä¼¤äº‹æ•… - è®°å¿†æ¢å¤å…³é”®å‰§æƒ…
    "knee_injury_accident": function() {
        bgImage.src = backgrounds.basketball_court;
        showDialog("ç³»ç»Ÿ", "è®°å¿†ç”»é¢ï¼šä¸€å¹´å‰ï¼Œæå›½è‰¯è¿˜æ˜¯çƒé˜Ÿçš„ç‹ç‰Œçƒå‘˜ï¼Œæ­£åœ¨å‚åŠ é‡è¦æ¯”èµ›ã€‚");
        setTimeout(() => {
            characterImage.src = characters.guoliang;
            showDialog("ç³»ç»Ÿ", "æ¯”èµ›è¿›å…¥æœ€åæ—¶åˆ»ï¼Œçƒé˜Ÿè½åä¸¤åˆ†ã€‚æå›½è‰¯çªç ´å¯¹æ–¹é˜²å®ˆï¼Œè·ƒèµ·å‡†å¤‡æ‰£ç¯®å¾—åˆ†ã€‚");
            setTimeout(() => {
                showDialog("ç³»ç»Ÿ", "å°±åœ¨è¿™æ—¶ï¼Œå¯¹æ–¹çƒå‘˜çš„é˜»æŒ¡è®©ä»–å¤±å»å¹³è¡¡ï¼Œä¸ºäº†é¿å…æ’åˆ°è§‚ä¼—å¸­çš„ä½ ï¼Œä»–æ”¹å˜äº†è½åœ°å§¿åŠ¿ã€‚");
                setTimeout(() => {
                    characterImage.src = characters.natsu;
                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæƒŠæï¼‰å°å¿ƒï¼");
                    setTimeout(() => {
                        showDialog("ç³»ç»Ÿ", "ä¸€å£°æ¸…è„†çš„'å’”åš“'å£°ï¼Œæå›½è‰¯é‡é‡æ‘”åœ¨åœ°ä¸Šï¼Œè†ç›–ä»¥ä¸€ç§ä¸è‡ªç„¶çš„è§’åº¦å¼¯æ›²ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå†²å‘åœºå†…ï¼‰å›½è‰¯ï¼");
                            setTimeout(() => {
                                showDialog("ç³»ç»Ÿ", "ä½ ç¬¬ä¸€ä¸ªå†²åˆ°ä»–èº«è¾¹ï¼Œè„¸ä¸Šæ»¡æ˜¯æ³ªæ°´ã€‚ä»–ç–¼å¾—å†·æ±—ç›´æµï¼Œå´è¿˜æ˜¯å‹‰å¼ºå¯¹ä½ ç¬‘äº†ç¬‘ã€‚");
                                setTimeout(() => {
                                    characterImage.src = characters.guoliang;
                                    showDialog("æå›½è‰¯", "åˆ«...æ‹…å¿ƒï¼Œæ²¡äº‹ã€‚");
                                    setTimeout(() => {
                                        if (!gameState.memoryFragments.includes('fragment10')) {
                                            gameState.memoryFragments.push('fragment10');
                                        }
                                        gameState.flags.rememberedInjury = true;
                                        updateStatsDisplay();
                                        showDialog("ç³»ç»Ÿ", "ä½ ç»ˆäºæƒ³èµ·ï¼Œæå›½è‰¯çš„è†ä¼¤æ˜¯ä¸ºäº†ä¿æŠ¤ä½ è€Œé€ æˆçš„ã€‚è¿™ä¸ªæ²‰é‡çš„è®°å¿†ä¸€ç›´è¢«ä½ æ½œæ„è¯†å‹æŠ‘ç€ã€‚");
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // åŒ»é™¢çº¦å®š - è®°å¿†æ¢å¤å…³é”®å‰§æƒ…
    "hospital_promise": function() {
        bgImage.src = backgrounds.home;
        showDialog("ç³»ç»Ÿ", "è®°å¿†ç”»é¢ï¼šåŒ»é™¢ç—…æˆ¿ï¼Œæå›½è‰¯åˆšåšå®Œæ‰‹æœ¯ï¼Œä½ å®ˆåœ¨ä»–åºŠè¾¹æ•´æ•´ä¸€æ™šã€‚");
        setTimeout(() => {
            characterImage.src = characters.guoliang;
            showDialog("æå›½è‰¯", "ï¼ˆè™šå¼±åœ°ï¼‰åŒ»ç”Ÿè¯´...å¯èƒ½å†ä¹Ÿä¸èƒ½æ‰“çƒäº†ã€‚");
            setTimeout(() => {
                characterImage.src = characters.natsu;
                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæ¡ä½ä»–çš„æ‰‹ï¼‰ä¸€å®šä¼šå¥½èµ·æ¥çš„ï¼Œåˆ«æ”¾å¼ƒï¼");
                setTimeout(() => {
                    characterImage.src = characters.guoliang;
                    showDialog("æå›½è‰¯", "ï¼ˆè‹¦ç¬‘ï¼‰æ²¡æƒ³åˆ°å¤§ä¸€å°±ç»“æŸçƒå‘˜ç”Ÿæ¶¯ã€‚æ‰€æœ‰è®¡åˆ’éƒ½...");
                    setTimeout(() => {
                        characterImage.src = characters.natsu;
                        showDialog("ç»“åŸå¤å¥ˆ", "é‚£å°±æ¢ä¸ªæ–¹å¼ç»§ç»­ï¼ä½ çš„æˆ˜æœ¯åˆ†æèƒ½åŠ›é‚£ä¹ˆå¼ºï¼Œä¸ºä»€ä¹ˆä¸å½“æ•™ç»ƒå‘¢ï¼Ÿ");
                        setTimeout(() => {
                            characterImage.src = characters.guoliang;
                            showDialog("æå›½è‰¯", "æ•™ç»ƒï¼Ÿï¼ˆæ€è€ƒï¼‰å…¶å®...æˆ‘ç¡®å®å¯¹æˆ˜æœ¯ç ”ç©¶æ¯”è¾ƒæœ‰å…´è¶£ã€‚");
                            setTimeout(() => {
                                characterImage.src = characters.natsu;
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘ç›¸ä¿¡ä½ ä¼šæˆä¸ºæœ€æ£’çš„æ•™ç»ƒï¼æˆ‘ä¼šä¸€ç›´æ”¯æŒä½ çš„ã€‚");
                                setTimeout(() => {
                                    characterImage.src = characters.guoliang;
                                    showDialog("æå›½è‰¯", "ï¼ˆè®¤çœŸåœ°ï¼‰å¦‚æœæˆ‘æˆä¸ºæ•™ç»ƒï¼Œä½ å°±ç­”åº”æˆ‘ä¸€ä¸ªæ¡ä»¶ï¼Œå¥½å—ï¼Ÿ");
                                    setTimeout(() => {
                                        characterImage.src = characters.natsu;
                                        showDialog("ç»“åŸå¤å¥ˆ", "ä»€ä¹ˆæ¡ä»¶ï¼Ÿ");
                                        setTimeout(() => {
                                            characterImage.src = characters.guoliang;
                                            showDialog("æå›½è‰¯", "ç­‰æˆ‘åº·å¤...æˆä¸ºæ ¡é˜Ÿæ•™ç»ƒçš„é‚£å¤©ï¼Œä½ ...");
                                            setTimeout(() => {
                                                showDialog("ç³»ç»Ÿ", "è®°å¿†åœ¨è¿™é‡Œçªç„¶ä¸­æ–­ï¼Œä½ æ— æ³•æƒ³èµ·ä»–å½“æ—¶è¯´äº†ä»€ä¹ˆã€‚");
                                                setTimeout(() => {
                                                    if (!gameState.memoryFragments.includes('fragment11')) {
                                                        gameState.memoryFragments.push('fragment11');
                                                    }
                                                    gameState.flags.rememberedPromise = true;
                                                    updateStatsDisplay();
                                                    showDialog("ç³»ç»Ÿ", "é‚£ä¸ªçº¦å®šæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½ ä¼šå¿˜è®°ï¼Ÿè¿™äº›è°œå›¢ä»éœ€è§£å¼€...");
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    },
    
    // çœŸç›¸æ­éœ² - ä¸»çº¿å‰§æƒ…é«˜æ½®
    "truth_revelation": function() {
        bgImage.src = backgrounds.park;
        showDialog("ç³»ç»Ÿ", "å­¦æ ¡æ¨±èŠ±æ ‘ä¸‹ï¼Œä½ é¼“èµ·å‹‡æ°”ç›´æ¥é¢å¯¹æå›½è‰¯ï¼Œè¯¢é—®é‚£äº›è¢«é—å¿˜çš„è®°å¿†ã€‚");
        setTimeout(() => {
            characterImage.src = characters.guoliang;
            showDialog("æå›½è‰¯", "ï¼ˆéœ‡æƒŠï¼‰ä½ ...æƒ³èµ·æ¥äº†ï¼Ÿ");
            setTimeout(() => {
                characterImage.src = characters.natsu;
                showDialog("ç»“åŸå¤å¥ˆ", "éƒ¨åˆ†è®°å¿†å›æ¥äº†ã€‚æˆ‘ä»¬æ›¾ç»å¾ˆäº²å¯†ï¼Œå¯¹å—ï¼Ÿä¸ºä»€ä¹ˆä½ ä¸€ç›´å‡è£…ä¸è®¤è¯†æˆ‘ï¼Ÿ");
                setTimeout(() => {
                    characterImage.src = characters.guoliang;
                    showDialog("æå›½è‰¯", "ï¼ˆæ·±å¸ä¸€å£æ°”ï¼‰ä½ ç¦»å¼€çš„é‚£ä¸€å¹´...æˆ‘æ¯å¤©éƒ½åœ¨æ¢å¤è®­ç»ƒï¼Œå°±ä¸ºäº†å®ç°æ‰¿è¯ºã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "å½“ä½ ç»ˆäºå›åˆ°å­¦æ ¡ï¼Œæˆ‘æ¿€åŠ¨åœ°å»æ‰¾ä½ ï¼Œå´å‘ç°ä½ ...å®Œå…¨ä¸è®°å¾—æˆ‘ã€‚åŒ»ç”Ÿè¯´ä½ çš„è®°å¿†å¯èƒ½éœ€è¦æ—¶é—´ï¼Œæˆ–è€…ç‰¹å®šåˆºæ¿€æ‰èƒ½æ¢å¤ã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "æˆ‘ä¸æƒ³å¼ºè¿«ä½ æƒ³èµ·ç—›è‹¦çš„äº‹ï¼Œæ‰€ä»¥å†³å®šç­‰ä½ è‡ªå·±æ¢å¤è®°å¿†ã€‚");
                            setTimeout(() => {
                                characterImage.src = characters.natsu;
                                showDialog("ç»“åŸå¤å¥ˆ", "ç—›è‹¦çš„äº‹ï¼Ÿä»€ä¹ˆæ„æ€ï¼Ÿ");
                                setTimeout(() => {
                                    characterImage.src = characters.guoliang;
                                    showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ï¼‰ä½ çŸ¥é“æˆ‘çš„è†ä¼¤æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä½†ä½ ä¸çŸ¥é“åæ¥å‘ç”Ÿäº†ä»€ä¹ˆã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ä½ å› ä¸ºè‡ªè´£è¿‡åº¦ï¼Œåœ¨åŒ»é™¢æ¥¼æ¢¯ä¸Šæ‘”å€’ï¼Œå¤´éƒ¨å—ä¼¤ã€‚é‚£æ¬¡äº‹æ•…è®©ä½ å¤±å»äº†éƒ¨åˆ†è®°å¿†ï¼Œå°¤å…¶æ˜¯å’Œæˆ‘...å’Œé‚£æ®µç—›è‹¦ç»å†ç›¸å…³çš„éƒ¨åˆ†ã€‚");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "ä½ çš„çˆ¶æ¯å†³å®šè®©ä½ è½¬å­¦ä¸€å¹´ï¼Œå¸Œæœ›ç¯å¢ƒæ”¹å˜èƒ½å¸®åŠ©æ¢å¤ã€‚");
                                            setTimeout(() => {
                                                if (!gameState.memoryFragments.includes('fragment12')) {
                                                    gameState.memoryFragments.push('fragment12');
                                                }
                                                characterImage.src = characters.natsu;
                                                showDialog("ç»“åŸå¤å¥ˆ", "æ‰€ä»¥...æˆ‘å¿˜è®°äº†æˆ‘ä»¬çš„å…³ç³»ï¼Œæ˜¯å› ä¸ºé‚£æ¬¡äº‹æ•…ï¼Ÿ");
                                                setTimeout(() => {
                                                    characterImage.src = characters.guoliang;
                                                    showDialog("æå›½è‰¯", "ï¼ˆç‚¹å¤´ï¼‰æ˜¯çš„ã€‚æˆ‘æœ¬æƒ³ç»™ä½ æ—¶é—´ï¼Œæ²¡æƒ³åˆ°ä½ åˆå¼€å§‹æ¥è¿‘æˆ‘ï¼Œå°±åƒå‘½è¿çš„å®‰æ’ä¸€æ ·ã€‚");
                                                    setTimeout(() => {
                                                        showDialog("æå›½è‰¯", "æˆ‘ä¸€ç›´åœ¨ç­‰å¾…ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå‘Šè¯‰ä½ çœŸç›¸ã€‚");
                                                        setTimeout(() => {
                                                            characterImage.src = characters.natsu;
                                                            showDialog("ç»“åŸå¤å¥ˆ", "é‚£ä¸ªçº¦å®š...ä½ åœ¨åŒ»é™¢è¯´çš„é‚£ä¸ªæ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ");
                                                            setTimeout(() => {
                                                                characterImage.src = characters.guoliang;
                                                                showDialog("æå›½è‰¯", "ï¼ˆå¾®ç¬‘ï¼‰æˆ‘è¯´ï¼Œ'å¦‚æœæˆ‘æˆä¸ºæ•™ç»ƒï¼Œä½ å°±ç­”åº”åšæˆ‘çš„å¥³æœ‹å‹'ã€‚");
                                                                setTimeout(() => {
                                                                    characterImage.src = characters.natsu;
                                                                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆçœ¼æ³ªæ¶Œå‡ºï¼‰å¤©å•Š...æˆ‘å±…ç„¶å¿˜è®°äº†è¿™ä¹ˆé‡è¦çš„äº‹...");
                                                                    setTimeout(() => {
                                                                        gameState.flags.truthRevealed = true;
                                                                        gameState.affection = 95; // çœŸç›¸æ­éœ²ï¼Œå¥½æ„Ÿåº¦å¤§å¹…æå‡
                                                                        gameState.relationshipStatus = "æ‹äºº";
                                                                        updateStatsDisplay();
                                                                        showDialog("ç³»ç»Ÿ", "çœŸç›¸ç»ˆäºæ­éœ²ï¼Œä½ å’Œæå›½è‰¯é‡æ–°ç¡®è®¤äº†æ„Ÿæƒ…ã€‚å…¨éƒ¨è®°å¿†ç¢ç‰‡å·²æ”¶é›†ï¼Œæ¸¸æˆä¸»çº¿å®Œæˆï¼");
                                                                        unlockAchievement("çœŸçˆ±æ°¸æ’", "æ­å¼€äº†ä¸æå›½è‰¯ä¹‹é—´çš„å…¨éƒ¨çœŸç›¸");
                                                                    }, 2000);
                                                                }, 2000);
                                                            }, 2000);
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                }, 2000);
            }, 2000);
        }, 2000);
    }
};
        
        // Game initialization
        // å°†DOMå…ƒç´ è·å–ç§»åˆ°window.onloadå†…éƒ¨ï¼Œå¹¶ä½¿ç”¨JavaScriptæ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        window.onload = function() {
            // è·å–DOMå…ƒç´ 
            const loadingScreen = document.getElementById('loading-screen');
            const menuOverlay = document.getElementById('menu-overlay');
            const dialogBox = document.getElementById('dialog-box');
            const characterName = document.getElementById('character-name');
            const dialogText = document.getElementById('dialog-text');
            const choicesContainer = document.getElementById('choices-container');
            const characterImage = document.getElementById('character-image');
            const bgImage = document.getElementById('bg-image');
            // ...å…¶ä»–DOMå…ƒç´ è·å–
            
            // å°†DOMå…ƒç´ å­˜å‚¨åœ¨å…¨å±€å¯¹è±¡ä¸­ä¾›å…¶ä»–å‡½æ•°è®¿é—®
            window.gameDOM = {
                loadingScreen,
                menuOverlay,
                dialogBox,
                characterName,
                dialogText,
                choicesContainer,
                characterImage,
                bgImage,
                // ...å…¶ä»–DOMå…ƒç´ 
            };
            
            // ä¸ºåˆå§‹ç•Œé¢çš„æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const startButton = document.querySelector('#choices-container button:nth-child(1)');
            const helpButton = document.querySelector('#choices-container button:nth-child(2)');
            
            if(startButton) startButton.addEventListener('click', () => makeChoice(0));
            if(helpButton) helpButton.addEventListener('click', showHelp);
            
            // æ¨¡æ‹ŸåŠ è½½
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                startGame();
            }, 2000);
            
            // Menu button event
            document.getElementById('menu-button').addEventListener('click', toggleMenu);
            
            // Update initial stats display
            updateStatsDisplay();
            
            // Adjust dialog box position for mobile
            window.addEventListener('resize', adjustDialogBoxPosition);
            adjustDialogBoxPosition();
        };
        
        // Adjust dialog box position based on screen size
        function adjustDialogBoxPosition() {
            const actionBar = document.getElementById('action-bar');
            if (actionBar && dialogBox) {
                const actionBarHeight = actionBar.offsetHeight;
                dialogBox.style.bottom = actionBarHeight + 'px';
            }
        }

        // Scene renderer - handles different story scenes
        function renderScene(sceneId) {
            gameState.currentScene = sceneId;
            
            switch(sceneId) {
                case "intro":
                    characterImage.src = characters.natsu;
                    bgImage.src = backgrounds.home;
                    showDialog("ç³»ç»Ÿ", "æ¬¢è¿æ¥åˆ°å›½è‰¯è¯±æ•å™¨ï¼åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä½ å°†æ‰®æ¼”ç»“åŸå¤å¥ˆï¼Œä¸€ä¸ªå¯¹å¤§å­¦ç¯®çƒé˜Ÿæ•™ç»ƒæå›½è‰¯ç—´è¿·çš„å¥³å­©ã€‚ä½ çš„ç›®æ ‡æ˜¯èµ¢å¾—ä»–çš„å¿ƒï¼", [
                        { text: "å¼€å§‹æ¸¸æˆ", next: "day1_morning" },
                        { text: "æ¸¸æˆè¯´æ˜", next: null }
                    ]);
                    break;
                    
                case "day1_morning":
                    characterImage.src = characters.natsu;
                    bgImage.src = backgrounds.home;
                    showDialog("ç³»ç»Ÿ", "ç¬¬ä¸€å¤©ï¼Œæ—©æ™¨ã€‚é˜³å…‰é€è¿‡çª—å¸˜æ´’åœ¨ä½ çš„åºŠä¸Šï¼Œæ–°çš„ä¸€å¤©å¼€å§‹äº†ã€‚ä½ æ˜¯ç»“åŸå¤å¥ˆï¼Œä¸€åå¤§å­¦äºŒå¹´çº§å•†å­¦é™¢å­¦ç”Ÿï¼Œä¸“æ”»å•†æ³•ã€‚ä½ å¯¹åŒæ ¡çš„ç¯®çƒé˜Ÿæ•™ç»ƒæå›½è‰¯æœ‰ç€ä¸å¯è¨€è¯´çš„è¿·æ‹ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆè‡ªè¨€è‡ªè¯­ï¼‰æå›½è‰¯æ•™ç»ƒ...é‚£åŒä¸“æ³¨çš„çœ¼ç›ï¼Œé‚£å¼ºå£®çš„èº«æï¼Œè¿˜æœ‰é‚£å†·å³»çš„è¡¨æƒ…...ç®€ç›´å°±æ˜¯æˆ‘çš„ç†æƒ³å‹ï¼ä»Šå¤©ä¸€å®šè¦é¼“èµ·å‹‡æ°”å»è§ä»–ï¼å¬è¯´ä»–æ¯å¤©æ—©ä¸Šéƒ½ä¼šåœ¨ç¯®çƒåœºè®­ç»ƒçƒå‘˜ã€‚", [
                            { text: "ç«‹åˆ»å‰å¾€ç¯®çƒåœº", next: "goto_court" },
                            { text: "å…ˆæ•´ç†ä¸€ä¸‹ä»ªå®¹", next: "prepare_first" },
                            { text: "æŸ¥é˜…ä¸€äº›ç¯®çƒçŸ¥è¯†", next: "study_basketball" }
                        ]);
                    }, 2000);
                    break;
                    
                case "prepare_first":
                    showDialog("ç»“åŸå¤å¥ˆ", "è™½ç„¶ææ•™ç»ƒçœ‹èµ·æ¥å†·å†°å†°çš„ï¼Œä½†ç¬¬ä¸€å°è±¡è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼æˆ‘å¾—æ‰“æ‰®å¾—å¥½çœ‹ä¸€ç‚¹ï¼", [
                        { text: "ç®€å•æ¢³å¦†æ‰“æ‰®ï¼ˆ+1é­…åŠ›ï¼‰", next: "goto_court" },
                        { text: "ç²¾å¿ƒæ‰“æ‰®ï¼ˆ+3é­…åŠ›ï¼Œä½†ä¼šè¿Ÿåˆ°ï¼‰", next: "late_arrival" }
                    ]);
                    break;
                    
                case "study_basketball":
                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å¯¹ç¯®çƒå‡ ä¹ä¸€çªä¸é€šï¼Œè‡³å°‘åº”è¯¥äº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†å†å»è§ä»–å§ï¼Ÿ");
                    setTimeout(() => {
                        gameState.stats.basketball += 3;
                        updateStatsDisplay();
                        showDialog("ç³»ç»Ÿ", "ä½ èŠ±äº†ä¸€äº›æ—¶é—´æŸ¥é˜…ç¯®çƒè§„åˆ™å’Œæœ¯è¯­ã€‚ç¯®çƒçŸ¥è¯†+3");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ä¸‰ç§’åŒºã€ä¸­é”‹ã€æŒ¡æ‹†ã€ç©ºåˆ‡...å¤©å•Šï¼Œè¿™äº›æœ¯è¯­å¥½éš¾è®°ï¼ä¸è¿‡è‡³å°‘æœ‰ç‚¹æ¦‚å¿µäº†ã€‚ç°åœ¨è¯¥å‡ºå‘äº†ï¼", [
                                { text: "å‰å¾€ç¯®çƒåœº", next: "goto_court" }
                            ]);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "goto_court":
                    gameState.currentLocation = 'basketball_court';
                    bgImage.src = backgrounds.basketball_court;
                    showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°äº†ç¯®çƒåœºã€‚çƒå‘˜ä»¬æ­£åœ¨è¿›è¡Œæ¿€çƒˆçš„è®­ç»ƒï¼Œæ±—æ°´åœ¨é˜³å…‰ä¸‹é—ªçƒã€‚è€Œåœ¨åœºè¾¹ï¼Œç«™ç€ä¸€ä¸ªé«˜å¤§çš„èº«å½±â€”â€”æå›½è‰¯æ•™ç»ƒï¼Œä»–å£®å®çš„èº«æå’Œå†·å³»çš„è¡¨æƒ…è®©äººä¸æ•¢è½»æ˜“æ¥è¿‘ã€‚");
                    setTimeout(() => {
                        renderScene("first_meeting");
                    }, 2000);
                    break;
                    
                case "late_arrival":
                    gameState.stats.charm += 3;
                    gameState.currentLocation = 'basketball_court';
                    bgImage.src = backgrounds.basketball_court;
                    showDialog("ç³»ç»Ÿ", "ä½ ç²¾å¿ƒæ‰“æ‰®äº†ä¸€ç•ªï¼Œçœ‹èµ·æ¥å…‰å½©ç…§äººï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œå½“ä½ åˆ°è¾¾ç¯®çƒåœºæ—¶ï¼Œæ™¨ç»ƒå·²ç»ç»“æŸäº†ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "å•Šï¼Œæ™šäº†ä¸€æ­¥...ä¸è¿‡æˆ‘çœ‹åˆ°ææ•™ç»ƒæ­£åœ¨æ”¶æ‹¾å™¨æï¼Œä¹Ÿè®¸è¿˜æœ‰æœºä¼šï¼", [
                            { text: "ä¸Šå‰æ‰“æ‹›å‘¼", next: "first_meeting_late" },
                            { text: "é»˜é»˜è§‚å¯Ÿ", next: "observe_silently" }
                        ]);
                    }, 2000);
                    break;
                    
                case "first_meeting":
                    characterImage.src = characters.guoliang;
                    showDialog("ç³»ç»Ÿ", "ä½ é¼“èµ·å‹‡æ°”ï¼Œèµ°å‘åœºè¾¹çš„ææ•™ç»ƒã€‚è¿‘è·ç¦»çœ‹ä»–æ›´åŠ ä»¤äººéœ‡æ’¼â€”â€”èº«é«˜è‡³å°‘ä¸€ç±³ä¹ï¼Œè‚Œè‚‰çº¿æ¡åˆ†æ˜ï¼Œçœ‰å®‡é—´é€ç€ä¸€è‚¡ä¸æ€’è‡ªå¨çš„æ°”åŠ¿ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰å¤©å•Šï¼Œä»–æ¯”æˆ‘æƒ³è±¡çš„è¿˜è¦å®Œç¾...é‚£è‡‚è†€ï¼Œé‚£èº«æï¼Œç»å¯¹æ˜¯ç”Ÿå­©å­çš„å¥½ææ–™ï¼ä¸è¡Œä¸è¡Œï¼Œç°åœ¨ä¸æ˜¯èƒ¡æ€ä¹±æƒ³çš„æ—¶å€™ï¼Œè¯¥è¯´äº›ä»€ä¹ˆå‘¢ï¼Ÿ", [
                            { text: "ç›´æ¥é—®å¥½", next: "direct_greeting" },
                            { text: "è¯¢é—®ç¯®çƒè®­ç»ƒ", next: "ask_about_training" },
                            { text: "è£…ä½œå¶é‡", next: "pretend_coincidence" }
                        ]);
                    }, 2000);
                    break;
                    
                case "first_meeting_late":
                    characterImage.src = characters.guoliang;
                    showDialog("æå›½è‰¯", "è®­ç»ƒå·²ç»ç»“æŸäº†ã€‚", [
                        { text: "è‡ªæˆ‘ä»‹ç»", next: "introduce_self_late" },
                        { text: "æå‡ºå¸®å¿™", next: "offer_help_late" }
                    ]);
                    break;
                    
                case "direct_greeting":
                    showDialog("ç»“åŸå¤å¥ˆ", "æ—©...æ—©ä¸Šå¥½ï¼Œææ•™ç»ƒã€‚æˆ‘æ˜¯ç»“åŸå¤å¥ˆï¼ŒäºŒå¹´çº§å•†å­¦é™¢çš„å­¦ç”Ÿã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "æ—©ä¸Šå¥½ã€‚", [
                            { text: "è¡¨è¾¾å¯¹ç¯®çƒçš„å…´è¶£", next: "express_interest" },
                            { text: "å¦è¯šåœ°è¡¨è¾¾å¯¹ä»–çš„ä»°æ…•", next: "express_admiration" },
                            { text: "è¯¢é—®æ•™ç»ƒæ—¥ç¨‹", next: "ask_schedule" }
                        ]);
                    }, 2000);
                    break;
                    
                case "ask_about_training":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œæˆ‘å¯¹ç¯®çƒå¾ˆæ„Ÿå…´è¶£ã€‚èƒ½å’Œæˆ‘èŠèŠçƒé˜Ÿçš„è®­ç»ƒæ–¹æ³•å—ï¼Ÿ");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ä½ æ‰“ç¯®çƒï¼Ÿ", [
                            { text: "å¦ç™½ä¸å¤ªä¼šæ‰“", next: "admit_no_skills" },
                            { text: "è¡¨ç°å‡ºå¼ºçƒˆçš„å­¦ä¹ æ¬²æœ›", next: "want_to_learn" },
                            { text: "è°ç§°è‡ªå·±ä¼šä¸€ç‚¹", next: "lie_about_skills" }
                        ]);
                    }, 2000);
                    break;
                    
                case "pretend_coincidence":
                    showDialog("ç»“åŸå¤å¥ˆ", "å•Šï¼Œè¿™ä¸æ˜¯ææ•™ç»ƒå—ï¼ŸçœŸå·§ï¼Œæˆ‘æ­£å¥½è·¯è¿‡ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆæŠ•æ¥æ€€ç–‘çš„çœ¼ç¥ï¼‰è¿™ä¹ˆæ—©å°±'è·¯è¿‡'ç¯®çƒåœºï¼Ÿ", [
                            { text: "å°´å°¬åœ°æ”¹å£", next: "change_topic_embarrassed" },
                            { text: "åšæŒè°è¨€", next: "maintain_lie" },
                            { text: "æ‰¿è®¤æ˜¯ç‰¹æ„æ¥çš„", next: "admit_intentional_visit" }
                        ]);
                    }, 2000);
                    break;
                    
                case "express_interest":
                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å¾ˆå–œæ¬¢ç¯®çƒï¼Œä¸€ç›´å…³æ³¨æ ¡é˜Ÿçš„æ¯”èµ›ã€‚ä½ çš„æŒ‡å¯¼è®©çƒé˜Ÿè¿›æ­¥å¾ˆå¤§ã€‚è™½ç„¶æˆ‘è‡ªå·±ä¸å¤ªä¼šæ‰“ï¼Œä½†ä¸€ç›´æƒ³äº†è§£æ›´å¤šã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "å¯¹ç¯®çƒæ„Ÿå…´è¶£ï¼Ÿï¼ˆçœ¼ä¸­é—ªè¿‡ä¸€ä¸æ„å¤–ï¼‰å¥½ç°è±¡ã€‚å¹´è½»äººåº”è¯¥å¤šæ¥è§¦ä½“è‚²è¿åŠ¨ã€‚");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 3;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¼¼ä¹å¯¹ä½ çš„ç¯®çƒå…´è¶£æœ‰äº›æ¬£èµã€‚å¥½æ„Ÿåº¦+3");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "express_admiration":
                    showDialog("ç»“åŸå¤å¥ˆ", "å®é™…ä¸Š...æˆ‘ä¸€ç›´å¾ˆä»°æ…•ä½ ã€‚ä½ ä½œä¸ºæ•™ç»ƒçš„é£æ ¼å’Œå†³æ–­åŠ›è®©æˆ‘å¾ˆæ•¬ä½©ã€‚è¿˜æœ‰ä½ çš„...å‘ƒ...ä½“æ ¼å¾ˆå‡ºä¼—...");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆçœ‰å¤´å¾®çš±ï¼‰...è°¢è°¢ã€‚ï¼ˆæ˜æ˜¾æœ‰äº›å°´å°¬ï¼‰ä¸è¿‡æˆ‘åªæ˜¯åšå¥½è‡ªå·±çš„å·¥ä½œã€‚");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 1;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ä½ çš„ç›´ç™½è®©ææ•™ç»ƒæœ‰äº›æªæ‰‹ä¸åŠã€‚å¥½æ„Ÿåº¦å¾®å¾®æå‡ã€‚");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "ask_schedule":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹çƒé˜Ÿçš„è®­ç»ƒæ—¶é—´è¡¨ã€‚æ–¹ä¾¿çš„è¯ï¼Œæˆ‘æƒ³æ¥è§‚æ‘©å­¦ä¹ ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆå®¡è§†äº†ä½ ä¸€ä¼šå„¿ï¼‰æˆ‘ä»¬å‘¨ä¸€ã€ä¸‰ã€äº”æ—©ä¸Šæœ‰æ™¨ç»ƒï¼Œå¤§å¤šæ•°ä¸‹åˆéƒ½æœ‰è®­ç»ƒã€‚æœ‰ç‰¹åˆ«çš„åŸå› æƒ³äº†è§£ï¼Ÿ");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 2;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒå¯¹ä½ çš„é—®é¢˜æœ‰äº›è°¨æ…ï¼Œä½†è¿˜æ˜¯å›ç­”äº†ã€‚å¥½æ„Ÿåº¦+2");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "admit_no_skills":
                    showDialog("ç»“åŸå¤å¥ˆ", "è€å®è¯´ï¼Œæˆ‘ä¸å¤ªä¼šæ‰“ç¯®çƒã€‚å•†ç§‘å­¦ç”Ÿå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç ”ç©¶æ¡ˆä¾‹åˆ†æï¼Œå¾ˆå°‘æœ‰æœºä¼šæ¥è§¦ä½“è‚²æ´»åŠ¨...");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆç•¥å¾®ç‚¹å¤´ï¼‰è¯šå®å¾ˆå¥½ã€‚ç¯®çƒéœ€è¦æ—¶é—´ç»ƒä¹ ï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½é€‚åˆã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¼¼ä¹æ¬£èµä½ çš„è¯šå®ã€‚");
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 2;
                            updateStatsDisplay();
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "want_to_learn":
                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘ä¸å¤ªä¼šæ‰“ï¼Œä½†æˆ‘çœŸçš„å¾ˆæƒ³å­¦ï¼çœ‹åˆ°çƒå‘˜ä»¬åœ¨åœºä¸Šçš„é…åˆï¼Œé‚£ç§å›¢é˜Ÿç²¾ç¥å’Œæ¿€æƒ…çœŸçš„å¾ˆå¸å¼•æˆ‘ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆå®¡è§†åœ°çœ‹ç€ä½ ï¼‰å­¦ä¹ ç¯®çƒéœ€è¦æ—¶é—´å’Œæ¯…åŠ›ã€‚ï¼ˆåœé¡¿ç‰‡åˆ»ï¼‰å¦‚æœçœŸæœ‰å…´è¶£ï¼Œå¯ä»¥ä»åŸºæœ¬è§„åˆ™å¼€å§‹äº†è§£ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–æ²¡æœ‰ç›´æ¥æ‹’ç»æˆ‘ï¼è¿™æ˜¯ä¸ªå¥½å…†å¤´ï¼");
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 3;
                            updateStatsDisplay();
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "lie_about_skills":
                    showDialog("ç»“åŸå¤å¥ˆ", "å—¯ï¼Œæˆ‘ä¼šä¸€ç‚¹ç‚¹ã€‚è™½ç„¶æ°´å¹³ä¸é«˜ï¼Œä½†åŸºæœ¬è§„åˆ™å’ŒæŠ€å·§è¿˜æ˜¯æ‡‚çš„ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "æ˜¯å—ï¼Ÿï¼ˆçªç„¶æ‹¿èµ·ä¸€ä¸ªç¯®çƒé€’ç»™ä½ ï¼‰é‚£ç¤ºèŒƒä¸€ä¸‹åŸºæœ¬æŠ•ç¯®å§¿åŠ¿ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæ…Œï¼‰å•Š...è¿™ä¸ª...ï¼ˆä½ ç¬¨æ‹™åœ°æ¨¡ä»¿æŠ•ç¯®åŠ¨ä½œï¼Œçƒå®Œå…¨è„±ç¦»é¢„æœŸè½¨é“ï¼‰");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆé¢æ— è¡¨æƒ…ï¼‰ä»¥åæ¥çƒåœºï¼Œè¯šå®ç‚¹ä¼šæ›´å¥½ã€‚");
                                setTimeout(() => {
                                    gameState.flags.metGuoliang = true;
                                    gameState.affection -= 2; // æ’’è°å¯¼è‡´å¥½æ„Ÿåº¦ä¸‹é™
                                    updateStatsDisplay();
                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¸å–œæ¬¢ä½ çš„ä¸è¯šå®ã€‚å¥½æ„Ÿåº¦-2");
                                    unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯...è™½ç„¶æœ‰äº›å°´å°¬");
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "change_topic_embarrassed":
                    showDialog("ç»“åŸå¤å¥ˆ", "å‘ƒ...å…¶å®...ï¼ˆè„¸çº¢ï¼‰å¥½å§ï¼Œæˆ‘æ˜¯ç‰¹æ„æ¥çœ‹çƒé˜Ÿè®­ç»ƒçš„ã€‚æˆ‘å¯¹ç¯®çƒå¾ˆæ„Ÿå…´è¶£ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆå¾®å¾®ç‚¹å¤´ï¼‰æ¯”èµ·ç¼–æ•…äº‹ï¼Œè¯šå®æ›´å€¼å¾—å°Šé‡ã€‚è®­ç»ƒè¿˜æœ‰åŠå°æ—¶ç»“æŸï¼Œå¯ä»¥åœ¨åœºè¾¹è§‚çœ‹ã€‚");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 2;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒå¯¹ä½ æœ€ç»ˆçš„è¯šå®è¡¨ç¤ºè®¤å¯ã€‚å¥½æ„Ÿåº¦+2");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "maintain_lie":
                    showDialog("ç»“åŸå¤å¥ˆ", "æ˜¯å•Šï¼Œæˆ‘ç»å¸¸è¿™ä¸ªæ—¶é—´æ¥å›¾ä¹¦é¦†ï¼Œæ‰€ä»¥ä¼šè·¯è¿‡çƒåœºã€‚ä»Šå¤©åˆšå¥½çœ‹åˆ°ä½ åœ¨è®­ç»ƒçƒé˜Ÿï¼Œå°±å¤šçœ‹äº†ä¸€ä¼šå„¿ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆçœ¼ç¥ä¸­å¸¦ç€ä¸ä¿¡ä»»ï¼‰å›¾ä¹¦é¦†åœ¨æ ¡åŒºå¦ä¸€è¾¹ã€‚ï¼ˆè½¬èº«ç»§ç»­å·¥ä½œï¼‰");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection -= 1;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒçœ‹ç©¿äº†ä½ çš„è°è¨€ï¼Œå¯¹ä½ çš„å°è±¡ä¸å¤ªå¥½ã€‚å¥½æ„Ÿåº¦-1");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "ä¸æå›½è‰¯çš„é¦–æ¬¡å¯¹è¯å¹¶ä¸é¡ºåˆ©");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "admit_intentional_visit":
                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæ·±å‘¼å¸ï¼‰å…¶å®æˆ‘æ˜¯ç‰¹æ„æ¥çš„...æˆ‘ä¸€ç›´å¾ˆä»°æ…•ä½ ä½œä¸ºæ•™ç»ƒçš„æˆå°±ï¼Œæƒ³äº²çœ¼çœ‹çœ‹ä½ æ˜¯å¦‚ä½•è®­ç»ƒçƒé˜Ÿçš„ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ç•¥å¾®ç¼“å’Œï¼‰è‡³å°‘ä½ å¤Ÿå¦è¯šã€‚ï¼ˆç¨ä½œåœé¡¿ï¼‰å¦‚æœå¯¹ç¯®çƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥ç•™ä¸‹æ¥è§‚æ‘©ã€‚");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 3;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒæ¬£èµä½ çš„ç›´æ¥å’Œè¯šå®ã€‚å¥½æ„Ÿåº¦+3");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "introduce_self_late":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒä½ å¥½ï¼Œæˆ‘æ˜¯ç»“åŸå¤å¥ˆï¼Œå•†å­¦é™¢äºŒå¹´çº§çš„å­¦ç”Ÿã€‚æˆ‘å¯¹ç¯®çƒå¾ˆæ„Ÿå…´è¶£ï¼Œç‰¹æ„æ¥çœ‹è®­ç»ƒçš„ï¼Œæ²¡æƒ³åˆ°æ¥æ™šäº†...");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆä¸€è¾¹æ•´ç†å™¨æï¼‰æ˜å¤©æ—©ä¸Šä¸ƒç‚¹ï¼Œå‡†æ—¶ã€‚å¦‚æœçœŸå¯¹ç¯®çƒæ„Ÿå…´è¶£ï¼Œå®ˆæ—¶æ˜¯åŸºæœ¬ç´ è´¨ã€‚");
                        setTimeout(() => {
                            gameState.flags.metGuoliang = true;
                            gameState.affection += 1;
                            updateStatsDisplay();
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒå¯¹ä½ è¿Ÿåˆ°æœ‰äº›ä¸æ»¡ï¼Œä½†é‚€è¯·ä½ æ˜å¤©å†æ¥ã€‚å¥½æ„Ÿåº¦+1");
                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "offer_help_late":
                    showDialog("ç»“åŸå¤å¥ˆ", "éœ€è¦å¸®å¿™æ•´ç†å™¨æå—ï¼Ÿæˆ‘çœ‹ä½ ä¸€ä¸ªäººæ”¶æ‹¾è¿™ä¹ˆå¤šä¸œè¥¿æŒºè¾›è‹¦çš„ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆæŠ¬å¤´çœ‹äº†ä½ ä¸€çœ¼ï¼‰...å¯ä»¥æŠŠé‚£è¾¹çš„çƒæ”¶åˆ°æ¨è½¦é‡Œã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ å¸®ææ•™ç»ƒæ”¶æ‹¾äº†è®­ç»ƒå™¨æï¼ŒæœŸé—´ä»–å‡ æ¬¡æŠ•æ¥å®¡è§†çš„ç›®å…‰ï¼Œä¼¼ä¹åœ¨è¯„ä¼°ä½ çš„åšäº‹æ–¹å¼ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "è°¢è°¢å¸®å¿™ã€‚ä½ æ˜¯ï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ˜¯ç»“åŸå¤å¥ˆï¼Œå•†å­¦é™¢äºŒå¹´çº§çš„å­¦ç”Ÿã€‚æˆ‘å¯¹ç¯®çƒå¾ˆæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æƒ³æ¥çœ‹çœ‹è®­ç»ƒã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "æ˜å¤©æ—©ä¸Šä¸ƒç‚¹ï¼Œå¦‚æœæƒ³çœ‹è®­ç»ƒçš„è¯ã€‚");
                                        setTimeout(() => {
                                            gameState.flags.metGuoliang = true;
                                            gameState.affection += 4;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ä½ çš„ä¸»åŠ¨å¸®å¿™ç»™ææ•™ç»ƒç•™ä¸‹äº†å¥½å°è±¡ã€‚å¥½æ„Ÿåº¦+4");
                                            unlockAchievement("åˆæ¬¡ä¼šé¢", "æˆåŠŸä¸æå›½è‰¯è¿›è¡Œç¬¬ä¸€æ¬¡å¯¹è¯");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "observe_silently":
                    showDialog("ç³»ç»Ÿ", "ä½ å†³å®šåœ¨è¿œå¤„é»˜é»˜è§‚å¯Ÿææ•™ç»ƒã€‚ä»–åŠ¨ä½œå¹²ç»ƒåœ°æ”¶æ‹¾ç€è®­ç»ƒå™¨æï¼Œå¼ºå£®çš„æ‰‹è‡‚è‚Œè‚‰éšç€åŠ¨ä½œèµ·ä¼ã€‚å³ä½¿æ˜¯åšè¿™æ ·ç®€å•çš„å·¥ä½œï¼Œä»–ä¹Ÿé€å‡ºä¸€ç§ä¸å®¹å°è§‘çš„æ°”åœºã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–è¿æ•´ç†å™¨æçš„æ ·å­éƒ½è¿™ä¹ˆå¸…æ°”...é‚£ä¸“æ³¨çš„ç¥æƒ…ï¼Œé‚£è®¤çœŸçš„æ€åº¦...");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "çªç„¶ï¼Œææ•™ç»ƒæŠ¬å¤´å‘ä½ çš„æ–¹å‘çœ‹äº†ä¸€çœ¼ã€‚ä½ æ…Œå¿™è½¬èº«ï¼Œå‡è£…åœ¨çœ‹å…¶ä»–åœ°æ–¹ã€‚");
                            setTimeout(() => {
                                showDialog("ç³»ç»Ÿ", "ä½ æ²¡æœ‰å‹‡æ°”ä¸Šå‰æ‰“æ‹›å‘¼ï¼Œæœ€ç»ˆç¦»å¼€äº†çƒåœºã€‚ä»Šå¤©çš„ç›¸é‡ä»¥å¤±è´¥å‘Šç»ˆã€‚");
                                setTimeout(() => {
                                    gameState.mood = "å¤±è½";
                                    updateStatsDisplay();
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "first_gift":
                    showDialog("æå›½è‰¯", "ï¼ˆæ¥è¿‡ç¤¼ç‰©ï¼Œå¼ºå£®çš„æ‰‹æŒ‡è½»è½»è§¦ç¢°ç¤¼ç‰©è¡¨é¢ï¼‰è°¢è°¢...è¿™ä¸ªå¾ˆå®ç”¨ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–æ”¶ä¸‹äº†ï¼è™½ç„¶è¡¨æƒ…ä¾æ—§å†°å†·ï¼Œä½†æˆ‘æ„Ÿè§‰ä»–çš„çœ¼ç¥æŸ”å’Œäº†ä¸€äº›ï¼");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒæ”¶ä¸‹äº†ä½ çš„ç¤¼ç‰©ï¼Œå¥½æ„Ÿåº¦æå‡ï¼");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾å›°æƒ‘ï¼‰ä¸è¿‡ï¼Œä¸ºä»€ä¹ˆé€æˆ‘ç¤¼ç‰©ï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "å‘ƒ...æˆ‘è§‰å¾—æ•™ç»ƒå·¥ä½œå¾ˆè¾›è‹¦ï¼Œæƒ³è¡¨è¾¾ä¸€ä¸‹æ•¬æ„ã€‚è€Œä¸”...ï¼ˆè„¸çº¢ï¼‰æˆ‘æŒºæ¬£èµä½ çš„ã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆæ²‰é»˜ç‰‡åˆ»ï¼‰...è°¢è°¢ã€‚ï¼ˆä¼¼ä¹ä¸å¤ªä¹ æƒ¯è¢«äººç›´æ¥è¡¨è¾¾å¥½æ„Ÿï¼‰æˆ‘å¾—å»è®­ç»ƒäº†ã€‚");
                                        setTimeout(() => {
                                            gameState.affection += 5;
                                            updateStatsDisplay();
                                        }, 1000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "cafe_encounter":
                    characterImage.src = characters.guoliang;
                    showDialog("ç³»ç»Ÿ", "æ­£å½“ä½ æ‰“ç®—æ‰¾ä¸ªä½ç½®åä¸‹æ—¶ï¼Œä½ æƒŠè®¶åœ°å‘ç°æå›½è‰¯æ•™ç»ƒç‹¬è‡ªååœ¨è§’è½ï¼Œæ­£åœ¨ç¿»é˜…ä¸€äº›æ–‡ä»¶ã€‚ä»–å¥å£®çš„èº«èº¯åœ¨è¿™æ ·çš„ç¯å¢ƒä¸­æ˜¾å¾—æœ‰äº›æ ¼æ ¼ä¸å…¥ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰å¤©å•Šï¼ææ•™ç»ƒå±…ç„¶åœ¨è¿™é‡Œï¼æ˜¯åº”è¯¥æ‰“æ‹›å‘¼è¿˜æ˜¯è£…ä½œæ²¡çœ‹è§å‘¢ï¼Ÿ", [
                            { text: "ä¸»åŠ¨æ‰“æ‹›å‘¼", next: "cafe_greeting" },
                            { text: "å‡è£…å¶é‡", next: "cafe_pretend_coincidence" },
                            { text: "è¿œè¿œè§‚å¯Ÿ", next: "cafe_observe" }
                        ]);
                    }, 2000);
                    break;
                    
                case "cafe_greeting":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œä½ å¥½ï¼æ²¡æƒ³åˆ°åœ¨è¿™é‡Œé‡è§ä½ ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆæŠ¬å¤´ï¼Œç•¥å¸¦æƒŠè®¶ï¼‰ç»“åŸåŒå­¦...ï¼ˆä»–è¿…é€Ÿåˆä¸Šæ–‡ä»¶å¤¹ï¼‰");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æŠ±æ­‰ï¼Œæ‰“æ‰°åˆ°ä½ äº†å—ï¼Ÿ");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "æ²¡æœ‰ã€‚åªæ˜¯åœ¨å¤„ç†ä¸€äº›...å·¥ä½œä¸Šçš„äº‹æƒ…ã€‚");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ä½ æ³¨æ„åˆ°ä»–åˆä¸Šçš„æ–‡ä»¶å¤¹ä¸Šå†™ç€'èµåŠ©åˆåŒçº çº·'å‡ ä¸ªå­—ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "çœ‹èµ·æ¥æ˜¯å¾ˆé‡è¦çš„æ–‡ä»¶ã€‚æˆ‘æ­£å¥½æ˜¯å­¦å•†æ³•çš„ï¼Œå¦‚æœæœ‰ä»€ä¹ˆæ³•å¾‹é—®é¢˜ï¼Œä¹Ÿè®¸æˆ‘èƒ½æä¾›ä¸€äº›å»ºè®®ï¼Ÿ", [
                                            { text: "è¿›ä¸€æ­¥è¯¢é—®åˆåŒé—®é¢˜", next: "ask_about_contract" },
                                            { text: "è½¬ç§»è¯é¢˜", next: "change_subject_cafe" }
                                        ]);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "ask_about_contract":
                    showDialog("æå›½è‰¯", "ï¼ˆæƒŠè®¶åœ°æŒ‘çœ‰ï¼‰ä½ å­¦å•†æ³•ï¼Ÿæˆ‘ä»¥ä¸ºä½ åªæ˜¯...ï¼ˆåœé¡¿ï¼‰å¯¹ç¯®çƒæ„Ÿå…´è¶£ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘çš„ä¸“ä¸šç¡®å®æ˜¯å•†æ³•ã€‚çƒé˜Ÿé‡åˆ°åˆåŒé—®é¢˜äº†å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ç‰‡åˆ»ï¼‰...æ˜¯çš„ã€‚ä¸€ä¸ªèµåŠ©å•†æƒ³æå‰ç»ˆæ­¢åˆåŒï¼Œæ¡æ¬¾å¾ˆå¤æ‚ã€‚å­¦æ ¡æ³•åŠ¡éƒ¨é—¨äººæ‰‹ä¸è¶³ï¼Œæš‚æ—¶æ²¡æ³•å¤„ç†ã€‚");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å¯ä»¥çœ‹çœ‹å—ï¼Ÿæˆ‘å»å¹´å‚åŠ è¿‡å•†æ³•ç«èµ›ï¼Œå¯¹ä½“è‚²èµåŠ©åˆåŒæœ‰ä¸€äº›äº†è§£ã€‚");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆæ²‰æ€ï¼‰...ä½ ç¡®å®šå—ï¼Ÿè¿™ä¸æ˜¯å­¦ç”Ÿè¯¥è´Ÿè´£çš„äº‹æƒ…ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "å°±å½“æ˜¯å®è·µç»éªŒå§ã€‚è€Œä¸”ï¼Œèƒ½å¸®åˆ°çƒé˜Ÿçš„è¯ï¼Œæˆ‘å¾ˆä¹æ„ã€‚", [
                                            { text: "æå‡ºä¸“ä¸šå»ºè®®", next: "offer_legal_advice" },
                                            { text: "è¯·ä»–å–å’–å•¡æ”¾æ¾", next: "offer_coffee" }
                                        ]);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "offer_legal_advice":
                    if (gameState.stats.law >= 50) {
                        showDialog("ç³»ç»Ÿ", "ä½ è¯¦ç»†é˜…è¯»äº†åˆåŒï¼Œå‘ç°äº†ä¸€ä¸ªå¯¹å­¦æ ¡æœ‰åˆ©çš„å…³é”®æ¡æ¬¾ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æ•™ç»ƒï¼Œä½ çœ‹è¿™æ¡æ¬¾ã€‚èµåŠ©å•†ç¡®å®å¯ä»¥æå‰ç»ˆæ­¢ï¼Œä½†éœ€è¦æŒ‰æ¯”ä¾‹æ”¯ä»˜å‰©ä½™æœŸé™çš„30%ä½œä¸ºè¡¥å¿é‡‘ã€‚è¿™æ˜¯ä¸ªæœ‰åˆ©æ¡ä»¶ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆçœ¼ä¸­é—ªè¿‡æƒŠè®¶ï¼‰ä½ è¯´å¾—å¯¹...æˆ‘ä¹‹å‰æ²¡æ³¨æ„åˆ°è¿™ç‚¹ã€‚");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ä½ ç»§ç»­åˆ†æäº†åˆåŒçš„å…¶ä»–ç»†èŠ‚ï¼Œæå‡ºäº†å‡ ä¸ªå»ºè®¾æ€§çš„å»ºè®®ã€‚ææ•™ç»ƒä¸“æ³¨åœ°å¬ç€ï¼Œå¶å°”ç‚¹å¤´è¡¨ç¤ºè®¤åŒã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ç•¥å¾®ç¼“å’Œï¼‰ä½ çš„åˆ†æå¾ˆä¸“ä¸šã€‚è¿™å¯¹çƒé˜Ÿå¾ˆæœ‰å¸®åŠ©ï¼Œè°¢è°¢ã€‚");
                                        setTimeout(() => {
                                            gameState.flags.discoveredLawConnection = true;
                                            gameState.flags.helpedWithContract = true;
                                            gameState.affection += 10;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ä½ æˆåŠŸå¸®åŠ©ææ•™ç»ƒè§£å†³äº†åˆåŒé—®é¢˜ï¼Œè®©ä»–çœ‹åˆ°äº†ä½ çš„æ‰åå’Œä»·å€¼ã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                            unlockAchievement("æ³•å¾‹ä¸“å®¶", "ç”¨ä¸“ä¸šçŸ¥è¯†å¸®åŠ©äº†ææ•™ç»ƒ");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    } else {
                        showDialog("ç³»ç»Ÿ", "ä½ å°è¯•åˆ†æåˆåŒï¼Œä½†ç”±äºçŸ¥è¯†æœ‰é™ï¼Œæå‡ºçš„å»ºè®®ä¸å¤ªä¸“ä¸šã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾å¤±æœ›ï¼‰è°¢è°¢ä½ çš„å¸®å¿™...ä¸è¿‡æˆ‘å¯èƒ½è¿˜æ˜¯éœ€è¦å’¨è¯¢ä¸“ä¸šäººå£«ã€‚");
                            setTimeout(() => {
                                gameState.affection += 2;
                                updateStatsDisplay();
                                showDialog("ç³»ç»Ÿ", "è™½ç„¶æ²¡èƒ½æä¾›å®è´¨å¸®åŠ©ï¼Œä½†ææ•™ç»ƒè¿˜æ˜¯æ„Ÿè°¢ä½ çš„çƒ­å¿ƒã€‚å¥½æ„Ÿåº¦å°å¹…æå‡ã€‚");
                                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰çœ‹æ¥æˆ‘éœ€è¦æ›´åŠªåŠ›åœ°å­¦ä¹ å•†æ³•çŸ¥è¯†...");
                            }, 2000);
                        }, 2000);
                    }
                    break;
                    
                case "offer_coffee":
                    showDialog("ç»“åŸå¤å¥ˆ", "ç°åœ¨å…ˆæ”¾æ¾ä¸€ä¸‹å§ï¼Œä½ çœ‹èµ·æ¥å¾ˆç–²æƒ«ã€‚è®©æˆ‘è¯·ä½ å–æ¯å’–å•¡ï¼Œç¨åå†çœ‹åˆåŒï¼Ÿ");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆæ²‰é»˜ç‰‡åˆ»ï¼‰...å¥½å§ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ ä¸ºææ•™ç»ƒç‚¹äº†ä¸€æ¯é»‘å’–å•¡ï¼Œä½ ä»¬æœ‰äº†ä¸€æ®µè½»æ¾çš„äº¤è°ˆã€‚è°ˆè¯ä¸­ï¼Œä½ äº†è§£åˆ°ä»–å¯¹ç¯®çƒçš„çƒ­çˆ±æºäºé’å°‘å¹´æ—¶æœŸã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆè¯­æ°”æ¯”å¹³æ—¶æŸ”å’Œï¼‰ä»¥å‰åœ¨å­¦æ ¡ï¼Œæˆ‘ä¹Ÿæ˜¯å•†ç§‘å­¦ç”Ÿã€‚");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "çœŸçš„å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆæœ€åé€‰æ‹©äº†ç¯®çƒæ•™ç»ƒè¿™æ¡è·¯ï¼Ÿ");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆç›®å…‰å˜å¾—æ·±è¿œï¼‰å› ä¸ºä¸€ä¸ªçº¦å®šã€‚ï¼ˆçªç„¶åœä½ï¼‰æŠ±æ­‰ï¼Œè¯´å¤ªå¤šäº†ã€‚");
                                        setTimeout(() => {
                                            gameState.memoryFragments.push('fragment3');
                                            gameState.affection += 5;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒéš¾å¾—åˆ†äº«äº†è‡ªå·±çš„è¿‡å»ï¼Œä½ ä»¬ä¹‹é—´çš„è·ç¦»ä¼¼ä¹æ‹‰è¿‘äº†ã€‚å¥½æ„Ÿåº¦+5");
                                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰çº¦å®šï¼Ÿå’Œè°çš„çº¦å®šï¼Ÿä¸ºä»€ä¹ˆå¬åˆ°è¿™ä¸ªè¯ï¼Œæˆ‘çš„å¿ƒä¼šä¸è‡ªè§‰åœ°åŠ é€Ÿ...");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "change_subject_cafe":
                    showDialog("ç»“åŸå¤å¥ˆ", "ä¸å¥½æ„æ€ï¼Œæˆ‘ä¸è¯¥é—®è¿™ä¹ˆå¤šã€‚æˆ‘åªæ˜¯æ¥å–æ¯å’–å•¡çš„ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "æ²¡å…³ç³»ã€‚ï¼ˆå°†æ–‡ä»¶æ”¾è¿›åŒ…é‡Œï¼‰å›¢é˜Ÿæœ€è¿‘è¡¨ç°ä¸é”™ï¼Œå¸Œæœ›èƒ½ä¿æŒä¸‹å»ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ ä»¬èŠäº†ä¸€äº›å…³äºçƒé˜Ÿçš„è¯é¢˜ï¼Œæ°”æ°›è¿˜ç®—è½»æ¾ã€‚ææ•™ç»ƒè™½ç„¶è¡¨æƒ…ä¾æ—§å†·å³»ï¼Œä½†è¯­æ°”æ¯”å¹³æ—¶å’Œç¼“äº†ä¸€äº›ã€‚");
                            setTimeout(() => {
                                gameState.affection += 2;
                                updateStatsDisplay();
                                showDialog("ç³»ç»Ÿ", "æ„å¤–çš„å’–å•¡å…ç›¸é‡è®©ä½ å’Œææ•™ç»ƒå…³ç³»æ›´è‡ªç„¶äº†ä¸€äº›ã€‚å¥½æ„Ÿåº¦+2");
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "cafe_pretend_coincidence":
                    showDialog("ç³»ç»Ÿ", "ä½ å‡è£…åˆšåˆšæ³¨æ„åˆ°ææ•™ç»ƒï¼Œè£…ä½œæƒŠè®¶çš„æ ·å­èµ°å‘ä»–çš„æ¡Œå­ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "å’¦ï¼Ÿææ•™ç»ƒï¼ŸçœŸæ˜¯å·§å•Šï¼Œæ²¡æƒ³åˆ°åœ¨è¿™é‡Œé‡è§ä½ ï¼");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆé¢æ— è¡¨æƒ…åœ°æŠ¬å¤´ï¼‰ç»“åŸåŒå­¦...ï¼ˆä»–å®¡è§†åœ°çœ‹äº†ä½ ä¸€çœ¼ï¼Œä¼¼ä¹åœ¨åˆ¤æ–­ä½ çš„çœŸè¯šåº¦ï¼‰");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘èƒ½åè¿™é‡Œå—ï¼Ÿå…¶ä»–åœ°æ–¹éƒ½æ»¡äº†ã€‚");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆç¯é¡¾å››å‘¨ï¼Œå‘ç°è¿˜æœ‰ä¸å°‘ç©ºä½ï¼Œä½†è¿˜æ˜¯ç‚¹äº†ç‚¹å¤´ï¼‰...å¯ä»¥ã€‚ï¼ˆå°†æ–‡ä»¶å¤¹æ”¾åˆ°ä¸€è¾¹ï¼‰");
                                    setTimeout(() => {
                                        showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¼¼ä¹çœ‹ç©¿äº†ä½ çš„å°å¿ƒæ€ï¼Œä½†å¹¶æ²¡æœ‰æ­ç©¿ã€‚ä½ ä»¬æœ‰äº†ä¸€æ¬¡çŸ­æš‚ä½†ç¤¼è²Œçš„äº¤è°ˆã€‚");
                                        setTimeout(() => {
                                            gameState.affection += 1;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "è™½ç„¶æ‰‹æ®µæœ‰äº›ç”Ÿç¡¬ï¼Œä½†è‡³å°‘å¢åŠ äº†æ¥è§¦çš„æœºä¼šã€‚å¥½æ„Ÿåº¦ç•¥å¾®æå‡ã€‚");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "cafe_observe":
                    showDialog("ç³»ç»Ÿ", "ä½ é€‰æ‹©åœ¨è¿œå¤„çš„ä½ç½®åä¸‹ï¼Œå·å·è§‚å¯Ÿææ•™ç»ƒã€‚ä»–ä¸“æ³¨åœ°é˜…è¯»æ–‡ä»¶ï¼Œå¶å°”çš±çœ‰ï¼Œçœ‹èµ·æ¥é‡åˆ°äº†ä»€ä¹ˆå›°éš¾ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–è¿æ²‰æ€çš„æ ·å­éƒ½è¿™ä¹ˆè¿·äºº...é‚£ç´§é”çš„çœ‰å¤´ï¼Œé‚£åšæ¯…çš„ä¾§è„¸...");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "çªç„¶ï¼Œææ•™ç»ƒä¼¼ä¹æ„Ÿå—åˆ°äº†è§†çº¿ï¼Œæœä½ çš„æ–¹å‘çœ‹è¿‡æ¥ã€‚ä½ æ…Œå¿™ä½å¤´å‡è£…çœ‹æ‰‹æœºã€‚");
                            setTimeout(() => {
                                showDialog("ç³»ç»Ÿ", "è¿‡äº†ä¸€ä¼šå„¿ï¼Œå½“ä½ å†æ¬¡æŠ¬å¤´æ—¶ï¼Œå‘ç°ææ•™ç»ƒå·²ç»ç¦»å¼€äº†å’–å•¡å…ã€‚ä»Šå¤©çš„æœºä¼šé”™è¿‡äº†ã€‚");
                                setTimeout(() => {
                                    gameState.mood = "é—æ†¾";
                                    updateStatsDisplay();
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "cafe_special_encounter":
                    gameState.flags.specialEncounter = true;
                    characterImage.src = characters.guoliang;
                    showDialog("ç³»ç»Ÿ", "æ­£å½“ä½ äº«ç”¨é¥®æ–™æ—¶ï¼Œé—¨å£ä¼ æ¥ä¸€é˜µéªšåŠ¨ã€‚æå›½è‰¯æ•™ç»ƒèµ°è¿›å’–å•¡å…ï¼Œçœ‹èµ·æ¥ä»–åˆšç»“æŸäº†è®­ç»ƒï¼Œè¿åŠ¨è£…è¿˜æœªæ¢ä¸‹ã€‚");
                    setTimeout(() => {
                        showDialog("ç³»ç»Ÿ", "å‡ ä½å¥³ç”Ÿå°å£°è®®è®ºç€ï¼Œæ˜¾ç„¶è¢«ä»–å¼ºå£®çš„èº«æå’Œå†·å³»çš„æ°”è´¨å¸å¼•ã€‚ä½ æ³¨æ„åˆ°ææ•™ç»ƒç¯é¡¾å››å‘¨ï¼Œå’–å•¡å…å‡ ä¹å·²åº§æ— è™šå¸­ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒè·³åŠ é€Ÿï¼‰è¿™æ˜¯å¤©èµçš„æœºä¼šï¼", [
                                { text: "é‚€è¯·ä»–å…±äº«åº§ä½", next: "invite_seat_share" },
                                { text: "è£…ä½œæ²¡çœ‹è§", next: "pretend_not_seeing_cafe" },
                                { text: "ä¸»åŠ¨è®©åº§", next: "offer_seat" }
                            ]);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "invite_seat_share":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼è¿™é‡Œæœ‰ç©ºä½ï¼Œå¦‚æœä½ ä¸ä»‹æ„çš„è¯ï¼Œå¯ä»¥ä¸€èµ·åã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾æƒŠè®¶ï¼‰ç»“åŸåŒå­¦...ï¼ˆç¯é¡¾å››å‘¨ï¼Œè€ƒè™‘äº†ä¸€ä¸‹ï¼‰è°¢è°¢ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒåœ¨ä½ å¯¹é¢åä¸‹ï¼Œä»–èº«ä¸Šæ•£å‘ç€è®­ç»ƒåçš„çƒ­åº¦ï¼Œè¿‘è·ç¦»æ„Ÿå—åˆ°ä»–çš„æ°”åœºè®©ä½ æœ‰äº›ç´§å¼ ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "è®­ç»ƒåä¹ æƒ¯å–ç‚¹å’–å•¡ã€‚ä½ ç»å¸¸æ¥è¿™é‡Œï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "å—¯ï¼Œæˆ‘å–œæ¬¢è¿™é‡Œçš„æ°›å›´ï¼Œé€‚åˆå­¦ä¹ å’Œæ”¾æ¾ã€‚å¯¹äº†ï¼Œä½ çœ‹èµ·æ¥è®­ç»ƒå¾ˆè¾›è‹¦ï¼Œéœ€è¦ä»€ä¹ˆé¥®æ–™å—ï¼Ÿæˆ‘å¯ä»¥å¸®ä½ ç‚¹ã€‚", [
                                        { text: "æ¨èç‰¹è°ƒå’–å•¡", next: "recommend_special_coffee" },
                                        { text: "è¯¢é—®ä»–çš„åå¥½", next: "ask_preference" }
                                    ]);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "recommend_special_coffee":
                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘ä¸ªäººå¾ˆæ¨èè¿™é‡Œçš„ç‰¹è°ƒå†°å’–å•¡ï¼Œè®­ç»ƒåå–ç‰¹åˆ«æç¥ã€‚è¦ä¸è¦è¯•è¯•ï¼Ÿ");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "å¥½ã€‚ï¼ˆæå‡ºé’±åŒ…ï¼‰");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ä¸ç”¨ï¼Œè¿™æ¬¡ç®—æˆ‘è¯·ä½ çš„ï¼å°±å½“æ˜¯...æ„Ÿè°¢ä½ å¹³æ—¶å¯¹çƒé˜Ÿçš„è¾›å‹¤ä»˜å‡ºã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ç‰‡åˆ»ï¼Œæœ€ç»ˆæ”¶å›é’±åŒ…ï¼‰...è°¢è°¢ã€‚ä¸è¿‡ä¸‹æ¬¡æˆ‘è¯·å›æ¥ã€‚");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒè¿™å¥'ä¸‹æ¬¡'è®©ä½ å¿ƒå¤´ä¸€é¢¤ã€‚ä½ ä¸ºä»–ç‚¹äº†ç‰¹è°ƒå’–å•¡ï¼Œå›æ¥åå‘ç°ä»–æ­£åœ¨çœ‹æ‰‹æœºä¸Šçš„æˆ˜æœ¯åˆ†æã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "å¯¹äº†ï¼Œæˆ‘ä¸€ç›´æƒ³é—®ï¼Œæ˜¯ä»€ä¹ˆè®©ä½ å†³å®šæˆä¸ºç¯®çƒæ•™ç»ƒçš„ï¼Ÿä½ çœ‹èµ·æ¥...å¾ˆä¸“ä¸šã€‚");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "ï¼ˆæ²‰é»˜ç‰‡åˆ»ï¼‰å¤§å­¦æ—¶åŠ å…¥ç¯®çƒé˜Ÿï¼Œåæ¥å—ä¼¤é€€å½¹ï¼Œä½†ä¸æƒ³ç¦»å¼€è¿™é¡¹è¿åŠ¨...ï¼ˆåœé¡¿ï¼‰è¿˜æœ‰ä¸€ä¸ªçº¦å®šã€‚");
                                            setTimeout(() => {
                                                showDialog("ç»“åŸå¤å¥ˆ", "çº¦å®šï¼Ÿå’Œè°çš„ï¼Ÿ");
                                                setTimeout(() => {
                                                    showDialog("æå›½è‰¯", "ï¼ˆç¥æƒ…çªç„¶å˜å¾—å¤æ‚ï¼‰...ä¸€ä¸ªæœ‹å‹ã€‚ï¼ˆè½¬ç§»è¯é¢˜ï¼‰ä½ å‘¢ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©å•†æ³•ï¼Ÿ");
                                                    setTimeout(() => {
                                                        gameState.memoryFragments.push('fragment6');
                                                        gameState.affection += 8;
                                                        updateStatsDisplay();
                                                        showDialog("ç³»ç»Ÿ", "ä½ ä»¬æœ‰äº†ä¸€æ¬¡æ·±å…¥çš„äº¤è°ˆï¼Œææ•™ç»ƒç½•è§åœ°åˆ†äº«äº†ä»–çš„è¿‡å»ã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰é‚£ä¸ª'çº¦å®š'å’Œ'æœ‹å‹'...ä¸ºä»€ä¹ˆå¬åˆ°è¿™äº›è¯ï¼Œæˆ‘ä¼šæ„Ÿåˆ°å¦‚æ­¤åœ¨æ„ï¼Ÿ");
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "ask_preference":
                    showDialog("ç»“åŸå¤å¥ˆ", "ä½ å¹³æ—¶å–œæ¬¢å–ä»€ä¹ˆï¼Ÿæˆ‘å»å¸®ä½ ç‚¹ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "æ™®é€šé»‘å’–å•¡å°±å¥½ï¼Œä¸åŠ ç³–ã€‚ï¼ˆé€’ç»™ä½ é’±ï¼‰");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ä¸ç”¨ç»™é’±ï¼Œè¿™æ¬¡æˆ‘è¯·ä½ ã€‚ï¼ˆå¾®ç¬‘ï¼‰å°±å½“æ˜¯è°¢è°¢ä½ å¹³æ—¶å¯¹å­¦ç”Ÿä»¬çš„è€å¿ƒæŒ‡å¯¼ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆå¾®å¾®æƒŠè®¶ï¼‰...è°¢è°¢ã€‚");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ä½ ä¸ºææ•™ç»ƒç‚¹äº†å’–å•¡ã€‚å½“ä½ å›æ¥æ—¶ï¼Œå‘ç°ä»–æ­£åœ¨å¤„ç†ä¸€äº›çƒé˜Ÿæ–‡ä»¶ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "çƒé˜Ÿäº‹åŠ¡å¾ˆç¹å¿™å§ï¼Ÿçœ‹ä½ ç»å¸¸åŠ ç­ã€‚");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "ä¹ æƒ¯äº†ã€‚ï¼ˆç¨ä½œåœé¡¿ï¼‰æœ€è¿‘æœ‰äº›åˆåŒé—®é¢˜æ¯”è¾ƒéº»çƒ¦ã€‚");
                                            setTimeout(() => {
                                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å­¦çš„æ˜¯å•†æ³•ï¼Œä¹Ÿè®¸èƒ½å¸®ä¸Šå¿™ï¼Ÿæˆ‘åœ¨å­¦æ ¡å•†æ³•ç¤¾å›¢ä¹Ÿæ‹…ä»»é¡¾é—®ã€‚");
                                                setTimeout(() => {
                                                    showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾æƒŠè®¶ï¼‰ä½ æ˜¯å•†æ³•ä¸“ä¸šï¼Ÿä»¥åå¯èƒ½çœŸçš„éœ€è¦è¯·æ•™ä½ ã€‚å­¦æ ¡æ³•åŠ¡éƒ¨é—¨äººæ‰‹ä¸è¶³ï¼Œå¾ˆå¤šæ—¶é—´éƒ½è€½è¯¯åœ¨è¿™äº›çäº‹ä¸Šã€‚");
                                                    setTimeout(() => {
                                                        gameState.flags.discoveredLawConnection = true;
                                                        gameState.affection += 5;
                                                        updateStatsDisplay();
                                                        showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒå¯¹ä½ çš„ä¸“ä¸šèƒ½åŠ›è¡¨ç¤ºè®¤å¯ï¼Œä½ ä»¬æ‰¾åˆ°äº†å…±åŒè¯é¢˜ã€‚å¥½æ„Ÿåº¦æå‡ï¼");
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "pretend_not_seeing_cafe":
                    showDialog("ç³»ç»Ÿ", "ä½ è£…ä½œæ²¡çœ‹è§ææ•™ç»ƒï¼Œä½å¤´ä¸“æ³¨äºè‡ªå·±çš„é¥®æ–™å’Œæ‰‹æœºã€‚");
                    setTimeout(() => {
                        showDialog("ç³»ç»Ÿ", "ä½ å·å·æŠ¬çœ¼è§‚å¯Ÿï¼Œçœ‹åˆ°ææ•™ç»ƒç¯é¡¾å››å‘¨åï¼Œé€‰æ‹©ç¦»å¼€äº†å’–å•¡å…ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰å”‰ï¼Œé”™è¿‡äº†ä¸€ä¸ªå¥½æœºä¼š...");
                            setTimeout(() => {
                                gameState.mood = "é—æ†¾";
                                updateStatsDisplay();
                            }, 1000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "offer_seat":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼æ‚¨è¦å–å’–å•¡å—ï¼Ÿæˆ‘æ­£å¥½è¦èµ°äº†ï¼Œè¿™ä¸ªä½ç½®æ‚¨å¯ä»¥ç”¨ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆå¾®å¾®ç‚¹å¤´ï¼‰è°¢è°¢ï¼Œä¸è¿‡ä¸å¿…ä¸ºæˆ‘ç¦»å¼€ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å·²ç»å–å®Œäº†ï¼ŒçœŸçš„è¦èµ°ã€‚ï¼ˆæ”¶æ‹¾ä¸œè¥¿ï¼‰ä¸è¿‡...");
                            setTimeout(() => {
                                showDialog("ç³»ç»Ÿ", "ä½ çŠ¹è±«äº†ä¸€ä¸‹ï¼Œé¼“èµ·å‹‡æ°”ç»§ç»­è¯´ã€‚");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "å¦‚æœæ‚¨ä¸ä»‹æ„ï¼Œä¸‹æ¬¡æˆ‘ä»¬å¯ä»¥ä¸€èµ·å–å’–å•¡èŠèŠå¤©ã€‚æˆ‘å¾ˆæƒ³å¤šäº†è§£ä¸€ä¸‹ç¯®çƒå’Œæ‚¨çš„æ•™ç»ƒç»å†ã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾æ„å¤–ï¼‰...å¥½å§ã€‚æœ‰æœºä¼šçš„è¯ã€‚");
                                        setTimeout(() => {
                                            gameState.affection += 3;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "è™½ç„¶åªæ˜¯ç®€çŸ­çš„äº’åŠ¨ï¼Œä½†ä½ æˆåŠŸé‚€çº¦äº†ææ•™ç»ƒï¼Œç•™ä¸‹äº†å¥½å°è±¡ã€‚å¥½æ„Ÿåº¦+3");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "law_connection":
                    characterImage.src = characters.guoliang;
                    bgImage.src = backgrounds.office;
                    showDialog("ç³»ç»Ÿ", "ä½ å‰å¾€æ•™å¸ˆåŠå…¬å®¤æ‰¾å¯»èµ„æ–™æ—¶ï¼Œå¶ç„¶å¬åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„å£°éŸ³ä»æ—è¾¹çš„ä¼šè®®å®¤ä¼ æ¥ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "æˆ‘ç†è§£åˆåŒæ¡æ¬¾çš„å¤æ‚æ€§ï¼Œä½†çƒé˜Ÿéœ€è¦è¿™ç¬”èµåŠ©é‡‘æ‰èƒ½å‚åŠ ä¸‹ä¸ªæœˆçš„é”¦æ ‡èµ›ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ è½»è½»é è¿‘ä¼šè®®å®¤ï¼Œé€è¿‡åŠå¼€çš„é—¨ç¼ï¼Œçœ‹åˆ°ææ•™ç»ƒæ­£å’Œä¸¤ä½ç©¿ç€æ­£è£…çš„äººäº¤è°ˆï¼Œçœ‹èµ·æ¥åƒæ˜¯å¾‹å¸ˆã€‚");
                            setTimeout(() => {
                                showDialog("å¾‹å¸ˆ", "ææ•™ç»ƒï¼ŒæŒ‰ç…§ç°è¡Œæ¡æ¬¾ï¼ŒèµåŠ©å•†æœ‰æƒåœ¨è¿™ä¸ªæ—¶é—´ç‚¹è°ƒæ•´èµåŠ©é‡‘é¢ã€‚æˆ‘ä»¬èƒ½åšçš„å¾ˆæœ‰é™ã€‚");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ç½•è§åœ°æ˜¾éœ²å‡ºç„¦è™‘ï¼‰æ²¡æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆå—ï¼Ÿçƒå‘˜ä»¬å·²ç»è®­ç»ƒäº†æ•´æ•´ä¸€å­¦æœŸ...");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ä»–åœ¨ä¸ºçƒé˜Ÿçš„èµåŠ©é—®é¢˜å‘æ„...è¿™æ­£æ˜¯æˆ‘èƒ½å¸®ä¸Šå¿™çš„åœ°æ–¹ï¼", [
                                            { text: "ä¸»åŠ¨æä¾›å¸®åŠ©", next: "offer_law_help" },
                                            { text: "å…ˆç¦»å¼€ï¼Œç­‰åˆé€‚æ—¶æœº", next: "wait_for_better_timing" }
                                        ]);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "offer_law_help":
                    showDialog("ç³»ç»Ÿ", "ä½ é¼“èµ·å‹‡æ°”ï¼Œè½»è½»æ•²äº†æ•²ä¼šè®®å®¤çš„é—¨ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "æ‰“æ‰°äº†...æˆ‘æ˜¯å•†æ³•ä¸“ä¸šçš„ç»“åŸå¤å¥ˆï¼Œå¶ç„¶å¬åˆ°ä½ ä»¬åœ¨è®¨è®ºèµåŠ©åˆåŒé—®é¢˜ã€‚ä¹Ÿè®¸æˆ‘èƒ½æä¾›ä¸€äº›å¸®åŠ©ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆæƒŠè®¶ï¼‰ç»“åŸï¼Ÿè¿™æ˜¯æ ¡æ³•åŠ¡å¤„çš„äº‹æƒ…ï¼Œå­¦ç”Ÿä¸è¯¥å‚ä¸ã€‚");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘åœ¨å•†æ³•ç ”ç©¶ç¤¾å®ä¹ ï¼Œä¸“é—¨ç ”ç©¶è¿‡ä½“è‚²èµåŠ©åˆåŒæ¡ˆä¾‹ã€‚æ•™æˆä¹Ÿç»å¸¸è®©æˆ‘ååŠ©å®¡æ ¸ä¸€äº›å®é™…åˆåŒã€‚");
                                setTimeout(() => {
                                    showDialog("å¾‹å¸ˆ", "ææ•™ç»ƒï¼Œæˆ‘ä»¬ç¡®å®äººæ‰‹ç´§å¼ ...ä¹Ÿè®¸è®©è¿™ä½åŒå­¦çœ‹çœ‹ä¹Ÿæ— å¦¨ï¼Ÿ");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ç‰‡åˆ»ï¼‰...å¥½å§ã€‚");
                                        setTimeout(() => {
                                            if (gameState.stats.law >= 55) {
                                                renderScene("successful_contract_help");
                                            } else {
                                                renderScene("attempted_contract_help");
                                            }
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "successful_contract_help":
                    showDialog("ç³»ç»Ÿ", "ä½ ä»”ç»†é˜…è¯»äº†èµåŠ©åˆåŒï¼Œå‘ç°äº†ä¸€ä¸ªå…³é”®çš„æ¼æ´ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ‰¾åˆ°äº†ï¼æ ¹æ®ç¬¬17æ¡ç¬¬3æ¬¾ï¼ŒèµåŠ©å•†ç¡®å®å¯ä»¥è°ƒæ•´é‡‘é¢ï¼Œä½†éœ€è¦æå‰60å¤©é€šçŸ¥ã€‚è€Œæ®æˆ‘æ‰€çŸ¥ï¼Œä»–ä»¬çš„é€šçŸ¥åªæå‰äº†45å¤©ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("å¾‹å¸ˆ", "ï¼ˆç¿»é˜…æ–‡ä»¶ï¼Œçœ¼ç›çªç„¶äº®èµ·æ¥ï¼‰ä½ è¯´å¾—å¯¹ï¼æˆ‘ä»¬ç«Ÿç„¶å¿½ç•¥äº†è¿™ç‚¹ï¼");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆçœ‹å‘ä½ ï¼Œçœ¼ç¥ä¸­æœ‰ç€æƒŠè®¶å’Œæ¬£èµï¼‰è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("å¾‹å¸ˆ", "æ„å‘³ç€ä»–ä»¬çš„è°ƒæ•´æ— æ•ˆï¼Œå¿…é¡»æŒ‰åŸå®šé‡‘é¢æ‰§è¡Œï¼Œæˆ–è€…é‡æ–°ç»™äºˆ60å¤©é€šçŸ¥æœŸã€‚è€Œ60å¤©åï¼Œé”¦æ ‡èµ›å·²ç»ç»“æŸäº†ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç³»ç»Ÿ", "ä¼šè®®ç»“æŸåï¼Œææ•™ç»ƒå•ç‹¬ç•™ä¸‹ä½ ã€‚");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "ä½ çœŸçš„å¸®äº†å¤§å¿™ã€‚ï¼ˆéš¾å¾—åœ°ç›´è§†ä½ çš„çœ¼ç›ï¼‰ä½ çš„æ³•å¾‹çŸ¥è¯†...ä»¤äººå°è±¡æ·±åˆ»ã€‚");
                                            setTimeout(() => {
                                                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆè„¸çº¢ï¼‰è°¢è°¢ï¼æˆ‘å¾ˆé«˜å…´èƒ½å¸®ä¸Šå¿™ã€‚");
                                                setTimeout(() => {
                                                    showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ç‰‡åˆ»ï¼‰å¦‚æœ...ä½ æœ‰å…´è¶£ï¼Œçƒé˜Ÿå¯èƒ½è¿˜éœ€è¦ä½ çš„å¸®åŠ©ã€‚çƒé˜Ÿäº‹åŠ¡æœ‰å¾ˆå¤šæ³•å¾‹å±‚é¢çš„é—®é¢˜ã€‚");
                                                    setTimeout(() => {
                                                        showDialog("ç»“åŸå¤å¥ˆ", "çœŸçš„å—ï¼Ÿæˆ‘å¤ªä¹æ„äº†ï¼è¿™å¯¹æˆ‘æ¥è¯´ä¹Ÿæ˜¯å¾ˆå¥½çš„å®è·µæœºä¼šï¼");
                                                        setTimeout(() => {
                                                            gameState.flags.helpedWithContract = true;
                                                            gameState.affection += 15;
                                                            updateStatsDisplay();
                                                            showDialog("ç³»ç»Ÿ", "ä½ æˆåŠŸè¿ç”¨ä¸“ä¸šçŸ¥è¯†å¸®åŠ©äº†ææ•™ç»ƒï¼Œä»–å¯¹ä½ åˆ®ç›®ç›¸çœ‹ã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                                            unlockAchievement("æ³•å¾‹è‹±é›„", "æˆåŠŸè§£å†³äº†çƒé˜Ÿçš„åˆåŒå±æœº");
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "attempted_contract_help":
                    showDialog("ç³»ç»Ÿ", "ä½ è®¤çœŸæŸ¥çœ‹åˆåŒï¼Œä½†å…¶ä¸­çš„ä¸“ä¸šæœ¯è¯­å’Œå¤æ‚æ¡æ¬¾è®©ä½ æ„Ÿåˆ°æœ‰äº›åƒåŠ›ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "è¿™é‡Œçš„ç¬¬12æ¡ä¼¼ä¹æåˆ°äº†è°ƒæ•´é‡‘é¢çš„æ¡ä»¶...ï¼ˆä½ åŠªåŠ›åˆ†æç€ï¼‰");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ æå‡ºäº†å‡ ç‚¹å»ºè®®ï¼Œä½†å¾‹å¸ˆä»¬è§£é‡Šè¿™äº›åœ¨æ³•å¾‹ä¸Šç«™ä¸ä½è„šã€‚ä¼šè®®æœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆä¼šè®®ç»“æŸåï¼‰è°¢è°¢ä½ æƒ³å¸®å¿™ï¼Œä½†è¿™äº›é—®é¢˜æ¯”è¾ƒä¸“ä¸šã€‚");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "å¯¹ä¸èµ·ï¼Œæˆ‘ä»¥ä¸ºæˆ‘èƒ½å¸®ä¸Šå¿™...ï¼ˆä½å¤´ï¼‰");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆè¯­æ°”ç¼“å’Œï¼‰è‡³å°‘ä½ å°è¯•äº†ã€‚è¿™æ¯”å¤§å¤šæ•°äººåšçš„æ›´å¤šã€‚");
                                        setTimeout(() => {
                                            gameState.affection += 3;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "è™½ç„¶æ²¡èƒ½è§£å†³é—®é¢˜ï¼Œä½†ææ•™ç»ƒæ„Ÿè°¢ä½ çš„åŠªåŠ›å’ŒçœŸè¯šã€‚å¥½æ„Ÿåº¦å°å¹…æå‡ã€‚");
                                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰æˆ‘éœ€è¦æ›´åŠ åŠªåŠ›å­¦ä¹ å•†æ³•çŸ¥è¯†...");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "wait_for_better_timing":
                    showDialog("ç³»ç»Ÿ", "ä½ å†³å®šå…ˆä¸æ‰“æ‰°ä»–ä»¬çš„ä¼šè®®ï¼Œé»˜é»˜ç¦»å¼€äº†ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ç°åœ¨æ‰“æ–­å¯èƒ½ä¸å¤ªåˆé€‚ã€‚æˆ‘åº”è¯¥å…ˆå¥½å¥½å‡†å¤‡ï¼Œæ‰¾ä¸ªæ›´å¥½çš„æ—¶æœºå¸®åŠ©ä»–ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ ç¦»å¼€æ—¶ï¼Œéšçº¦å¬åˆ°ææ•™ç»ƒæ²®ä¸§çš„å£°éŸ³ï¼Œæ˜¾ç„¶çƒé˜Ÿé¢ä¸´ç€ä¸¥å³»çš„èµ„é‡‘é—®é¢˜ã€‚");
                            setTimeout(() => {
                                gameState.flags.discoveredLawConnection = true;
                                updateStatsDisplay();
                                showDialog("ç³»ç»Ÿ", "ä½ äº†è§£äº†ææ•™ç»ƒæ­£åœ¨é¢ä¸´çš„å›°å¢ƒï¼Œè¿™å¯èƒ½æ˜¯ä½ å±•ç¤ºä»·å€¼çš„æœºä¼šã€‚");
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "contract_help_opportunity":
                    characterImage.src = characters.guoliang;
                    showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°æ•™å¸ˆåŠå…¬å®¤ï¼Œå‘ç°ææ•™ç»ƒç‹¬è‡ªä¸€äººååœ¨æ¡Œå‰ï¼Œé¢å‰æ‘Šç€ä¸€å †æ–‡ä»¶ï¼Œçœ‰å¤´ç´§é”ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Ÿæœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®å¿™çš„å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆæŠ¬å¤´ï¼Œç•¥æ˜¾ç–²æƒ«ï¼‰ç»“åŸåŒå­¦...ï¼ˆçŠ¹è±«ç‰‡åˆ»ï¼‰ä¸Šæ¬¡ä½ æåˆ°ä½ å­¦å•†æ³•ï¼Ÿ");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æ˜¯çš„ï¼Œæœ‰æ³•å¾‹æ–¹é¢çš„é—®é¢˜éœ€è¦å¸®å¿™å—ï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "çƒé˜ŸèµåŠ©åˆåŒå‡ºäº†é—®é¢˜ã€‚å­¦æ ¡æ³•åŠ¡éƒ¨é—¨äººæ‰‹ä¸è¶³ï¼Œè¿™äº‹ä¸€ç›´æ‹–ç€ã€‚ï¼ˆæŒ‡å‘æ¡Œä¸Šçš„æ–‡ä»¶ï¼‰å¦‚æœä½ æœ‰æ—¶é—´...ä¹Ÿè®¸å¯ä»¥çœ‹çœ‹ï¼Ÿ");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "å½“ç„¶ï¼æˆ‘å¾ˆä¹æ„å¸®å¿™ï¼", [
                                            { text: "ä¸“æ³¨è§£å†³åˆåŒé—®é¢˜", next: "focus_on_contract" },
                                            { text: "è¾¹å·¥ä½œè¾¹èŠå¤©", next: "chat_while_working" }
                                        ]);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "focus_on_contract":
                    if (gameState.stats.law >= 50) {
                        showDialog("ç³»ç»Ÿ", "ä½ è®¤çœŸç ”ç©¶äº†èµåŠ©åˆåŒï¼Œå‡­å€Ÿæ‰å®çš„æ³•å¾‹çŸ¥è¯†ï¼ŒæˆåŠŸæ‰¾å‡ºäº†å‡ ä¸ªæœ‰åˆ©äºçƒé˜Ÿçš„æ¡æ¬¾å’ŒèµåŠ©å•†è¿è§„çš„è¯æ®ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œçœ‹è¿™é‡Œã€‚æ ¹æ®è¿™äº›æ¡æ¬¾ï¼ŒèµåŠ©å•†çš„è¡Œä¸ºæ„æˆäº†è¿çº¦ï¼Œæˆ‘ä»¬æœ‰å……åˆ†ç†ç”±è¦æ±‚ä»–ä»¬å±¥è¡ŒåŸåè®®ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆç›®å…‰ä¸­æµéœ²å‡ºç½•è§çš„é’¦ä½©ï¼‰ä½ ç¡®å®šè¿™èƒ½è¡Œå¾—é€šï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘éå¸¸ç¡®å®šã€‚æˆ‘è¿˜æ•´ç†äº†ä¸€ä»½åé©³å‡½çš„è‰ç¨¿ï¼Œä½ çœ‹çœ‹ã€‚ï¼ˆé€’ç»™ä»–ä¸€å¼ çº¸ï¼‰");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆä»”ç»†é˜…è¯»åï¼‰è¿™æ¯”å­¦æ ¡æ³•åŠ¡ç»™å‡ºçš„æ–¹æ¡ˆå¼ºå¤šäº†ã€‚ï¼ˆä»–ç›´è§†ä½ çš„çœ¼ç›ï¼‰è°¢è°¢ä½ ï¼Œç»“åŸã€‚è¿™å¯¹çƒé˜Ÿå¾ˆé‡è¦ã€‚");
                                        setTimeout(() => {
                                            showDialog("ç»“åŸå¤å¥ˆ", "ä¸ç”¨è°¢ï¼èƒ½å¸®åˆ°ä½ ...å’Œçƒé˜Ÿï¼Œæˆ‘å¾ˆå¼€å¿ƒã€‚");
                                            setTimeout(() => {
                                                showDialog("æå›½è‰¯", "ï¼ˆéš¾å¾—åœ°éœ²å‡ºä¸€ä¸å¾®ç¬‘ï¼‰ä½ çŸ¥é“å—ï¼Ÿä½ è®©æˆ‘æƒ³èµ·äº†ä¸€ä¸ªäººã€‚");
                                                setTimeout(() => {
                                                    showDialog("ç»“åŸå¤å¥ˆ", "å“¦ï¼Ÿæ˜¯è°ï¼Ÿ");
                                                    setTimeout(() => {
                                                        showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…çªç„¶å˜å¾—å¤æ‚ï¼‰...ä¸€ä¸ªè€æœ‹å‹ã€‚ï¼ˆè½¬ç§»è¯é¢˜ï¼‰çƒé˜Ÿè®­ç»ƒç»“æŸåæˆ‘è¦å»æäº¤è¿™ä»½æ–‡ä»¶ï¼Œä½ è¦ä¸€èµ·æ¥å—ï¼Ÿ");
                                                        setTimeout(() => {
                                                            gameState.flags.helpedWithContract = true;
                                                            gameState.memoryFragments.push('fragment7');
                                                            gameState.affection += 12;
                                                            updateStatsDisplay();
                                                            showDialog("ç³»ç»Ÿ", "ä½ æˆåŠŸå¸®åŠ©ææ•™ç»ƒè§£å†³äº†å›°æ‰°ä»–çš„é—®é¢˜ï¼Œä»–å¯¹ä½ çš„èƒ½åŠ›å’Œçƒ­å¿ƒè¡¨ç¤ºé«˜åº¦èµèµã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                                            unlockAchievement("æ³•å¾‹é¡¾é—®", "è¿ç”¨ä¸“ä¸šçŸ¥è¯†è§£å†³äº†çƒé˜ŸåˆåŒå±æœº");
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    } else {
                        showDialog("ç³»ç»Ÿ", "ä½ å°½åŠ›ç ”ç©¶åˆåŒï¼Œä½†ç”±äºçŸ¥è¯†å‚¨å¤‡æœ‰é™ï¼Œåªèƒ½æä¾›ä¸€äº›åŸºç¡€çš„å»ºè®®ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œæˆ‘çœ‹äº†ä¸€ä¸‹ï¼Œè¿™äº›æ¡æ¬¾ç¡®å®æœ‰äº›å¤æ‚ã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™é‡Œæœ‰ä¸€ç‚¹å¯ä»¥äº‰å–...");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆç‚¹å¤´ï¼‰è¿™ä¸ªæ–¹å‘æ˜¯å¯¹çš„ï¼Œä½†å¯èƒ½è¿˜éœ€è¦æ›´ä¸“ä¸šçš„æ„è§ã€‚ä¸è¿‡è°¢è°¢ä½ çš„å¸®åŠ©ï¼Œè‡³å°‘æœ‰äº†ä¸€äº›æ€è·¯ã€‚");
                                setTimeout(() => {
                                    gameState.affection += 5;
                                    updateStatsDisplay();
                                    showDialog("ç³»ç»Ÿ", "è™½ç„¶æ²¡èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œä½†ææ•™ç»ƒæ„Ÿè°¢ä½ çš„ç”¨å¿ƒå’Œä»˜å‡ºã€‚å¥½æ„Ÿåº¦æå‡ï¼");
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }
                    break;
                    
                case "chat_while_working":
                    showDialog("ç³»ç»Ÿ", "ä½ ä¸€è¾¹åˆ†æåˆåŒï¼Œä¸€è¾¹ä¸ææ•™ç»ƒèŠå¤©ï¼Œè¯•å›¾æ›´å¤šåœ°äº†è§£ä»–ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼Œä½ ä¸€ç›´éƒ½å¯¹ç¯®çƒè¿™ä¹ˆçƒ­çˆ±å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆç¨ä½œæ€è€ƒï¼‰å¤§å­¦æ—¶å¼€å§‹è®¤çœŸæ‰“çƒã€‚èµ·åˆåªæ˜¯å…´è¶£ï¼Œåæ¥æˆäº†èŒä¸šã€‚");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "é‚£ä½ ä¸ºä»€ä¹ˆé€‰æ‹©åšæ•™ç»ƒè€Œä¸æ˜¯ç»§ç»­ä½œä¸ºçƒå‘˜å‘¢ï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆçœ¼ç¥å¾®é»¯ï¼‰å—ä¼¤é€€å½¹ã€‚è†ç›–éŸ§å¸¦æ–­è£‚ï¼Œä¸é€‚åˆç»§ç»­é«˜å¼ºåº¦æ¯”èµ›ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "é‚£ä¸€å®šå¾ˆéš¾æ¥å—...ä»çƒå‘˜è½¬ä¸ºæ•™ç»ƒçš„è¿‡ç¨‹é¡ºåˆ©å—ï¼Ÿ");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "ï¼ˆéš¾å¾—åœ°å±•å¼€è¯é¢˜ï¼‰ä¸€å¼€å§‹å¾ˆå›°éš¾ã€‚çƒå‘˜å’Œæ•™ç»ƒæ˜¯ä¸¤ç§æ€ç»´æ–¹å¼ã€‚ï¼ˆé¡¿äº†é¡¿ï¼‰ä¸è¿‡æœ‰äººé¼“åŠ±æˆ‘èµ°è¿™æ¡è·¯ã€‚");
                                            setTimeout(() => {
                                                showDialog("ç»“åŸå¤å¥ˆ", "å“¦ï¼Ÿæ˜¯è°å•Šï¼Ÿ");
                                                setTimeout(() => {
                                                    showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…å˜å¾—å¤æ‚ï¼‰ä¸€ä¸ª...ç‰¹åˆ«çš„äººã€‚ï¼ˆçªç„¶è½¬å›å·¥ä½œï¼‰è¿™ä»½åˆåŒä½ çœ‹å¾—æ€ä¹ˆæ ·äº†ï¼Ÿ");
                                                    setTimeout(() => {
                                                        if (gameState.stats.law >= 45) {
                                                            showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ‰¾åˆ°äº†å‡ ä¸ªå¯¹æˆ‘ä»¬æœ‰åˆ©çš„æ¡æ¬¾ï¼ä½ çœ‹è¿™é‡Œ...");
                                                            setTimeout(() => {
                                                                showDialog("ç³»ç»Ÿ", "ä½ æˆåŠŸæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿè®©ææ•™ç»ƒæ•å¼€å¿ƒæ‰‰åˆ†äº«äº†ä¸€äº›ä¸ªäººæ•…äº‹ã€‚");
                                                                setTimeout(() => {
                                                                    gameState.flags.helpedWithContract = true;
                                                                    gameState.memoryFragments.push('fragment4');
                                                                    gameState.affection += 10;
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "ä½ ä¸ä»…å¸®åŠ©è§£å†³äº†é—®é¢˜ï¼Œè¿˜ä¸ææ•™ç»ƒå»ºç«‹äº†æ›´æ·±å±‚æ¬¡çš„è¿æ¥ã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                                                    unlockAchievement("æ•å¼€å¿ƒæ‰‰", "è®©ææ•™ç»ƒåˆ†äº«äº†ä»–çš„æ•…äº‹");
                                                                }, 2000);
                                                            }, 2000);
                                                        } else {
                                                            showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘è¿˜åœ¨ç ”ç©¶...è¿™äº›æ¡æ¬¾æ¯”æˆ‘æƒ³è±¡çš„æ›´å¤æ‚ã€‚");
                                                            setTimeout(() => {
                                                                showDialog("æå›½è‰¯", "æ²¡å…³ç³»ï¼Œèƒ½å¸®å¿™çœ‹å°±å·²ç»å¾ˆæ„Ÿè°¢äº†ã€‚");
                                                                setTimeout(() => {
                                                                    gameState.memoryFragments.push('fragment4');
                                                                    gameState.affection += 6;
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "è™½ç„¶æ²¡èƒ½å®Œå…¨è§£å†³åˆåŒé—®é¢˜ï¼Œä½†ä½ ä¸ææ•™ç»ƒçš„äº¤æµæ‹‰è¿‘äº†è·ç¦»ã€‚å¥½æ„Ÿåº¦æå‡ï¼");
                                                                }, 2000);
                                                            }, 2000);
                                                        }
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "discover_schedule":
                    characterImage.src = characters.guoliang;
                    showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°æ•™å¸ˆåŠå…¬åŒºï¼Œå‘ç°ææ•™ç»ƒçš„åŠå…¬å®¤é—¨å¼€ç€ï¼Œä½†é‡Œé¢æ²¡äººã€‚åŠå…¬æ¡Œä¸Šæ”¾ç€ä¸€ä»½å‘¨è®­ç»ƒè®¡åˆ’è¡¨ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰è¿™æ˜¯ææ•™ç»ƒçš„è®­ç»ƒå®‰æ’è¡¨ï¼æˆ‘å¯ä»¥çœ‹çœ‹ä»–å¹³æ—¶çš„è¡Œç¨‹å®‰æ’...", [
                            { text: "å·çœ‹è®­ç»ƒå®‰æ’è¡¨", next: "peek_schedule" },
                            { text: "ç¤¼è²Œç­‰å¾…", next: "wait_politely" }
                        ]);
                    }, 2000);
                    break;
                    
                case "peek_schedule":
                    showDialog("ç³»ç»Ÿ", "ä½ å·¦å³å¼ æœ›ï¼Œç¡®è®¤æ²¡äººæ³¨æ„ï¼Œç„¶åå¿«é€Ÿæµè§ˆææ•™ç»ƒçš„è®­ç»ƒå®‰æ’è¡¨ã€‚");
                    setTimeout(() => {
                        showDialog("ç³»ç»Ÿ", "è¡¨æ ¼è¯¦ç»†è®°å½•äº†ææ•™ç»ƒæ¯å‘¨çš„è®­ç»ƒæ—¶é—´ã€åœ°ç‚¹å’Œå†…å®¹ï¼Œè¿™å¯¹ä½ è®¡åˆ’å¶é‡ä»–éå¸¸æœ‰å¸®åŠ©ã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆçªç„¶å‡ºç°åœ¨é—¨å£ï¼‰åœ¨æ‰¾ä»€ä¹ˆï¼Ÿ");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "å•Šï¼ææ•™ç»ƒï¼æˆ‘...æˆ‘æ˜¯æ¥é—®ä¸€ä¸‹...", [
                                    { text: "å¦ç™½æ‰¿è®¤", next: "admit_peeking" },
                                    { text: "ç¼–ä¸ªç†ç”±", next: "make_excuse" }
                                ]);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "admit_peeking":
                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæ·±å‘¼å¸ï¼‰å¯¹ä¸èµ·ï¼Œæˆ‘çœ‹åˆ°è®­ç»ƒå®‰æ’è¡¨ï¼Œæœ‰ç‚¹å¥½å¥‡ã€‚æˆ‘ä¸åº”è¯¥æœªç»å…è®¸å°±çœ‹æ‚¨çš„æ–‡ä»¶ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆä¸¥è‚ƒåœ°çœ‹ç€ä½ ï¼‰è‡³å°‘ä½ å¦è¯šã€‚ï¼ˆèµ°åˆ°æ¡Œå‰ï¼‰æœ‰ä»€ä¹ˆç‰¹åˆ«æƒ³çŸ¥é“çš„å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘åªæ˜¯æƒ³äº†è§£çƒé˜Ÿçš„è®­ç»ƒå®‰æ’...å¯èƒ½çš„è¯ï¼Œæƒ³æ¥è§‚æ‘©å­¦ä¹ ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆè€ƒè™‘ç‰‡åˆ»ï¼‰å¦‚æœçœŸå¯¹ç¯®çƒæ„Ÿå…´è¶£ï¼Œæ²¡å¿…è¦å·çœ‹ã€‚ï¼ˆæ‹¿èµ·å®‰æ’è¡¨ï¼‰è¿™æ˜¯å…¬å¼€ä¿¡æ¯ï¼Œæƒ³äº†è§£å¯ä»¥ç›´æ¥é—®æˆ‘ã€‚");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "å¯¹ä¸èµ·ï¼Œæˆ‘ä»¥åä¼šç›´æ¥è¯¢é—®çš„ã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆè¯­æ°”ç¼“å’Œï¼‰è®­ç»ƒæ—¶é—´åœ¨è¡¨æ ¼ä¸Šï¼Œå¦‚æœæƒ³è§‚æ‘©ï¼Œæå‰å‘Šè¯‰æˆ‘ä¸€å£°ã€‚");
                                        setTimeout(() => {
                                            gameState.flags.knowsSchedule = true;
                                            gameState.affection += 1; // è¯šå®è·å¾—ä¸€ç‚¹å¥½æ„Ÿï¼Œä½†å·çœ‹å¯¼è‡´å°è±¡ä¸ä½³
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ä½ çš„å¦è¯šæŒ½å›äº†ä¸€äº›å°è±¡ï¼Œææ•™ç»ƒå…è®¸ä½ äº†è§£ä»–çš„è®­ç»ƒå®‰æ’ã€‚");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "make_excuse":
                    showDialog("ç»“åŸå¤å¥ˆ", "ææ•™ç»ƒï¼æˆ‘æ˜¯æ¥é—®å…³äºç¯®çƒç¤¾å›¢çš„äº‹æƒ…ã€‚æ­£å¥½çœ‹åˆ°æ‚¨çš„åŠå…¬å®¤é—¨å¼€ç€ï¼Œå°±æƒ³ç­‰æ‚¨ä¸€ä¸‹ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆæ€€ç–‘åœ°çœ‹ç€ä½ å’Œæ¡Œä¸Šçš„å®‰æ’è¡¨ï¼‰æ˜¯å—ï¼Ÿçœ‹èµ·æ¥ä½ å¯¹æˆ‘çš„è®­ç»ƒå®‰æ’å¾ˆæ„Ÿå…´è¶£ã€‚");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "å‘ƒ...æˆ‘åªæ˜¯ä¸å°å¿ƒçœ‹åˆ°äº†ã€‚çœŸçš„åªæ˜¯æ¥é—®ç¤¾å›¢çš„äº‹æƒ…ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆä¸ç½®å¯å¦ï¼‰ç¯®çƒç¤¾å›¢çš„äº‹æ‰¾ç¤¾é•¿ï¼Œä¸æ˜¯æ‰¾æˆ‘ã€‚ï¼ˆèµ°åˆ°æ¡Œå‰ï¼‰ä¸‹æ¬¡æœ‰äº‹ï¼Œæ•²é—¨ç­‰å›åº”å†è¿›æ¥ã€‚");
                                setTimeout(() => {
                                    gameState.affection -= 3; // æ’’è°å¯¼è‡´å¥½æ„Ÿåº¦ä¸‹é™
                                    updateStatsDisplay();
                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¼¼ä¹çœ‹ç©¿äº†ä½ çš„è°è¨€ï¼Œå¯¹ä½ çš„å°è±¡å˜å·®äº†ã€‚å¥½æ„Ÿåº¦-3");
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "wait_politely":
                    showDialog("ç³»ç»Ÿ", "ä½ å†³å®šåœ¨é—¨å¤–ç­‰å¾…ææ•™ç»ƒå›æ¥ï¼Œä¸å»ç¿»çœ‹ä»–çš„ç§äººç‰©å“ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆå‡ åˆ†é’Ÿåå›åˆ°åŠå…¬å®¤ï¼‰ç»“åŸåŒå­¦ï¼Ÿæœ‰äº‹æ‰¾æˆ‘ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "æ˜¯çš„ï¼Œææ•™ç»ƒã€‚æˆ‘æƒ³äº†è§£ä¸€ä¸‹çƒé˜Ÿçš„è®­ç»ƒå®‰æ’ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œæƒ³æ¥è§‚æ‘©å­¦ä¹ ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "ï¼ˆç•¥æ˜¾æ„å¤–ï¼‰å¯¹ç¯®çƒæ„Ÿå…´è¶£ï¼Ÿï¼ˆèµ°åˆ°æ¡Œå‰æ‹¿èµ·å®‰æ’è¡¨ï¼‰è¿™æ˜¯è®­ç»ƒæ—¶é—´è¡¨ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚æœ‰å…´è¶£çš„è¯ï¼Œéšæ—¶å¯ä»¥æ¥ã€‚");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "çœŸçš„å—ï¼Ÿå¤ªæ„Ÿè°¢äº†ï¼æˆ‘ä¸€å®šä¼šå¥½å¥½å­¦ä¹ çš„ï¼");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "ï¼ˆéš¾å¾—åœ°å¾®å¾®ç‚¹å¤´ï¼‰æ€åº¦ä¸é”™ã€‚å­¦ä¹ ä»»ä½•ä¸œè¥¿éƒ½éœ€è¦è€å¿ƒå’Œå°Šé‡ã€‚");
                                        setTimeout(() => {
                                            gameState.flags.knowsSchedule = true;
                                            gameState.affection += 5;
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ä½ çš„ç¤¼è²Œå’ŒçœŸè¯šæ‰“åŠ¨äº†ææ•™ç»ƒï¼Œä»–ä¸»åŠ¨åˆ†äº«äº†è®­ç»ƒå®‰æ’ã€‚å¥½æ„Ÿåº¦+5");
                                            unlockAchievement("è¯šä¿¡ä¹‹å¿ƒ", "ç”¨ç¤¼è²Œèµ¢å¾—äº†å°Šé‡");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "basketball_lesson":
                    characterImage.src = characters.guoliang;
                    gameState.flags.taughtBasketball = true;
                    showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°ç¯®çƒåœºï¼Œå‘ç°è®­ç»ƒåˆšåˆšç»“æŸï¼Œåªæœ‰ææ•™ç»ƒä¸€äººè¿˜åœ¨åœºä¸ŠæŠ•ç¯®ã€‚ä»–çš„æ¯ä¸ªåŠ¨ä½œéƒ½å……æ»¡åŠ›é‡å’Œç²¾å‡†ï¼Œçœ‹èµ·æ¥å¼‚å¸¸å¸…æ°”ã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰å¤©å•Šï¼Œä»–è¿æŠ•ç¯®çš„æ ·å­éƒ½è¿™ä¹ˆè¿·äºº...");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆæ³¨æ„åˆ°ä½ ï¼‰ç»“åŸï¼Ÿæœ‰äº‹ï¼Ÿ");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘...æˆ‘æƒ³å­¦ä¹ ä¸€ä¸‹åŸºæœ¬çš„ç¯®çƒæŠ€å·§ã€‚ä¸€ç›´çœ‹æ‚¨è®­ç»ƒçƒé˜Ÿï¼Œè‡ªå·±ä¹Ÿæƒ³è¯•è¯•ã€‚", [
                                    { text: "è¯·æ±‚åŸºæœ¬æŒ‡å¯¼", next: "ask_basic_guidance" },
                                    { text: "æ‰¿è®¤å®Œå…¨ä¸æ‡‚", next: "admit_ignorance" }
                                ]);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "ask_basic_guidance":
                    showDialog("ç»“åŸå¤å¥ˆ", "èƒ½æ•™æˆ‘ä¸€äº›åŸºç¡€çš„æŠ•ç¯®å§¿åŠ¿å—ï¼Ÿæˆ‘æƒ³äº²è‡ªä½“éªŒä¸€ä¸‹ç¯®çƒçš„ä¹è¶£ã€‚");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆè€ƒè™‘ç‰‡åˆ»ï¼‰...å¥½ã€‚ï¼ˆæ‹¿èµ·çƒé€’ç»™ä½ ï¼‰å…ˆæ„Ÿå—ä¸€ä¸‹çƒçš„é‡é‡å’Œæ‰‹æ„Ÿã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ä½ æ¥è¿‡çƒï¼Œæ„Ÿå—å®ƒçš„çº¹ç†å’Œé‡é‡ã€‚ææ•™ç»ƒç«™åœ¨ä½ èº«æ—ï¼Œå¼€å§‹è€å¿ƒè®²è§£ã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "åŒè„šä¸è‚©åŒå®½ï¼ŒæŒçƒçš„æ‰‹æŒè¦æœ‰ç©ºéš™ï¼Œä¸è¦è´´ç€çƒé¢...");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ä½ æŒ‰ç…§æŒ‡å¯¼åšå‡ºåŠ¨ä½œï¼Œä½†ç¬¬ä¸€æ¬¡å°è¯•æ—¶çƒå®Œå…¨åç¦»äº†ç¯®ç­ã€‚");
                                    setTimeout(() => {
                                        showDialog("æå›½è‰¯", "æ‰‹è…•å‘åŠ›ä¸å¤Ÿã€‚ï¼ˆèµ°è¿‘ä½ ï¼‰æ‰‹è‡‚è¦è¿™æ ·ã€‚");
                                        setTimeout(() => {
                                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒç«™åˆ°ä½ èº«åï¼Œå¥å£®çš„æ‰‹è‡‚è½»è½»æ‰¶ç€ä½ çš„æ‰‹è‚˜ï¼Œå¸®ä½ è°ƒæ•´å§¿åŠ¿ã€‚ä»–çš„ä½“æ¸©å’Œæ°”æ¯è¿‘åœ¨å’«å°ºï¼Œè®©ä½ å¿ƒè·³åŠ é€Ÿã€‚");
                                            setTimeout(() => {
                                                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆè„¸çº¢ï¼‰è¿™...è¿™æ ·å—ï¼Ÿ");
                                                setTimeout(() => {
                                                    showDialog("æå›½è‰¯", "å¯¹ï¼Œç„¶åæ‰‹è…•å‘å‰ä¸€æ¨ã€‚ï¼ˆä»–çš„æ‰‹è½»è½»å¼•å¯¼ä½ çš„åŠ¨ä½œï¼‰");
                                                    setTimeout(() => {
                                                        showDialog("ç³»ç»Ÿ", "åœ¨ææ•™ç»ƒçš„å¼•å¯¼ä¸‹ï¼Œä½ çš„çƒç»ˆäºæŠ•è¿›äº†ç¯®ç­ã€‚");
                                                        setTimeout(() => {
                                                            showDialog("ç»“åŸå¤å¥ˆ", "è¿›äº†ï¼å¤ªç¥å¥‡äº†ï¼");
                                                            setTimeout(() => {
                                                                showDialog("æå›½è‰¯", "ï¼ˆç½•è§åœ°å¾®ç¬‘ï¼‰ä¸é”™çš„è¿›æ­¥ã€‚ç¯®çƒéœ€è¦è€å¿ƒå’ŒæŒç»­ç»ƒä¹ ã€‚");
                                                                setTimeout(() => {
                                                                    gameState.stats.basketball += 5;
                                                                    gameState.affection += 8;
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒäº²è‡ªæ•™ä½ æ‰“ç¯®çƒï¼Œä½ ä»¬ä¹‹é—´çš„è·ç¦»æ‹‰è¿‘äº†ã€‚ç¯®çƒæŠ€èƒ½+5ï¼Œå¥½æ„Ÿåº¦+8");
                                                                    unlockAchievement("åˆå­¦ç¯®çƒ", "æ¥å—äº†ææ•™ç»ƒçš„ç§äººæŒ‡å¯¼");
                                                                }, 2000);
                                                            }, 2000);
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "admit_ignorance":
                    showDialog("ç»“åŸå¤å¥ˆ", "è€å®è¯´ï¼Œæˆ‘å¯¹ç¯®çƒä¸€çªä¸é€šï¼Œè¿æ€ä¹ˆæ­£ç¡®æŒçƒéƒ½ä¸å¤ªæ¸…æ¥šã€‚ä½†æˆ‘çœŸçš„å¾ˆæƒ³å­¦ï¼");
                    setTimeout(() => {
                        showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ç¼“å’Œï¼‰æ‰¿è®¤æ— çŸ¥æ˜¯å­¦ä¹ çš„ç¬¬ä¸€æ­¥ã€‚ï¼ˆæ‹¿èµ·çƒï¼‰æ¥ï¼Œè¯•è¯•åŸºæœ¬æŒçƒå§¿åŠ¿ã€‚");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒå¸¦ç€éš¾å¾—çš„è€å¿ƒï¼Œä»æœ€åŸºç¡€çš„æ¡çƒæ–¹å¼å¼€å§‹æ•™ä½ ã€‚ä»–çš„å£°éŸ³è™½ç„¶ä¾æ—§ä½æ²‰ï¼Œä½†è¯­æ°”æŸ”å’Œäº†è®¸å¤šã€‚");
                            setTimeout(() => {
                                showDialog("æå›½è‰¯", "æ‰‹æŒ‡å¼ å¼€ï¼Œä¸è¦ç”¨æŒå¿ƒæ¥è§¦çƒé¢ã€‚ï¼ˆä»–çš„å¤§æ‰‹è½»è½»è°ƒæ•´ä½ çš„æ‰‹æŒ‡ä½ç½®ï¼‰");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒçš„æ‰‹è§¦ç¢°åˆ°ä½ çš„æ‰‹æŒ‡ï¼Œé‚£ç²—ç³™è€Œæ¸©æš–çš„è§¦æ„Ÿè®©ä½ å¿ƒè·³æ¼äº†ä¸€æ‹ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆç´§å¼ åœ°ï¼‰è¿™...è¿™æ ·å¯¹å—ï¼Ÿ");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "å¯¹ï¼Œç„¶åè¯•ç€æŠ•çƒã€‚è‚˜éƒ¨ä¼¸ç›´ï¼Œæ‰‹è…•å‘åŠ›ã€‚");
                                            setTimeout(() => {
                                                showDialog("ç³»ç»Ÿ", "ä½ è¯•ç€æŠ•çƒï¼Œè™½ç„¶æ²¡è¿›ï¼Œä½†è‡³å°‘æ–¹å‘å¯¹äº†ã€‚ææ•™ç»ƒç»§ç»­è€å¿ƒæŒ‡å¯¼ï¼Œç›´åˆ°ä½ ç»ˆäºæŠ•è¿›ä¸€çƒã€‚");
                                                setTimeout(() => {
                                                    showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æŠ•è¿›äº†ï¼ï¼ˆæ¿€åŠ¨åœ°è·³èµ·æ¥ï¼‰è°¢è°¢ä½ çš„æŒ‡å¯¼ï¼Œææ•™ç»ƒï¼");
                                                    setTimeout(() => {
                                                        showDialog("æå›½è‰¯", "ï¼ˆå¾®å¾®ç‚¹å¤´ï¼‰å¤©åˆ†ä¸é”™ã€‚ï¼ˆé¡¿äº†é¡¿ï¼‰æˆ‘åˆšå¼€å§‹æ‰“çƒæ—¶ï¼Œä¹Ÿæœ‰äººè¿™æ ·æ•™æˆ‘ã€‚");
                                                        setTimeout(() => {
                                                            showDialog("ç»“åŸå¤å¥ˆ", "æ˜¯è°å•Šï¼Ÿä½ çš„æ•™ç»ƒå—ï¼Ÿ");
                                                            setTimeout(() => {
                                                                showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…ä¸€ç¬é—´å¤æ‚ï¼‰...ä¸€ä¸ªé‡è¦çš„äººã€‚ï¼ˆè½¬ç§»è¯é¢˜ï¼‰ç»§ç»­ç»ƒä¹ å§ï¼ŒåŸºç¡€å¾ˆé‡è¦ã€‚");
                                                                setTimeout(() => {
                                                                    gameState.stats.basketball += 5;
                                                                    gameState.affection += 10;
                                                                    gameState.memoryFragments.push('fragment2');
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "ææ•™ç»ƒä¸ä»…æ•™ä½ æ‰“ç¯®çƒï¼Œè¿˜åˆ†äº«äº†ä»–çš„ä¸€æ®µå›å¿†ã€‚ä½ ä»¬çš„å…³ç³»æ˜æ˜¾æ›´äº²è¿‘äº†ã€‚ç¯®çƒæŠ€èƒ½+5ï¼Œå¥½æ„Ÿåº¦+10");
                                                                    unlockAchievement("ç‰¹åˆ«çš„å­¦ç”Ÿ", "è®©ææ•™ç»ƒå›å¿†èµ·ç‰¹åˆ«çš„è¿‡å»");
                                                                }, 2000);
                                                            }, 2000);
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "office_law_help":
                    showDialog("æå›½è‰¯", "ï¼ˆæ¥è¿‡ä½ çš„ç¬”è®°ï¼Œè®¤çœŸç¿»é˜…ï¼‰è¿™äº›...å¾ˆä¸“ä¸šã€‚");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ•´ç†äº†å‡ ä¸ªä½“è‚²èµåŠ©åˆåŒå¸¸è§çš„æ³•å¾‹é™·é˜±å’Œè§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨é¢ä¸´åˆåŒé—®é¢˜ï¼Œå¸Œæœ›èƒ½æœ‰æ‰€å¸®åŠ©ã€‚");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆæŠ¬å¤´çœ‹ä½ ï¼Œç›®å…‰ä¸­æœ‰ç€ç½•è§çš„èµèµï¼‰ç¡®å®æœ‰å¸®åŠ©ã€‚çƒé˜Ÿæ­£å¥½é‡åˆ°ä¸€äº›èµåŠ©é—®é¢˜ã€‚");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "å¦‚æœéœ€è¦æ›´å…·ä½“çš„å¸®åŠ©ï¼Œæˆ‘éšæ—¶å¯ä»¥æä¾›æ”¯æŒã€‚æˆ‘åœ¨å•†æ³•è¯¾ä¸Šæˆç»©ä¸€ç›´å¾ˆå¥½ï¼Œä¹Ÿå‚åŠ è¿‡å‡ æ¬¡å•†æ³•ç«èµ›ã€‚");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆæ²‰æ€ç‰‡åˆ»ï¼‰å…¶å®...æœ‰ä¸€ä»½åˆåŒæˆ‘æ­£åœ¨çƒ¦æ¼ã€‚ï¼ˆä»æŠ½å±‰é‡Œæ‹¿å‡ºæ–‡ä»¶ï¼‰ä½ æ„¿æ„çœ‹çœ‹å—ï¼Ÿ");
                                    setTimeout(() => {
                                        showDialog("ç³»ç»Ÿ", "ä½ å’Œææ•™ç»ƒä¸€èµ·ç ”ç©¶åˆåŒï¼Œä½ çš„ä¸“ä¸šçŸ¥è¯†ç»™ä»–ç•™ä¸‹äº†æ·±åˆ»å°è±¡ã€‚è®¨è®ºä¸­ï¼Œä½ ä»¬çš„è·ç¦»ä¼¼ä¹æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½è¿‘ã€‚");
                                        setTimeout(() => {
                                            if (gameState.stats.law >= 55) {
                                                showDialog("æå›½è‰¯", "ï¼ˆæƒŠè®¶ï¼‰ä½ æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ...å­¦æ ¡æ³•åŠ¡éƒ¨é—¨éƒ½æ²¡æ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚");
                                                setTimeout(() => {
                                                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¾®ç¬‘ï¼‰æœ‰æ—¶å€™å¤šä¸€åŒçœ¼ç›çœ‹é—®é¢˜ä¼šæœ‰ä¸åŒå‘ç°ã€‚");
                                                    setTimeout(() => {
                                                        showDialog("æå›½è‰¯", "ï¼ˆéš¾å¾—åœ°ç›´è§†ä½ ï¼‰ç»“åŸåŒå­¦ï¼Œä½ ä¸ä»…ä»…æ˜¯ä¸ªå­¦ç”Ÿ...ä½ æœ‰çœŸæ‰å®å­¦ã€‚ï¼ˆé¡¿äº†é¡¿ï¼‰è¿™è®©æˆ‘æƒ³èµ·äº†ä¸€ä¸ªäººã€‚");
                                                        setTimeout(() => {
                                                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¥½å¥‡ï¼‰æ˜¯è°å•Šï¼Ÿ");
                                                            setTimeout(() => {
                                                                showDialog("æå›½è‰¯", "ï¼ˆè¡¨æƒ…å˜å¾—å¤æ‚ï¼‰...ä¸€æ®µå¾€äº‹äº†ã€‚ï¼ˆè½¬ç§»è¯é¢˜ï¼‰è°¢è°¢ä½ çš„å¸®åŠ©ï¼Œè¿™å¯¹çƒé˜Ÿå¾ˆé‡è¦ã€‚");
                                                                setTimeout(() => {
                                                                    gameState.flags.helpedWithContract = true;
                                                                    gameState.memoryFragments.push('fragment7');
                                                                    gameState.affection += 15;
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "ä½ æˆåŠŸè¿ç”¨ä¸“ä¸šçŸ¥è¯†å¸®åŠ©ææ•™ç»ƒè§£å†³äº†éš¾é¢˜ï¼Œä»–å¯¹ä½ åˆ®ç›®ç›¸çœ‹ã€‚å¥½æ„Ÿåº¦å¤§å¹…æå‡ï¼");
                                                                    unlockAchievement("æ³•å¾‹æ™ºè€…", "ç”¨ä¸“ä¸šçŸ¥è¯†è§£å†³äº†æ£˜æ‰‹é—®é¢˜");
                                                                }, 2000);
                                                            }, 2000);
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            } else {
                                                showDialog("æå›½è‰¯", "è°¢è°¢ä½ çš„å»ºè®®ã€‚è™½ç„¶é—®é¢˜è¿˜éœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼Œä½†ä½ çš„åˆ†æç»™äº†æˆ‘æ–°æ€è·¯ã€‚");
                                                setTimeout(() => {
                                                    gameState.affection += 7;
                                                    updateStatsDisplay();
                                                    showDialog("ç³»ç»Ÿ", "è™½ç„¶æ²¡èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œä½†ä½ çš„ä¸“ä¸šæ€åº¦å’Œçƒ­å¿ƒå¸®åŠ©è®©ææ•™ç»ƒå°è±¡æ·±åˆ»ã€‚å¥½æ„Ÿåº¦æå‡ï¼");
                                                }, 2000);
                                            }
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "law_help_offer":
                    showDialog("æå›½è‰¯", "ï¼ˆæƒŠè®¶ï¼‰ä½ è¯´ä»€ä¹ˆï¼Ÿ");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘æ³¨æ„åˆ°æ‚¨åˆšæ‰çœ‹çš„æ–‡ä»¶æ˜¯å…³äºåˆåŒçš„ã€‚æˆ‘æ°å¥½æ˜¯å•†æ³•ä¸“ä¸šçš„å­¦ç”Ÿï¼Œå¦‚æœçƒé˜Ÿé‡åˆ°æ³•å¾‹é—®é¢˜ï¼Œä¹Ÿè®¸æˆ‘èƒ½å¸®ä¸Šå¿™ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("æå›½è‰¯", "ï¼ˆæ²‰æ€ç‰‡åˆ»ï¼‰ç¡®å®æœ‰ä¸€äº›èµåŠ©åˆåŒçš„éº»çƒ¦...");
                            setTimeout(() => {
                                showDialog("ç»“åŸå¤å¥ˆ", "æˆ‘å‚åŠ è¿‡å•†æ³•ç«èµ›ï¼Œå¯¹ä½“è‚²èµåŠ©åˆåŒä¹Ÿæœ‰ç ”ç©¶ã€‚è‡³å°‘å¯ä»¥æä¾›ä¸€äº›åˆæ­¥å»ºè®®ï¼Ÿ");
                                setTimeout(() => {
                                    showDialog("æå›½è‰¯", "ï¼ˆçŠ¹è±«ï¼‰è¿™æ˜¯å­¦æ ¡çš„æ­£å¼äº‹åŠ¡ï¼Œå­¦ç”Ÿå‚ä¸ä¸å¤ªåˆé€‚...");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "å°±å½“æ˜¯æˆ‘çš„å®è·µå­¦ä¹ ï¼Ÿæˆ‘å¯ä»¥å…ˆçœ‹çœ‹ï¼Œå¦‚æœèƒ½å¸®ä¸Šå¿™æœ€å¥½ï¼Œä¸è¡Œçš„è¯ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚");
                                        setTimeout(() => {
                                            showDialog("æå›½è‰¯", "...å¥½å§ã€‚ï¼ˆä»åŒ…é‡Œæ‹¿å‡ºæ–‡ä»¶å¤¹ï¼‰ä¸‹å‘¨äºŒä¸‹åˆä¸‰ç‚¹ï¼ŒåŠå…¬å®¤ã€‚å¦‚æœä½ çœŸæœ‰å…´è¶£å¸®å¿™çš„è¯ã€‚");
                                            setTimeout(() => {
                                                gameState.flags.discoveredLawConnection = true;
                                                gameState.affection += 5;
                                                updateStatsDisplay();
                                                showDialog("ç³»ç»Ÿ", "ä½ ä¸»åŠ¨å±•ç¤ºäº†è‡ªå·±çš„ä¸“ä¸šä»·å€¼ï¼Œææ•™ç»ƒå¯¹ä½ å¦çœ¼ç›¸çœ‹ã€‚å¥½æ„Ÿåº¦+5");
                                                unlockAchievement("ä¸“ä¸šå±•ç¤º", "å±•ç¤ºäº†è‡ªå·±çš„æ³•å¾‹ä¸“é•¿");
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "rival_introduction":
                    characterImage.src = characters.rival;
                    bgImage.src = backgrounds.cafe;
                    showDialog("ç³»ç»Ÿ", "ä½ åœ¨å’–å•¡å…å­¦ä¹ æ—¶ï¼Œå¬åˆ°é‚»æ¡Œå‡ ä¸ªå¥³ç”Ÿåœ¨çƒ­çƒˆè®¨è®ºç€ä»€ä¹ˆã€‚");
                    setTimeout(() => {
                        showDialog("å¥³ç”ŸA", "ä½ ä»¬å¬è¯´äº†å—ï¼Ÿä½“è‚²ç³»çš„ç›¸æ³½å­¦å§æœ€è¿‘ä¸€ç›´åœ¨æ¥è¿‘ææ•™ç»ƒï¼");
                        setTimeout(() => {
                            showDialog("å¥³ç”ŸB", "çœŸçš„å‡çš„ï¼Ÿé‚£ä¸ªæ ¡èŠ±çº§äººç‰©ï¼Ÿå¥¹ä¸æ˜¯æœ‰å¾ˆå¤šè¿½æ±‚è€…å—ï¼Œæ€ä¹ˆä¼šå¯¹ææ•™ç»ƒæ„Ÿå…´è¶£ï¼Ÿ");
                            setTimeout(() => {
                                showDialog("å¥³ç”ŸC", "å¬è¯´å¥¹è´Ÿè´£çš„å­¦ç”Ÿä¼šä½“è‚²éƒ¨æœ€è¿‘è¦å’Œç¯®çƒé˜Ÿåˆä½œï¼Œå€Ÿæœºä¼šç»å¸¸æ‰¾ææ•™ç»ƒ'è®¨è®ºå·¥ä½œ'å‘¢ï¼");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "ä½ ä¸ç”±è‡ªä¸»åœ°ç«–èµ·è€³æœµï¼Œå¿ƒé‡Œæ¶Œèµ·ä¸€è‚¡è«åçš„ä¸å®‰ã€‚");
                                    setTimeout(() => {
                                        showDialog("å¥³ç”ŸA", "è€Œä¸”æ®è¯´ç›¸æ³½å­¦å§ä¸ä»…äººç¾ï¼Œè¿˜æ˜¯è¿åŠ¨å¥å°†ï¼Œå›½ä¸­æ—¶è¿˜æ˜¯ç¯®çƒæ ¡é˜Ÿçš„ï¼è¿™ä¸‹ææ•™ç»ƒè‚¯å®šä¼šè¢«å¸å¼•å§ï¼Ÿ");
                                        setTimeout(() => {
                                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰ç›¸æ³½...ï¼Ÿè¿™ä¸ªåå­—æ€ä¹ˆæœ‰ç‚¹ç†Ÿæ‚‰ï¼Ÿ", [
                                                { text: "ç»§ç»­å·å¬", next: "continue_eavesdropping" },
                                                { text: "ä¸»åŠ¨æ‰“å¬", next: "ask_about_rival" }
                                            ]);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "continue_eavesdropping":
                    showDialog("ç³»ç»Ÿ", "ä½ å‡è£…çœ‹ä¹¦ï¼Œå®é™…ä¸Šå…¨ç¥è´¯æ³¨åœ°å¬ç€é‚»æ¡Œçš„è°ˆè¯ã€‚");
                    setTimeout(() => {
                        showDialog("å¥³ç”ŸB", "ä¸è¿‡ææ•™ç»ƒä¸æ˜¯å‡ºäº†åçš„å†·æ¼ å—ï¼Ÿå¬è¯´å¾ˆå¤šå¥³ç”Ÿéƒ½è¢«ä»–å†°å±±è„¸æ‹’ç»è¿‡ã€‚");
                        setTimeout(() => {
                            showDialog("å¥³ç”ŸC", "ä½†ç›¸æ³½å­¦å§å’Œä»–æ˜¯åŒå±Šæ ¡å‹å•Šï¼æ®è¯´ä»¥å‰å°±è®¤è¯†ï¼Œæœ‰å…±åŒè¯é¢˜ã€‚");
                            setTimeout(() => {
                                showDialog("å¥³ç”ŸA", "è€Œä¸”æˆ‘å‰å‡ å¤©äº²çœ¼çœ‹åˆ°ä»–ä»¬ä¸€èµ·åƒé¥­ï¼ææ•™ç»ƒå±…ç„¶è¿˜å¾®ç¬‘äº†ï¼");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "å¬åˆ°è¿™é‡Œï¼Œä½ æ„Ÿåˆ°ä¸€é˜µè«åçš„é…¸æ¥šå’Œä¸å®‰ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆå¿ƒæƒ³ï¼‰åŒå±Šæ ¡å‹ï¼Ÿéš¾é“...ä»–ä»¬æœ‰è¿‡å»çš„è”ç³»ï¼Ÿè¿™ç§æ„Ÿè§‰æ˜¯...å«‰å¦’å—ï¼Ÿ");
                                        setTimeout(() => {
                                            gameState.flags.rivalAppeared = true;
                                            gameState.mood = "æ‹…å¿§";
                                            updateStatsDisplay();
                                            showDialog("ç³»ç»Ÿ", "ä½ å¾—çŸ¥äº†æ½œåœ¨çš„'æƒ…æ•Œ'å­˜åœ¨ï¼Œè¿™è®©ä½ æ„Ÿåˆ°ä¸€ä¸å±æœºæ„Ÿã€‚ä¹Ÿè®¸ä½ åº”è¯¥æ›´ç§¯æä¸»åŠ¨åœ°æ¥è¿‘ææ•™ç»ƒï¼Ÿ");
                                            unlockAchievement("å±æœºæ„Ÿ", "å‘ç°äº†æ½œåœ¨çš„æƒ…æ•Œ");
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "ask_about_rival":
                    showDialog("ç»“åŸå¤å¥ˆ", "ä¸å¥½æ„æ€ï¼Œæˆ‘æ— æ„ä¸­å¬åˆ°ä½ ä»¬æåˆ°ç›¸æ³½å­¦å§å’Œææ•™ç»ƒ...å¥¹æ˜¯è°å‘¢ï¼Ÿ");
                    setTimeout(() => {
                        showDialog("å¥³ç”ŸA", "ï¼ˆæƒŠè®¶åœ°çœ‹ç€ä½ ï¼‰å•Šï¼Œä½ æ˜¯å¯¹ææ•™ç»ƒæœ‰å…´è¶£å—ï¼Ÿ");
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ä¸ï¼Œæˆ‘åªæ˜¯...ï¼ˆè„¸çº¢ï¼‰åœ¨ç¯®çƒé˜Ÿå¸®å¿™ï¼Œæ‰€ä»¥æœ‰ç‚¹å¥½å¥‡ã€‚");
                            setTimeout(() => {
                                showDialog("å¥³ç”ŸC", "ç›¸æ³½ç¾å’²ï¼Œå¤§å››ä½“è‚²ç³»çš„å­¦å§ï¼Œå­¦ç”Ÿä¼šä½“è‚²éƒ¨éƒ¨é•¿ã€‚åˆç¾åˆå¼ºï¼Œæ˜¯æ ¡å›­åäººå‘¢ï¼");
                                setTimeout(() => {
                                    showDialog("å¥³ç”ŸB", "å¥¹å’Œææ•™ç»ƒå¥½åƒæ˜¯åŒå±ŠåŒå­¦ï¼Œæ®è¯´å…³ç³»ä¸ä¸€èˆ¬å“¦ï¼æœ€è¿‘ç»å¸¸çœ‹åˆ°ä»–ä»¬ä¸€èµ·åƒé¥­è®¨è®ºäº‹æƒ…ã€‚");
                                    setTimeout(() => {
                                        showDialog("ç³»ç»Ÿ", "å¬ç€å¥³ç”Ÿä»¬çš„æè¿°ï¼Œä½ è„‘æµ·ä¸­æµ®ç°å‡ºä¸€ä¸ªå…‰èŠ’ä¸‡ä¸ˆçš„å®Œç¾å­¦å§å½¢è±¡ï¼Œä¸ä¹‹ç›¸æ¯”ï¼Œè‡ªå·±ä»¿ä½›é»¯ç„¶å¤±è‰²ã€‚");
                                        setTimeout(() => {
                                            showDialog("ç»“åŸå¤å¥ˆ", "è°¢è°¢å‘Šè¯‰æˆ‘ã€‚ï¼ˆå¼ºæŒ¤å‡ºå¾®ç¬‘ï¼‰");
                                            setTimeout(() => {
                                                showDialog("å¥³ç”ŸA", "ï¼ˆæ„å‘³æ·±é•¿åœ°ç¬‘ï¼‰å¦‚æœä½ ä¹Ÿå–œæ¬¢ææ•™ç»ƒï¼Œå¯è¦åŠ æ²¹å“¦ï¼å¬è¯´ç›¸æ³½å­¦å§æœ€è¿‘åŠ¨ä½œå¾ˆç§¯æå‘¢ï¼");
                                                setTimeout(() => {
                                                    gameState.flags.rivalAppeared = true;
                                                    gameState.mood = "ä¸å®‰";
                                                    updateStatsDisplay();
                                                    showDialog("ç³»ç»Ÿ", "ä½ å¾—çŸ¥äº†å¼ºå¤§çš„ç«äº‰å¯¹æ‰‹å­˜åœ¨ï¼Œè¿™è®©ä½ æ„Ÿåˆ°å‹åŠ›å’Œä¸å®‰ã€‚ä¹Ÿè®¸ä½ éœ€è¦å±•ç¤ºè‡ªå·±ç‹¬ç‰¹çš„ä¸€é¢ï¼Œæ‰èƒ½å¸å¼•ææ•™ç»ƒçš„æ³¨æ„ï¼Ÿ");
                                                    unlockAchievement("æƒ…æ•Œå‡ºç°", "äº†è§£åˆ°äº†æ½œåœ¨çš„ç«äº‰å¯¹æ‰‹");
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "memory_dream":
                    bgImage.src = backgrounds.park;
                    showDialog("ç³»ç»Ÿ", "ä½ åšäº†ä¸€ä¸ªå¥‡æ€ªçš„æ¢¦ã€‚æ¢¦ä¸­ï¼Œä½ ç«™åœ¨æ¨±èŠ±ç››å¼€çš„æ ¡å›­é‡Œï¼Œå‘¨å›´çš„ä¸€åˆ‡éƒ½æ¨¡ç³Šä¸æ¸…ï¼Œå”¯æœ‰é¢å‰çš„é‚£ä¸ªäººå½±å¼‚å¸¸æ¸…æ™°ã€‚");
                    setTimeout(() => {
                        showDialog("???", "ç»“åŸï¼Œå¦‚æœæˆ‘æˆä¸ºæ•™ç»ƒï¼Œä½ å°±...")
                        setTimeout(() => {
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæ¢¦ä¸­ï¼‰ä»€ä¹ˆï¼Ÿä½ è¯´ä»€ä¹ˆï¼Ÿï¼ˆä½ åŠªåŠ›å»å¬ï¼Œä½†å£°éŸ³å´è¶Šæ¥è¶Šè¿œï¼‰");
                            setTimeout(() => {
                                showDialog("ç³»ç»Ÿ", "æ¢¦ä¸­äººå½±çš„è„¸å§‹ç»ˆæ¨¡ç³Šä¸æ¸…ï¼Œä½†é‚£èº«å½¢ã€é‚£å£°éŸ³ï¼Œå´è®©ä½ æ„Ÿåˆ°æ— æ¯”ç†Ÿæ‚‰...");
                                setTimeout(() => {
                                    showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆæƒŠé†’ï¼‰é‚£ä¸ªäººæ˜¯...ææ•™ç»ƒï¼Ÿä¸ï¼Œé‚£æ—¶ä»–è¿˜ä¸æ˜¯æ•™ç»ƒ...é‚£æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä¼šæ¢¦åˆ°è¿™ä¸ªï¼Ÿ");
                                    setTimeout(() => {
                                        if (!gameState.memoryFragments.includes('fragment5')) {
                                            gameState.memoryFragments.push('fragment5');
                                        }
                                        updateStatsDisplay();
                                        showDialog("ç³»ç»Ÿ", "è¿™ä¸ªæ¢¦è®©ä½ æ„Ÿåˆ°å›°æƒ‘åˆå¿ƒè·³åŠ é€Ÿã€‚ä½ å’Œææ•™ç»ƒçš„è¿‡å»ï¼Œä¼¼ä¹æ¯”ä½ è®°å¿†ä¸­çš„è¦å¤æ‚å¾—å¤š...");
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
                    
                case "memory_trigger":
                    bgImage.src = backgrounds.home;
                    showDialog("ç³»ç»Ÿ", "å¤œæ™šï¼Œä½ èººåœ¨åºŠä¸Šï¼Œç¿»æ¥è¦†å»æ— æ³•å…¥ç¡ã€‚è¿‡å»å‡ å‘¨ä¸ææ•™ç»ƒçš„äº’åŠ¨åœ¨è„‘æµ·ä¸­ä¸æ–­æµ®ç°ï¼Œè¿˜æœ‰é‚£äº›å¥‡æ€ªçš„æ¢¦å¢ƒç¢ç‰‡...");
                    setTimeout(() => {
                        showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆè‡ªè¨€è‡ªè¯­ï¼‰ä¸ºä»€ä¹ˆæˆ‘æ€»è§‰å¾—ä¸ä»–ä¹‹é—´æœ‰ä»€ä¹ˆè¢«é—å¿˜çš„è”ç³»ï¼Ÿé‚£äº›æ¢¦ï¼Œé‚£äº›ç†Ÿæ‚‰çš„æ„Ÿè§‰...");
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "çªç„¶ï¼Œä¸€é˜µå‰§çƒˆçš„å¤´ç—›è¢­æ¥ï¼Œä½ æŠ±ä½å¤´ï¼Œçœ¼å‰é—ªè¿‡æ— æ•°æ¨¡ç³Šçš„ç”»é¢ã€‚");
                            setTimeout(() => {
                                bgImage.src = backgrounds.park;
                                showDialog("ç³»ç»Ÿ", "æ¨±èŠ±æ ‘ä¸‹ï¼Œä½ å’Œä¸€ä¸ªé«˜å¤§çš„èº«å½±å¹¶è‚©è€Œç«‹...");
                                setTimeout(() => {
                                    showDialog("ç³»ç»Ÿ", "å›¾ä¹¦é¦†é‡Œï¼Œä½ ä»¬ä¿¯é¦–ç ”è¯»åŒä¸€æœ¬å•†æ³•æ•™æï¼Œæ¿€çƒˆè®¨è®ºç€æŸä¸ªæ¡ˆä¾‹...");
                                    setTimeout(() => {
                                        showDialog("ç³»ç»Ÿ", "ç¯®çƒåœºè¾¹ï¼Œä½ ä¸ºä»–çš„ç²¾å½©è¡¨ç°æ¬¢å‘¼ï¼Œä»–å‘ä½ æŠ•æ¥å¾®ç¬‘...");
                                        setTimeout(() => {
                                            showDialog("ç³»ç»Ÿ", "åŒ»é™¢èµ°å»Šï¼Œä½ æ³ªæµæ»¡é¢åœ°æ¡ç€ä»–çš„æ‰‹ï¼Œä»–èººåœ¨ç—…åºŠä¸Šï¼Œè†ç›–ç¼ ç€åšåšçš„ç»·å¸¦...");
                                            setTimeout(() => {
                                                bgImage.src = backgrounds.home;
                                                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆéœ‡æƒŠåœ°æ‚ä½å˜´ï¼‰å¤©å•Š...æˆ‘æƒ³èµ·æ¥äº†ï¼æå›½è‰¯...ä»–ä¸ä»…ä»…æ˜¯æˆ‘æ†§æ†¬çš„æ•™ç»ƒ...ä»–æ˜¯æˆ‘å¤§ä¸€æ—¶çš„åŒç­åŒå­¦ï¼");
                                                setTimeout(() => {
                                                    showDialog("ç³»ç»Ÿ", "è®°å¿†å¦‚æ½®æ°´èˆ¬æ¶Œæ¥ï¼Œä½ ç»ˆäºæ˜ç™½äº†é‚£ç§ç†Ÿæ‚‰æ„Ÿçš„æ¥æºã€‚ä½ å’Œæå›½è‰¯æ›¾ç»æ˜¯éå¸¸äº²å¯†çš„æœ‹å‹ï¼Œç”šè‡³å¯èƒ½æ›´å¤š...");
                                                    setTimeout(() => {
                                                        showDialog("ç»“åŸå¤å¥ˆ", "ä½†ä¸ºä»€ä¹ˆæˆ‘ä¼šå¿˜è®°è¿™ä¹ˆé‡è¦çš„äº‹ï¼Ÿåˆä¸ºä»€ä¹ˆä»–è£…ä½œä¸è®¤è¯†æˆ‘ï¼Ÿ");
                                                        setTimeout(() => {
                                                            showDialog("ç³»ç»Ÿ", "ä½ æ€¥åˆ‡åœ°ç¿»å‡ºæ‰‹æœºï¼ŒæŸ¥çœ‹å¤§ä¸€æ—¶çš„ç…§ç‰‡ã€‚åœ¨ä¸€å¼ ç­çº§åˆå½±ä¸­ï¼Œä½ ç»ˆäºæ‰¾åˆ°äº†è¯æ®â€”â€”å¹´è½»çš„æå›½è‰¯ç«™åœ¨ä½ èº«æ—ï¼Œä½ ä»¬ç›¸è§†è€Œç¬‘ã€‚");
                                                            setTimeout(() => {
                                                                showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆéš¾ä»¥ç½®ä¿¡ï¼‰ä¸€å®šå‘ç”Ÿäº†ä»€ä¹ˆ...æˆ‘å¿…é¡»å»é—®æ¸…æ¥šï¼");
                                                                setTimeout(() => {
                                                                    gameState.flags.memoryTrigger = true;
                                                                    updateStatsDisplay();
                                                                    showDialog("ç³»ç»Ÿ", "é‡å¤§å‰§æƒ…è½¬æŠ˜ï¼ä½ ç»ˆäºæƒ³èµ·äº†è¢«é—å¿˜çš„è¿‡å»ï¼Œä½†è¿™åªæ˜¯è°œå›¢çš„å¼€å§‹...");
                                                                    unlockAchievement("è®°å¿†è§‰é†’", "æ­å¼€äº†è¢«é—å¿˜çš„çœŸç›¸");
                                                                    
                                                                    // æ­¤å¤„å¯ä»¥ç»§ç»­æ·»åŠ å¯»æ‰¾çœŸç›¸çš„å‰§æƒ…åˆ†æ”¯
                                                                }, 2000);
                                                            }, 2000);
                                                        }, 2000);
                                                    }, 2000);
                                                }, 2000);
                                            }, 2000);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 2000);
                        }, 2000);
                    }, 2000);
                    break;
    
                    // å¯ä»¥åœ¨æ­¤ç»§ç»­æ·»åŠ æ›´å¤šå‰§æƒ…åˆ†æ”¯åœºæ™¯
                    
                    default:
                        showDialog("ç³»ç»Ÿ", "ç»§ç»­æ¸¸æˆ...");
                    }
        }
        
        // Start the game
        function startGame() {
            renderScene("intro");
        }

        // Update stats display
        function updateStatsDisplay() {
            moneyDisplay.textContent = gameState.money;
            affectionDisplay.textContent = gameState.affection;
            moodDisplay.textContent = gameState.mood;
            dayDisplay.textContent = `ç¬¬${gameState.day}å¤©`;
            
            // Update profile window stats if open
            if (document.getElementById('profile-window').style.display === 'flex') {
                document.getElementById('charm-stat').textContent = gameState.stats.charm;
                document.getElementById('intel-stat').textContent = gameState.stats.intelligence;
                document.getElementById('energy-stat').textContent = gameState.stats.energy;
                document.getElementById('cooking-stat').textContent = gameState.stats.cooking;
                document.getElementById('basketball-stat').textContent = gameState.stats.basketball;
                document.getElementById('law-stat').textContent = gameState.stats.law;
                
                document.getElementById('guoliang-affection').textContent = gameState.affection;
                document.getElementById('guoliang-relationship').style.width = `${gameState.affection}%`;
                document.getElementById('relationship-status').textContent = gameState.relationshipStatus;
                
                // Update memory fragments
                if (gameState.memoryFragments.length > 0) {
                    let fragmentsHTML = '';
                    gameState.memoryFragments.forEach(fragmentId => {
                        const fragment = memoryFragmentsData.find(f => f.id === fragmentId);
                        if (fragment) {
                            fragmentsHTML += `<div style="margin-bottom: 10px;">
                                <div style="font-weight: bold;">${fragment.title}</div>
                                <div style="color: #666; font-style: italic;">${fragment.text}</div>
                            </div>`;
                        }
                    });
                    document.getElementById('memory-fragments').innerHTML = fragmentsHTML;
                } else {
                    document.getElementById('memory-fragments').innerHTML = 'å°šæœªæ‰¾åˆ°ä»»ä½•è®°å¿†ç¢ç‰‡...';
                }
            }
        }

        // Toggle menu overlay
        function toggleMenu() {
            menuOverlay.style.display = menuOverlay.style.display === 'flex' ? 'none' : 'flex';
        }

        // Resume game
        function resumeGame() {
            menuOverlay.style.display = 'none';
        }

        // Save game
        function saveGame() {
            localStorage.setItem('guoliangTrapSave', JSON.stringify(gameState));
            showModal('ä¿å­˜æˆåŠŸ', 'æ¸¸æˆå·²ä¿å­˜');
        }

        // Load game
        function loadGame() {
            const savedGame = localStorage.getItem('guoliangTrapSave');
            if (savedGame) {
                gameState = JSON.parse(savedGame);
                updateStatsDisplay();
                renderScene(gameState.currentScene);
                menuOverlay.style.display = 'none';
                showModal('è¯»å–æˆåŠŸ', 'æ¸¸æˆå·²è¯»å–');
            } else {
                showModal('æ— å­˜æ¡£', 'æ²¡æœ‰æ‰¾åˆ°æ¸¸æˆå­˜æ¡£');
            }
        }

        // Show help
        function showHelp() {
            menuOverlay.style.display = 'none';
            showModal('æ¸¸æˆè¯´æ˜', 
                'ã€Šå›½è‰¯è¯±æ•å™¨ã€‹æ˜¯ä¸€æ¬¾æ‹çˆ±å…»æˆæ¸¸æˆï¼Œä½ æ‰®æ¼”ç»“åŸå¤å¥ˆï¼Œç›®æ ‡æ˜¯èµ¢å¾—ç¯®çƒæ•™ç»ƒæå›½è‰¯çš„å¿ƒã€‚\n\n' +
                'æ¸¸æˆç³»ç»Ÿï¼š\n' +
                '- å¥½æ„Ÿåº¦ï¼šé€šè¿‡äº’åŠ¨ã€é€ç¤¼æå‡ææ•™ç»ƒå¯¹ä½ çš„å¥½æ„Ÿ\n' +
                '- å±æ€§ï¼šæå‡è‡ªå·±çš„å„é¡¹èƒ½åŠ›ä»¥è§£é”æ›´å¤šå‰§æƒ…\n' +
                '- é‡‘é’±ï¼šå®Œæˆäº‹ä»¶å’Œå·¥ä½œè·å¾—é‡‘é’±\n' +
                '- åœ°ç‚¹ï¼šè®¿é—®ä¸åŒåœ°ç‚¹è§¦å‘ä¸åŒäº‹ä»¶\n' +
                '- è®°å¿†ç¢ç‰‡ï¼šæ”¶é›†è¢«é—å¿˜çš„å›å¿†ï¼Œè§£å¼€éšè—çœŸç›¸\n\n' +
                'è§’è‰²è®¾å®šï¼š\n' +
                '- ç»“åŸå¤å¥ˆï¼šå•†å­¦é™¢å­¦ç”Ÿï¼Œç²¾é€šå•†æ³•ï¼Œä½†å¯¹ç¯®çƒçŸ¥è¯†æœ‰é™\n' +
                '- æå›½è‰¯ï¼šå†·å³»çš„ç¯®çƒæ•™ç»ƒï¼Œä¸¥å‰ä¸­å¸¦ç€ç¥ç§˜æ„Ÿ\n\n' +
                'ç§˜å¯†æç¤ºï¼šè¿™ä¸ªæ•…äº‹ä¸­éšè—ç€æ„æƒ³ä¸åˆ°çš„åè½¬...\n' +
                'æ¯æ¬¡é€‰æ‹©éƒ½ä¼šå½±å“å‰§æƒ…èµ°å‘å’Œè§’è‰²å…³ç³»å‘å±•ï¼'
            );
        }

        // Show settings
        function showSettings() {
            menuOverlay.style.display = 'none';
            showModal('è®¾ç½®', 'æ¸¸æˆè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // Show profile window
        function showProfile() {
            document.getElementById('profile-window').style.display = 'flex';
            updateStatsDisplay();
        }

        // Show inventory window
        function showInventory() {
            const inventoryWindow = document.getElementById('inventory-window');
            const itemsContainer = document.getElementById('items-container');
            
            // Clear previous items
            itemsContainer.innerHTML = '';
            
            // Add items from inventory
            if (gameState.inventory.length === 0) {
                itemsContainer.innerHTML = '<div style="grid-column: span 3; text-align: center; padding: 20px;">ç‰©å“æ ä¸ºç©º</div>';
            } else {
                gameState.inventory.forEach(itemId => {
                    const item = itemsData[itemId];
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item';
                    itemElement.onclick = () => useItem(itemId);
                    
                    itemElement.innerHTML = `
                        <div class="item-image">${item.icon}</div>
                        <div class="item-name">${item.name}</div>
                    `;
                    
                    itemsContainer.appendChild(itemElement);
                });
            }
            
            inventoryWindow.style.display = 'flex';
        }

        // Show shop window
        function showShop() {
            document.getElementById('shop-window').style.display = 'flex';
        }

        // Show map window
        function showMap() {
            document.getElementById('map-window').style.display = 'flex';
        }
        
        // Show schedule window
        function showSchedule() {
            const scheduleWindow = document.getElementById('schedule-window');
            const scheduleContent = document.getElementById('schedule-content');
            
            // Clear previous content
            scheduleContent.innerHTML = '';
            
            // Add schedule data
            const weekDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const dayNames = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            
            weekDays.forEach((day, index) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'schedule-day';
                
                let dayHTML = `<div class="schedule-day-header">${dayNames[index]}</div>`;
                dayHTML += '<div class="schedule-events">';
                
                gameState.guoliangSchedule[day].forEach(event => {
                    dayHTML += `<div class="schedule-event">
                        <div class="schedule-time">${event.time}</div>
                        <div>${event.activity}</div>
                    </div>`;
                });
                
                dayHTML += '</div>';
                dayElement.innerHTML = dayHTML;
                scheduleContent.appendChild(dayElement);
            });
            
            scheduleWindow.style.display = 'flex';
        }

        // Close system window
        function closeWindow(windowId) {
            document.getElementById(windowId).style.display = 'none';
        }

        // Advance to next day
        function nextDay() {
            if (gameState.day === 1 && !gameState.flags.metGuoliang) {
                showModal('æç¤º', 'ç¬¬ä¸€å¤©ç»“æŸå‰ï¼Œä½ åº”è¯¥å»ç¯®çƒåœºè§è§ææ•™ç»ƒã€‚');
                return;
            }
            
            gameState.day++;
            gameState.currentWeekDay = (gameState.currentWeekDay % 7) + 1; // å¾ªç¯ 1-7
            gameState.stats.energy = Math.min(gameState.stats.energy + 10, 100); // Recover energy
            
            // Random events based on day and relationship progress
            triggerRandomDailyEvent();
            
            // Check for story progression
            checkStoryProgression();
            
            // Update displays
            updateStatsDisplay();
            showModal('æ–°çš„ä¸€å¤©', `ç¬¬${gameState.day}å¤©å¼€å§‹äº†ã€‚ä»Šå¤©æ˜¯${getWeekdayName(gameState.currentWeekDay)}ï¼Œä¼šæœ‰ä»€ä¹ˆå‘ç”Ÿå‘¢ï¼Ÿ`);
        }
        
        // Get weekday name
        function getWeekdayName(weekday) {
            const weekdays = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            return weekdays[weekday - 1];
        }
        
        // Trigger random daily event
        function triggerRandomDailyEvent() {
            // Different probability and events based on relationship progress
            let eventProbability = 0.3;
            if (gameState.affection >= 50) eventProbability = 0.4;
            if (gameState.affection >= 70) eventProbability = 0.5;
            
            const randomEvent = Math.random();
            if (randomEvent < eventProbability) {
                // Select events based on relationship level
                let events = [];
                
                // Basic events (any affection level)
                const basicEvents = [
                    { text: 'ä½ åœ¨æ ¡å›­å¶é‡äº†ææ•™ç»ƒï¼Œä»–å¯¹ä½ å¾®å¾®ç‚¹å¤´è‡´æ„ã€‚å¥½æ„Ÿåº¦+1', effect: { affection: 1 } },
                    { text: 'ä½ å¾—çŸ¥ææ•™ç»ƒæœ€è¿‘æ­£ä¸ºçƒé˜Ÿçš„æˆ˜æœ¯çƒ¦æ¼ã€‚', effect: {} },
                    { text: 'æœ‰ä¼ è¨€è¯´ææ•™ç»ƒå¹´è½»æ—¶æ›¾æ˜¯æ ¡é˜Ÿæ˜æ˜Ÿçƒå‘˜ã€‚', effect: {} },
                    { text: 'ä½ å¬è¯´ææ•™ç»ƒæœ€è¿‘æ‹’ç»äº†æ ¡èŠ±çš„è¡¨ç™½ã€‚', effect: {} },
                    { text: 'ä½ çœ‹åˆ°ææ•™ç»ƒåœ¨å›¾ä¹¦é¦†æŸ¥é˜…å•†ä¸šæ³•å¾‹ç›¸å…³çš„ä¹¦ç±ï¼Œè¿™æœ‰äº›æ„å¤–ã€‚', effect: {} }
                ];
                
                // Mid-level relationship events
                const midLevelEvents = [
                    { text: 'ææ•™ç»ƒåœ¨èµ°å»Šä¸Šå«ä½äº†ä½ ï¼Œè¯¢é—®äº†ä½ æœ€è¿‘çš„å­¦ä¹ æƒ…å†µã€‚å¥½æ„Ÿåº¦+2', effect: { affection: 2 } },
                    { text: 'ä¸€ä½åŒå­¦å‘Šè¯‰ä½ ï¼Œææ•™ç»ƒåœ¨åŠå…¬å®¤æ›¾æèµ·è¿‡ä½ çš„åå­—ã€‚', effect: {} },
                    { text: 'ä½ å¶ç„¶å‘ç°ææ•™ç»ƒçš„æ¡Œä¸Šæ”¾ç€ä¸€ä»½å•†æ³•ç›¸å…³çš„åˆåŒï¼Œçœ‹èµ·æ¥ä»–æ­£åœ¨ä¸ºæ­¤çƒ¦æ¼ã€‚', effect: {} },
                    { text: 'ææ•™ç»ƒåœ¨è®­ç»ƒä¸­ä¼¼ä¹å—äº†è½»ä¼¤ï¼Œä½ æ„Ÿåˆ°ä¸€é˜µè«åçš„å¿ƒç—›ã€‚', effect: {} }
                ];
                
                // High-level relationship events
                const highLevelEvents = [
                    { text: 'ææ•™ç»ƒä¼¼ä¹åœ¨å¯»æ‰¾ä¸€äº›ä¸œè¥¿ï¼Œä½ æ— æ„ä¸­å¬åˆ°ä»–æåˆ°"é‚£æœ¬ç›¸å†Œå»å“ªäº†"ã€‚', effect: {} },
                    { text: 'ææ•™ç»ƒçœ‹èµ·æ¥å¿ƒæƒ…ä¸ä½³ï¼Œä½†è§åˆ°ä½ æ—¶è¡¨æƒ…æ˜æ˜¾æ”¾æ¾äº†ä¸€äº›ã€‚å¥½æ„Ÿåº¦+3', effect: { affection: 3 } },
                    { text: 'ä½ åœ¨æ ¡åŒ»é™¢å¶é‡ææ•™ç»ƒï¼Œä»–ä¼¼ä¹æ˜¯æ¥å¤æŸ¥æ—§ä¼¤ã€‚ä»–çœ‹åˆ°ä½ æ—¶è¡¨æƒ…å¤æ‚ã€‚', effect: {} },
                    { text: 'ææ•™ç»ƒçš„æœ‹å‹çœ‹åˆ°ä½ æ—¶æµéœ²å‡ºæƒŠè®¶çš„è¡¨æƒ…ï¼Œä»¿ä½›è®¤è¯†ä½ ä¸€æ ·ã€‚', effect: {} }
                ];
                
                // Add events based on relationship level
                events = [...basicEvents];
                if (gameState.affection >= 30) events = [...events, ...midLevelEvents];
                if (gameState.affection >= 60) events = [...events, ...highLevelEvents];
                
                // Select a random event
                const eventIndex = Math.floor(Math.random() * events.length);
                const selectedEvent = events[eventIndex];
                
                // Apply event effects
                if (selectedEvent.effect.affection) {
                    gameState.affection += selectedEvent.effect.affection;
                }
                
                // Show event
                showModal('æ—¥å¸¸äº‹ä»¶', selectedEvent.text);
                
                // Special random chance to find a memory fragment
                if (gameState.affection >= 20 && Math.random() < 0.1) {
                    setTimeout(() => {
                        findRandomMemoryFragment();
                    }, 2000);
                }
            }
        }
        
        // Find a random memory fragment
        function findRandomMemoryFragment() {
            // Only fragments not yet discovered
            const availableFragments = memoryFragmentsData.filter(fragment => 
                !gameState.memoryFragments.includes(fragment.id)
            );
            
            if (availableFragments.length > 0) {
                const fragment = availableFragments[Math.floor(Math.random() * availableFragments.length)];
                gameState.memoryFragments.push(fragment.id);
                
                showSpecialEvent('è®°å¿†ç¢ç‰‡æµ®ç°', `ä½ çªç„¶æƒ³èµ·äº†ä»€ä¹ˆ...\n\n"${fragment.text}"\n\nè¿™æ®µè®°å¿†æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ºä»€ä¹ˆç°åœ¨æ‰æµ®ç°åœ¨è„‘æµ·ä¸­ï¼Ÿ`);
                
                // If enough fragments are collected, trigger a major revelation
                if (gameState.memoryFragments.length >= 3 && !gameState.flags.memoryTrigger) {
                    setTimeout(() => {
                        gameState.flags.discoveredHint = true;
                    }, 2000);
                }
            }
        }

// æ›´æ–°å‰§æƒ…æ£€æŸ¥å‡½æ•°ï¼ŒåŠ å…¥æ–°çš„å‰§æƒ…è§¦å‘æ¡ä»¶
function updateStoryChecks() {
    // æ·»åŠ åˆ°checkStoryProgressionå‡½æ•°ä¸­
    
    // å­¦ç”Ÿæ•™ç»ƒæ—¥å¸¸ - ä¸­åº¦å¥½æ„Ÿåº¦æ—¶éšæœºè§¦å‘
    if (gameState.day >= 5 && gameState.affection >= 25 && !gameState.flags.seenStudentCoachDaily && Math.random() < 0.4) {
        setTimeout(() => {
            gameState.flags.seenStudentCoachDaily = true;
            newScenes.student_coach_practice();
        }, 1500);
    }
    
    // è®°å¿†æ¢å¤å…³é”®å‰§æƒ… - éœ€è¦è¶³å¤Ÿçš„è®°å¿†ç¢ç‰‡å’Œå¥½æ„Ÿåº¦
    if (gameState.flags.memoryTrigger && !gameState.flags.rememberedFirstMeeting && gameState.affection >= 70) {
        setTimeout(() => {
            newScenes.classroom_first_meeting();
        }, 1500);
    }
    
    if (gameState.flags.rememberedFirstMeeting && !gameState.flags.rememberedInjury && gameState.affection >= 75) {
        setTimeout(() => {
            newScenes.knee_injury_accident();
        }, 1500);
    }
    
    if (gameState.flags.rememberedInjury && !gameState.flags.rememberedPromise && gameState.affection >= 80) {
        setTimeout(() => {
            newScenes.hospital_promise();
        }, 1500);
    }
    
    // çœŸç›¸æ­éœ² - ä¸»çº¿å‰§æƒ…é«˜æ½®
    if (gameState.flags.rememberedPromise && !gameState.flags.truthRevealed && gameState.affection >= 85 && gameState.memoryFragments.length >= 10) {
        setTimeout(() => {
            newScenes.truth_revelation();
        }, 1500);
    }
}
                    
        // Check for story progression based on game state
        function checkStoryProgression() {
            // Unlock memory hints after day 5 and good affection

            updateStoryChecks();
            if (gameState.day >= 5 && gameState.affection >= 30 && !gameState.flags.discoveredHint && gameState.memoryFragments.length >= 2) {
                setTimeout(() => {
                    showSpecialEvent('å¥‡æ€ªçš„å›å¿†', 'æ·±å¤œï¼Œä½ è¢«ä¸€ä¸ªæ¢¦æƒŠé†’ã€‚æ¢¦ä¸­çš„ä½ ç«™åœ¨æ¨±èŠ±æ ‘ä¸‹ï¼Œå¯¹é¢æ˜¯æ¨¡ç³Šçš„äººå½±ã€‚\n\n"å¦‚æœæˆ‘æˆä¸ºæ•™ç»ƒï¼Œä½ å°±..."é‚£ä¸ªç†Ÿæ‚‰çš„å£°éŸ³è¯´é“ã€‚\n\nè¿™ä¸ä»…ä»…æ˜¯æ¢¦ï¼Œè€Œæ˜¯è¢«å°˜å°çš„è®°å¿†åœ¨è¯•å›¾æµ®å‡ºæ°´é¢ã€‚ä½ å’Œæå›½è‰¯çš„è¿‡å»ï¼Œä¼¼ä¹æ¯”ä½ è®°å¿†ä¸­çš„è¦å¤æ‚å¾—å¤š...');
                    gameState.flags.discoveredHint = true;
                    unlockAchievement('æ¨¡ç³Šçš„è®°å¿†', 'å‘ç°äº†å…³äºè¿‡å»çš„çº¿ç´¢');
                }, 1000);
            }
            
            // Update relationship status based on affection
            if (gameState.affection >= 80) {
                gameState.relationshipStatus = "äº²å¯†å…³ç³»";
            } else if (gameState.affection >= 60) {
                gameState.relationshipStatus = "äº²å¯†æœ‹å‹";
            } else if (gameState.affection >= 40) {
                gameState.relationshipStatus = "å¥½å‹";
            } else if (gameState.affection >= 20) {
                gameState.relationshipStatus = "æœ‹å‹";
            } else {
                gameState.relationshipStatus = "è®¤è¯†çš„äºº";
            }
            
            // Rival introduction event
            if (gameState.day >= 8 && gameState.affection >= 25 && !gameState.flags.rivalAppeared) {
                setTimeout(() => {
                    renderScene("rival_introduction");
                }, 1500);
            }
            
            // Law connection discovery
            if (gameState.day >= 10 && gameState.affection >= 35 && !gameState.flags.discoveredLawConnection) {
                setTimeout(() => {
                    renderScene("law_connection");
                }, 1500);
            }
            
            // Final memory trigger
            if (gameState.affection >= 85 && gameState.day >= 15 && !gameState.flags.memoryTrigger) {
                setTimeout(() => {
                    renderScene("memory_trigger");
                }, 1500);
            }
        }

        // Buy an item from shop
        function buyItem(itemId) {
            const item = itemsData[itemId];
            
            if (gameState.money >= item.price) {
                gameState.money -= item.price;
                gameState.inventory.push(itemId);
                updateStatsDisplay();
                showModal('è´­ä¹°æˆåŠŸ', `ä½ è´­ä¹°äº†${item.name}`);
                
                // Apply immediate effects if any
                if (item.effect) {
                    if (item.effect.charm) {
                        gameState.stats.charm += item.effect.charm;
                        showModal('å±æ€§æå‡', `ä½ çš„é­…åŠ›æå‡äº†${item.effect.charm}ç‚¹`);
                    }
                    if (item.effect.basketball) {
                        gameState.stats.basketball += item.effect.basketball;
                        showModal('å±æ€§æå‡', `ä½ çš„ç¯®çƒçŸ¥è¯†æå‡äº†${item.effect.basketball}ç‚¹`);
                    }
                    if (item.effect.law) {
                        gameState.stats.law += item.effect.law;
                        showModal('å±æ€§æå‡', `ä½ çš„å•†æ³•çŸ¥è¯†æå‡äº†${item.effect.law}ç‚¹`);
                    }
                }
                
                // Special case for alumni book
                if (itemId === 'alumnibook' && !gameState.flags.foundOldPhoto) {
                    setTimeout(() => {
                        showModal('æƒŠäººå‘ç°', 'ä½ ç¿»é˜…æ ¡å‹å½•æ—¶ï¼Œåœ¨ä¸€å¹´å‰çš„ç¯®çƒç¤¾å›¢é¡µé¢å‘ç°äº†ä¸€å¼ ç…§ç‰‡ã€‚ç…§ç‰‡è§’è½é‡Œï¼Œææ•™ç»ƒå’Œä¸€ä½çœ‹èµ·æ¥å¾ˆåƒä½ çš„å¥³ç”Ÿç«™åœ¨ä¸€èµ·ï¼Œä¼¼ä¹åœ¨çƒ­çƒˆè®¨è®ºç€ä»€ä¹ˆã€‚\n\nè¿™ä¸å¯èƒ½...ä½ ä»æœªåŠ å…¥è¿‡ç¯®çƒç¤¾å›¢ã€‚è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ');
                        
                        setTimeout(() => {
                            gameState.flags.foundOldPhoto = true;
                            gameState.memoryFragments.push('fragment2');
                            updateStatsDisplay();
                            unlockAchievement('ç…§ç‰‡çº¿ç´¢', 'å‘ç°äº†ä¸€å¼ ç¥ç§˜çš„ç…§ç‰‡');
                        }, 3000);
                    }, 2000);
                }
            } else {
                showModal('é‡‘é’±ä¸è¶³', 'ä½ æ²¡æœ‰è¶³å¤Ÿçš„é‡‘é’±è´­ä¹°è¿™ä¸ªç‰©å“');
            }
        }

        // Use an item from inventory
        function useItem(itemId) {
            const item = itemsData[itemId];
            
            // Different handling based on current location
            if (gameState.currentLocation === 'basketball_court') {
                if (itemId === 'basketball' || itemId === 'sportswatch' || itemId === 'cookies' || itemId === 'tacticsbook' || itemId === 'energydrink') {
                    // Give gift to Guoliang
                    showModal('èµ é€ç¤¼ç‰©', `ä½ å°†${item.name}é€ç»™äº†ææ•™ç»ƒã€‚`, () => {
                        // Remove item from inventory
                        const itemIndex = gameState.inventory.indexOf(itemId);
                        if (itemIndex > -1) {
                            gameState.inventory.splice(itemIndex, 1);
                        }
                        
                        // Increase affection
                        if (item.effect && item.effect.affection) {
                            gameState.affection += item.effect.affection;
                            updateStatsDisplay();
                            
                            // Flag for first gift
                            if (!gameState.flags.firstGift) {
                                gameState.flags.firstGift = true;
                                unlockAchievement('åˆæ¬¡èµ ç¤¼', 'ç¬¬ä¸€æ¬¡ç»™ææ•™ç»ƒé€ç¤¼ç‰©');
                                renderScene("first_gift");
                            } else {
                                showModal('å¥½æ„Ÿåº¦æå‡', `ææ•™ç»ƒæ”¶ä¸‹äº†ä½ çš„ç¤¼ç‰©ï¼Œå¥½æ„Ÿåº¦å¢åŠ äº†${item.effect.affection}ç‚¹`, () => {
                                    showRandomGiftReaction(itemId);
                                });
                            }
                        }
                    });
                } else if (itemId === 'lawnotes' && gameState.stats.law >= 50) {
                    showModal('å±•ç¤ºç¬”è®°', 'ä½ çŠ¹è±«åœ°æ‹¿å‡ºå•†æ³•ç¬”è®°ï¼Œ"ææ•™ç»ƒï¼Œæˆ‘å¬è¯´çƒé˜Ÿæœ‰åˆåŒé—®é¢˜...æˆ‘æ˜¯å•†æ³•ä¸“ä¸šçš„ï¼Œä¹Ÿè®¸èƒ½å¸®ä¸Šå¿™ï¼Ÿ"', () => {
                        const itemIndex = gameState.inventory.indexOf(itemId);
                        if (itemIndex > -1) {
                            gameState.inventory.splice(itemIndex, 1);
                        }
                        
                        renderScene("law_help_offer");
                    });
                } else {
                    showModal('ä¸é€‚åˆ', 'è¿™ä¸ªç‰©å“ä¸é€‚åˆåœ¨è¿™é‡Œä½¿ç”¨');
                }
            } else if (gameState.currentLocation === 'office' && itemId === 'lawnotes' && gameState.flags.discoveredLawConnection) {
                showModal('æä¾›å¸®åŠ©', 'ä½ æ‹¿å‡ºç²¾å¿ƒå‡†å¤‡çš„å•†æ³•ç¬”è®°ï¼Œ"ææ•™ç»ƒï¼Œæˆ‘æ•´ç†äº†ä¸€äº›å…³äºä½“è‚²èµåŠ©åˆåŒçš„æ³•å¾‹è¦ç‚¹ï¼Œä¹Ÿè®¸å¯¹æ‚¨å¤„ç†çƒé˜ŸåˆåŒæœ‰å¸®åŠ©ã€‚"', () => {
                    const itemIndex = gameState.inventory.indexOf(itemId);
                    if (itemIndex > -1) {
                        gameState.inventory.splice(itemIndex, 1);
                    }
                    
                    renderScene("office_law_help");
                });
            } else if (gameState.currentLocation === 'cafe' && (itemId === 'cookies' || itemId === 'energydrink')) {
                showModal('å’–å•¡å…', `ä½ æƒ³åœ¨å’–å•¡å…ä½¿ç”¨${item.name}å—ï¼Ÿ`, () => {
                    if (Math.random() < 0.3 && !gameState.flags.specialEncounter) {
                        // ç‰¹æ®Šå’–å•¡å…é‚‚é€…äº‹ä»¶
                        const itemIndex = gameState.inventory.indexOf(itemId);
                        if (itemIndex > -1) {
                            gameState.inventory.splice(itemIndex, 1);
                        }
                        
                        renderScene("cafe_special_encounter");
                    } else {
                        showDialog("ç³»ç»Ÿ", `ä½ åœ¨å’–å•¡å…äº«ç”¨äº†${item.name}ï¼Œæ„Ÿè§‰ç²¾ç¥äº†ä¸€äº›ã€‚ä½“åŠ›+5`);
                        gameState.stats.energy = Math.min(gameState.stats.energy + 5, 100);
                        
                        const itemIndex = gameState.inventory.indexOf(itemId);
                        if (itemIndex > -1) {
                            gameState.inventory.splice(itemIndex, 1);
                        }
                        updateStatsDisplay();
                    }
                });
            } else {
                showModal('ä¸é€‚åˆ', 'ä½ éœ€è¦åœ¨åˆé€‚çš„åœ°ç‚¹ä½¿ç”¨è¿™ä¸ªç‰©å“ã€‚ç¯®çƒç›¸å…³çš„ç‰©å“å¯ä»¥åœ¨ç¯®çƒåœºé€ç»™ææ•™ç»ƒã€‚');
            }
        }

        // Show random reaction based on gift
        function showRandomGiftReaction(itemId) {
            const reactions = {
                basketball: [
                    "ææ•™ç»ƒæ‹¿èµ·ç¯®çƒï¼Œç†Ÿç»ƒåœ°è½¬äº†å‡ ä¸‹ï¼Œç›®å…‰ä¾ç„¶å†°å†·ï¼Œä½†è¯­æ°”ç¼“å’Œäº†äº›è®¸ã€‚'è°¢è°¢ï¼Œè¿™ä¸ªè´¨é‡ä¸é”™ã€‚'",
                    "ææ•™ç»ƒçœ‹äº†çœ‹ç¯®çƒï¼Œä¹ æƒ¯æ€§åœ°æ‚é‡äº†ä¸€ä¸‹ã€‚'æ­£å¥½çƒé˜Ÿéœ€è¦å¤šå¤‡å‡ ä¸ªï¼Œè°¢è°¢ã€‚'ä»–çš„è¯ç®€çŸ­ï¼Œå´ä¸æ˜¾å¾—æ•·è¡ã€‚",
                    "ææ•™ç»ƒå°†ç¯®çƒæ”¾åœ¨ä¸€æ—ï¼Œé’¢é“èˆ¬çš„ç›®å…‰ä¸­é—ªè¿‡ä¸€ä¸å¥½å¥‡ã€‚'ä½ å¾ˆçƒ­çˆ±ç¯®çƒï¼Ÿæœ‰å…´è¶£äº†è§£æ›´å¤šæˆ˜æœ¯å—ï¼Ÿ'ä»–é—®é“ï¼Œä¼¼ä¹å¯¹ä½ äº§ç”Ÿäº†äº›è®¸å…´è¶£ã€‚"
                ],
                sportswatch: [
                    "ææ•™ç»ƒçœ‹äº†çœ‹æ‰‹è¡¨ï¼Œå¼ºå£®çš„æ‰‹è…•å’Œè¿™æ¬¾æ‰‹è¡¨æ„å¤–åœ°æ­é…ã€‚'è¿™ä¸ªåŠŸèƒ½å¾ˆé½å…¨ï¼Œè°¢è°¢ã€‚'ä»–çš„å˜´è§’å¾®å¾®ä¸Šæ‰¬ï¼Œéœ²å‡ºéš¾å¾—çš„ç¬‘æ„ã€‚",
                    "ææ•™ç»ƒå°†æ‰‹è¡¨æˆ´åœ¨ç²—å£®çš„æ‰‹è…•ä¸Šï¼Œè°ƒæ•´äº†ä¸€ä¸‹è¡¨å¸¦ã€‚'è®¡æ—¶ä¼šæ›´æ–¹ä¾¿äº†ï¼Œè°¢è°¢ã€‚'ä»–è¯•ç€æŒ‰äº†å‡ ä¸ªæŒ‰é’®ï¼Œçœ‹èµ·æ¥å¾ˆæ»¡æ„ã€‚",
                    "ææ•™ç»ƒæƒŠè®¶åœ°çœ‹ç€æ‰‹è¡¨ï¼Œè¿™æ˜¯ä»–å†°å±±è¡¨æƒ…ä¸­å°‘æœ‰çš„æƒ…ç»ªæ³¢åŠ¨ã€‚'è¿™ä¸ªæ¬¾å¼...æˆ‘ä¸€ç›´æƒ³ä¹°ï¼Œè°¢è°¢ã€‚'ä»–çš„è¯é‡Œé€éœ²ç€çœŸè¯šã€‚"
                ],
                cookies: [
                    "ææ•™ç»ƒå°äº†ä¸€å—é¥¼å¹²ï¼Œå’€åš¼çš„æ ·å­è®©äººæƒ³èµ·ä¸€å¤´æ²‰é»˜çš„ç‹®å­ã€‚'å‘³é“ä¸é”™ï¼Œæ˜¯ä½ åšçš„å—ï¼Ÿ'ä»–ç½•è§åœ°ä¸»åŠ¨æé—®ã€‚",
                    "ææ•™ç»ƒå°†é¥¼å¹²æ”¾åœ¨åŠå…¬æ¡Œä¸Šï¼Œæ•´é½åœ°æ‘†å¥½ã€‚'è°¢è°¢ï¼Œè®­ç»ƒåä¼šåƒçš„ã€‚'ç®€çŸ­çš„å›åº”ä¸­è•´å«ç€éš¾å¾—çš„æ¸©åº¦ã€‚",
                    "ææ•™ç»ƒçœ¼ç›äº®äº†ä¸€ä¸‹ï¼Œåƒå†°é¢ä¸Šçªç„¶æ˜ å‡ºçš„é˜³å…‰ã€‚'æˆ‘å¾ˆä¹…æ²¡åƒåˆ°æ‰‹å·¥é¥¼å¹²äº†ï¼Œè°¢è°¢ã€‚'ä»–çš„è¯­æ°”ä¸­é€éœ²å‡ºä¸€ä¸éš¾ä»¥å¯Ÿè§‰çš„æ€€å¿µã€‚"
                ],
                tacticsbook: [
                    "ææ•™ç»ƒç¿»é˜…äº†å‡ é¡µï¼Œé‚£åŒå¸¸å¹´æ¡ç¯®çƒçš„ç²—ç³™å¤§æ‰‹å°å¿ƒç¿¼ç¿¼åœ°ç¿»åŠ¨ç€ä¹¦é¡µã€‚'è¿™æœ¬æˆ‘ä¸€ç›´åœ¨æ‰¾ï¼Œè°¢è°¢ä½ ã€‚'ä»–çš„ç›®å…‰ä¸“æ³¨ï¼Œå¯¹ä½ çš„è¯„ä»·ä¼¼ä¹æé«˜äº†ã€‚",
                    "ææ•™ç»ƒè®¤çœŸåœ°çœ‹äº†çœ‹å°é¢ï¼Œå¼ºå¥çš„èº«èº¯å¾®å¾®å‰å€¾ã€‚'è¿™æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œéå¸¸æ„Ÿè°¢ã€‚'ä»–çš„å£°éŸ³ä½æ²‰æœ‰åŠ›ã€‚",
                    "ææ•™ç»ƒçš„è¡¨æƒ…å˜å¾—è®¤çœŸï¼Œä¸å¹³æ—¶è®­ç»ƒçƒå‘˜æ—¶å¦‚å‡ºä¸€è¾™ã€‚'è¿™æœ¬ä¹¦...å¾ˆé€‚åˆæˆ‘ç›®å‰çš„ç ”ç©¶ï¼Œè°¢è°¢ã€‚'ä»–çš„è¯­æ°”ä¸­æœ‰ä¸€ç§ä½ ä»æœªå¬è¿‡çš„éƒ‘é‡ã€‚"
                ],
                energydrink: [
                    "ææ•™ç»ƒæ¥è¿‡é¥®æ–™ï¼Œä»–å¼ºå£®çš„æ‰‹è‡‚ä¸Šé’ç­‹éšçº¦å¯è§ã€‚'è°¢è°¢ï¼Œè®­ç»ƒåç¡®å®éœ€è¦è¡¥å……èƒ½é‡ã€‚'ä»–çš„è¯éš¾å¾—è¶…è¿‡äº†äº”ä¸ªå­—ã€‚",
                    "ææ•™ç»ƒçœ‹äº†çœ‹é¥®æ–™ï¼Œçœ‰å¤´å¾®å¾®èˆ’å±•ã€‚'æ­£å¥½æ¸´äº†ï¼Œè°¢è°¢ã€‚'ä»–ä¸€å£æ°”å–äº†å¤§åŠç“¶ï¼Œåƒæ˜¯ç¡®å®éœ€è¦è¿™ä»½èƒ½é‡ã€‚",
                    "ææ•™ç»ƒæ‹¿ç€é¥®æ–™ï¼Œå˜´è§’å‡ºç°äº†ä¸€ä¸ä½ ä»æœªè§è¿‡çš„ç¬‘æ„ã€‚'ä½ æ€ä¹ˆçŸ¥é“æˆ‘å–œæ¬¢è¿™ä¸ªç‰Œå­ï¼Ÿ'ä»–é—®é“ï¼Œè¯­æ°”ä¸­æœ‰ç€å¥½å¥‡ã€‚"
                ]
            };
            
            const reaction = reactions[itemId][Math.floor(Math.random() * reactions[itemId].length)];
            showDialog("æå›½è‰¯", reaction);
        }

        // Visit a location
        function visitLocation(locationId) {
            gameState.currentLocation = locationId;
            bgImage.src = backgrounds[locationId];
            closeWindow('map-window');
            
            // Add to visited locations if first time
            if (!gameState.visitedLocations.includes(locationId)) {
                gameState.visitedLocations.push(locationId);
                unlockAchievement(`æ¢ç´¢ï¼š${getLocationName(locationId)}`, `é¦–æ¬¡è®¿é—®${getLocationName(locationId)}`);
            }
            
            // Handle location-specific events
            switch(locationId) {
                case 'basketball_court':
                    if (!gameState.flags.metGuoliang) {
                        renderScene("first_meeting");
                    } else {
                        // Check for special basketball court events based on progress
                        if (gameState.day >= 7 && gameState.affection >= 30 && !gameState.flags.taughtBasketball && Math.random() < 0.4) {
                            renderScene("basketball_lesson");
                        } else {
                            const reactions = [
                                "ä½ æ¥åˆ°ç¯®çƒåœºï¼Œææ•™ç»ƒæ­£åœ¨æŒ‡å¯¼çƒå‘˜ä»¬è®­ç»ƒã€‚ä»–é«˜å¤§çš„èº«å½±åœ¨çƒåœºä¸Šæ ¼å¤–é†’ç›®ï¼Œçƒå‘˜ä»¬å¯¹ä»–è¨€å¬è®¡ä»ã€‚",
                                "ç¯®çƒåœºä¸Šï¼Œææ•™ç»ƒæ­£åœ¨æˆ˜æœ¯æ¿ä¸Šç”»ç€ä»€ä¹ˆã€‚ä»–æµ“çœ‰ç´§é”ï¼Œè‚Œè‚‰çº¿æ¡åˆ†æ˜çš„æ‰‹è‡‚å±•ç°å‡ºéå‡¡çš„åŠ›é‡æ„Ÿã€‚",
                                "ææ•™ç»ƒæ­£åœ¨åœºè¾¹è§‚å¯Ÿçƒå‘˜ä»¬çš„è¡¨ç°ï¼Œç¥æƒ…ä¸“æ³¨ã€‚ä»–å¥å£®çš„èº«èº¯å®›å¦‚é›•å¡‘èˆ¬æŒºç«‹ï¼Œæ•£å‘å‡ºä¸å®¹å¿½è§†çš„æ°”åœºã€‚"
                            ];
                            showDialog("ç³»ç»Ÿ", reactions[Math.floor(Math.random() * reactions.length)]);
                            characterImage.src = characters.guoliang;
                        }
                    }
                    break;
                    
                case 'library':
                    characterImage.src = characters.natsu;
                    const libraryEvents = [
                        "ä½ åœ¨å›¾ä¹¦é¦†æ‰¾åˆ°ä¸€æœ¬å…³äºç¯®çƒæˆ˜æœ¯çš„ä¹¦ï¼Œå­¦ä¹ äº†ä¸€äº›çŸ¥è¯†ã€‚ç¯®çƒæŠ€èƒ½+1",
                        "ä½ åœ¨å›¾ä¹¦é¦†çš„ä¸€è§’å¶ç„¶çœ‹åˆ°ä¸€ä»½æ—§æ ¡æŠ¥ï¼Œä¸Šé¢æœ‰ææ•™ç»ƒå¹´è½»æ—¶å‚åŠ æ¯”èµ›çš„ç…§ç‰‡ã€‚ä»–çš„çœ¼ç¥ä¸ç°åœ¨ä¸€æ ·åšå®šï¼Œå´å°‘äº†å‡ åˆ†å†·æ¼ ã€‚",
                        "ä½ åœ¨å›¾ä¹¦é¦†å®‰é™åœ°å­¦ä¹ å•†æ³•ï¼Œæå‡äº†è‡ªå·±çš„çŸ¥è¯†ã€‚å•†æ³•æŠ€èƒ½+1",
                        "åœ¨ç¿»é˜…å­¦æ ¡å†å²èµ„æ–™æ—¶ï¼Œä½ å‘ç°ä¸€å¼ ç¯®çƒé˜Ÿçš„è€ç…§ç‰‡ã€‚ç…§ç‰‡ä¸Šæœ‰ä¸ªæ¨¡ç³Šçš„èº«å½±ï¼Œæ€»è®©ä½ æ„Ÿè§‰è«åç†Ÿæ‚‰ã€‚"
                    ];
                    
                    const eventIndex = Math.floor(Math.random() * libraryEvents.length);
                    showDialog("ç³»ç»Ÿ", libraryEvents[eventIndex]);
                    
                    if (eventIndex === 0) {
                        gameState.stats.basketball += 1;
                    } else if (eventIndex === 2) {
                        gameState.stats.law += 1;
                    } else if (eventIndex === 3 && !gameState.memoryFragments.includes('fragment1')) {
                        setTimeout(() => {
                            gameState.memoryFragments.push('fragment1');
                            showDialog("ç»“åŸå¤å¥ˆ", "ï¼ˆè‡ªè¨€è‡ªè¯­ï¼‰å¥‡æ€ª...é‚£ä¸ªèº«å½±ä¸ºä»€ä¹ˆä¼šè®©æˆ‘æ„Ÿåˆ°å¿ƒè·³åŠ é€Ÿï¼Ÿéš¾é“æˆ‘æ›¾ç»è§è¿‡ï¼Ÿ");
                            updateStatsDisplay();
                        }, 2000);
                    }
                    updateStatsDisplay();
                    break;
                    
                case 'cafe':
                    characterImage.src = characters.natsu;
                    if (!gameState.flags.visitedCafe) {
                        showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°æ ¡å›­é™„è¿‘çš„å’–å•¡å…ï¼Œè¿™é‡Œç¯å¢ƒèˆ’é€‚ï¼Œæ˜¯å­¦ç”Ÿä»¬æœ€å–œæ¬¢çš„ä¼‘æ¯åœ°ç‚¹ã€‚å¬è¯´ææ•™ç»ƒå¶å°”ä¹Ÿä¼šæ¥è¿™é‡Œå–å’–å•¡ã€‚");
                        gameState.flags.visitedCafe = true;
                    } else if (Math.random() < 0.2 && gameState.affection >= 20) {
                        renderScene("cafe_encounter");
                    } else {
                        showDialog("ç³»ç»Ÿ", "å’–å•¡å…é‡Œäººä¸å¤šï¼Œä½ æ‰¾äº†ä¸ªå®‰é™çš„ä½ç½®åä¸‹ã€‚èˆ’é€‚çš„ç¯å¢ƒè®©ä½ å¿ƒæƒ…æ”¾æ¾äº†ä¸€äº›ã€‚å¿ƒæƒ…å˜ä¸ºï¼šæ„‰å¿«");
                        gameState.mood = "æ„‰å¿«";
                        updateStatsDisplay();
                    }
                    break;
                    
                case 'office':
                    if (!gameState.flags.knowsSchedule && gameState.affection >= 25) {
                        renderScene("discover_schedule");
                    } else if (gameState.flags.discoveredLawConnection && !gameState.flags.helpedWithContract) {
                        renderScene("contract_help_opportunity");
                    } else {
                        characterImage.src = characters.natsu;
                        showDialog("ç³»ç»Ÿ", "ä½ æ¥åˆ°æ•™å¸ˆåŠå…¬å®¤åŒºåŸŸï¼Œä½†ææ•™ç»ƒä¸åœ¨ä»–çš„åŠå…¬å®¤ã€‚ä¹Ÿè®¸ä»–æ­£åœ¨çƒåœºæˆ–å…¶ä»–åœ°æ–¹ï¼Ÿ");
                    }
                    break;
                    
                case 'classroom':
                    characterImage.src = characters.natsu;
                    const classroomEvents = [
                        "ä½ åœ¨å•†æ³•è¯¾ä¸Šä¸“å¿ƒå¬è®²ï¼Œæé«˜äº†è‡ªå·±çš„ä¸“ä¸šçŸ¥è¯†ã€‚å•†æ³•æŠ€èƒ½+1",
                        "æ•™æˆæåˆ°äº†ä¸€ä¸ªä½“è‚²èµåŠ©åˆåŒçš„æ¡ˆä¾‹ï¼Œè¿™è®©ä½ æƒ³åˆ°äº†ææ•™ç»ƒå¯èƒ½é¢ä¸´çš„é—®é¢˜ã€‚",
                        "ä¸‹è¯¾åï¼Œä¸€ä½åŒå­¦å‘ä½ æ‰“å¬ææ•™ç»ƒçš„æƒ…å†µï¼Œçœ‹æ¥ä»–çš„é­…åŠ›ä¸åªå¯¹ä½ æœ‰æ•ˆã€‚"
                    ];
                    
                    const classEvent = classroomEvents[Math.floor(Math.random() * classroomEvents.length)];
                    showDialog("ç³»ç»Ÿ", classEvent);
                    
                    if (classEvent === classroomEvents[0]) {
                        gameState.stats.law += 1;
                        updateStatsDisplay();
                    }
                    break;
                    
                case 'home':
                    characterImage.src = characters.natsu;
                    showDialog("ç³»ç»Ÿ", "ä½ å›åˆ°äº†è‡ªå·±çš„å…¬å¯“ã€‚è¿™æ˜¯ä¸€å¤©ç»“æŸçš„å¥½åœ°æ–¹ï¼Œå¯ä»¥æ•´ç†æ€ç»ªï¼Œè®¡åˆ’ä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‚");
                    
                    // Random chance for special dream if memory hints discovered
                    if (gameState.flags.discoveredHint && Math.random() < 0.3) {
                        setTimeout(() => {
                            showDialog("ç³»ç»Ÿ", "å¤œæ™šï¼Œä½ åšäº†ä¸€ä¸ªå¥‡æ€ªçš„æ¢¦...");
                            setTimeout(() => {
                                renderScene("memory_dream");
                            }, 2000);
                        }, 2000);
                    }
                    break;
                    
                default:
                    characterImage.src = characters.natsu;
                    showDialog("ç³»ç»Ÿ", `ä½ æ¥åˆ°äº†${getLocationName(locationId)}ã€‚`);
            }
        }

function updateLocationEvents() {
    // ç¯®çƒåœºäº‹ä»¶æ›´æ–°
    const updatedBasketballCourtEvents = [
        "ä½ æ¥åˆ°ç¯®çƒåœºï¼Œæå›½è‰¯æ­£åœ¨æŒ‡å¯¼å­¦ç”Ÿè®­ç»ƒã€‚è™½ç„¶ä»–åªæ¯”å…¶ä»–é˜Ÿå‘˜å¤§ä¸€å²ï¼Œä½†ä»–çš„ä¸“ä¸šæŒ‡å¯¼è®©æ‰€æœ‰äººéƒ½å¿ƒæœå£æœã€‚",
        "ç¯®çƒåœºä¸Šï¼Œæå›½è‰¯ä¸€è¾¹ååŠ©è®­ç»ƒï¼Œä¸€è¾¹æŸ¥çœ‹è¯¾æœ¬ç¬”è®°ã€‚ä»–ä¼¼ä¹åœ¨å°è¯•å¹³è¡¡æ•™ç»ƒå·¥ä½œå’Œå­¦ä¸šã€‚",
        "æå›½è‰¯æ­£å’Œå‡ ä¸ªçƒå‘˜è®¨è®ºæˆ˜æœ¯ã€‚ä½ æ³¨æ„åˆ°å³ä½¿åœ¨è¯¾ä¸šç¹é‡çš„æƒ…å†µä¸‹ï¼Œä»–å¯¹ç¯®çƒçš„çƒ­æƒ…ä¾ç„¶ä¸å‡ã€‚"
    ];
    
    // æ•™å®¤äº‹ä»¶æ›´æ–°
    const updatedClassroomEvents = [
        "ä½ åœ¨æ•™å®¤é‡Œçœ‹åˆ°æå›½è‰¯ä¹Ÿé€‰äº†è¿™é—¨è¯¾ã€‚ä»–ååœ¨è§’è½è®¤çœŸè®°ç¬”è®°ï¼Œå¶å°”çš±çœ‰æ€è€ƒã€‚",
        "ä¸‹è¯¾åï¼Œæå›½è‰¯å’Œæ•™æˆè®¨è®ºä½“è‚²ç›¸å…³çš„æ³•å¾‹é—®é¢˜ã€‚ä»–ä¼¼ä¹æ­£å°†æ‰€å­¦çŸ¥è¯†åº”ç”¨åˆ°ç¯®çƒé˜Ÿç®¡ç†ä¸­ã€‚",
        "æå›½è‰¯åœ¨è¯¾å ‚ä¸Šå›ç­”é—®é¢˜ï¼Œä»–çš„ä¸“ä¸šè§è§£ä»¤æ•™æˆåˆ®ç›®ç›¸çœ‹ã€‚è¿™ä¸çƒåœºä¸Šä¸¥å‰çš„å½¢è±¡å½¢æˆäº†æœ‰è¶£å¯¹æ¯”ã€‚"
    ];
    
    // å›¾ä¹¦é¦†äº‹ä»¶æ›´æ–°
    const updatedLibraryEvents = [
        "ä½ åœ¨å›¾ä¹¦é¦†çœ‹åˆ°æå›½è‰¯æ­£åŸ‹å¤´äºä¸€å †ä½“è‚²ç®¡ç†å’Œæˆ˜æœ¯åˆ†æçš„ä¹¦ç±ä¸­ã€‚ä»–çš„å­¦ä¹ æ€åº¦ä¸è®­ç»ƒæ—¶ä¸€æ ·ä¸“æ³¨ã€‚",
        "æå›½è‰¯ååœ¨å›¾ä¹¦é¦†è§’è½ï¼Œä¸€è¾¹ç¿»é˜…ä½“è‚²åŒ»å­¦ä¹¦ç±ï¼Œä¸€è¾¹æŒ‰æ‘©è‡ªå·±çš„è†ç›–ã€‚ä»–ä¼¼ä¹ä»åœ¨å…³æ³¨è‡ªå·±çš„ä¼¤åŠ¿ã€‚",
        "ä½ æ³¨æ„åˆ°æå›½è‰¯å’Œå‡ ä¸ªå­¦ç”Ÿåœ¨è®¨è®ºè¯¾é¢˜ã€‚ä»–ä¸ä»…æ˜¯çƒé˜Ÿçš„æ•™ç»ƒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè®¤çœŸçš„å­¦ç”Ÿã€‚"
    ];
    
    // è¿™äº›æ›´æ–°åçš„äº‹ä»¶å¯ä»¥æ›¿æ¢æˆ–è¡¥å……åŸæœ‰äº‹ä»¶
}
                        
        // Get location name
        function getLocationName(locationId) {
            const names = {
                home: "å…¬å¯“",
                basketball_court: "ç¯®çƒåœº",
                library: "å›¾ä¹¦é¦†",
                cafe: "å’–å•¡å…",
                park: "å…¬å›­",
                gym: "å¥èº«æˆ¿",
                classroom: "æ•™å®¤",
                office: "æ•™å¸ˆåŠå…¬å®¤"
            };
            return names[locationId] || locationId;
        }

        // Show modal dialog
        function showModal(title, text, callback = null) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            modal.style.display = 'flex';
            modalCallback = callback;
        }

        // Close modal
        function closeModal() {
            modal.style.display = 'none';
            modalCallback = null;
        }

        // Confirm modal action
        function confirmModal() {
            modal.style.display = 'none';
            if (modalCallback) {
                modalCallback();
                modalCallback = null;
            }
        }
        
        // Show special event
        function showSpecialEvent(title, text, callback = null) {
            specialEventTitle.textContent = title;
            specialEventText.textContent = text;
            specialEvent.style.display = 'flex';
            specialEventCallback = callback;
        }
        
        // Close special event
        function closeSpecialEvent() {
            specialEvent.style.display = 'none';
            if (specialEventCallback) {
                specialEventCallback();
                specialEventCallback = null;
            }
        }

        // Show dialog with character name
        function showDialog(name, text, choices = null) {
            // æ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨
            if (!characterName || !dialogText || !choicesContainer) {
                console.error("å¯¹è¯æ¡†å…ƒç´ æœªæ‰¾åˆ°!");
                return;
            }
            
            characterName.textContent = name;
            dialogText.textContent = text;
            
            if (choices) {
                renderChoices(choices);
            } else {
                choicesContainer.innerHTML = '<button class="choice-button" onclick="continueDialog()">ç»§ç»­</button>';
            }
        }

        // Continue dialog (when no choices)
        function continueDialog() {
            // Default continue, just clear the dialog
            showDialog("ç³»ç»Ÿ", "ä½ å†³å®šåšä»€ä¹ˆï¼Ÿ");
            choicesContainer.innerHTML = '';
        }

        // Render choices
        function renderChoices(choices) {
            // æ¸…ç©ºå·²æœ‰é€‰é¡¹
            choicesContainer.innerHTML = '';
            
            // ä¸ºæ¯ä¸ªé€‰é¡¹åˆ›å»ºæŒ‰é’®
            choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(index, choice.next);
                choicesContainer.appendChild(button);
            });
        }

        // Make a choice
        function makeChoice(index, nextScene = null) {
            if (nextScene) {
                renderScene(nextScene);
            } else if (gameState.currentScene === "intro") {
                renderScene("day1_morning");
            }
        }

        // Unlock achievement
        function unlockAchievement(title, description) {
            if (!gameState.achievements.includes(title)) {
                gameState.achievements.push(title);
                
                // Show achievement notification
                achievementNotification.textContent = `ğŸ† è§£é”æˆå°±ï¼š${title}`;
                achievementNotification.style.display = 'block';
                
                setTimeout(() => {
                    achievementNotification.style.display = 'none';
                }, 3000);
            }
        }</script>
</body>
</html>

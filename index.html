<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>国良诱捕器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #0d1117;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
            color: #e6edf3;
        }
        
        #game-container {
            width: 100%;
            height: 100%;
            max-width: 450px;
            max-height: 800px;
            background-color: #161b22;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        /* Title Screen */
        #title-screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e253a 0%, #0d1117 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
            z-index: 10;
            transition: opacity 0.5s;
        }
        
        #title-logo {
            font-size: 3rem;
            font-weight: bold;
            color: #f778ba;
            text-shadow: 0 0 15px rgba(247, 120, 186, 0.7);
            margin-bottom: 3rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { text-shadow: 0 0 15px rgba(247, 120, 186, 0.7); }
            50% { text-shadow: 0 0 25px rgba(247, 120, 186, 0.9); }
            100% { text-shadow: 0 0 15px rgba(247, 120, 186, 0.7); }
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            background-color: #30363d;
            color: #f778ba;
            border: 2px solid #f778ba;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0.7rem 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 180px;
            text-align: center;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            background-color: #373e47;
        }
        
        /* Game UI */
        #game-ui {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        /* Status Bar */
        #status-bar {
            height: 60px;
            background-color: #0d1117;
            display: flex;
            align-items: center;
            padding: 0 15px;
            justify-content: space-between;
            border-bottom: 1px solid #30363d;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .status-label {
            font-size: 0.7rem;
            color: #8b949e;
        }
        
        .status-value {
            font-weight: bold;
            color: #f778ba;
            font-size: 0.9rem;
        }
        
        /* Scene Container */
        #scene-container {
            height: 35%;
            min-height: 200px;
            background-color: #1e253a;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        #scene-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 6rem;
            text-align: center;
            z-index: -1;
            opacity: 0.8;
        }
        
        #character {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 160px;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: transform 0.3s ease-out;
        }
        
        #character-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5));
        }
        
        /* Menu Button */
        #menu-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(13, 17, 23, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #f778ba;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #30363d;
            padding: 10px;
            margin: -10px;
        }
        
        #menu-button:active {
            transform: scale(0.95);
            background-color: rgba(30, 37, 58, 0.9);
        }
        
        /* Dialogue Box */
        #dialogue-box {
            flex-grow: 1;
            background-color: #0d1117;
            padding: 1rem;
            position: relative;
            border-top: 2px solid #30363d;
            display: flex;
            flex-direction: column;
        }
        
        #speaker-name {
            background-color: #f778ba;
            color: #0d1117;
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 0.9rem;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        #dialogue-text {
            margin-top: 1.2rem;
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 0.6rem;
            padding: 0.5rem;
            min-height: 80px;
            max-height: 30vh;
            color: #e6edf3;
            background-color: rgba(30, 37, 58, 0.3);
            border-radius: 10px;
            border: 1px solid #30363d;
        }
        
        #tap-indicator {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: #f778ba;
            animation: tap-pulse 1.5s infinite;
            font-size: 1.2rem;
        }
        
        @keyframes tap-pulse {
            0% { opacity: 0.6; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-3px); }
            100% { opacity: 0.6; transform: translateY(0); }
        }
        
        /* Choice Buttons */
        #choices-container {
            margin-top: 0.6rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: 35vh;
            gap: 8px;
        }
        
        .choice-btn {
            background-color: #21262d;
            padding: 1rem 1.2rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #30363d;
            text-align: left;
            font-size: 0.95rem;
            position: relative;
            color: #e6edf3;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            user-select: none;
            pointer-events: auto;
        }
        
        .choice-btn:active {
            background-color: #30363d;
            transform: translateY(2px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .choice-btn.disabled {
            opacity: 0.5;
            pointer-events: none;
            border: 1px solid #484f58;
            color: #8b949e;
        }
        
        .choice-btn::after {
            content: "›";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #f778ba;
            opacity: 0.8;
        }
        
        /* Description for choice */
        .choice-desc {
            font-size: 0.85rem;
            color: #8b949e;
            margin-top: 0.3rem;
        }
        
        /* Game Menu */
        #game-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(13, 17, 23, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .menu-title {
            font-size: 1.8rem;
            color: #f778ba;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(247, 120, 186, 0.5);
        }
        
        .menu-btn {
            width: 80%;
            max-width: 280px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #21262d;
            border: 1px solid #30363d;
            color: #e6edf3;
        }
        
        .menu-btn:hover {
            background-color: #30363d;
            border-color: #f778ba;
        }
        
        .menu-btn::before {
            margin-right: 1rem;
            font-size: 1.2rem;
            color: #f778ba;
        }
        
        #inventory-btn::before {
            content: "🎒";
        }
        
        #map-btn::before {
            content: "🗺️";
        }
        
        #status-btn::before {
            content: "📊";
        }
        
        #memory-btn::before {
            content: "💫";
        }
        
        #log-btn::before {
            content: "📝";
        }
        
        #save-btn::before {
            content: "💾";
        }
        
        #close-menu-btn::before {
            content: "↩️";
        }
        
        /* Sub-screens (Map, Inventory, etc.) */
        .sub-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0d1117;
            z-index: 15;
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            overflow-y: auto;
        }
        
        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid #30363d;
            position: sticky;
            top: 0;
            background-color: #0d1117;
            z-index: 2;
        }
        
        .screen-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f778ba;
        }
        
        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #21262d;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: #e6edf3;
            border: 1px solid #30363d;
        }
        
        .back-btn:active {
            transform: scale(0.95);
            background-color: #30363d;
        }
        
        /* Map Screen */
        .location-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 0.6rem;
            padding-bottom: 1rem;
        }
        
        .location-item {
            background-color: #21262d;
            border-radius: 12px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            border: 1px solid #30363d;
        }
        
        .location-item:active {
            transform: translateY(3px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            background-color: #30363d;
        }
        
        .location-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .location-name {
            font-size: 0.9rem;
            color: #e6edf3;
            font-weight: bold;
        }
        
        .current-location {
            border: 2px solid #f778ba;
            background-color: rgba(247, 120, 186, 0.1);
        }
        
        .current-location .location-name {
            color: #f778ba;
        }
        
        /* Status Screen */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }
        
        .status-bar-item {
            background-color: #21262d;
            border-radius: 10px;
            padding: 1rem 1.2rem;
            border: 1px solid #30363d;
        }
        
        .status-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .status-bar-label {
            font-weight: bold;
            color: #e6edf3;
        }
        
        .status-bar-value {
            color: #f778ba;
            font-weight: bold;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #30363d;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f778ba, #da5e9b);
            transition: width 0.5s;
            border-radius: 6px;
        }
        
        /* Inventory Screen */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-top: 0.6rem;
            padding-bottom: 1rem;
        }
        
        .inventory-item {
            background-color: #21262d;
            border-radius: 10px;
            height: 5.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            border: 1px solid #30363d;
        }
        
        .inventory-item:active {
            background-color: #30363d;
            transform: translateY(2px);
        }
        
        .inventory-icon {
            font-size: 2rem;
            margin-bottom: 0.3rem;
        }
        
        .inventory-name {
            font-size: 0.8rem;
            color: #e6edf3;
            text-align: center;
            padding: 0 0.3rem;
        }
        
        /* Item Detail Modal */
        #item-detail-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(13, 17, 23, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 25;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .item-detail-container {
            width: 85%;
            max-width: 320px;
            background-color: #21262d;
            border-radius: 15px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #30363d;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .item-detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            width: 100%;
        }
        
        .item-detail-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
        }
        
        .item-detail-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #f778ba;
        }
        
        .item-detail-description {
            font-size: 1rem;
            color: #c9d1d9;
            margin-bottom: 1.8rem;
            text-align: center;
            line-height: 1.5;
        }
        
        .item-detail-buttons {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
        
        .item-detail-btn {
            padding: 0.7rem 1.2rem;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            border: none;
            transition: all 0.3s;
        }
        
        .use-btn {
            background-color: #f778ba;
            color: #0d1117;
            flex: 2;
            margin-right: 10px;
        }
        
        .use-btn:active {
            background-color: #da5e9b;
            transform: translateY(2px);
        }
        
        .cancel-btn {
            background-color: #30363d;
            color: #e6edf3;
            flex: 1;
        }
        
        .cancel-btn:active {
            background-color: #484f58;
            transform: translateY(2px);
        }
        
        /* Memory Log Screen */
        .memory-log-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            padding-bottom: 1rem;
        }
        
        .memory-log-item {
            background-color: #21262d;
            border-radius: 10px;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            position: relative;
            border: 1px solid #30363d;
            transition: all 0.3s;
        }
        
        .memory-log-item:active {
            transform: translateY(2px);
            background-color: #30363d;
        }
        
        .memory-log-item.locked {
            background-color: #161b22;
            color: #484f58;
            border: 1px solid #30363d;
            cursor: default;
        }
        
        .memory-log-icon {
            font-size: 2rem;
            margin-bottom: 0.3rem;
            color: #f778ba;
        }
        
        .memory-log-item.locked .memory-log-icon {
            color: #484f58;
        }
        
        .memory-log-number {
            font-size: 0.8rem;
            font-weight: bold;
            color: #c9d1d9;
        }
        
        .memory-log-item.locked .memory-log-number {
            color: #6e7681;
        }
        
        /* Memory Log Modal */
        #memory-log-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(13, 17, 23, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 30;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .memory-log-content {
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            background-color: #21262d;
            border-radius: 15px;
            padding: 1.5rem;
            overflow-y: auto;
            position: relative;
            border: 1px solid #30363d;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .memory-log-close {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #30363d;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1rem;
            color: #e6edf3;
            border: 1px solid #484f58;
        }
        
        .memory-log-close:active {
            transform: scale(0.95);
            background-color: #484f58;
        }
        
        .memory-log-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #f778ba;
            margin-bottom: 1.2rem;
            padding-right: 2rem;
        }
        
        .memory-log-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #c9d1d9;
        }
        
        /* Game Log Screen */
        #log-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .log-entry {
            background-color: #21262d;
            margin-bottom: 0.5rem;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid #30363d;
        }
        
        .log-entry.special {
            border-left: 3px solid #f778ba;
        }
        
        .log-heading {
            font-weight: bold;
            color: #f778ba;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .log-text {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #c9d1d9;
        }
        
        /* Memory Collected Screen */
        #memory-collected {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(13, 17, 23, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 25;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }
        
        #memory-title {
            color: #f778ba;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 10px rgba(247, 120, 186, 0.5);
            text-align: center;
        }
        
        #memory-content {
            background-color: #21262d;
            padding: 1.5rem;
            border-radius: 15px;
            width: 90%;
            max-height: 50vh;
            overflow-y: auto;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid #30363d;
            color: #c9d1d9;
        }
        
        #continue-btn {
            background-color: #f778ba;
            color: #0d1117;
            border: none;
            width: 150px;
            font-weight: bold;
        }
        
        #continue-btn:active {
            background-color: #da5e9b;
        }
        
        /* Notification */
        #notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(13, 17, 23, 0.9);
            color: #f778ba;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            font-size: 1rem;
            z-index: 30;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            border: 1px solid #f778ba;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 250px;
            font-weight: bold;
        }
        
        /* Loading Screen */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e253a 0%, #0d1117 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            transition: opacity 0.5s;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid #30363d;
            border-bottom-color: #f778ba;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1.5s linear infinite;
            margin-bottom: 1.5rem;
        }
        
        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        #loading-text {
            color: #f778ba;
            font-size: 1.3rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        /* Responsive Adjustments */
        @media (max-height: 600px) {
            #scene-container {
                height: 30%;
                min-height: 150px;
            }
            
            #dialogue-text {
                max-height: 25vh;
                font-size: 0.95rem;
            }
            
            #choices-container {
                max-height: 30vh;
            }
            
            .choice-btn {
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
            }
            
            .status-item {
                transform: scale(0.9);
            }
        }

        @media (min-height: 800px) {
            #dialogue-text {
                max-height: 35vh;
            }
            
            #choices-container {
                max-height: 40vh;
            }
        }

        /* Game Progress Indicator */
        .progress-indicator {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: #8b949e;
            display: flex;
            align-items: center;
        }

        .progress-indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #30363d;
            margin-right: 5px;
        }

        .progress-indicator-dot.active {
            background-color: #f778ba;
        }

        /* Special Effects */
        .scene-transition {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            opacity: 0;
            pointer-events: none;
            z-index: 40;
            transition: opacity 0.5s;
        }

        /* Highlight effect for new elements */
        @keyframes highlight {
            0% { box-shadow: 0 0 0 rgba(247, 120, 186, 0); }
            50% { box-shadow: 0 0 15px rgba(247, 120, 186, 0.8); }
            100% { box-shadow: 0 0 0 rgba(247, 120, 186, 0); }
        }

        .highlight {
            animation: highlight 2s ease-in-out;
        }
        
        /* Emergency Recovery Button */
        #recovery-button {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 999;
            padding: 5px 10px;
            background-color: #f778ba;
            color: #0d1117;
            border: none;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Loading Screen -->
        <div id="loading-screen">
            <span class="loader"></span>
            <div id="loading-text">加载中...</div>
        </div>
        
        <!-- Title Screen -->
        <div id="title-screen">
            <div id="title-logo">国良诱捕器</div>
            <div class="btn" id="start-btn">开始游戏</div>
            <div class="btn" id="load-btn">继续游戏</div>
            <div class="btn" id="about-btn">关于游戏</div>
        </div>
        
        <!-- Game UI -->
        <div id="game-ui">
            <!-- Status Bar -->
            <div id="status-bar">
                <div class="status-item">
                    <div class="status-label">日期</div>
                    <div class="status-value" id="date-display">第1天</div>
                </div>
                <div class="status-item">
                    <div class="status-label">时间</div>
                    <div class="status-value" id="time-display">上午</div>
                </div>
                <div class="status-item">
                    <div class="status-label">体力</div>
                    <div class="status-value" id="energy-display">100%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">记忆</div>
                    <div class="status-value" id="memory-display">0/12</div>
                </div>
            </div>
            
            <!-- Scene Container -->
            <div id="scene-container">
                <div id="scene-bg">🏫</div>
                <div id="character"><img src="https://pic1.imgdb.cn/item/66e83fc7d9c307b7e9977eda.png" alt="角色" id="character-img"></div>
                <div id="menu-button">≡</div>
            </div>
            
            <!-- Dialogue Box -->
            <div id="dialogue-box">
                <div id="speaker-name">系统</div>
                <div id="dialogue-text">欢迎来到《国良诱捕器》！你将扮演结城夏奈，一位商法专业的大二学生。你的目标是追求李国良，大三篮球队的学生教练。点击屏幕继续...</div>
                <div id="tap-indicator">▼</div>
                <div id="choices-container"></div>
                <div class="progress-indicator">
                    <div class="progress-indicator-dot active"></div>
                    <div class="progress-indicator-dot"></div>
                    <div class="progress-indicator-dot"></div>
                </div>
            </div>
        </div>
        
        <!-- Game Menu -->
        <div id="game-menu">
            <div class="menu-title">游戏菜单</div>
            <div class="btn menu-btn" id="inventory-btn">物品栏</div>
            <div class="btn menu-btn" id="map-btn">地图</div>
            <div class="btn menu-btn" id="status-btn">属性</div>
            <div class="btn menu-btn" id="memory-btn">记忆收集</div>
            <div class="btn menu-btn" id="log-btn">游戏日志</div>
            <div class="btn menu-btn" id="save-btn">保存游戏</div>
            <div class="btn menu-btn" id="close-menu-btn">返回游戏</div>
        </div>
        
        <!-- Map Screen -->
        <div id="map-screen" class="sub-screen">
            <div class="screen-header">
                <div class="screen-title">地图</div>
                <div class="back-btn">←</div>
            </div>
            <div class="location-grid">
                <div class="location-item" data-location="apartment">
                    <div class="location-icon">🏠</div>
                    <div class="location-name">公寓</div>
                </div>
                <div class="location-item" data-location="basketball-court">
                    <div class="location-icon">🏀</div>
                    <div class="location-name">篮球场</div>
                </div>
                <div class="location-item" data-location="library">
                    <div class="location-icon">📚</div>
                    <div class="location-name">图书馆</div>
                </div>
                <div class="location-item" data-location="cafe">
                    <div class="location-icon">☕</div>
                    <div class="location-name">咖啡厅</div>
                </div>
                <div class="location-item" data-location="park">
                    <div class="location-icon">🌳</div>
                    <div class="location-name">公园</div>
                </div>
                <div class="location-item" data-location="gym">
                    <div class="location-icon">💪</div>
                    <div class="location-name">健身房</div>
                </div>
                <div class="location-item" data-location="classroom">
                    <div class="location-icon">🏫</div>
                    <div class="location-name">教室</div>
                </div>
                <div class="location-item" data-location="office">
                    <div class="location-icon">🧑‍💼</div>
                    <div class="location-name">教师办公室</div>
                </div>
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="sub-screen">
            <div class="screen-header">
                <div class="screen-title">物品栏</div>
                <div class="back-btn">←</div>
            </div>
            <div class="inventory-grid" id="inventory-grid">
                <!-- 物品将通过JS动态添加 -->
            </div>
        </div>
        
        <!-- Status Screen -->
        <div id="status-screen" class="sub-screen">
            <div class="screen-header">
                <div class="screen-title">属性面板</div>
                <div class="back-btn">←</div>
            </div>
            <div class="status-grid">
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">魅力</div>
                        <div class="status-bar-value" id="charm-value">20/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="charm-bar" style="width: 20%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">智慧</div>
                        <div class="status-bar-value" id="wisdom-value">25/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="wisdom-bar" style="width: 25%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">体力</div>
                        <div class="status-bar-value" id="stamina-value">100/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="stamina-bar" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">商法知识</div>
                        <div class="status-bar-value" id="law-value">40/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="law-bar" style="width: 40%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">篮球技能</div>
                        <div class="status-bar-value" id="basketball-value">10/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="basketball-bar" style="width: 10%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">烹饪能力</div>
                        <div class="status-bar-value" id="cooking-value">15/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cooking-bar" style="width: 15%;"></div>
                    </div>
                </div>
                <div class="status-bar-item">
                    <div class="status-bar-header">
                        <div class="status-bar-label">国良好感度</div>
                        <div class="status-bar-value" id="affection-value">0/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="affection-bar" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Collection Screen -->
        <div id="memory-log-screen" class="sub-screen">
            <div class="screen-header">
                <div class="screen-title">记忆碎片</div>
                <div class="back-btn">←</div>
            </div>
            <div class="memory-log-grid" id="memory-log-grid">
                <!-- 记忆碎片将通过JS动态添加 -->
            </div>
        </div>
        
        <!-- Game Log Screen -->
        <div id="log-screen" class="sub-screen">
            <div class="screen-header">
                <div class="screen-title">游戏日志</div>
                <div class="back-btn">←</div>
            </div>
            <div id="log-container">
                <!-- 日志将通过JS动态添加 -->
            </div>
        </div>
        
        <!-- Item Detail Modal -->
        <div id="item-detail-modal">
            <div class="item-detail-container">
                <div class="item-detail-header">
                    <div class="item-detail-icon" id="item-detail-icon">📘</div>
                    <div class="item-detail-name" id="item-detail-name">篮球入门</div>
                </div>
                <div class="item-detail-description" id="item-detail-description">提高篮球技能的书籍</div>
                <div class="item-detail-buttons">
                    <button class="item-detail-btn use-btn" id="use-item-btn">使用</button>
                    <button class="item-detail-btn cancel-btn" id="cancel-item-btn">取消</button>
                </div>
            </div>
        </div>
        
        <!-- Memory Detail Modal -->
        <div id="memory-log-modal">
            <div class="memory-log-content">
                <div class="memory-log-close">✕</div>
                <h3 class="memory-log-title" id="memory-log-modal-title">记忆碎片：初次相遇</h3>
                <div class="memory-log-text" id="memory-log-modal-text">
                    你想起了一个模糊的场景，在一个明亮的教室里，有一个高大的身影坐在你旁边。他在帮你解答商法课题，你们看起来很熟悉...
                </div>
            </div>
        </div>
        
        <!-- Notification -->
        <div id="notification">属性提升！</div>
        
        <!-- Memory Collection Popup -->
        <div id="memory-collected">
            <div id="memory-title">记忆碎片收集</div>
            <div id="memory-content">你发现了一段被遗忘的记忆...</div>
            <div class="btn" id="continue-btn">继续</div>
        </div>

        <!-- Scene Transition Effect -->
        <div class="scene-transition"></div>
        
        <!-- Emergency Recovery Button -->
        <button id="recovery-button">恢复游戏</button>
    </div>

    <script>
        // 游戏数据
        let gameData = {
            player: {
                name: "结城夏奈",
                attributes: {
                    charm: 20,
                    wisdom: 25,
                    stamina: 100,
                    law: 40,
                    basketball: 10,
                    cooking: 15
                },
                inventory: [],
                memoryFragments: []
            },
            characters: {
                guoliang: {
                    name: "李国良",
                    affection: 0,
                    metFlag: false
                },
                misaki: {
                    name: "相泽美咲",
                    metFlag: false
                }
            },
            gameState: {
                day: 1,
                time: "morning", // morning, afternoon, evening
                location: "apartment",
                storyFlag: 0,
                energyLeft: 3,
                completedEvents: [],
                gameLog: [] // 游戏日志
            }
        };

        // 物品数据
        const itemsData = {
            basketballBook: {
                id: "basketballBook",
                name: "篮球入门",
                icon: "📘",
                description: "提高篮球技能的书籍，使用后篮球技能+5。",
                effect: {type: "attribute", target: "basketball", value: 5}
            },
            lawBook: {
                id: "lawBook",
                name: "商法教材",
                icon: "📚",
                description: "提高商法知识的教材，使用后商法知识+5。",
                effect: {type: "attribute", target: "law", value: 5}
            },
            sportsDrink: {
                id: "sportsDrink",
                name: "运动饮料",
                icon: "🥤",
                description: "恢复少量体力，使用后体力+20。",
                effect: {type: "attribute", target: "stamina", value: 20}
            },
            chocolates: {
                id: "chocolates",
                name: "巧克力礼盒",
                icon: "🍫",
                description: "给李国良的礼物，使用后好感度+10。",
                effect: {type: "affection", value: 10}
            },
            homemadeCookies: {
                id: "homemadeCookies",
                name: "手工饼干",
                icon: "🍪",
                description: "自制点心，使用后好感度+15。",
                effect: {type: "affection", value: 15}
            },
            photoAlbum: {
                id: "photoAlbum",
                name: "校友相册",
                icon: "📔",
                description: "记录学校往年的照片，使用后获得记忆碎片。",
                effect: {type: "memory", id: "memory2"}
            },
            perfume: {
                id: "perfume",
                name: "香水",
                icon: "🧴",
                description: "提高魅力值，使用后魅力+10。",
                effect: {type: "attribute", target: "charm", value: 10}
            },
            cookbook: {
                id: "cookbook",
                name: "食谱",
                icon: "📕",
                description: "提高烹饪能力，使用后烹饪+10。",
                effect: {type: "attribute", target: "cooking", value: 10}
            }
        };

        // 记忆碎片数据
        const memoryFragmentsData = {
            memory1: {
                id: "memory1",
                title: "记忆碎片：初次相遇",
                content: "你想起了一个模糊的场景，在一个明亮的教室里，有一个高大的身影坐在你旁边。他在帮你解答商法课题，你们看起来很熟悉..."
            },
            memory2: {
                id: "memory2",
                title: "记忆碎片：校友相册中的照片",
                content: "在校友相册中，你发现了一张合影，照片中的你和李国良站在一起，看起来是同一个班级。但你为什么没有这段记忆？"
            },
            memory3: {
                id: "memory3",
                title: "记忆碎片：篮球比赛",
                content: "你记起在看台上激动地呐喊，为场上的李国良加油。他是球队的明星球员，但在一次关键扣篮后，他的落地姿势不对..."
            },
            memory4: {
                id: "memory4",
                title: "记忆碎片：医院的日子",
                content: "一段在医院的记忆闪回，你每天都去看望膝盖受伤的李国良，为他带去学习资料和鼓励。你们的关系比普通同学亲密得多。"
            },
            memory5: {
                id: "memory5",
                title: "记忆碎片：樱花树下的约定",
                content: "樱花树下，李国良握着你的手，说：'等我成为教练的那天，你要答应做我的女朋友。'你笑着点头答应了。"
            },
            memory6: {
                id: "memory6",
                title: "记忆碎片：失意的夜晚",
                content: "一个雨夜，李国良告诉你他因为膝伤无法继续职业篮球的梦想，你紧紧抱住他，告诉他你会一直支持他。"
            },
            memory7: {
                id: "memory7",
                title: "记忆碎片：教练之路",
                content: "你记得自己鼓励李国良转型为教练，说他有教导他人的天赋。他因为你的话重新燃起了对篮球的热情。"
            },
            memory8: {
                id: "memory8",
                title: "记忆碎片：意外的那天",
                content: "一个雨天，你为了赶去给李国良送东西，在校园里跑得太快，然后是一片黑暗...接着你在医院醒来，感觉很多记忆都模糊了。"
            },
            memory9: {
                id: "memory9",
                title: "记忆碎片：父母的决定",
                content: "医院的对话中，你隐约听到父母和医生的对话，说是因为意外对你的大脑有影响，最好不要受到太大刺激。你被转学到了商法专业。"
            },
            memory10: {
                id: "memory10",
                title: "记忆碎片：李国良的选择",
                content: "病房外，李国良与你的父母交谈，同意暂时不打扰你，让你自然恢复记忆。他选择在暗中等待你，履行你们的约定。"
            },
            memory11: {
                id: "memory11",
                title: "记忆碎片：商法才能",
                content: "你想起自己在上商法选修课时展现出的天赋，这让李国良很惊讶。他一直鼓励你发展这方面的能力。"
            },
            memory12: {
                id: "memory12",
                title: "记忆碎片：完整的过去",
                content: "所有记忆碎片连接在一起，你终于想起了完整的过去：你和李国良是高中同学，一起选修了商法课程。你们相爱，他因保护你在比赛中受伤，你因自责导致意外失忆。现在，命运让你们再次相遇，履行樱花树下的约定。"
            }
        };

        // 定义场景和事件数据
        const locationsData = {
            apartment: {
                name: "公寓",
                icon: "🏠",
                description: "你的居住地，可以休息恢复体力。",
                events: ["rest", "study", "cook"]
            },
            "basketball-court": {
                name: "篮球场",
                icon: "🏀",
                description: "校篮球队训练的地方，李国良经常在这里。",
                events: ["watchTraining", "practiceBasketball", "meetGuoliang"]
            },
            library: {
                name: "图书馆",
                icon: "📚",
                description: "学习的好地方，可以提高知识。",
                events: ["studyLaw", "readBooks", "meetClassmate"]
            },
            cafe: {
                name: "咖啡厅",
                icon: "☕",
                description: "校园附近的咖啡厅，是放松和社交的好地方。",
                events: ["drinkCoffee", "meetFriends", "contractEvent"]
            },
            park: {
                name: "公园",
                icon: "🌳",
                description: "校园内的小公园，樱花树下是个特别的地方。",
                events: ["relax", "cherryBlossomMemory", "exercise"]
            },
            gym: {
                name: "健身房",
                icon: "💪",
                description: "校园健身中心，可以提高体力。",
                events: ["workout", "rehabilitationTraining", "meetMisaki"]
            },
            classroom: {
                name: "教室",
                icon: "🏫",
                description: "上课的地方，可以提高学术知识。",
                events: ["attendClass", "groupStudy", "presentationEvent"]
            },
            office: {
                name: "教师办公室",
                icon: "🧑‍💼",
                description: "教授们的办公室，可以获取学习建议。",
                events: ["meetProfessor", "seekAdvice", "helpGrading"]
            }
        };

        // 定义事件数据
        const eventsData = {
            // 公寓事件
            rest: {
                name: "休息",
                description: "休息一会儿，恢复体力。",
                energyCost: 0,
                requirements: {},
                execute: function() {
                    changeAttribute("stamina", 50);
                    addToLog("活动", "你在公寓里好好休息了一会儿，恢复了不少体力。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你在公寓里好好休息了一会儿，恢复了不少体力。"}
                        ],
                        choices: []
                    };
                }
            },
            study: {
                name: "自习",
                description: "在家学习提高知识。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("wisdom", 5);
                    changeAttribute("law", 3);
                    addToLog("活动", "你认真地复习了商法课程，知识和智慧都有所提升。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你认真地复习了商法课程，知识和智慧都有所提升。"}
                        ],
                        choices: []
                    };
                }
            },
            cook: {
                name: "烹饪",
                description: "尝试做一些美食，提高烹饪能力。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("cooking", 3);
                    const cookingValue = gameData.player.attributes.cooking;
                    addToLog("活动", "你尝试烹饪了一些点心，烹饪能力得到提升。");
                    if (cookingValue >= 30 && !hasItem("homemadeCookies")) {
                        addToInventory("homemadeCookies");
                        addToLog("获得物品", "你成功做出了美味的手工饼干！");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你尝试烹饪了一些点心，烹饪能力得到提升。你成功做出了美味的手工饼干！"},
                                {speaker: "夏奈", text: "这次的饼干看起来很不错，也许可以送给李国良尝尝..."}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你尝试烹饪了一些点心，烹饪能力得到提升。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            
            // 篮球场事件
            watchTraining: {
                name: "观看训练",
                description: "观看篮球队训练。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("basketball", 2);
                    addToLog("活动", "你观看了篮球队的训练，对篮球有了更多了解。");
                    if (!gameData.characters.guoliang.metFlag && gameData.gameState.storyFlag === 0) {
                        gameData.characters.guoliang.metFlag = true;
                        gameData.gameState.storyFlag = 1;
                        addToLog("剧情", "你在篮球场第一次见到了李国良，他是篮球队的学生教练。");
                        return firstMeetingEvent();
                    } else {
                        return {
                            dialogue: [{speaker: "系统", text: "你观看了篮球队的训练，对篮球有了更多了解。"},
                                {speaker: "夏奈", text: "他们训练得真认真，特别是李国良教练，指导得很专业。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            practiceBasketball: {
                name: "练习篮球",
                description: "尝试自己练习一下篮球。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("basketball", 5);
                    changeAttribute("stamina", -10);
                    addToLog("活动", "你在球场一角练习投篮，篮球技能有所提升，消耗了一些体力。");
                    
                    const basketballSkill = gameData.player.attributes.basketball;
                    if (basketballSkill >= 25 && gameData.characters.guoliang.metFlag && gameData.characters.guoliang.affection >= 15 && !hasCompleted("basketballTraining")) {
                        completeEvent("basketballTraining");
                        addToLog("剧情", "李国良注意到你在练习篮球，主动过来指导你。");
                        return basketballTrainingEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在球场一角练习投篮，虽然很多都没进，但篮球技能有所提升。"},
                                {speaker: "夏奈", text: "原来篮球没那么简单啊...不过我不会放弃的！"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            meetGuoliang: {
                name: "寻找李国良",
                description: "尝试在篮球场找到李国良。",
                energyCost: 1,
                requirements: {
                    flags: ["metGuoliang"]
                },
                available: function() {
                    return gameData.characters.guoliang.metFlag;
                },
                execute: function() {
                    addToLog("活动", "你在篮球场寻找李国良。");
                    if (gameData.characters.guoliang.affection >= 10 && gameData.gameState.storyFlag === 1 && !hasCompleted("firstConversation")) {
                        completeEvent("firstConversation");
                        gameData.gameState.storyFlag = 2;
                        addToLog("剧情", "你鼓起勇气与李国良进行了更深入的交谈。");
                        return deeperConversationEvent();
                    } else if (gameData.characters.guoliang.affection >= 30 && gameData.gameState.storyFlag === 3 && !hasCompleted("contractHelp")) {
                        addToLog("剧情", "你和李国良讨论了篮球队的赞助合同问题。");
                        return contractDiscussionEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在篮球场找到了李国良，但他看起来正忙着训练队员。"},
                                {speaker: "夏奈", text: "他看起来真的很忙，也许现在不是打扰他的好时机..."}
                            ],
                            choices: []
                        };
                    }
                }
            },
            
            // 图书馆事件
            studyLaw: {
                name: "研究商法",
                description: "在图书馆研究商法知识。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("law", 7);
                    changeAttribute("wisdom", 3);
                    addToLog("活动", "你在图书馆专心研究商法知识，提高了不少专业技能。");
                    
                    if (!hasItem("lawBook") && Math.random() > 0.7) {
                        addToInventory("lawBook");
                        addToLog("获得物品", "图书管理员给了你一本商法教材。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在图书馆专心研究商法知识，提高了不少专业技能。"},
                                {speaker: "图书管理员", text: "这位同学，这本新到的商法教材可能对你有用，你可以借走。"},
                                {speaker: "夏奈", text: "太感谢了！这正是我需要的！"}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在图书馆专心研究商法知识，提高了不少专业技能。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            readBooks: {
                name: "阅读",
                description: "阅读各种书籍拓展知识面。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("wisdom", 5);
                    addToLog("活动", "你在图书馆阅读了各种书籍，增长了见识。");
                    
                    if (!hasItem("basketballBook") && Math.random() > 0.7) {
                        addToInventory("basketballBook");
                        addToLog("获得物品", "你找到了一本篮球入门教程。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在图书馆阅读了各种书籍，增长了见识。"},
                                {speaker: "夏奈", text: "咦，这本篮球入门教程看起来不错...也许可以帮我了解李国良的世界。"}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在图书馆阅读了各种书籍，增长了见识。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            meetClassmate: {
                name: "与同学交流",
                description: "在图书馆与同学交流。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("charm", 3);
                    addToLog("活动", "你在图书馆与同学交流学习心得，社交能力有所提升。");
                    
                    if (gameData.gameState.storyFlag >= 1 && !hasCompleted("classmateTalk") && Math.random() > 0.5) {
                        completeEvent("classmateTalk");
                        if (!hasMemoryFragment("memory1") && gameData.player.memoryFragments.length >= 1) {
                            collectMemoryFragment("memory1");
                            addToLog("记忆", "你从同学那里得知，李国良似乎和你是同一届的学生。");
                            return {
                                dialogue: [
                                    {speaker: "同学", text: "夏奈！来，给你介绍一下，这是相泽美咲学姐，学生会体育部部长。"},
                                    {speaker: "同学", text: "夏奈，听说你对篮球队的李教练很感兴趣？"},
                                    {speaker: "夏奈", text: "嗯...是有点，你认识他吗？"},
                                    {speaker: "同学", text: "不太熟，不过听说他以前是校队的明星球员，因为膝伤才转做教练的。你知道吗，他好像和你是同一届的，只是你转到商法专业之后才没怎么接触。"},
                                    {speaker: "夏奈", text: "同一届？不可能吧...我完全没印象啊..."},
                                    {speaker: "系统", text: "一个奇怪的画面闪过你的脑海..."}
                                ],
                                choices: []
                            };
                        }
                    }
                    
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你在图书馆与同学交流学习心得，社交能力有所提升。"}
                        ],
                        choices: []
                    };
                }
            },
            
            // 咖啡厅事件
            drinkCoffee: {
                name: "喝杯咖啡",
                description: "放松一下，享受咖啡时光。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("stamina", 20);
                    addToLog("活动", "你在咖啡厅放松地喝了杯咖啡，恢复了一些精力。");
                    
                    if (gameData.characters.guoliang.metFlag && gameData.characters.guoliang.affection >= 20 && !hasCompleted("cafeMeeting") && Math.random() > 0.5) {
                        completeEvent("cafeMeeting");
                        addToLog("剧情", "你在咖啡厅偶遇了李国良。");
                        return cafeEncounterEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在咖啡厅放松地喝了杯咖啡，恢复了一些精力。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            meetFriends: {
                name: "与朋友聚会",
                description: "和朋友们在咖啡厅聚会。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("charm", 5);
                    addToLog("活动", "你和朋友们在咖啡厅聊天，度过了愉快的时光，社交能力得到提升。");
                    if (!gameData.characters.misaki.metFlag && gameData.characters.guoliang.affection >= 15) {
                        gameData.characters.misaki.metFlag = true;
                        addToLog("剧情", "你认识了相泽美咲，学生会体育部部长。");
                        return meetMisakiEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你和朋友们在咖啡厅聊天，度过了愉快的时光，社交能力得到提升。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            contractEvent: {
                name: "合同复习",
                description: "在咖啡厅整理学习资料。",
                energyCost: 1,
                available: function() {
                    return gameData.gameState.storyFlag >= 2;
                },
                requirements: {},
                execute: function() {
                    changeAttribute("law", 4);
                    addToLog("活动", "你在咖啡厅整理商法课程的合同法相关资料，法律知识有所提升。");
                    if (gameData.gameState.storyFlag === 2 && gameData.player.attributes.law >= 40 && !hasCompleted("contractReview")) {
                        completeEvent("contractReview");
                        gameData.gameState.storyFlag = 3;
                        addToLog("剧情", "李国良寻求你对篮球队赞助合同的帮助。");
                        return contractReviewEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在咖啡厅整理商法课程的合同法相关资料，法律知识有所提升。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            
            // 公园事件
            relax: {
                name: "放松散步",
                description: "在公园里散步放松。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("stamina", 15);
                    addToLog("活动", "你在公园里悠闲地散步，心情舒畅，恢复了一些精力。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你在公园里悠闲地散步，心情舒畅，恢复了一些精力。"}
                        ],
                        choices: []
                    };
                }
            },
            cherryBlossomMemory: {
                name: "观赏樱花",
                description: "观赏公园中的樱花树。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    addToLog("活动", "你在公园欣赏美丽的樱花。");
                    if (gameData.player.memoryFragments.length >= 3 && !hasMemoryFragment("memory5")) {
                        collectMemoryFragment("memory5");
                        addToLog("记忆", "樱花树下的景色触发了你关于某个重要约定的记忆。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你站在盛开的樱花树下，一种奇怪的熟悉感油然而生。"},
                                {speaker: "夏奈", text: "为什么...我感觉在这里有过很重要的回忆..."},
                                {speaker: "系统", text: "一段模糊的记忆闪过你的脑海..."}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在公园欣赏美丽的樱花，心情愉悦。"},
                                {speaker: "夏奈", text: "这些樱花真美啊...不知道为什么，这景色让我感到有点怀念。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            exercise: {
                name: "户外锻炼",
                description: "在公园进行户外锻炼。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("stamina", -10);
                    changeAttribute("charm", 3);
                    addToLog("活动", "你在公园进行了一些户外锻炼，身体素质得到锻炼，外表看起来更有活力。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你在公园进行了一些户外锻炼，身体素质得到锻炼，外表看起来更有活力。"}
                        ],
                        choices: []
                    };
                }
            },
            
            // 健身房事件
            workout: {
                name: "健身",
                description: "在健身房进行锻炼。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("stamina", -10);
                    changeAttribute("charm", 4);
                    addToLog("活动", "你在健身房进行了全面的锻炼，体力虽然消耗了一些，但身材和气质都有所提升。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你在健身房进行了全面的锻炼，体力虽然消耗了一些，但身材和气质都有所提升。"}
                        ],
                        choices: []
                    };
                }
            },
            rehabilitationTraining: {
                name: "康复训练",
                description: "观察康复训练区。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    addToLog("活动", "你观察了健身房的康复训练区，了解了一些运动损伤的康复知识。");
                    if (gameData.player.memoryFragments.length >= 2 && !hasMemoryFragment("memory4") && gameData.characters.guoliang.affection >= 25) {
                        collectMemoryFragment("memory4");
                        addToLog("记忆", "看到康复训练的运动员，你想起了在医院陪伴李国良的日子。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在康复训练区看到几个正在进行膝关节恢复训练的运动员。"},
                                {speaker: "夏奈", text: "看到他们的训练，总感觉很熟悉，好像我曾经..."},
                                {speaker: "系统", text: "突然间，一段在医院陪伴受伤的人的记忆闪现..."}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你观察了健身房的康复训练区，了解了一些运动损伤的康复知识。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            meetMisaki: {
                name: "与美咲交流",
                description: "尝试与相泽美咲交流。",
                energyCost: 1,
                available: function() {
                    return gameData.characters.misaki.metFlag;
                },
                requirements: {},
                execute: function() {
                    addToLog("活动", "你尝试与相泽美咲交流。");
                    if (gameData.characters.guoliang.affection >= 40 && !hasCompleted("misakiConfrontation")) {
                        completeEvent("misakiConfrontation");
                        addToLog("剧情", "相泽美咲向你透露了一些关于你过去的线索。");
                        return misakiConfrontationEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你尝试与相泽美咲交流，但她似乎正忙着处理学生会的事务。"},
                                {speaker: "美咲", text: "抱歉，我现在很忙。如果没有重要的事，可以改天再说吗？"},
                                {speaker: "夏奈", text: "没关系，不打扰你了..."}
                            ],
                            choices: []
                        };
                    }
                }
            },
            
            // 教室事件
            attendClass: {
                name: "上课",
                description: "参加商法课程。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("law", 6);
                    changeAttribute("wisdom", 3);
                    addToLog("活动", "你认真听了商法课程，知识有了很大提升。");
                    return {
                        dialogue: [
                            {speaker: "系统", text: "你认真听了商法课程，知识有了很大提升。"}
                        ],
                        choices: []
                    };
                }
            },
            groupStudy: {
                name: "小组学习",
                description: "参加小组学习活动。",
                energyCost: 2,
                requirements: {},
                execute: function() {
                    changeAttribute("law", 4);
                    changeAttribute("charm", 3);
                    changeAttribute("wisdom", 2);
                    addToLog("活动", "你参加了商法课的小组学习，与同学们一起研究案例，各方面能力都有所提升。");
                    
                    if (!hasItem("photoAlbum") && gameData.player.memoryFragments.length >= 1 && !hasMemoryFragment("memory2")) {
                        addToInventory("photoAlbum");
                        addToLog("获得物品", "一位同学给了你一本校友相册。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你参加了商法课的小组学习，与同学们一起研究案例。"},
                                {speaker: "同学", text: "对了，下周我们要做校友回顾展，我找到了一些往年的相册，大家要不要看看？"},
                                {speaker: "夏奈", text: "校友相册？可以啊..."},
                                {speaker: "同学", text: "夏奈，这本你拿着吧，可能会对你的项目有帮助。"},
                                {speaker: "夏奈", text: "谢谢，我会好好看看的。"}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你参加了商法课的小组学习，与同学们一起研究案例，各方面能力都有所提升。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            presentationEvent: {
                name: "课堂展示",
                description: "进行商法课题的展示。",
                energyCost: 2,
                requirements: {
                    attributes: {law: 35}
                },
                execute: function() {
                    changeAttribute("law", 5);
                    changeAttribute("charm", 5);
                    changeAttribute("wisdom", 3);
                    addToLog("活动", "你在商法课上做了精彩的案例分析展示，得到了教授的好评。各项能力都有所提升。");
                    
                    if (gameData.characters.guoliang.metFlag && gameData.characters.guoliang.affection >= 20 && !hasCompleted("classPresentation")) {
                        completeEvent("classPresentation");
                        addToLog("剧情", "李国良特意来观看你的课堂展示，对你的表现印象深刻。");
                        return presentationSuccessEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你在商法课上做了精彩的案例分析展示，得到了教授的好评。各项能力都有所提升。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            
            // 教师办公室事件
            meetProfessor: {
                name: "拜访教授",
                description: "拜访商法教授讨论学习问题。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("law", 5);
                    addToLog("活动", "你向商法教授请教了一些学习上的问题，获得了宝贵的指导。");
                    
                    if (gameData.gameState.storyFlag >= 3 && gameData.player.attributes.law >= 50 && !hasCompleted("professorAdvice")) {
                        completeEvent("professorAdvice");
                        addToLog("剧情", "教授暗示李国良曾经对商法很感兴趣，并提到了一个意外。");
                        return professorAdviceEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你向商法教授请教了一些学习上的问题，获得了宝贵的指导。"},
                                {speaker: "教授", text: "你在合同法方面有很好的理解，继续保持。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            seekAdvice: {
                name: "寻求建议",
                description: "请教教授关于法律实践的建议。",
                energyCost: 1,
                requirements: {},
                execute: function() {
                    changeAttribute("wisdom", 4);
                    addToLog("活动", "你向教授请教了关于法律实践的一些问题，获得了宝贵的人生建议。");
                    
                    if (gameData.gameState.storyFlag >= 4 && !hasCompleted("finalAdvice") && gameData.player.memoryFragments.length >= 7) {
                        completeEvent("finalAdvice");
                        addToLog("剧情", "教授暗示你去找李国良问清楚真相。");
                        return finalAdviceEvent();
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你向教授请教了关于法律实践的一些问题，获得了宝贵的人生建议。"}
                            ],
                            choices: []
                        };
                    }
                }
            },
            helpGrading: {
                name: "协助批改",
                description: "帮助教授批改作业。",
                energyCost: 2,
                requirements: {
                    attributes: {law: 30}
                },
                execute: function() {
                    changeAttribute("law", 3);
                    changeAttribute("wisdom", 4);
                    addToLog("活动", "你帮助教授批改商法作业，在过程中巩固了知识并获得了新的见解。");
                    
                    if (gameData.player.memoryFragments.length >= 4 && !hasMemoryFragment("memory11")) {
                        collectMemoryFragment("memory11");
                        addToLog("记忆", "教授无意中透露你是转到商法专业的，这让你感到困惑。");
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你帮助教授批改商法作业，在过程中展现出很强的专业素养。"},
                                {speaker: "教授", text: "夏奈，你对商法的理解真是与众不同。自从你转到这个专业，进步之快让人惊讶。"},
                                {speaker: "夏奈", text: "转到这个专业？我一直不是商法专业的吗？"},
                                {speaker: "教授", text: "啊，抱歉，我可能记错了。总之，你很有天赋。"},
                                {speaker: "系统", text: "教授的话让你感到奇怪，一段关于你商法才能的记忆片段涌现..."}
                            ],
                            choices: []
                        };
                    } else {
                        return {
                            dialogue: [
                                {speaker: "系统", text: "你帮助教授批改商法作业，在过程中巩固了知识并获得了新的见解。"}
                            ],
                            choices: []
                        };
                    }
                }
            }
        };

        // 定义关键剧情事件
        // 第一幕：初次相遇
        function firstMeetingEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你来到篮球场，看到球员们正在训练。场边一位高大的男生正在指导他们。"},
                    {speaker: "夏奈", text: "那就是李国良吧..."},
                    {speaker: "国良", text: "传球要果断！防守站位再紧一点！动作快！"},
                    {speaker: "系统", text: "他严肃的表情和专业的指导让你不由得多看了几眼。"},
                    {speaker: "夏奈", text: "好帅啊...不知道该怎么接近他..."}
                ],
                choices: [
                    {
                        text: "鼓起勇气上前打招呼",
                        action: function() {
                            changeCharacterAffection("guoliang", 5);
                            addToLog("互动", "你鼓起勇气向李国良打招呼，虽然他的回应很简短，但你迈出了第一步。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "你好，我是结城夏奈，商法专业的学生..."},
                                    {speaker: "国良", text: "有事吗？我们正在训练。"},
                                    {speaker: "夏奈", text: "啊，抱歉打扰了！我...我只是对篮球很感兴趣..."},
                                    {speaker: "国良", text: "...训练结束后，场地对所有学生开放。你可以那时候来练习。"},
                                    {speaker: "系统", text: "虽然他的回应很简短，但至少你迈出了第一步。李国良似乎对你有些印象了。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "先默默观察训练",
                        action: function() {
                            changeAttribute("basketball", 3);
                            addToLog("互动", "你先在场边观察训练，了解更多篮球知识，然后在训练结束后与李国良简短交谈。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你决定先在场边观察训练，了解更多篮球知识。"},
                                    {speaker: "系统", text: "训练结束后，球员们三三两两地离开。李国良留下来收拾器材。"},
                                    {speaker: "夏奈", text: "（这是个机会！）那个...你好！训练很精彩！"},
                                    {speaker: "国良", text: "谢谢。你是...？"},
                                    {speaker: "夏奈", text: "我是结城夏奈，商法专业的。我想了解更多关于篮球的事..."},
                                    {speaker: "国良", text: "图书馆有很多篮球入门书籍，可以从那里开始。"},
                                    {speaker: "系统", text: "他的建议虽然有点生硬，但你感觉他并不是故意冷淡。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "假装偶然路过",
                        action: function() {
                            changeAttribute("charm", 2);
                            addToLog("互动", "你假装偶然路过篮球场，一个飞来的篮球让你有机会与李国良短暂交谈。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你假装偶然路过篮球场，希望引起李国良的注意。"},
                                    {speaker: "系统", text: "一个失控的篮球朝你飞来！"},
                                    {speaker: "夏奈", text: "啊！"},
                                    {speaker: "国良", text: "小心！"},
                                    {speaker: "系统", text: "李国良快速冲过来，在球击中你之前接住了它。"},
                                    {speaker: "国良", text: "没事吧？训练时间最好不要靠近场地。"},
                                    {speaker: "夏奈", text: "谢谢你接住球...我是结城夏奈，冒昧打扰了。"},
                                    {speaker: "国良", text: "李国良。下次小心点。"},
                                    {speaker: "系统", text: "虽然交流很短暂，但你成功地和他有了第一次接触。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 更深入的对话事件
        function deeperConversationEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你鼓起勇气，再次来到篮球场找李国良。"},
                    {speaker: "夏奈", text: "李教练，打扰一下，有时间聊几句吗？"},
                    {speaker: "国良", text: "结城同学？有什么事吗？"},
                    {speaker: "夏奈", text: "我想多了解一下篮球...顺便，叫我夏奈就好。"}
                ],
                choices: [
                    {
                        text: "询问他的篮球经历",
                        action: function() {
                            changeCharacterAffection("guoliang", 5);
                            addToLog("互动", "你询问李国良的篮球经历，了解到他因膝伤转型为教练。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "听说你以前是校队的主力球员？为什么转做教练了呢？"},
                                    {speaker: "国良", text: "..."},
                                    {speaker: "系统", text: "李国良的表情明显变得有些复杂。"},
                                    {speaker: "国良", text: "膝盖受伤了。不能再打比赛级别的篮球。"},
                                    {speaker: "夏奈", text: "我很抱歉听到这个..."},
                                    {speaker: "国良", text: "没关系，能继续参与篮球已经很满足了。教练也能帮助队员成长。"},
                                    {speaker: "系统", text: "你注意到他说话时，无意识地摸了摸左膝。这个动作莫名地让你感到心疼。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "提到自己的商法专业",
                        action: function() {
                            changeCharacterAffection("guoliang", 3);
                            addToLog("互动", "你提到自己的商法专业，引起了李国良对球队赞助合同的兴趣。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我是商法专业的学生，最近在学习体育相关的合同法。"},
                                    {speaker: "国良", text: "商法？这倒是巧合，我们队正好有些赞助合同的事情..."},
                                    {speaker: "夏奈", text: "真的吗？如果需要帮忙，我很乐意提供一些建议。"},
                                    {speaker: "国良", text: "那...有时间的话，也许可以请教你几个问题。"},
                                    {speaker: "系统", text: "李国良看起来对你的专业知识很感兴趣，这可能是接近他的好机会。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "直接表达好感",
                        action: function() {
                            addToLog("互动", "你直接表达了对李国良的好感，他的反应有些奇怪，似乎觉得你很眼熟。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "其实...我挺欣赏你的。可以多了解你吗？"},
                                    {speaker: "国良", text: "..."},
                                    {speaker: "系统", text: "李国良明显愣了一下，脸上闪过一丝复杂的表情。"},
                                    {speaker: "国良", text: "你...总觉得你有点眼熟，我们以前见过吗？"},
                                    {speaker: "夏奈", text: "应该没有吧？我是今年才转到商法专业的。"},
                                    {speaker: "国良", text: "这样啊...抱歉，我训练还没结束，改天再聊吧。"},
                                    {speaker: "系统", text: "李国良匆忙回到了球场，但你注意到他离开时又回头看了你一眼。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 咖啡厅偶遇事件
        function cafeEncounterEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你正在咖啡厅享用一杯拿铁，忽然看到李国良独自一人走了进来。"},
                    {speaker: "夏奈", text: "（是李国良！他一个人呢...要不要打招呼？）"}
                ],
                choices: [
                    {
                        text: "主动邀请他一起坐",
                        action: function() {
                            changeCharacterAffection("guoliang", 8);
                            addToLog("互动", "你主动邀请李国良一起坐，发现他走路时左腿有些不自然。");
                            if (gameData.player.memoryFragments.length >= 1 && !hasMemoryFragment("memory3")) {
                                collectMemoryFragment("memory3");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "李教练！这边有空位，要一起坐吗？"},
                                        {speaker: "国良", text: "结城同学...好的，谢谢。"},
                                        {speaker: "系统", text: "他走过来坐下，你注意到他走路时左腿稍有些不自然。"},
                                        {speaker: "夏奈", text: "膝盖还会疼吗？"},
                                        {speaker: "国良", text: "偶尔会...等等，我告诉过你是左膝受伤吗？"},
                                        {speaker: "夏奈", text: "呃...你刚才走路的姿势，我猜的？"},
                                        {speaker: "系统", text: "一个闪回的画面突然出现在你的脑海中：球场上，一个球员高高跃起，然后重重摔倒..."}
                                    ]
                                };
                            } else {
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "李教练！这边有空位，要一起坐吗？"},
                                        {speaker: "国良", text: "结城同学...好的，谢谢。"},
                                        {speaker: "系统", text: "他走过来坐下，你注意到他面前放着一些文件。"},
                                        {speaker: "夏奈", text: "在忙工作？"},
                                        {speaker: "国良", text: "嗯，篮球队的一些赞助文件，说实话有些头疼。"},
                                        {speaker: "夏奈", text: "我可以看看吗？也许能帮上忙。"},
                                        {speaker: "国良", text: "那真是太好了...这个条款你怎么看？"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "假装没看到，等他注意到你",
                        action: function() {
                            changeCharacterAffection("guoliang", 3);
                            addToLog("互动", "你假装没注意到李国良，结果他主动跟你打招呼，你们坐在一起聊天。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你假装没有注意到他，专心喝着咖啡。"},
                                    {speaker: "系统", text: "李国良买完咖啡转身时，注意到了你。"},
                                    {speaker: "国良", text: "结城同学？一个人吗？"},
                                    {speaker: "夏奈", text: "啊，李教练！是的，我在复习功课。你也是来喝咖啡的？"},
                                    {speaker: "国良", text: "嗯，顺便处理一些文件。"},
                                    {speaker: "夏奈", text: "训练队员很累吧？要一起坐会儿吗？"},
                                    {speaker: "系统", text: "李国良犹豫了一下，然后点点头坐在了你对面。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "观察他一会儿再决定",
                        action: function() {
                            changeAttribute("wisdom", 2);
                            addToLog("互动", "你先观察了李国良一会儿，发现他似乎在为文件烦恼，随后主动搭话。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你决定先观察他一会儿再决定是否打招呼。"},
                                    {speaker: "系统", text: "李国良点了杯黑咖啡，坐在角落开始查看一些文件。他看起来很专注，但时不时皱眉。"},
                                    {speaker: "夏奈", text: "（他好像在为什么事情烦恼...要过去吗？）"},
                                    {speaker: "系统", text: "就在你犹豫的时候，李国良抬头看到了你，微微点头示意。"},
                                    {speaker: "系统", text: "你鼓起勇气走了过去。"},
                                    {speaker: "夏奈", text: "在处理球队的事情吗？看起来很复杂的样子。"},
                                    {speaker: "国良", text: "是的...一些赞助合同的问题。说起来，你不是学商法的吗？"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 合同复习事件
        function contractReviewEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你在咖啡厅复习商法课程中关于体育赞助合同的部分。"},
                    {speaker: "夏奈", text: "这个案例分析很有意思..."},
                    {speaker: "系统", text: "突然，你感觉有人在看着你。抬头一看，是李国良。"},
                    {speaker: "国良", text: "结城同学，正好！我想请教你一个问题。"},
                    {speaker: "夏奈", text: "什么问题？"},
                    {speaker: "国良", text: "篮球队最近收到一份赞助合同，但我对里面的条款有些疑虑。你能帮我看看吗？"}
                ],
                choices: [
                    {
                        text: "当然愿意帮忙",
                        action: function() {
                            changeCharacterAffection("guoliang", 10);
                            addToLog("互动", "你帮助李国良分析赞助合同，指出了几处对球队不利的条款，获得了他的赞赏。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "当然可以，正好我最近在学这方面的知识。"},
                                    {speaker: "系统", text: "李国良拿出合同，你仔细阅读后发现了几处对球队不利的条款。"},
                                    {speaker: "夏奈", text: "这里和这里的条款需要注意，这样写的话对球队很不利..."},
                                    {speaker: "国良", text: "真的？我完全没注意到..."},
                                    {speaker: "夏奈", text: "我建议你们要求修改这些条款，或者寻找其他赞助商。"},
                                    {speaker: "国良", text: "太感谢了！你的专业知识真是帮了大忙。"},
                                    {speaker: "系统", text: "李国良诚恳的感谢让你感到很开心，你们的关系更进一步了。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "谦虚地表示自己只是学生",
                        action: function() {
                            changeCharacterAffection("guoliang", 5);
                            addToLog("互动", "你谦虚地表示自己只是学生，但仍然帮助李国良分析了合同，他邀请你担任球队的临时法律顾问。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我只是学生，水平有限...不过我很乐意试试看。"},
                                    {speaker: "国良", text: "已经很感谢了，我相信你的能力。"},
                                    {speaker: "系统", text: "你认真审阅了合同，指出了几处需要注意的地方。"},
                                    {speaker: "夏奈", text: "根据我的理解，这些条款对球队不太有利..."},
                                    {speaker: "国良", text: "原来如此，这确实是个问题。你的建议很专业。"},
                                    {speaker: "夏奈", text: "如果需要，我可以帮你们起草一个修改方案。"},
                                    {speaker: "国良", text: "那就太好了。对了，你愿意担任球队的临时法律顾问吗？"}
                                ]
                            };
                        }
                    },
                    {
                        text: "建议咨询专业人士",
                        action: function() {
                            addToLog("互动", "你建议李国良咨询专业律师，但在他坚持下仍给出了初步建议，他对你的分析很满意。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "这类合同最好咨询专业律师，我只是学生..."},
                                    {speaker: "国良", text: "我们预算有限，请不起专业律师。就算给个初步意见也很有帮助。"},
                                    {speaker: "夏奈", text: "那...我可以试着看看，但结果仅供参考。"},
                                    {speaker: "系统", text: "你仔细检查了合同，发现了几处问题。"},
                                    {speaker: "夏奈", text: "这些条款看起来对球队不太公平，建议谨慎考虑。"},
                                    {speaker: "国良", text: "我就知道有问题...你的分析很到位，比我想象的要专业多了。"},
                                    {speaker: "国良", text: "有没有兴趣帮球队长期提供一些法律建议？"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 合同讨论事件
        function contractDiscussionEvent() {
            completeEvent("contractHelp");
            gameData.gameState.storyFlag = 4;
            addToLog("剧情进展", "你成功帮助李国良修改了篮球队的赞助合同，他对你的专业能力非常欣赏。");
            return {
                dialogue: [
                    {speaker: "系统", text: "你找到了正在篮球场边休息的李国良。"},
                    {speaker: "夏奈", text: "李教练，我准备了一份合同修改建议。"},
                    {speaker: "国良", text: "太及时了！赞助商正好给了回复。"},
                    {speaker: "系统", text: "你们一起坐下来讨论合同细节。"},
                    {speaker: "国良", text: "你的建议非常专业，我真没想到能得到这么好的帮助。"},
                    {speaker: "夏奈", text: "不客气，能帮上忙我很开心。"},
                    {speaker: "国良", text: "说实话，你让我想起了一个人...也很擅长这些。"}
                ],
                choices: [
                    {
                        text: "询问那个人是谁",
                        action: function() {
                            if (gameData.player.memoryFragments.length >= 3) {
                                collectMemoryFragment("memory6");
                                addToLog("记忆", "李国良提到曾有一个人在他最需要时给予支持，你得到了关于失意夜晚的记忆碎片。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "是谁啊？前女友吗？"},
                                        {speaker: "国良", text: "...一个很重要的人。"},
                                        {speaker: "系统", text: "李国良的表情变得复杂而怀念。"},
                                        {speaker: "国良", text: "她总是在我最需要的时候给我支持。"},
                                        {speaker: "夏奈", text: "那...你们现在还联系吗？"},
                                        {speaker: "国良", text: "命运有时很奇妙，也许她从未真正离开..."},
                                        {speaker: "系统", text: "他的话让你感到莫名熟悉，一段关于雨夜和失落的记忆闪现..."}
                                    ]
                                };
                            } else {
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "是谁啊？你的朋友吗？"},
                                        {speaker: "国良", text: "...一个很重要的人。不过现在不方便多说。"},
                                        {speaker: "系统", text: "李国良明显不想继续这个话题。"},
                                        {speaker: "国良", text: "对了，球队下周有一场友谊赛，你有兴趣来看吗？"},
                                        {speaker: "夏奈", text: "当然！我很乐意。"},
                                        {speaker: "国良", text: "那就这么定了。比赛结束后，球队会有个小聚会，你也来吧。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "接受球队法律顾问的职位",
                        action: function() {
                            changeCharacterAffection("guoliang", 12);
                            addToLog("互动", "你接受了球队法律顾问的职位，李国良提到曾有位队员也对法律很精通，表情中有种期待。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "如果球队需要，我很乐意正式担任球队的法律顾问。"},
                                    {speaker: "国良", text: "真的吗？那太好了！这对球队帮助很大。"},
                                    {speaker: "系统", text: "李国良真诚地握了握你的手，你感觉到一种奇妙的熟悉感。"},
                                    {speaker: "国良", text: "欢迎加入球队大家庭。说起来...我们曾经有个队员也对法律很精通..."},
                                    {speaker: "夏奈", text: "是吗？现在怎么样了？"},
                                    {speaker: "国良", text: "她...有些特殊原因离开了。但我一直希望她能回来。"},
                                    {speaker: "系统", text: "李国良看着你的眼神中有一种难以言说的期待。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "询问球队的日常运作",
                        action: function() {
                            changeAttribute("wisdom", 3);
                            addToLog("互动", "你询问了球队的日常运作，李国良谈起球队时充满热情，提到曾有人教会他永不放弃的精神。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "球队平时是怎么运作的？除了训练还有哪些活动？"},
                                    {speaker: "国良", text: "训练、比赛、社区活动、队内聚会...篮球队是个大家庭。"},
                                    {speaker: "系统", text: "李国良谈起球队时，眼中充满了热情。"},
                                    {speaker: "国良", text: "我们强调团队精神和互相支持，这不仅仅是比赛的需要，也是生活的态度。"},
                                    {speaker: "夏奈", text: "听起来很温暖。"},
                                    {speaker: "国良", text: "是啊...曾经有人教会我，在挫折面前永不放弃的精神。"},
                                    {speaker: "系统", text: "他的目光变得柔和，似乎沉浸在某种回忆中。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 遇到美咲事件
        function meetMisakiEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "咖啡厅里，你遇到了几位朋友，她们正和一位气质不凡的学姐聊天。"},
                    {speaker: "朋友", text: "夏奈！来，给你介绍一下，这是相泽美咲学姐，学生会体育部部长。"},
                    {speaker: "美咲", text: "你好，结城同学。听说过你，商法系的优秀学生？"},
                    {speaker: "夏奈", text: "学姐好，过奖了..."},
                    {speaker: "美咲", text: "最近听说你和李国良走得很近？"}
                ],
                choices: [
                    {
                        text: "坦然承认",
                        action: function() {
                            addToLog("互动", "你坦然承认与李国良的接触，美咲暗示李国良对你的态度不同寻常，言语中有隐隐的敌意。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "是的，我在帮篮球队处理一些法律事务。"},
                                    {speaker: "美咲", text: "哦？真是热心呢。不过，李国良这个人比较特别，不是很容易接近的类型。"},
                                    {speaker: "夏奈", text: "我觉得他人挺好的，虽然有点严肃。"},
                                    {speaker: "美咲", text: "是吗？那看来他对你态度很不一般呢。"},
                                    {speaker: "系统", text: "相泽美咲微笑着，但你感觉到一种隐隐的敌意。"},
                                    {speaker: "美咲", text: "改天有空一起聊聊吧，我对李国良的事情...很了解。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "低调回应",
                        action: function() {
                            changeAttribute("wisdom", 2);
                            addToLog("互动", "你低调回应美咲的问题，她提到自己是李国良的老同学，并暗示了一些他的过去。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "只是偶尔帮一些忙而已，没什么特别的关系。"},
                                    {speaker: "美咲", text: "是吗？李国良可不是随便让人帮忙的类型。"},
                                    {speaker: "系统", text: "相泽美咲意味深长地看着你。"},
                                    {speaker: "美咲", text: "我和李国良是同一届的老同学了，他从来不轻易接受外人的帮助..."},
                                    {speaker: "夏奈", text: "也许是球队真的需要法律方面的建议吧。"},
                                    {speaker: "美咲", text: "有意思。你知道他为什么从球员变成教练吗？"}
                                ]
                            };
                        }
                    },
                    {
                        text: "反问她与李国良的关系",
                        action: function() {
                            changeAttribute("charm", 3);
                            addToLog("互动", "你反问美咲与李国良的关系，出乎她的意料，她暗示了李国良过去的某些事。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "学姐似乎对李教练很关注啊？你们关系很好吗？"},
                                    {speaker: "系统", text: "相泽美咲明显没料到你会这么直接。"},
                                    {speaker: "美咲", text: "我们是同届同学，又都在体育圈，了解是很自然的事。"},
                                    {speaker: "夏奈", text: "原来如此，那学姐应该很了解他的过去吧？"},
                                    {speaker: "美咲", text: "当然，包括他是怎么受伤的，还有那个...算了，不说也罢。"},
                                    {speaker: "夏奈", text: "那个什么？学姐如果知道什么，能告诉我吗？"},
                                    {speaker: "美咲", text: "抱歉，有些事不是我该说的。不过...小心不要重蹈别人的覆辙。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 美咲对峙事件
        function misakiConfrontationEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你在健身房看到了正在锻炼的相泽美咲学姐。"},
                    {speaker: "夏奈", text: "美咲学姐，好巧。"},
                    {speaker: "美咲", text: "结城同学...看来你最近和李国良进展不错？"},
                    {speaker: "夏奈", text: "我们合作得很愉快。"}
                ],
                choices: [
                    {
                        text: "直接询问她和李国良的关系",
                        action: function() {
                            if (gameData.player.memoryFragments.length >= 5) {
                                collectMemoryFragment("memory9");
                                addToLog("记忆", "美咲透露你的父母在那次意外后让你转专业，远离可能触发记忆的人和事。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "学姐和李教练是什么关系？你似乎对我们走得近很在意。"},
                                        {speaker: "美咲", text: "哼，直接啊。我只是不想看到历史重演。"},
                                        {speaker: "夏奈", text: "什么历史？"},
                                        {speaker: "美咲", text: "你真的什么都不记得了？有意思..."},
                                        {speaker: "夏奈", text: "什么意思？我该记得什么？"},
                                        {speaker: "美咲", text: "你的父母做得很彻底嘛。那次意外后，他们坚持让你转专业，远离一切可能触发记忆的人和事..."},
                                        {speaker: "系统", text: "美咲的话让你震惊，一段关于医院和父母谈话的记忆浮现..."}
                                    ]
                                };
                            } else {
                                addToLog("互动", "你直接问美咲与李国良的关系，她表示只是关心他，暗示他经历过一些伤害。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "学姐和李教练是什么关系？你似乎对我们走得近很在意。"},
                                        {speaker: "美咲", text: "别误会，我只是作为学长关心他。李国良...经历过一些事情，我不想看他再受伤。"},
                                        {speaker: "夏奈", text: "受伤？除了膝伤还有什么？"},
                                        {speaker: "美咲", text: "有些伤口是看不见的。如果你只是一时兴起，建议你不要太深入。"},
                                        {speaker: "夏奈", text: "我对他是认真的。"},
                                        {speaker: "美咲", text: "希望如此。对了，你知道樱花树下的约定吗？"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "平静地表达对李国良的真诚感情",
                        action: function() {
                            changeCharacterAffection("guoliang", 5);
                            addToLog("互动", "你表达了对李国良的真诚感情，美咲被打动，提到你像李国良以前认识的那个女孩。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我很珍视与李教练的每一次相处。这不只是一时兴起的感情。"},
                                    {speaker: "系统", text: "美咲似乎被你的真诚打动。"},
                                    {speaker: "美咲", text: "...你这样说，真的很像她。"},
                                    {speaker: "夏奈", text: "像谁？"},
                                    {speaker: "美咲", text: "没什么。只是觉得你和李国良以前认识的那个女孩很像。"},
                                    {speaker: "夏奈", text: "他以前的...女朋友？"},
                                    {speaker: "美咲", text: "某种意义上是吧。这个话题到此为止。记住，有些记忆或许被遗忘是有原因的。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "询问她对自己的敌意",
                        action: function() {
                            changeAttribute("wisdom", 3);
                            addToLog("互动", "你询问美咲对你的敌意，她解释是出于警惕，暗示李国良曾因一段感情受过伤。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "学姐，我能感觉到你对我有些敌意，为什么？"},
                                    {speaker: "美咲", text: "敌意？不，是警惕。李国良不是玩具，他已经因为一段感情受过伤。"},
                                    {speaker: "夏奈", text: "我从未把他当玩具。不过，你说的那段感情是什么？"},
                                    {speaker: "美咲", text: "我说太多了。总之，如果你只是把他当作校园恋爱的目标，请及时收手。"},
                                    {speaker: "夏奈", text: "我不知道你指的是什么，但我对他的感情是真心的。"},
                                    {speaker: "美咲", text: "希望如此。命运有时候真的很奇妙，不是吗？"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 篮球训练事件
        function basketballTrainingEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你正在篮球场一角练习投篮，进步虽然不大，但你没有放弃。"},
                    {speaker: "国良", text: "手腕的力度要均匀，投篮时两只手要协调。"},
                    {speaker: "夏奈", text: "啊！李教练..."},
                    {speaker: "国良", text: "我看你最近经常来练习，很有毅力。需要指导吗？"}
                ],
                choices: [
                    {
                        text: "欣然接受",
                        action: function() {
                            changeCharacterAffection("guoliang", 8);
                            changeAttribute("basketball", 8);
                            addToLog("互动", "李国良亲自指导你投篮技巧，你学得很快，他提到曾有人鼓励他转型做教练。");
                            if (gameData.player.memoryFragments.length >= 2 && !hasMemoryFragment("memory7")) {
                                collectMemoryFragment("memory7");
                                addToLog("记忆", "你想起自己曾经鼓励某人不要放弃篮球，建议他尝试做教练。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "真的吗？那太好了！请多指教！"},
                                        {speaker: "系统", text: "李国良站在你身后，调整你的姿势。他的动作很专业，但又充满耐心。"},
                                        {speaker: "国良", text: "重心要稳，目光要盯住篮筐上的一点...对，就是这样。"},
                                        {speaker: "系统", text: "在他的指导下，你的球竟然进了！"},
                                        {speaker: "夏奈", text: "进了！太神奇了！"},
                                        {speaker: "国良", text: "你学得很快。"},
                                        {speaker: "夏奈", text: "因为有好老师啊。你真的很擅长教别人，当教练很适合你。"},
                                        {speaker: "国良", text: "...谢谢。其实当初是有人鼓励我转型做教练的。"},
                                        {speaker: "系统", text: "他的话触发了你的某段记忆...你想起自己曾经鼓励某人不要放弃篮球，尝试做教练..."}
                                    ]
                                };
                            } else {
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "真的吗？那太好了！请多指教！"},
                                        {speaker: "系统", text: "李国良详细地教导你正确的投篮姿势和技巧。"},
                                        {speaker: "国良", text: "投篮是节奏和感觉的结合，多练习就会进步的。"},
                                        {speaker: "夏奈", text: "谢谢你的指导，我一定会努力的！"},
                                        {speaker: "国良", text: "你的态度很好。篮球最重要的不是天赋，而是永不放弃的精神。"},
                                        {speaker: "系统", text: "你们一起练习了将近一小时，不知不觉中，你和李国良的距离似乎近了不少。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "请他展示示范",
                        action: function() {
                            changeCharacterAffection("guoliang", 5);
                            addToLog("互动", "李国良示范了优美流畅的投篮动作，然后手把手教你正确姿势，近距离接触让你心跳加速。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "能先看你示范一下标准动作吗？"},
                                    {speaker: "国良", text: "可以。"},
                                    {speaker: "系统", text: "李国良拿起篮球，虽然动作因为膝伤有些限制，但他的投篮姿势依然优美流畅。球稳稳命中篮筐。"},
                                    {speaker: "夏奈", text: "太厉害了！即使受伤也这么准！"},
                                    {speaker: "国良", text: "膝伤影响的是爆发力和弹跳，基本功不会丢。来，你试试。"},
                                    {speaker: "系统", text: "他手把手教你正确的投篮姿势，这种亲密的指导让你有些心跳加速。"},
                                    {speaker: "国良", text: "集中注意力，不要分心。篮球需要专注。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "谦虚地说自己可能没有天赋",
                        action: function() {
                            changeAttribute("wisdom", 3);
                            addToLog("互动", "你谦虚地说自己可能没有篮球天赋，李国良鼓励你，称赞你在商法上的天赋。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我可能没有篮球天赋...只是想多了解你的世界。"},
                                    {speaker: "系统", text: "李国良看着你，眼神中闪过一丝温柔。"},
                                    {speaker: "国良", text: "天赋不是最重要的。坚持和热爱才是。来，试试这样..."},
                                    {speaker: "系统", text: "他耐心地指导你基础动作，不厌其烦地纠正每一个细节。"},
                                    {speaker: "国良", text: "你比你想象的要有天赋。只是需要找到正确的方法。"},
                                    {speaker: "夏奈", text: "真的吗？我以为自己很笨拙..."},
                                    {speaker: "国良", text: "每个人都有自己擅长的领域。就像你在商法上的天赋一样令人印象深刻。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 课堂展示成功事件
        function presentationSuccessEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你在商法课上做了一个出色的体育赞助合同案例分析。"},
                    {speaker: "教授", text: "结城同学的分析非常专业，特别是对条款漏洞的解读很有深度。"},
                    {speaker: "系统", text: "下课后，你惊讶地发现李国良站在教室门口。"},
                    {speaker: "夏奈", text: "李教练？你怎么在这？"},
                    {speaker: "国良", text: "我听说你今天有个重要的课堂展示，想来看看。你的表现真是令人印象深刻。"}
                ],
                choices: [
                    {
                        text: "感谢他的支持",
                        action: function() {
                            changeCharacterAffection("guoliang", 10);
                            addToLog("互动", "你感谢李国良特意来看你的展示，他邀请你一起喝咖啡，有人暗中观察着你们。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "谢谢你特意来看我的展示，这对我意义重大。"},
                                    {speaker: "国良", text: "不客气。你帮了球队很多，这是我应该做的。"},
                                    {speaker: "夏奈", text: "你的支持给了我很大信心。对了，你是怎么知道我今天有展示的？"},
                                    {speaker: "国良", text: "我...偶然听说的。"},
                                    {speaker: "系统", text: "他的表情有些不自然，似乎隐瞒了什么。"},
                                    {speaker: "国良", text: "有空一起喝杯咖啡吗？我想请你帮个忙。"},
                                    {speaker: "夏奈", text: "当然可以！现在就走吗？"},
                                    {speaker: "系统", text: "你们一起离开了教室，没注意到角落里相泽美咲若有所思的目光。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "好奇他为何而来",
                        action: function() {
                            changeAttribute("wisdom", 3);
                            addToLog("互动", "你询问李国良为什么来看你的展示，他的解释有些牵强，似乎隐藏着更深的含义。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "你是特意来看我的展示的吗？为什么？"},
                                    {speaker: "国良", text: "..."},
                                    {speaker: "系统", text: "李国良稍微犹豫了一下。"},
                                    {speaker: "国良", text: "因为我想了解更多你在专业上的表现。作为球队法律顾问，我需要确认你的能力。"},
                                    {speaker: "夏奈", text: "真的只是因为这个？"},
                                    {speaker: "国良", text: "还有...我想支持你，就像你一直支持球队一样。"},
                                    {speaker: "系统", text: "他的话似乎有更深的含义，但你没能完全理解。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "害羞地邀请他共进晚餐",
                        action: function() {
                            changeCharacterAffection("guoliang", 7);
                            addToLog("互动", "你邀请李国良共进晚餐，惊讶地发现他知道你喜欢的食物，他的反应有些奇怪。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "既然你来了...要不要一起吃晚饭？作为你支持我的感谢。"},
                                    {speaker: "系统", text: "李国良似乎有些意外，但随即微笑点头。"},
                                    {speaker: "国良", text: "乐意之至。你有什么想吃的吗？"},
                                    {speaker: "夏奈", text: "我知道学校附近有家不错的日料店..."},
                                    {speaker: "国良", text: "日料？你喜欢吃三文鱼刺身配白萝卜泥吗？"},
                                    {speaker: "夏奈", text: "是啊！那正是我最爱的！你怎么知道？"},
                                    {speaker: "国良", text: "只是...猜的。"},
                                    {speaker: "系统", text: "他的眼神中闪过一丝复杂的情绪，但很快恢复了平静。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 教授建议事件
        function professorAdviceEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你来到办公室向商法教授请教学习问题。"},
                    {speaker: "教授", text: "夏奈，你最近在合同法方面的进步很大。尤其是体育相关合同的分析很有深度。"},
                    {speaker: "夏奈", text: "谢谢教授。我最近在帮篮球队处理一些赞助合同。"},
                    {speaker: "教授", text: "李国良的球队吧？我听说了。你知道他以前也对商法很感兴趣吗？"}
                ],
                choices: [
                    {
                        text: "表示惊讶",
                        action: function() {
                            if (gameData.player.memoryFragments.length >= 6 && !hasMemoryFragment("memory10")) {
                                collectMemoryFragment("memory10");
                                addToLog("记忆", "教授无意中提到一次意外后李国良来找过他，触发了你关于病房外谈话的记忆。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "真的吗？我不知道他还有这方面的兴趣。"},
                                        {speaker: "教授", text: "是的，他曾经选修过我的课。那次意外后，他来找过我..."},
                                        {speaker: "夏奈", text: "什么意外？"},
                                        {speaker: "教授", text: "啊，我可能记错了...总之，夏奈，有时候命运的安排很微妙。人与人之间的连接，往往比我们想象的要深。"},
                                        {speaker: "系统", text: "教授的话让你陷入思考。一段模糊的记忆浮现：病房外，两个人在低声交谈..."}
                                    ]
                                };
                            } else {
                                addToLog("互动", "教授告诉你李国良曾对商法有兴趣，暗示偶然相遇背后可能有更多故事。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "真的吗？我不知道他还有这方面的兴趣。"},
                                        {speaker: "教授", text: "人总是有很多面的。有时候，看似偶然的相遇背后，或许藏着更多故事。"},
                                        {speaker: "夏奈", text: "教授，您这话是什么意思？"},
                                        {speaker: "教授", text: "没什么，只是感慨而已。对了，下周有个体育法研讨会，你有兴趣参加吗？"},
                                        {speaker: "夏奈", text: "当然有兴趣！"},
                                        {speaker: "教授", text: "很好。到时候你可以邀请李国良一起，他应该会感兴趣。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "询问更多关于李国良的事",
                        action: function() {
                            changeAttribute("wisdom", 5);
                            addToLog("互动", "你询问教授对李国良的了解，他提到李国良是特别的学生，拥有独特的法律思考和应对逆境的能力。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "教授认识李国良很久了吗？能告诉我更多关于他的事吗？"},
                                    {speaker: "教授", text: "我对所有学生都记忆深刻，尤其是那些特别的学生。"},
                                    {speaker: "夏奈", text: "特别？他有什么特别之处？"},
                                    {speaker: "教授", text: "除了是校队的明星球员外，他对法律的思考很有独特见解。不过后来..."},
                                    {speaker: "夏奈", text: "后来怎么了？"},
                                    {speaker: "教授", text: "人生总有起伏。重要的是如何在逆境中找到新的方向。李国良做到了这点，从球员转型为教练。"},
                                    {speaker: "系统", text: "教授似乎有意回避某些话题，但你还是获得了一些关于李国良的信息。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "谈论自己对商法的兴趣",
                        action: function() {
                            changeAttribute("law", 7);
                            addToLog("互动", "你谈论自己对商法的兴趣，教授暗示你好像曾接触过这些知识，提出了关于记忆的哲学思考。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我很享受学习商法的过程，尤其是能将理论应用到实践中。"},
                                    {speaker: "教授", text: "你有天赋，夏奈。有时候我甚至感觉你好像曾经接触过这些知识..."},
                                    {speaker: "夏奈", text: "怎么会？我是第一次学习这些内容啊。"},
                                    {speaker: "教授", text: "有时候，知识的学习不仅来自课堂，还可能来自我们遗忘或尚未发现的经历。"},
                                    {speaker: "夏奈", text: "教授今天说话很有哲理啊。"},
                                    {speaker: "教授", text: "呵呵，年纪大了就喜欢思考这些。对了，你对体育法有兴趣吗？我有一本很好的参考书可以借给你。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 最终建议事件
        function finalAdviceEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "随着收集到的记忆碎片越来越多，你开始对自己的过去感到困惑。"},
                    {speaker: "系统", text: "你决定去找教授寻求建议。"},
                    {speaker: "教授", text: "夏奈，你看起来有心事？"},
                    {speaker: "夏奈", text: "教授...如果一个人失去了重要的记忆，应该怎么办？"}
                ],
                choices: [
                    {
                        text: "直接询问自己的过去",
                        action: function() {
                            if (gameData.player.memoryFragments.length >= 10) {
                                collectMemoryFragment("memory12");
                                addToLog("记忆", "教授鼓励你去找李国良问清真相，你终于得到最后一块记忆碎片，理解了完整的过去。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "教授，我和李国良以前认识，对吗？不只是普通认识，而是很亲密的关系..."},
                                        {speaker: "教授", text: "...你想起来了？"},
                                        {speaker: "夏奈", text: "一些片段。但还不完整。"},
                                        {speaker: "教授", text: "有些事情，或许是命运的安排。如果你真的想知道全部真相，应该去问李国良本人。"},
                                        {speaker: "夏奈", text: "他一直知道，却没有告诉我？"},
                                        {speaker: "教授", text: "他有他的理由。记忆是很复杂的，强行唤醒可能会造成伤害。去找他吧，在樱花树下。"},
                                        {speaker: "系统", text: "随着教授的话，所有记忆碎片突然联系在一起，你终于想起了完整的过去..."}
                                    ]
                                };
                            } else {
                                addToLog("互动", "你询问自己与李国良的过去，教授建议让记忆自然恢复，不要强行回忆。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "教授，我和李国良以前是不是认识？"},
                                        {speaker: "教授", text: "这个问题...为什么这么问？"},
                                        {speaker: "夏奈", text: "我有一些奇怪的感觉和片段记忆，但无法完全理解。"},
                                        {speaker: "教授", text: "夏奈，记忆是很复杂的。有时候，真相会在适当的时候自然显现。"},
                                        {speaker: "夏奈", text: "但这种不确定感让我很困扰..."},
                                        {speaker: "教授", text: "我理解。也许你需要收集更多线索，让记忆自然恢复。强行回忆可能会适得其反。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "询问记忆恢复的方法",
                        action: function() {
                            changeAttribute("wisdom", 5);
                            addToLog("互动", "教授从心理学角度解释熟悉的环境可能触发记忆，提出遗忘有时是为了自我保护。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "有什么方法可以帮助恢复遗失的记忆吗？"},
                                    {speaker: "教授", text: "从心理学角度看，熟悉的环境、物品或人物可能会触发记忆。但这个过程需要自然发展。"},
                                    {speaker: "夏奈", text: "如果...这些记忆很重要呢？"},
                                    {speaker: "教授", text: "重要的记忆往往不会真正消失，只是暂时隐藏。当你准备好面对它们时，它们会回来的。"},
                                    {speaker: "夏奈", text: "准备好...是什么意思？"},
                                    {speaker: "教授", text: "有时候我们忘记事情是有原因的。可能是为了保护自己，也可能是需要以新的视角重新认识。"},
                                    {speaker: "系统", text: "教授的话让你若有所思。也许收集更多的记忆碎片是关键。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "谈论樱花树的记忆",
                        action: function() {
                            if (hasMemoryFragment("memory5")) {
                                collectMemoryFragment("memory8");
                                addToLog("记忆", "教授提到你在雨天为了见某人奔跑摔倒的意外，触发了你关于那个雨天的记忆。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "我经常梦到樱花树下的场景...感觉那里发生过对我很重要的事。"},
                                        {speaker: "教授", text: "校园里的那棵樱花树确实见证了许多约定。"},
                                        {speaker: "夏奈", text: "我似乎和某人在那里有过约定..."},
                                        {speaker: "教授", text: "也许你应该去那里走走，让记忆自然浮现。"},
                                        {speaker: "夏奈", text: "还有，我好像记得一场雨...我在校园里奔跑，然后...一片黑暗。"},
                                        {speaker: "教授", text: "...那次意外。是的，那天雨很大，你为了赶去见某人，在校园里跑得太快，不小心滑倒..."},
                                        {speaker: "系统", text: "教授的话触发了你关于那个雨天的记忆...你想起自己在雨中奔跑，摔倒，然后在医院醒来..."}
                                    ]
                                };
                            } else {
                                addToLog("互动", "你提到樱花树给你的奇怪感觉，教授建议多去那里走走，让记忆自然浮现。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "每次看到校园里的樱花树，我都有种奇怪的感觉..."},
                                        {speaker: "教授", text: "樱花树对很多人来说都是特别的地方。有人在那里告白，有人在那里约定..."},
                                        {speaker: "夏奈", text: "约定...这个词让我心跳加速。"},
                                        {speaker: "教授", text: "也许你该多去那里走走，让记忆自然浮现。"},
                                        {speaker: "夏奈", text: "您说得对，我会试试的。"},
                                        {speaker: "教授", text: "记住，有些事不需要急于求成。顺其自然，答案会在适当的时候出现。"}
                                    ]
                                };
                            }
                        }
                    }
                ]
            };
        }
        
        // 樱花树下的真相
        function finalRevealEvent() {
            gameData.gameState.storyFlag = 5;
            addToLog("剧情进展", "你在樱花树下与李国良相见，他承认一直知道你们的过去。");
            return {
                dialogue: [
                    {speaker: "系统", text: "收集到足够多的记忆碎片后，你决定前往校园中那棵樱花树，希望在那里找到最后的答案。"},
                    {speaker: "系统", text: "当你到达时，李国良已经站在那里等你了，仿佛他知道你会来。"},
                    {speaker: "夏奈", text: "你一直都知道，是吗？"},
                    {speaker: "国良", text: "...是的。"},
                    {speaker: "夏奈", text: "为什么不告诉我？"}
                ],
                choices: [
                    {
                        text: "表达对被隐瞒的失望",
                        action: function() {
                            addToLog("互动", "你表达了对被隐瞒真相的失望，李国良解释是遵医嘱和你父母意愿，担心强行唤醒记忆会伤害你。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "你知道我有多困惑吗？一个个碎片记忆折磨着我，而你却什么都不说。"},
                                    {speaker: "国良", text: "医生说强行唤醒记忆可能会对你造成二次伤害。你父母也希望你远离那些痛苦的回忆..."},
                                    {speaker: "夏奈", text: "不是你决定的事！这是我的记忆，我的人生！"},
                                    {speaker: "系统", text: "李国良低下头，神情愧疚。"},
                                    {speaker: "国良", text: "对不起...我只是不想再次伤害你。那次意外是因为我..."},
                                    {speaker: "夏奈", text: "因为你受伤，我太担心，在雨中奔跑去看你，然后滑倒...对吗？"},
                                    {speaker: "国良", text: "你想起来了？是的，我一直责备自己。如果不是我受伤，你就不会..."},
                                    {speaker: "夏奈", text: "那不是你的错。那是我自己的选择。我们...在这棵樱花树下有个约定，对吗？"}
                                ]
                            };
                        }
                    },
                    {
                        text: "平静地询问过去",
                        action: function() {
                            changeCharacterAffection("guoliang", 10);
                            addToLog("互动", "李国良讲述了你们的过去：高中同学、相恋、他的比赛受伤、你的鼓励、樱花树下的约定，以及你的意外失忆。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "能告诉我我们之间的过去吗？完整的版本。"},
                                    {speaker: "系统", text: "李国良深深地看着你，眼中满是复杂的情感。"},
                                    {speaker: "国良", text: "我们是高中同学，一起上商法选修课。你很有天赋，经常帮我解答问题。"},
                                    {speaker: "国良", text: "后来我们相爱了。我是球队的主力，你总是在看台上为我加油。"},
                                    {speaker: "国良", text: "那场比赛我想给你一个完美表现，冒险做了一个高难度动作，结果膝盖受伤..."},
                                    {speaker: "国良", text: "你每天都来医院陪我，鼓励我不要放弃篮球，可以转型做教练。"},
                                    {speaker: "国良", text: "就在这棵樱花树下，我们约定：等我成为教练的那天，你要答应做我的女朋友。"},
                                    {speaker: "国良", text: "但一个雨天，你匆忙来医院看我，在校园里跑得太快...那次意外后，你失去了关于我们的记忆。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "主动分享恢复的记忆",
                        action: function() {
                            changeCharacterAffection("guoliang", 15);
                            addToLog("互动", "你分享了已恢复的记忆片段，李国良既惊喜又感动，解释医生和你父母为何隐瞒真相，感叹命运的安排。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我记起来了。不是全部，但足够多...我们的商法课，你的比赛，医院的日子，还有这棵树下的约定。"},
                                    {speaker: "系统", text: "李国良的眼睛亮了起来，仿佛有星光闪烁。"},
                                    {speaker: "国良", text: "你...真的记得？"},
                                    {speaker: "夏奈", text: "嗯。虽然还有些模糊，但我记得最重要的部分。你等了我这么久..."},
                                    {speaker: "国良", text: "我说过会等你记起来。无论多久。"},
                                    {speaker: "夏奈", text: "医生和我父母为什么要隐瞒？"},
                                    {speaker: "国良", text: "意外后，医生说你的记忆创伤需要时间自愈，强行唤醒可能导致更严重的问题。"},
                                    {speaker: "国良", text: "你父母认为是我间接导致了意外，希望你远离篮球和我...所以你被转到商法专业。"},
                                    {speaker: "夏奈", text: "但命运还是让我们相遇了..."}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 高亲密度特殊剧情 - 雨中相拥
        function specialRainEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "一场突如其来的大雨把你困在了篮球馆。训练结束后，只剩下你和李国良两人。"},
                    {speaker: "国良", text: "雨太大了，我送你回去吧。"},
                    {speaker: "夏奈", text: "但你没带伞啊。"},
                    {speaker: "国良", text: "教练办公室有一把。虽然不大，但挤一挤应该够了。"},
                    {speaker: "系统", text: "李国良拿来一把黑色折叠伞，你们一起走入雨中。小伞下，你们不得不靠得很近。"}
                ],
                choices: [
                    {
                        text: "自然地挽住他的手臂",
                        action: function() {
                            changeCharacterAffection("guoliang", 12);
                            addToLog("特殊互动", "雨中共伞时你挽住李国良的手臂，一阵强风让他保护性地环住你的肩膀，他轻吻了你的额头。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你自然地挽住李国良的手臂，感受到他身体瞬间的僵硬，然后慢慢放松。"},
                                    {speaker: "系统", text: "雨声淅沥，伞下的世界仿佛只有你们两人。李国良的体温透过衣服传来，让你感到安心。"},
                                    {speaker: "国良", text: "小心路滑..."},
                                    {speaker: "系统", text: "他的声音比平时低沉，带着一丝你从未听过的温柔。"},
                                    {speaker: "夏奈", text: "嗯...谢谢你。"},
                                    {speaker: "系统", text: "你们走到一个拐角，突然一阵强风吹来，雨伞几乎被吹翻。李国良迅速转身，一手抓紧雨伞，一手保护性地环住你的肩膀。"},
                                    {speaker: "系统", text: "这个突然的拥抱让你们都愣住了。雨水打湿了你们的衣服，但此刻谁都没有在意。"},
                                    {speaker: "国良", text: "对不起，我..."},
                                    {speaker: "系统", text: "你抬头看着他，雨水顺着他的脸颊滑落。一种奇怪的熟悉感涌上心头。"},
                                    {speaker: "夏奈", text: "不...没关系。"},
                                    {speaker: "系统", text: "你们的目光在雨中交汇，时间仿佛静止。李国良慢慢低下头，轻轻吻了你的额头，如此自然，又如此熟悉。"},
                                    {speaker: "国良", text: "我们该继续走了...雨越来越大了。"},
                                    {speaker: "系统", text: "这一刻，虽然短暂，却在你心中留下了深刻的印记。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "不小心滑倒",
                        action: function() {
                            changeCharacterAffection("guoliang", 10);
                            addToLog("特殊互动", "雨中你不小心滑倒，李国良紧急抱住你防止摔倒，触发了你对那个意外雨天的记忆。");
                            if (gameData.player.memoryFragments.length >= 4 && !hasMemoryFragment("memory8")) {
                                collectMemoryFragment("memory8");
                                return {
                                    dialogue: [
                                        {speaker: "系统", text: "你们走在湿滑的路上，突然你一个踉跄，脚下打滑。"},
                                        {speaker: "夏奈", text: "啊！"},
                                        {speaker: "系统", text: "李国良反应极快，丢下雨伞，一把抱住你防止你摔倒。雨水瞬间打湿了你们两人。"},
                                        {speaker: "国良", text: "没事吧？太危险了..."},
                                        {speaker: "系统", text: "他的眼中充满担忧，紧紧抱着你的姿势让你想起了什么..."},
                                        {speaker: "夏奈", text: "这种感觉...好熟悉..."},
                                        {speaker: "系统", text: "一段关于雨天和意外的记忆突然闪现...你看到自己在雨中奔跑，然后滑倒..."},
                                        {speaker: "夏奈", text: "那个雨天...我在去医院看你的路上摔倒了，对吗？"},
                                        {speaker: "系统", text: "李国良震惊地看着你，然后慢慢点头。"},
                                        {speaker: "国良", text: "你记起来了？"},
                                        {speaker: "夏奈", text: "一些片段...那次意外后我失去了记忆？"},
                                        {speaker: "国良", text: "是的...你记起了多少？"},
                                        {speaker: "夏奈", text: "不多，但...我们曾经很亲密，对吗？"},
                                        {speaker: "系统", text: "李国良的眼神复杂而深情，他轻轻抚摸你湿漉漉的头发。"},
                                        {speaker: "国良", text: "记忆会慢慢回来的。我会一直在这里等你..."}
                                    ]
                                };
                            } else {
                                return {
                                    dialogue: [
                                        {speaker: "系统", text: "你们走在湿滑的路上，突然你一个踉跄，脚下打滑。"},
                                        {speaker: "夏奈", text: "啊！"},
                                        {speaker: "系统", text: "李国良反应极快，丢下雨伞，一把抱住你防止你摔倒。雨水瞬间打湿了你们两人。"},
                                        {speaker: "国良", text: "小心...你没事吧？"},
                                        {speaker: "夏奈", text: "我没事...谢谢你。"},
                                        {speaker: "系统", text: "你们四目相对，近距离感受着彼此的呼吸。李国良的手臂仍环绕着你的腰，保护性地抱着你。"},
                                        {speaker: "系统", text: "雨水顺着他的睫毛滴落，他的嘴唇近在咫尺..."},
                                        {speaker: "国良", text: "我..."},
                                        {speaker: "系统", text: "一阵汽车鸣笛声打破了这美妙的时刻。李国良慢慢松开手，弯腰捡起雨伞。"},
                                        {speaker: "国良", text: "我们得找个地方避雨，你已经湿透了。"},
                                        {speaker: "夏奈", text: "嗯..."},
                                        {speaker: "系统", text: "虽然只是短暂的拥抱，但这一刻已经在你心里留下了深刻的印记。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "分享伞下的感受",
                        action: function() {
                            changeCharacterAffection("guoliang", 8);
                            addToLog("特殊互动", "你分享雨中共伞的特别感受，李国良暗示你们可能在另一个雨天也曾这样走过。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "这样靠得很近...有点紧张。"},
                                    {speaker: "国良", text: "如果不舒服，我可以走外侧，让你打得更多一些。"},
                                    {speaker: "夏奈", text: "不，不是那个意思...只是...这感觉很特别。"},
                                    {speaker: "系统", text: "李国良侧头看你，目光温柔。"},
                                    {speaker: "国良", text: "是吗？什么感觉？"},
                                    {speaker: "夏奈", text: "安心，又有些怀念...好像我们曾经这样走过。"},
                                    {speaker: "系统", text: "李国良的眼神闪烁，似乎想说什么，却又止住了。"},
                                    {speaker: "国良", text: "也许...在另一个雨天？"},
                                    {speaker: "夏奈", text: "可能吧..."},
                                    {speaker: "系统", text: "你们肩并肩走在雨中，彼此靠得很近。这种微妙的亲密感，让你的心跳不由自主地加快。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 高亲密度特殊剧情 - 夜间办公室
        function specialOfficeEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你帮李国良整理球队文件，不知不觉已经到了深夜。篮球馆里只剩下你们两人，窗外是繁星点点。"},
                    {speaker: "国良", text: "抱歉让你工作到这么晚..."},
                    {speaker: "夏奈", text: "没关系，我很乐意帮忙。"},
                    {speaker: "系统", text: "办公室的灯光柔和，映照着你们疲惫却满足的脸庞。完成工作后，一种奇妙的宁静笼罩着你们。"}
                ],
                choices: [
                    {
                        text: "主动靠近他",
                        action: function() {
                            changeCharacterAffection("guoliang", 15);
                            addToLog("特殊互动", "你主动靠在李国良肩膀上，他温柔地回应了你，轻吻你的唇，称这感觉像久违的重逢。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你鼓起勇气，走到李国良身边，轻轻靠在了他的肩膀上。"},
                                    {speaker: "夏奈", text: "有点累了...可以这样靠一会儿吗？"},
                                    {speaker: "系统", text: "李国良的身体明显地僵了一下，但很快就放松下来，小心翼翼地环住你的肩膀。"},
                                    {speaker: "国良", text: "嗯...当然可以。"},
                                    {speaker: "系统", text: "办公室里只有你们平稳的呼吸声。时间仿佛静止，你感受着他胸膛的温暖和心跳的节奏。"},
                                    {speaker: "夏奈", text: "李教练...国良...我想说..."},
                                    {speaker: "系统", text: "你抬头看他，话语在嘴边却又说不出口。李国良低头与你四目相对，他的眼中满是深情和克制。"},
                                    {speaker: "系统", text: "在这安静的夜晚，你们的距离越来越近。最终，李国良轻轻捧起你的脸，吻上了你的唇。"},
                                    {speaker: "系统", text: "这个吻温柔而克制，像是一种久违的重逢。你闭上眼睛，感受着这熟悉又陌生的触感，心跳加速。"},
                                    {speaker: "国良", text: "对不起，我不该..."},
                                    {speaker: "夏奈", text: "不...这感觉很对。好像...我们本该如此。"},
                                    {speaker: "系统", text: "李国良的眼中闪过一丝希望和喜悦，他轻轻抚摸你的脸颊。"},
                                    {speaker: "国良", text: "夏奈...等你想起一切，我会告诉你我有多么想念这一刻。"},
                                    {speaker: "系统", text: "这个夜晚，成为了你们关系中重要的转折点。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "询问他的感受",
                        action: function() {
                            changeCharacterAffection("guoliang", 8);
                            addToLog("特殊互动", "你询问李国良对你的感受，他表达你对他很重要，无法用语言表达的感情，轻吻了你的额头。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "李教练...你对我，是什么感觉？"},
                                    {speaker: "系统", text: "李国良明显愣了一下，眼中闪过复杂的情绪。"},
                                    {speaker: "国良", text: "我..."},
                                    {speaker: "系统", text: "他深吸一口气，似乎在组织语言。"},
                                    {speaker: "国良", text: "你对我很重要，比你想象的要重要得多。"},
                                    {speaker: "夏奈", text: "只是因为我帮助球队吗？"},
                                    {speaker: "国良", text: "不，不只是这样..."},
                                    {speaker: "系统", text: "他的目光变得深邃，慢慢靠近你。"},
                                    {speaker: "国良", text: "有些感情，无法用语言表达..."},
                                    {speaker: "系统", text: "在这安静的办公室里，李国良轻轻握住你的手，温暖而坚定。你们相视而笑，无需言语。"},
                                    {speaker: "系统", text: "他慢慢低头，轻轻吻了你的额头，这个动作如此自然，仿佛你们已经这样做过无数次。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "假装疲惫靠在沙发上",
                        action: function() {
                            changeAttribute("charm", 5);
                            addToLog("特殊互动", "你假装疲惫靠在沙发上，李国良温柔地给你盖上外套，你们最终共享一件外套的温暖，相互依偎。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你假装疲惫，轻轻靠在办公室的小沙发上，闭上眼睛。"},
                                    {speaker: "国良", text: "太累了吗？要不要送你回去？"},
                                    {speaker: "夏奈", text: "再休息一会儿就好..."},
                                    {speaker: "系统", text: "你感觉有人靠近，然后一件外套轻轻盖在了你身上，带着李国良的气息和温度。"},
                                    {speaker: "系统", text: "你微微睁开眼，看到李国良坐在旁边的椅子上，柔和的灯光下，他的侧脸线条分明而温柔。"},
                                    {speaker: "夏奈", text: "谢谢...但你不冷吗？"},
                                    {speaker: "国良", text: "我没事。"},
                                    {speaker: "系统", text: "你坐起身，把外套展开，示意他也一起盖上。李国良犹豫了一下，最终坐到你身边。"},
                                    {speaker: "系统", text: "你们肩并肩坐在小沙发上，共享一件外套的温暖。这种亲密感让人心跳加速。"},
                                    {speaker: "国良", text: "夏奈...我..."},
                                    {speaker: "系统", text: "他的话语还未出口，你却感到一种莫名的安心和熟悉，不由自主地靠在了他的肩膀上。"},
                                    {speaker: "系统", text: "李国良轻轻环抱住你，在这静谧的夜晚，时间仿佛停滞，只有彼此的心跳声。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 高亲密度特殊剧情 - 樱花树下的吻
        function specialCherryBlossomEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "樱花盛开的季节，你和李国良在那棵特别的樱花树下漫步。粉色花瓣如雪般飘落，景色美不胜收。"},
                    {speaker: "夏奈", text: "真美啊..."},
                    {speaker: "国良", text: "是啊，每年这个时候，这里都是最美的。"},
                    {speaker: "系统", text: "李国良的眼神中充满了怀念，他看着樱花树，又看着你，目光复杂而深情。"}
                ],
                choices: [
                    {
                        text: "问他为何如此怀念",
                        action: function() {
                            if (hasMemoryFragment("memory5")) {
                                addToLog("特殊互动", "你提起樱花树下的约定，李国良惊喜于你的记忆恢复，在漫天樱花中热烈地吻了你。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "你看起来很怀念这里...为什么？"},
                                        {speaker: "国良", text: "因为...这里有个约定。"},
                                        {speaker: "夏奈", text: "是我们的约定吗？在我失忆前..."},
                                        {speaker: "系统", text: "李国良惊讶地看着你。"},
                                        {speaker: "国良", text: "你...记得？"},
                                        {speaker: "夏奈", text: "一些片段。你说过，等你成为教练的那天，我要答应做你的女朋友。"},
                                        {speaker: "系统", text: "李国良的眼睛亮了起来，像是点燃了希望。他慢慢靠近你。"},
                                        {speaker: "国良", text: "夏奈...我已经成为教练了。"},
                                        {speaker: "夏奈", text: "我知道..."},
                                        {speaker: "系统", text: "在漫天飞舞的樱花中，李国良轻轻捧起你的脸，吻上了你的唇。这个吻温柔而热烈，仿佛要弥补所有失去的时光。"},
                                        {speaker: "系统", text: "你闭上眼睛，回应着这个吻。樱花瓣落在你们身上，见证着这场迟来的重逢。"},
                                        {speaker: "国良", text: "我等了这一刻...太久太久..."},
                                        {speaker: "夏奈", text: "我们不会再分开了，对吗？"},
                                        {speaker: "国良", text: "永远不会。这一次，我会牢牢抓住你的手，不再让任何事情分开我们。"},
                                        {speaker: "系统", text: "在这个樱花纷飞的浪漫时刻，你们重新许下了彼此的承诺。"}
                                    ]
                                };
                            } else {
                                changeCharacterAffection("guoliang", 10);
                                addToLog("特殊互动", "你询问李国良对樱花树的怀念，他提到这里对他特别，曾有人给了他重新开始的勇气，随后在樱花中吻了你。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "你看起来很怀念这里...为什么？"},
                                        {speaker: "国良", text: "这里...对我来说是个特别的地方。"},
                                        {speaker: "夏奈", text: "特别？怎么特别？"},
                                        {speaker: "国良", text: "曾经在这里，有人给了我重新开始的勇气。"},
                                        {speaker: "夏奈", text: "是...女朋友吗？"},
                                        {speaker: "系统", text: "李国良看着你，眼神中有无限柔情。"},
                                        {speaker: "国良", text: "某种意义上...是的。"},
                                        {speaker: "系统", text: "你感到一丝莫名的酸楚和嫉妒。"},
                                        {speaker: "夏奈", text: "她...现在在哪里？"},
                                        {speaker: "国良", text: "比你想象的要近得多。"},
                                        {speaker: "系统", text: "他的话让你困惑。就在这时，一阵微风吹过，樱花瓣纷纷扬扬落下，有一片正好落在你的唇上。"},
                                        {speaker: "系统", text: "李国良情不自禁地伸手，轻轻拂去那片花瓣，手指不经意间触碰到你的嘴唇，引起一阵微妙的电流。"},
                                        {speaker: "系统", text: "在这个瞬间，你们的目光交汇，他慢慢低头，吻上了你的唇。这个吻温柔而试探，却又充满深情。"},
                                        {speaker: "系统", text: "当你们分开时，他轻声说道："},
                                        {speaker: "国良", text: "对不起...我不该...但我无法再等待了。"},
                                        {speaker: "夏奈", text: "不...这感觉很对..."},
                                        {speaker: "系统", text: "在樱花飞舞中，你们再次拥吻，仿佛这一刻已经等待了太久太久。"}
                                    ]
                                };
                            }
                        }
                    },
                    {
                        text: "主动拉住他的手",
                        action: function() {
                            changeCharacterAffection("guoliang", 12);
                            addToLog("特殊互动", "你主动拉住李国良的手，他告诉你曾经你们也这样牵手站在这棵树下，樱花树下你们深情相吻。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "在樱花纷飞中，你鼓起勇气，轻轻拉住了李国良的手。"},
                                    {speaker: "系统", text: "他明显地愣了一下，低头看着你们交握的手，眼中闪过惊讶和喜悦。"},
                                    {speaker: "国良", text: "夏奈..."},
                                    {speaker: "夏奈", text: "不知道为什么...这样牵着你的手，感觉很自然，很熟悉..."},
                                    {speaker: "系统", text: "李国良的眼神变得深邃，他轻轻收紧了握着你的手。"},
                                    {speaker: "国良", text: "因为...我们曾经无数次这样牵着手，站在这棵树下。"},
                                    {speaker: "夏奈", text: "真的吗？在我失去记忆之前？"},
                                    {speaker: "系统", text: "他点点头，眼中有些湿润。"},
                                    {speaker: "国良", text: "我们在这里许下了约定..."},
                                    {speaker: "系统", text: "李国良慢慢靠近你，一只手轻抚你的脸颊。"},
                                    {speaker: "国良", text: "我可以吻你吗？就像...从前那样。"},
                                    {speaker: "系统", text: "你没有回答，只是闭上眼睛，轻轻点头。下一刻，他的唇温柔地覆上你的，樱花在你们周围飞舞。"},
                                    {speaker: "系统", text: "这个吻唤醒了沉睡的情感，仿佛过去与现在在此刻交汇。你伸手环抱住他的脖子，加深了这个吻。"},
                                    {speaker: "系统", text: "当你们依依不舍地分开时，他的额头抵着你的，轻声说："},
                                    {speaker: "国良", text: "我爱你，一直都是。无论你记不记得。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "提起你的梦和记忆碎片",
                        action: function() {
                            if (gameData.player.memoryFragments.length >= 8) {
                                changeCharacterAffection("guoliang", 20);
                                addToLog("特殊互动", "你分享了关于樱花树下约定的记忆碎片，李国良激动地拥抱并热吻了你，你们承诺重新开始你们的故事。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "我经常梦到这棵樱花树...还有我们站在这里，你握着我的手，我们有个约定..."},
                                        {speaker: "系统", text: "李国良震惊地看着你，仿佛不敢相信自己的耳朵。"},
                                        {speaker: "国良", text: "你...记得那个约定？"},
                                        {speaker: "夏奈", text: "不是很清楚，但...是关于你成为教练，而我答应做你女朋友的约定？"},
                                        {speaker: "系统", text: "李国良的眼中瞬间涌出泪水，他紧紧抱住你，仿佛害怕你会再次消失。"},
                                        {speaker: "国良", text: "是的！就是这个约定！你真的记起来了..."},
                                        {speaker: "夏奈", text: "不只是这个...我还记得你的比赛，你的受伤，医院里的日子...虽然都是些片段..."},
                                        {speaker: "系统", text: "他捧起你的脸，急切地吻上你的唇。这个吻充满了渴望、喜悦和多年的等待。你热烈地回应着，感受着彼此的心跳。"},
                                        {speaker: "系统", text: "樱花瓣在你们周围飞舞，宛如一场粉色的雪。这个吻深沉而绵长，仿佛要弥补所有失去的时光。"},
                                        {speaker: "国良", text: "我等了这一刻...整整两年。每天都在想，你是否会记起我，记起我们。"},
                                        {speaker: "系统", text: "他的手轻抚你的头发、脸颊、颈项，动作轻柔又充满热情，像是确认你真实存在。"},
                                        {speaker: "夏奈", text: "对不起，让你等了这么久..."},
                                        {speaker: "国良", text: "不，重要的是你回来了。我们可以重新开始...不，是继续我们的故事。"},
                                        {speaker: "系统", text: "在这个樱花纷飞的美丽时刻，你们重新找回了彼此，弥合了时间的裂缝。"}
                                    ]
                                };
                            } else {
                                addToLog("特殊互动", "你提及对樱花树的梦境，李国良显得异常专注，暗示强行唤醒记忆可能有风险，但还是情不自禁地吻了你。");
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "我经常梦到这棵樱花树...感觉这里对我来说很特别。"},
                                        {speaker: "国良", text: "是吗？梦到了什么？"},
                                        {speaker: "夏奈", text: "一些模糊的场景...好像有人在这里对我说着什么重要的话。"},
                                        {speaker: "系统", text: "李国良的眼神变得异常专注，他慢慢靠近你。"},
                                        {speaker: "国良", text: "那个人...是我吗？"},
                                        {speaker: "夏奈", text: "我不确定...但感觉很像。我们之前真的在这里有过回忆吗？"},
                                        {speaker: "系统", text: "李国良深吸一口气，轻轻拉起你的手。"},
                                        {speaker: "国良", text: "夏奈...有些事情，不是我能告诉你的。需要你自己想起来。"},
                                        {speaker: "夏奈", text: "为什么？如果我们真的有过去，为什么不能告诉我？"},
                                        {speaker: "系统", text: "李国良的眼中充满痛苦和挣扎，他的拇指轻轻摩挲着你的手背。"},
                                        {speaker: "国良", text: "因为...医生说过，记忆需要自然恢复。强行唤醒可能会..."},
                                        {speaker: "系统", text: "他没有说完，但你明白了他的顾虑。就在这时，一阵风吹过，卷起漫天樱花。一片花瓣落在你的唇上。"},
                                        {speaker: "系统", text: "李国良情不自禁地伸手，轻轻拂去那片花瓣，手指不经意间触碰到你的嘴唇。你们的目光在这一刻交汇，时间仿佛静止。"},
                                        {speaker: "系统", text: "他缓缓低头，吻上了你的唇。这个吻小心翼翼，却又充满渴望。当他要离开时，你本能地追逐着他的唇，不愿分开。"},
                                        {speaker: "系统", text: "这个意外却又仿佛命中注定的吻，让你感受到一种深刻的归属感。"}
                                    ]
                                };
                            }
                        }
                    }
                ]
            };
        }
        
        // 高亲密度特殊剧情 - 公寓晚餐
        function specialDinnerEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "你邀请李国良来你的公寓共进晚餐，作为感谢他一直以来的帮助和指导。"},
                    {speaker: "系统", text: "你精心准备了几道菜，餐桌上摆放着蜡烛，气氛温馨而浪漫。"},
                    {speaker: "国良", text: "没想到你的烹饪技术这么好，味道很棒。"},
                    {speaker: "夏奈", text: "谢谢，我很高兴你喜欢。"},
                    {speaker: "系统", text: "晚餐后，你们坐在沙发上，窗外是城市的灯光，室内只有柔和的灯光照明。气氛变得微妙而亲密。"}
                ],
                choices: [
                    {
                        text: "靠近他并表达感情",
                        action: function() {
                            changeCharacterAffection("guoliang", 15);
                            addToLog("特殊互动", "你鼓起勇气表达对李国良的感情，他热情回应，你们共度了一个充满爱意的夜晚。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你鼓起勇气，挪动位置靠近李国良，心跳加速。"},
                                    {speaker: "夏奈", text: "国良...这段时间和你相处，我发现自己越来越喜欢你..."},
                                    {speaker: "系统", text: "李国良看着你，眼神中充满复杂的情感。"},
                                    {speaker: "国良", text: "夏奈..."},
                                    {speaker: "夏奈", text: "我知道这可能很突然，但我无法控制自己的感受..."},
                                    {speaker: "系统", text: "李国良轻轻握住你的手，眼中有深情，也有犹豫。"},
                                    {speaker: "国良", text: "这不突然...但你确定吗？关于你的感受？"},
                                    {speaker: "夏奈", text: "我从来没有这么确定过。每次见到你，我的心都会跳得很快..."},
                                    {speaker: "系统", text: "李国良深吸一口气，似乎下定了决心。他慢慢靠近你，轻轻抚摸你的脸颊。"},
                                    {speaker: "国良", text: "我也喜欢你，比你想象的要深得多..."},
                                    {speaker: "系统", text: "他的唇轻轻贴上你的，开始是试探性的轻吻，但很快变得热烈起来。你环抱住他的脖子，回应着这个吻。"},
                                    {speaker: "系统", text: "他的手轻抚你的背部，动作温柔而充满爱意。你们的吻越来越深入，彼此的呼吸变得急促。"},
                                    {speaker: "国良", text: "夏奈...我可以...？"},
                                    {speaker: "系统", text: "你明白他的意思，羞涩地点点头。李国良小心翼翼地将你拥入怀中，你能感受到他强烈的心跳。"},
                                    {speaker: "系统", text: "他的吻从你的唇移到颈项，每一次触碰都让你战栗。你的手不自觉地探入他的衬衫，感受他结实的肌肉。"},
                                    {speaker: "系统", text: "在这个充满爱意的夜晚，你们的关系迈向了新的阶段，融入彼此的怀抱中，共同编织美好的回忆。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "假装困倦，测试他的反应",
                        action: function() {
                            addToLog("特殊互动", "你假装困倦靠在沙发上，李国良温柔地照顾你，在你额头轻吻并说出想念这样时刻的心声。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你假装有些困倦，轻轻靠在沙发上，眼睛半闭。"},
                                    {speaker: "国良", text: "累了？我该走了，让你好好休息。"},
                                    {speaker: "夏奈", text: "嗯...有点累，但我不想你这么快就走..."},
                                    {speaker: "系统", text: "李国良看着你，眼神温柔。他轻轻拿起沙发上的毯子，为你盖上。"},
                                    {speaker: "国良", text: "那我再坐一会儿。"},
                                    {speaker: "系统", text: "你无意中（实则有意）靠在他的肩膀上，感受着他的体温和气息。"},
                                    {speaker: "夏奈", text: "嗯...你真舒服..."},
                                    {speaker: "系统", text: "李国良轻轻笑了，犹豫了一下，然后小心地环住你的肩膀，让你靠得更舒适。"},
                                    {speaker: "国良", text: "你啊..."},
                                    {speaker: "系统", text: "他的声音很温柔，带着一丝宠溺。你感觉他低头看了你很久，然后轻轻在你额头上落下一个吻。"},
                                    {speaker: "系统", text: "你假装熟睡，但心跳加速。李国良的手轻轻抚摸你的头发，动作无比轻柔。"},
                                    {speaker: "国良", text: "夏奈...如果你知道我有多想念这样的时刻..."},
                                    {speaker: "系统", text: "他的低语让你困惑，但也让你感到一阵甜蜜。你忍不住睁开眼睛，对上他深情的目光。"},
                                    {speaker: "夏奈", text: "其实...我没有睡着。"},
                                    {speaker: "系统", text: "李国良愣了一下，随即微笑。"},
                                    {speaker: "国良", text: "我知道。"},
                                    {speaker: "系统", text: "在这个温馨的夜晚，你们相视而笑，某种默契在心间流动。他倾身向前，轻轻吻上你的唇，这个吻温柔而克制，却充满了无尽的爱意。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "邀请他看电影",
                        action: function() {
                            changeCharacterAffection("guoliang", 10);
                            addToLog("特殊互动", "你邀请李国良看电影，电影中的爱情场景让气氛变得微妙，你们自然而然地吻在了一起。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "晚餐后想看部电影吗？我这有几部不错的片子。"},
                                    {speaker: "国良", text: "好啊，你来选吧。"},
                                    {speaker: "系统", text: "你选了一部浪漫爱情片，你们并排坐在沙发上。随着剧情发展，电影中的主角陷入热烈的拥吻。"},
                                    {speaker: "系统", text: "这一幕让气氛变得略微尴尬，你感到李国良在沙发上略微挪动了一下，似乎有些不自在。"},
                                    {speaker: "夏奈", text: "呃...要不要爆米花或饮料？"},
                                    {speaker: "国良", text: "好的，我来帮你。"},
                                    {speaker: "系统", text: "你们同时站起身，在狭小的空间里意外地靠得很近，几乎是面对面。"},
                                    {speaker: "系统", text: "这个突然的亲密距离让你屏住了呼吸。李国良的目光落在你的唇上，然后迅速移开，但你已经注意到了那一瞬间的火花。"},
                                    {speaker: "夏奈", text: "国良..."},
                                    {speaker: "系统", text: "你轻声呼唤他的名字，他的目光重新回到你脸上。这一次，他没有回避。"},
                                    {speaker: "系统", text: "在电影幽暗的光线下，你们慢慢靠近彼此。他的手轻轻抚上你的脸颊，你能感受到他温热的呼吸。"},
                                    {speaker: "系统", text: "他的吻温柔而试探，你闭上眼睛回应着。这个吻逐渐深入，他的手滑到你的腰间，将你拉得更近。"},
                                    {speaker: "系统", text: "你感受到他强壮的胸膛和急促的心跳，你的手不自觉地抚摸他的肩膀和背部。"},
                                    {speaker: "系统", text: "电影被遗忘在背景中，你们沉浸在这个充满激情的拥吻中，享受着彼此的温暖和亲密。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 亲密度最高时的特殊剧情 - 完全记忆恢复后的亲密时刻
        function intimateMemoryEvent() {
            return {
                dialogue: [
                    {speaker: "系统", text: "在记忆完全恢复后，你和李国良回到了你的公寓。多年的等待，终于迎来了重逢的时刻。"},
                    {speaker: "夏奈", text: "我记得一切...那些日子，我们的约定，你的等待..."},
                    {speaker: "国良", text: "夏奈...你不知道这对我意味着什么。我以为可能永远失去你了。"},
                    {speaker: "系统", text: "他紧紧拥抱着你，你能感受到他身体微微的颤抖，那是压抑太久的情感终于得到释放。"}
                ],
                choices: [
                    {
                        text: "主动亲吻他",
                        action: function() {
                            changeCharacterAffection("guoliang", 20);
                            addToLog("特殊互动", "记忆恢复后，你主动热烈亲吻李国良，你们在月光下弥补了失去的时光，完全地属于彼此。");
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "你捧起李国良的脸，深深地吻上他的唇。这个吻热烈而坚定，倾注了所有思念和爱意。"},
                                    {speaker: "系统", text: "李国良紧紧抱住你，回应着这个吻。你们的身体紧贴，心跳逐渐同步。"},
                                    {speaker: "夏奈", text: "我爱你...一直都是。即使在记忆缺失的日子里，我的心也在寻找你。"},
                                    {speaker: "国良", text: "夏奈...我的夏奈..."},
                                    {speaker: "系统", text: "他的吻从你的唇移到颈间，温热的触感让你战栗。你的手不自觉地滑入他的衬衫，感受他紧实的肌肉。"},
                                    {speaker: "系统", text: "他轻柔地将你抱起，你的腿环绕着他的腰。你们唇齿相依，走向卧室，所有的言语都化作了热烈的行动。"},
                                    {speaker: "系统", text: "他的手温柔而坚定地探索着你的身体，每一次触碰都让你颤抖。你们之间的欲望如潮水般涌动，却又充满了深沉的爱意。"},
                                    {speaker: "系统", text: "在月光的见证下，你们终于完全属于彼此，弥补了那些失去的时光。肌肤相亲，灵魂交融，爱意绵绵不绝。"},
                                    {speaker: "系统", text: "当一切平静下来，他紧紧抱着你，轻吻你的额头，眼神中满是温柔与珍视。"},
                                    {speaker: "国良", text: "我永远不会再让你离开..."},
                                    {speaker: "夏奈", text: "我也不会再忘记你...永远不会。"},
                                    {speaker: "系统", text: "这一夜，成为了你们新生活的美好开始，命运的齿轮终于回到正轨。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "细述你的记忆和感受",
                        action: function() {
                            changeCharacterAffection("guoliang", 15);
                            addToLog("特殊互动", "你详细描述恢复的记忆片段，李国良感动落泪，你们热情相拥，在晨光中迎来了重逢后的第一个清晨。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "我记得那场比赛，你为了给我留下深刻印象，做了那个危险动作..."},
                                    {speaker: "夏奈", text: "记得医院里的日子，我每天都去看你，陪你做康复训练..."},
                                    {speaker: "夏奈", text: "还有樱花树下的约定...你说等你成为教练，我就答应做你的女朋友。"},
                                    {speaker: "系统", text: "李国良的眼中闪烁着泪光，他轻轻抚摸你的脸颊，像是在确认这一切是否真实。"},
                                    {speaker: "国良", text: "你真的都记得...这两年，我看着你却不能相认，是我人生中最艰难的时刻。"},
                                    {speaker: "夏奈", text: "为什么不告诉我？"},
                                    {speaker: "国良", text: "医生说强行唤醒记忆可能会有风险...我不能冒这个险。"},
                                    {speaker: "系统", text: "你们相视而笑，所有的等待和痛苦都值得了。"},
                                    {speaker: "系统", text: "李国良慢慢低头，吻上你的唇。这个吻开始很轻柔，但很快变得热烈起来。你完全沉浸其中，回应着他的热情。"},
                                    {speaker: "系统", text: "他的手滑到你的背后，将你拉得更近。你能感受到他强烈的心跳和灼热的呼吸。你的手指穿过他的头发，渴望更多的接触。"},
                                    {speaker: "系统", text: "不知何时，你发现自己已经被他温柔地放在床上。他俯身在你上方，目光中充满爱意和渴望。"},
                                    {speaker: "国良", text: "我可以...？"},
                                    {speaker: "系统", text: "你微笑着点头，伸手将他拉向你。在这个充满爱意的夜晚，你们终于完全地属于彼此，弥补了失去的时光。"},
                                    {speaker: "系统", text: "他的每一个触碰都如此熟悉又如此新鲜，你们的身体仿佛早已相知，却又在发现新的奇迹。"},
                                    {speaker: "系统", text: "当晨光微微照入房间，你依偎在他的怀中，感受着前所未有的幸福和满足。命运的重逢，让一切等待都变得值得。"}
                                ]
                            };
                        }
                    },
                    {
                        text: "向他求婚",
                        action: function() {
                            changeCharacterAffection("guoliang", 25);
                            addToLog("特殊互动", "你大胆地向李国良求婚，他激动地接受了，你们在月光下订婚并共度了无比亲密的时刻。");
                            return {
                                dialogue: [
                                    {speaker: "夏奈", text: "国良...我们已经失去了太多时间。我不想再等了。"},
                                    {speaker: "国良", text: "什么意思？"},
                                    {speaker: "夏奈", text: "我想和你共度余生。不只是做你的女朋友...我想成为你的妻子。"},
                                    {speaker: "系统", text: "李国良震惊地看着你，眼中闪烁着不敢置信的光芒。"},
                                    {speaker: "夏奈", text: "我知道通常应该是男生求婚，但我们已经打破了太多常规...所以，李国良，你愿意娶我吗？"},
                                    {speaker: "系统", text: "李国良的眼中涌出泪水，他紧紧抱住你，几乎让你喘不过气来。"},
                                    {speaker: "国良", text: "当然愿意！我的答案永远是愿意！"},
                                    {speaker: "系统", text: "他激动地吻上你的唇，这个吻充满了喜悦和爱意。你完全融入这个吻中，感受着彼此的热情。"},
                                    {speaker: "系统", text: "不知不觉中，热吻变得更加深入。他的手轻抚你的背部，慢慢移向更私密的区域。你的身体因他的触碰而战栗。"},
                                    {speaker: "系统", text: "你们的呼吸变得急促，衣物一件件被解开。在月光的见证下，你们终于完全地属于彼此。"},
                                    {speaker: "系统", text: "他的吻从你的唇移向颈项，再到锁骨...每一处触碰都让你颤抖和呻吟。你的手抚摸着他结实的背肌，感受他因欲望而紧绷的身体。"},
                                    {speaker: "系统", text: "在这个特别的夜晚，你们以最亲密的方式庆祝重逢和订婚，彼此的身体和灵魂完美契合，仿佛本就是一体的两半。"},
                                    {speaker: "系统", text: "当黎明来临，你躺在他的臂弯中，感受着无与伦比的满足和幸福。你知道，从今往后，再没有什么能将你们分开。"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 结局系统 - 根据好感度和记忆碎片数量决定结局
        function determineEnding() {
            const affection = gameData.characters.guoliang.affection;
            const memoryCount = gameData.player.memoryFragments.length;
            
            if (affection >= 90 && memoryCount === 12) {
                // 完美结局 - 真爱终成
                return perfectEnding();
            } else if (affection >= 75 && memoryCount >= 8) {
                // 好结局 - 新的开始
                return goodEnding();
            } else if (affection >= 50 && memoryCount >= 5) {
                // 普通结局 - 朋友之上
                return normalEnding();
            } else {
                // 遗憾结局 - 各自前行
                return sadEnding();
            }
        }
        
        // 完美结局
        function perfectEnding() {
            return {
                dialogue: [
                    {speaker: "系统", text: "【完美结局：真爱终成】"},
                    {speaker: "系统", text: "记忆完全恢复后，你和李国良重续前缘，弥补了失去的时光。"},
                    {speaker: "系统", text: "一年后，在那棵樱花树下，李国良单膝跪地，向你求婚。你幸福地接受了。"},
                    {speaker: "系统", text: "婚礼上，相泽美咲作为伴娘，真诚地祝福你们。她曾经的敌意，只是因为担心李国良再次受伤。"},
                    {speaker: "系统", text: "你完成了法学学位，成为一名体育法专业律师，同时继续担任学校篮球队的法律顾问。"},
                    {speaker: "系统", text: "李国良带领球队取得了校史最好成绩，并收到了多所高校的邀请，但他选择留在这里，因为这里有太多珍贵的回忆。"},
                    {speaker: "系统", text: "每年樱花盛开时，你们都会回到那棵树下，重温那个特别的约定。命运的齿轮终于回到正轨，你们的爱情战胜了时间和遗忘。"},
                    {speaker: "系统", text: "游戏结束，感谢游玩《国良诱捕器》！"}
                ],
                choices: [
                    {
                        text: "重新开始游戏",
                        action: function() {
                            resetGame();
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "游戏已重置，欢迎再次体验《国良诱捕器》！"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 好结局
        function goodEnding() {
            return {
                dialogue: [
                    {speaker: "系统", text: "【好结局：新的开始】"},
                    {speaker: "系统", text: "虽然你没有完全恢复所有记忆，但你和李国良决定不再执着于过去，而是向前看，开启全新的恋情。"},
                    {speaker: "系统", text: "李国良坦诚地告诉了你们的过往，你选择相信你内心的感受——即使没有记忆，你的心也一直在寻找他。"},
                    {speaker: "系统", text: "你们在樱花树下重新许下约定：不论过去如何，未来要一起走下去。"},
                    {speaker: "系统", text: "你继续专注于商法事业，同时支持李国良的教练工作。你们的爱情虽然经历了一段弯路，但最终找到了彼此。"},
                    {speaker: "系统", text: "相泽美咲成为了你的好友，她告诉你，看到你们重新在一起，她终于放下了长久的愧疚。"},
                    {speaker: "系统", text: "有时候，一些零散的记忆仍会突然闪现，但你不再执着于拼凑完整的过去，因为现在的爱情同样美好而珍贵。"},
                    {speaker: "系统", text: "游戏结束，感谢游玩《国良诱捕器》！"}
                ],
                choices: [
                    {
                        text: "重新开始游戏",
                        action: function() {
                            resetGame();
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "游戏已重置，欢迎再次体验《国良诱捕器》！"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 普通结局
        function normalEnding() {
            return {
                dialogue: [
                    {speaker: "系统", text: "【普通结局：朋友之上】"},
                    {speaker: "系统", text: "你恢复了部分记忆，了解到与李国良的过去，但两人都犹豫要不要重新开始这段感情。"},
                    {speaker: "系统", text: "你们决定先做亲密的朋友，不急于确定关系，给彼此一些时间和空间。"},
                    {speaker: "系统", text: "你继续担任篮球队的法律顾问，与李国良保持着密切的合作关系。你们之间的默契和信任日益加深。"},
                    {speaker: "系统", text: "虽然没有明确的恋爱关系，但周围的人都看得出你们之间的特殊情感。相泽美咲曾对你说：有些事不需要刻意，顺其自然。"},
                    {speaker: "系统", text: "毕业时，李国良收到了外地一所知名体育学院的邀请。临行前，他在樱花树下对你说：我会等你想清楚的那一天。无论多久。"},
                    {speaker: "系统", text: "未来如何发展，还有很多可能性。但至少现在，你们都不再孤单，心中有了对方的位置。"},
                    {speaker: "系统", text: "游戏结束，感谢游玩《国良诱捕器》！"}
                ],
                choices: [
                    {
                        text: "重新开始游戏",
                        action: function() {
                            resetGame();
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "游戏已重置，欢迎再次体验《国良诱捕器》！"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 遗憾结局
        function sadEnding() {
            return {
                dialogue: [
                    {speaker: "系统", text: "【遗憾结局：各自前行】"},
                    {speaker: "系统", text: "尽管李国良试图帮助你恢复记忆，但你仍然只记得零星片段，无法完整连接起过去的感情。"},
                    {speaker: "系统", text: "面对这段无法完全理解的过往，你感到迷茫和压力。你告诉李国良，也许现在的你已经不是他记忆中的那个人了。"},
                    {speaker: "系统", text: "李国良尊重你的决定，虽然眼中满是不舍，但他说：我不能一直活在过去，你也是。"},
                    {speaker: "系统", text: "你专注于学业和实习，成为一名出色的商法律师。李国良接受了外地一所体育大学的邀请，离开了这座城市。"},
                    {speaker: "系统", text: "分别那天，他最后一次站在樱花树下，看着落英缤纷，似乎在告别那个未能兑现的约定。"},
                    {speaker: "系统", text: "相泽美咲告诉你：有时候，爱一个人就是要学会放手。李国良已经等了你两年，现在，他终于决定向前看了。"},
                    {speaker: "系统", text: "也许多年后，当命运再次让你们相遇，会有不同的故事发生。但现在，你们选择了各自的道路。"},
                    {speaker: "系统", text: "游戏结束，感谢游玩《国良诱捕器》！"}
                ],
                choices: [
                    {
                        text: "重新开始游戏",
                        action: function() {
                            resetGame();
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "游戏已重置，欢迎再次体验《国良诱捕器》！"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 秘密结局
        function secretEnding() {
            return {
                dialogue: [
                    {speaker: "系统", text: "【秘密结局：命运交织】"},
                    {speaker: "系统", text: "在收集所有记忆碎片，并完成特定隐藏任务后，你发现了更深层的真相。"},
                    {speaker: "系统", text: "原来你和李国良的相遇并非巧合，而是命运的刻意安排。"},
                    {speaker: "系统", text: "你的父母和李国良早有约定：如果你能自然恢复记忆并再次爱上他，他们就不再阻挠你们的感情。"},
                    {speaker: "系统", text: "相泽美咲实际上是你的远房表姐，她一直在暗中观察你们，帮助创造两人偶遇的机会。"},
                    {speaker: "系统", text: "当你质问李国良为何参与这个游戏时，他坦承道："},
                    {speaker: "国良", text: "因为我知道，真正的爱不会被记忆左右。如果我们真的有缘分，即使你忘记了过去，也会再次爱上我。"},
                    {speaker: "系统", text: "你既感动又有些生气，但最终理解了他的用心良苦。你们决定不再被过去束缚，携手创造全新的未来。"},
                    {speaker: "系统", text: "婚礼上，你的父母终于承认了他们的阴谋，但也表示这是对李国良的终极考验——如果他真心爱你，就会愿意从零开始追求你。"},
                    {speaker: "系统", text: "这场看似偶然的重逢，实际上是一场精心设计的国良诱捕器。而你，心甘情愿地坠入了这个温柔的陷阱。"},
                    {speaker: "系统", text: "游戏结束，感谢游玩《国良诱捕器》！"}
                ],
                choices: [
                    {
                        text: "重新开始游戏",
                        action: function() {
                            resetGame();
                            return {
                                dialogue: [
                                    {speaker: "系统", text: "游戏已重置，欢迎再次体验《国良诱捕器》！"}
                                ]
                            };
                        }
                    }
                ]
            };
        }
        
        // 重置游戏
        function resetGame() {
            gameData = {
                player: {
                    name: "结城夏奈",
                    attributes: {
                        charm: 20,
                        wisdom: 25,
                        stamina: 100,
                        law: 40,
                        basketball: 10,
                        cooking: 15
                    },
                    inventory: [],
                    memoryFragments: []
                },
                characters: {
                    guoliang: {
                        name: "李国良",
                        affection: 0,
                        metFlag: false
                    },
                    misaki: {
                        name: "相泽美咲",
                        metFlag: false
                    }
                },
                gameState: {
                    day: 1,
                    time: "morning",
                    location: "apartment",
                    storyFlag: 0,
                    energyLeft: 3,
                    completedEvents: [],
                    gameLog: []
                }
            };
            
            updateStatusDisplay();
            hideAllScreens();
            showScreen("title-screen");
        }
        
        // 游戏工具函数
        
        // 改变角色好感度
        function changeCharacterAffection(character, amount) {
            gameData.characters[character].affection += amount;
            
            // 限制最大值为100
            if (gameData.characters[character].affection > 100) {
                gameData.characters[character].affection = 100;
            }
            
            showNotification("好感度 +" + amount);
            updateStatusDisplay();
        }
        
        // 改变属性值
        function changeAttribute(attribute, amount) {
            gameData.player.attributes[attribute] += amount;
            
            // 确保属性值在0-100范围内
            if (gameData.player.attributes[attribute] > 100) {
                gameData.player.attributes[attribute] = 100;
            }
            if (gameData.player.attributes[attribute] < 0) {
                gameData.player.attributes[attribute] = 0;
            }
            
            if (amount > 0) {
                showNotification(attributeDisplayName(attribute) + " +" + amount);
            } else if (amount < 0) {
                showNotification(attributeDisplayName(attribute) + " " + amount);
            }
            
            updateStatusDisplay();
        }
        
        // 获取属性的显示名称
        function attributeDisplayName(attribute) {
            const names = {
                charm: "魅力",
                wisdom: "智慧",
                stamina: "体力",
                law: "商法知识",
                basketball: "篮球技能",
                cooking: "烹饪能力"
            };
            return names[attribute] || attribute;
        }
        
        // 添加物品到背包
        function addToInventory(itemId) {
            gameData.player.inventory.push(itemId);
            showNotification("获得物品：" + itemsData[itemId].name);
            updateInventoryDisplay();
            
            // 高亮提示物品栏
            document.getElementById("inventory-btn").classList.add("highlight");
            setTimeout(() => {
                document.getElementById("inventory-btn").classList.remove("highlight");
            }, 2000);
        }
        
        // 使用物品
        function useItem(itemId) {
            const item = itemsData[itemId];
            const index = gameData.player.inventory.indexOf(itemId);
            
            if (index !== -1) {
                gameData.player.inventory.splice(index, 1);
                
                if (item.effect.type === "attribute") {
                    changeAttribute(item.effect.target, item.effect.value);
                    addToLog("物品使用", `你使用了${item.name}，提升了${attributeDisplayName(item.effect.target)} ${item.effect.value}点。`);
                } else if (item.effect.type === "affection") {
                    changeCharacterAffection("guoliang", item.effect.value);
                    addToLog("物品使用", `你将${item.name}送给了李国良，好感度提升了${item.effect.value}点。`);
                } else if (item.effect.type === "memory" && !hasMemoryFragment(item.effect.id)) {
                    collectMemoryFragment(item.effect.id);
                    addToLog("物品使用", `你查看了${item.name}，发现了一个记忆碎片。`);
                }
                
                updateInventoryDisplay();
                return true;
            }
            
            return false;
        }
        
        // 检查是否有物品
        function hasItem(itemId) {
            return gameData.player.inventory.includes(itemId);
        }
        
        // 收集记忆碎片
        function collectMemoryFragment(fragmentId) {
            if (!hasMemoryFragment(fragmentId)) {
                gameData.player.memoryFragments.push(fragmentId);
                updateStatusDisplay();
                updateMemoryLogDisplay();
                
                // 显示记忆碎片收集界面
                document.getElementById("memory-title").textContent = memoryFragmentsData[fragmentId].title;
                document.getElementById("memory-content").textContent = memoryFragmentsData[fragmentId].content;
                
                document.getElementById("memory-collected").style.opacity = "1";
                document.getElementById("memory-collected").style.visibility = "visible";
                
                // 高亮提示记忆收集菜单
                document.getElementById("memory-btn").classList.add("highlight");
                setTimeout(() => {
                    document.getElementById("memory-btn").classList.remove("highlight");
                }, 2000);
                
                // 检查是否触发最终事件
                if (gameData.player.memoryFragments.length >= 10 && gameData.characters.guoliang.affection >= 75 && gameData.gameState.storyFlag === 4) {
                    gameData.gameState.storyFlag = 5;
                }
                
                return true;
            }
            
            return false;
        }
        
        // 检查是否有记忆碎片
        function hasMemoryFragment(fragmentId) {
            return gameData.player.memoryFragments.includes(fragmentId);
        }
        
        // 完成事件
        function completeEvent(eventId) {
            if (!hasCompleted(eventId)) {
                gameData.gameState.completedEvents.push(eventId);
                return true;
            }
            
            return false;
        }
        
        // 检查事件是否已完成
        function hasCompleted(eventId) {
            return gameData.gameState.completedEvents.includes(eventId);
        }
        
        // 检查事件条件
        function checkEventRequirements(event) {
            if (!event.requirements) {
                return true;
            }
            
            // 检查属性要求
            if (event.requirements.attributes) {
                for (const attr in event.requirements.attributes) {
                    if (gameData.player.attributes[attr] < event.requirements.attributes[attr]) {
                        return false;
                    }
                }
            }
            
            // 检查标志要求
            if (event.requirements.flags) {
                for (const flag of event.requirements.flags) {
                    if (flag === "metGuoliang" && !gameData.characters.guoliang.metFlag) {
                        return false;
                    }
                }
            }
            
            return true;
        }
        
        // 添加到游戏日志
        function addToLog(category, text) {
            const timeString = getTimeString();
            gameData.gameState.gameLog.unshift({
                time: timeString,
                category: category,
                text: text
            });
            
            // 限制日志最大数量
            if (gameData.gameState.gameLog.length > 50) {
                gameData.gameState.gameLog.pop();
            }
            
            updateLogDisplay();
            
            // 高亮提示日志按钮
            if (category === "剧情" || category === "记忆" || category === "特殊互动") {
                document.getElementById("log-btn").classList.add("highlight");
                setTimeout(() => {
                    document.getElementById("log-btn").classList.remove("highlight");
                }, 2000);
            }
        }
        
        // 获取时间字符串
        function getTimeString() {
            const dayText = "第" + gameData.gameState.day + "天";
            let timeText = "";
            switch (gameData.gameState.time) {
                case "morning":
                    timeText = "上午";
                    break;
                case "afternoon":
                    timeText = "下午";
                    break;
                case "evening":
                    timeText = "晚上";
                    break;
            }
            return dayText + " " + timeText;
        }
        
        // 更新游戏时间
        function advanceTime() {
            const times = ["morning", "afternoon", "evening"];
            const currentTimeIndex = times.indexOf(gameData.gameState.time);
            
            if (currentTimeIndex === times.length - 1) {
                // 如果是晚上，进入下一天早上
                gameData.gameState.day += 1;
                gameData.gameState.time = times[0];
                gameData.gameState.energyLeft = 3;
                
                // 恢复一些体力
                changeAttribute("stamina", 30);
                addToLog("时间流逝", "夜晚过去，进入新的一天。体力恢复了一些。");
                
                // 显示场景过渡效果
                const transition = document.querySelector(".scene-transition");
                transition.style.opacity = "1";
                setTimeout(() => {
                    transition.style.opacity = "0";
                }, 1000);
            } else {
                // 否则进入当天下一个时段
                gameData.gameState.time = times[currentTimeIndex + 1];
                addToLog("时间流逝", `时间来到了${getTimeString()}。`);
            }
            
            updateStatusDisplay();
            
            // 随机事件触发
            triggerRandomEvent();
        }
        
        // 消耗能量
        function consumeEnergy(amount) {
            gameData.gameState.energyLeft -= amount;
            if (gameData.gameState.energyLeft < 0) {
                gameData.gameState.energyLeft = 0;
            }
            updateStatusDisplay();
        }
        
        // 触发随机事件
        function triggerRandomEvent() {
            // 50%概率触发随机事件
            if (Math.random() > 0.5) {
                return;
            }
            
            // 根据好感度和记忆碎片数量可能触发特殊事件
            if (gameData.characters.guoliang.affection >= 50) {
                if (Math.random() > 0.7) {
                    if (!hasCompleted("specialRainEvent")) {
                        completeEvent("specialRainEvent");
                        addToLog("特殊事件", "一场突如其来的大雨让你与李国良有了一次特别的相遇。");
                        processEvent(specialRainEvent());
                        return;
                    }
                }
                
                if (Math.random() > 0.7) {
                    if (!hasCompleted("specialOfficeEvent") && gameData.characters.guoliang.affection >= 60) {
                        completeEvent("specialOfficeEvent");
                        addToLog("特殊事件", "你帮助李国良整理文件到深夜，发生了难忘的亲密接触。");
                        processEvent(specialOfficeEvent());
                        return;
                    }
                }
                
                if (Math.random() > 0.7) {
                    if (!hasCompleted("specialCherryBlossomEvent") && gameData.characters.guoliang.affection >= 70) {
                        completeEvent("specialCherryBlossomEvent");
                        addToLog("特殊事件", "樱花盛开的季节，你和李国良在那棵特别的樱花树下有了亲密接触。");
                        processEvent(specialCherryBlossomEvent());
                        return;
                    }
                }
                
                if (Math.random() > 0.8) {
                    if (!hasCompleted("specialDinnerEvent") && gameData.characters.guoliang.affection >= 80) {
                        completeEvent("specialDinnerEvent");
                        addToLog("特殊事件", "你邀请李国良来你的公寓共进晚餐，浪漫的气氛让你们更加亲近。");
                        processEvent(specialDinnerEvent());
                        return;
                    }
                }
                
                if (Math.random() > 0.9) {
                    if (!hasCompleted("intimateMemoryEvent") && gameData.characters.guoliang.affection >= 90 && gameData.player.memoryFragments.length >= 10) {
                        completeEvent("intimateMemoryEvent");
                        addToLog("特殊事件", "记忆完全恢复后，你和李国良终于迎来了重逢的亲密时刻。");
                        processEvent(intimateMemoryEvent());
                        return;
                    }
                }
            }
            
            // 检查是否达到最终结局条件
            if (gameData.gameState.storyFlag === 5 && !hasCompleted("finalReveal")) {
                completeEvent("finalReveal");
                addToLog("关键剧情", "你在樱花树下与李国良相见，他终于告诉了你关于过去的真相。");
                processEvent(finalRevealEvent());
                return;
            }
            
            // 如果达到结局条件，触发结局
            if (gameData.player.memoryFragments.length >= 12 && gameData.characters.guoliang.affection >= 90 && gameData.gameState.storyFlag === 5) {
                processEvent(determineEnding());
                return;
            }
        }
        
        // UI相关函数
        
        // 显示通知
        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.style.opacity = "1";
            notification.style.transform = "translateX(-50%) translateY(0)";
            
            setTimeout(function() {
                notification.style.opacity = "0";
                notification.style.transform = "translateX(-50%) translateY(-10px)";
            }, 2500);
        }
        
        // 更新状态显示
        function updateStatusDisplay() {
            document.getElementById("date-display").textContent = "第" + gameData.gameState.day + "天";
            
            let timeText = "";
            switch (gameData.gameState.time) {
                case "morning":
                    timeText = "上午";
                    break;
                case "afternoon":
                    timeText = "下午";
                    break;
                case "evening":
                    timeText = "晚上";
                    break;
            }
            document.getElementById("time-display").textContent = timeText;
            
            document.getElementById("energy-display").textContent = gameData.player.attributes.stamina + "%";
            document.getElementById("memory-display").textContent = gameData.player.memoryFragments.length + "/12";
            
            // 更新属性页面
            document.getElementById("charm-value").textContent = gameData.player.attributes.charm + "/100";
            document.getElementById("charm-bar").style.width = gameData.player.attributes.charm + "%";
            
            document.getElementById("wisdom-value").textContent = gameData.player.attributes.wisdom + "/100";
            document.getElementById("wisdom-bar").style.width = gameData.player.attributes.wisdom + "%";
            
            document.getElementById("stamina-value").textContent = gameData.player.attributes.stamina + "/100";
            document.getElementById("stamina-bar").style.width = gameData.player.attributes.stamina + "%";
            
            document.getElementById("law-value").textContent = gameData.player.attributes.law + "/100";
            document.getElementById("law-bar").style.width = gameData.player.attributes.law + "%";
            
            document.getElementById("basketball-value").textContent = gameData.player.attributes.basketball + "/100";
            document.getElementById("basketball-bar").style.width = gameData.player.attributes.basketball + "%";
            
            document.getElementById("cooking-value").textContent = gameData.player.attributes.cooking + "/100";
            document.getElementById("cooking-bar").style.width = gameData.player.attributes.cooking + "%";
            
            document.getElementById("affection-value").textContent = gameData.characters.guoliang.affection + "/100";
            document.getElementById("affection-bar").style.width = gameData.characters.guoliang.affection + "%";
            
            // 更新进度指示器
            updateProgressIndicator();
        }
        
        // 更新进度指示器
        function updateProgressIndicator() {
            const dots = document.querySelectorAll('.progress-indicator-dot');
            dots.forEach(dot => dot.classList.remove('active'));
            
            // 根据故事阶段更新指示点
            if (gameData.gameState.storyFlag >= 0) {
                dots[0].classList.add('active');
            }
            if (gameData.gameState.storyFlag >= 2) {
                dots[1].classList.add('active');
            }
            if (gameData.gameState.storyFlag >= 4) {
                dots[2].classList.add('active');
            }
        }
        
        // 更新物品栏显示
        function updateInventoryDisplay() {
            const inventoryGrid = document.getElementById("inventory-grid");
            inventoryGrid.innerHTML = "";
            
            if (gameData.player.inventory.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.style.textAlign = "center";
                emptyMessage.style.padding = "2rem";
                emptyMessage.style.color = "#8b949e";
                emptyMessage.style.gridColumn = "1 / -1";
                emptyMessage.textContent = "物品栏是空的，请探索游戏世界收集物品。";
                inventoryGrid.appendChild(emptyMessage);
                return;
            }
            
            gameData.player.inventory.forEach(function(itemId) {
                const item = itemsData[itemId];
                const itemElement = document.createElement("div");
                itemElement.className = "inventory-item";
                itemElement.dataset.itemId = itemId;
                
                const iconElement = document.createElement("div");
                iconElement.className = "inventory-icon";
                iconElement.textContent = item.icon;
                
                const nameElement = document.createElement("div");
                nameElement.className = "inventory-name";
                nameElement.textContent = item.name;
                
                itemElement.appendChild(iconElement);
                itemElement.appendChild(nameElement);
                
                itemElement.addEventListener("click", function() {
                    showItemDetail(itemId);
                });
                
                inventoryGrid.appendChild(itemElement);
            });
        }
        
        // 显示物品详情
        function showItemDetail(itemId) {
            const item = itemsData[itemId];
            document.getElementById("item-detail-icon").textContent = item.icon;
            document.getElementById("item-detail-name").textContent = item.name;
            document.getElementById("item-detail-description").textContent = item.description;
            
            document.getElementById("use-item-btn").onclick = function() {
                useItem(itemId);
                document.getElementById("item-detail-modal").style.opacity = "0";
                document.getElementById("item-detail-modal").style.visibility = "hidden";
            };
            
            document.getElementById("cancel-item-btn").onclick = function() {
                document.getElementById("item-detail-modal").style.opacity = "0";
                document.getElementById("item-detail-modal").style.visibility = "hidden";
            };
            
            document.getElementById("item-detail-modal").style.opacity = "1";
            document.getElementById("item-detail-modal").style.visibility = "visible";
        }
        
        // 更新记忆碎片显示
        function updateMemoryLogDisplay() {
            const memoryLogGrid = document.getElementById("memory-log-grid");
            memoryLogGrid.innerHTML = "";
            
            // 创建12个记忆碎片格子
            for (let i = 1; i <= 12; i++) {
                const fragmentId = "memory" + i;
                const isCollected = hasMemoryFragment(fragmentId);
                
                const itemElement = document.createElement("div");
                itemElement.className = isCollected ? "memory-log-item" : "memory-log-item locked";
                
                const iconElement = document.createElement("div");
                iconElement.className = "memory-log-icon";
                iconElement.textContent = isCollected ? "💫" : "🔒";
                
                const numberElement = document.createElement("div");
                numberElement.className = "memory-log-number";
                numberElement.textContent = "#" + i;
                
                itemElement.appendChild(iconElement);
                itemElement.appendChild(numberElement);
                
                if (isCollected) {
                    itemElement.addEventListener("click", function() {
                        showMemoryDetail(fragmentId);
                    });
                }
                
                memoryLogGrid.appendChild(itemElement);
            }
        }
        
        // 显示记忆详情
        function showMemoryDetail(fragmentId) {
            const fragment = memoryFragmentsData[fragmentId];
            document.getElementById("memory-log-modal-title").textContent = fragment.title;
            document.getElementById("memory-log-modal-text").textContent = fragment.content;
            
            document.getElementById("memory-log-modal").style.opacity = "1";
            document.getElementById("memory-log-modal").style.visibility = "visible";
            
            document.querySelector(".memory-log-close").onclick = function() {
                document.getElementById("memory-log-modal").style.opacity = "0";
                document.getElementById("memory-log-modal").style.visibility = "hidden";
            };
        }
        
        // 更新日志显示
        function updateLogDisplay() {
            const logContainer = document.getElementById("log-container");
            logContainer.innerHTML = "";
            
            if (gameData.gameState.gameLog.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.style.textAlign = "center";
                emptyMessage.style.padding = "2rem";
                emptyMessage.style.color = "#8b949e";
                emptyMessage.textContent = "游戏日志是空的，请开始你的冒险。";
                logContainer.appendChild(emptyMessage);
                return;
            }
            
            gameData.gameState.gameLog.forEach(function(log) {
                const logEntry = document.createElement("div");
                logEntry.className = "log-entry";
                
                // 特殊样式处理
                if (log.category === "剧情" || log.category === "记忆" || log.category === "特殊互动") {
                    logEntry.classList.add("special");
                }
                
                const logHeading = document.createElement("div");
                logHeading.className = "log-heading";
                logHeading.textContent = `[${log.time}] ${log.category}`;
                
                const logText = document.createElement("div");
                logText.className = "log-text";
                logText.textContent = log.text;
                
                logEntry.appendChild(logHeading);
                logEntry.appendChild(logText);
                
                logContainer.appendChild(logEntry);
            });
        }
        
        // 显示/隐藏屏幕
        function showScreen(screenId) {
            const screen = document.getElementById(screenId);
            
            if (screenId === "title-screen") {
                screen.style.opacity = "1";
                document.getElementById("game-ui").style.opacity = "0";
            } else if (screenId === "game-ui") {
                document.getElementById("title-screen").style.opacity = "0";
                screen.style.opacity = "1";
            } else {
                screen.style.opacity = "1";
                screen.style.visibility = "visible";
            }
        }
        
        function hideScreen(screenId) {
            const screen = document.getElementById(screenId);
            screen.style.opacity = "0";
            
            if (screenId !== "title-screen" && screenId !== "game-ui") {
                setTimeout(function() {
                    screen.style.visibility = "hidden";
                }, 300);
            }
        }
        
        function hideAllScreens() {
            const subScreens = document.querySelectorAll(".sub-screen");
            subScreens.forEach(screen => {
                screen.style.opacity = "0";
                setTimeout(() => {
                    screen.style.visibility = "hidden";
                }, 300);
            });
            
            document.getElementById("game-menu").style.opacity = "0";
            document.getElementById("game-menu").style.visibility = "hidden";
            document.getElementById("memory-collected").style.opacity = "0";
            document.getElementById("memory-collected").style.visibility = "hidden";
            document.getElementById("memory-log-modal").style.opacity = "0";
            document.getElementById("memory-log-modal").style.visibility = "hidden";
            document.getElementById("item-detail-modal").style.opacity = "0";
            document.getElementById("item-detail-modal").style.visibility = "hidden";
        }
        
        // 更新场景
        function updateScene(location) {
            const locationData = locationsData[location];
            gameData.gameState.location = location;
            
            // 显示场景过渡效果
            const transition = document.querySelector(".scene-transition");
            transition.style.opacity = "1";
            
            setTimeout(() => {
                // 更新场景背景
                document.getElementById("scene-bg").textContent = locationData.icon;
                
                // 根据地点和状态更新角色显示
                updateCharacterDisplay();
                
                // 淡出过渡效果
                transition.style.opacity = "0";
                
                // 确保始终更新位置事件和选项
                setTimeout(() => {
                    updateLocationEvents();
                }, 300);
            }, 500);
            
            // 更新地图中当前位置的高亮
            document.querySelectorAll(".location-item").forEach(function(item) {
                if (item.dataset.location === location) {
                    item.classList.add("current-location");
                } else {
                    item.classList.remove("current-location");
                }
            });
            
            addToLog("移动", `你来到了${locationData.name}。`);
        }
        
        // 更新角色显示
        function updateCharacterDisplay() {
            const characterImg = document.getElementById("character-img");
            const location = gameData.gameState.location;
            const character = document.getElementById("character");
            
            // 默认显示夏奈
            characterImg.src = "https://pic1.imgdb.cn/item/66e83fc7d9c307b7e9977eda.png";  
            characterImg.alt = "结城夏奈";
            characterImg.style.display = "block";
            
            // 添加角色进入动画
            character.style.transform = "translateX(-50%) translateY(20px)";
            character.style.opacity = "0";
            
            setTimeout(() => {
                character.style.transform = "translateX(-50%) translateY(0)";
                character.style.opacity = "1";
            }, 300);
            
            // 在特定地点可能显示李国良
            if (location === "basketball-court" && (Math.random() > 0.5 || gameData.gameState.storyFlag >= 1)) {
                characterImg.src = "https://pic1.imgdb.cn/item/66be21a1d9c307b7e9cc9c98.jpg";  // 李国良形象
                characterImg.alt = "李国良";
                characterImg.style.display = "block";
            }
            
            // 在健身房可能显示美咲
            if (location === "gym" && gameData.characters.misaki.metFlag && Math.random() > 0.7) {
                characterImg.src = "https://pic1.imgdb.cn/item/66d7f116d9c307b7e9a009b9.jpg";  // 美咲形象
                characterImg.alt = "相泽美咲";
                characterImg.style.display = "block";
            }
            
            // 在某些场景中调整角色位置
            if (location === "library" || location === "classroom") {
                character.style.bottom = "5px"; // 调整位置，避免遮挡场景
            } else {
                character.style.bottom = "10px";
            }
        }
        
        // 处理对话和选项显示
        let currentDialogClickHandler = null;
        
        function processEvent(event) {
            const dialogueBox = document.getElementById("dialogue-box");
            const dialogueText = document.getElementById("dialogue-text");
            const speakerName = document.getElementById("speaker-name");
            const choicesContainer = document.getElementById("choices-container");
            const tapIndicator = document.getElementById("tap-indicator");
            
            if (!event || !event.dialogue || event.dialogue.length === 0) {
                console.warn("处理了一个空事件或没有对话的事件");
                return;
            }
            
            // 如果存在旧的点击处理器，先移除它
            if (currentDialogClickHandler) {
                dialogueBox.removeEventListener('click', currentDialogClickHandler);
                currentDialogClickHandler = null;
            }
            
            // 清空之前的内容
            dialogueText.innerHTML = "";
            choicesContainer.innerHTML = "";
            
            // 显示第一句对话
            const firstDialogue = event.dialogue[0];
            speakerName.textContent = firstDialogue.speaker;
            
            // 直接显示文本，不使用打字机效果
            dialogueText.textContent = firstDialogue.text;
            
            // 保存当前事件数据
            dialogueBox.dataset.currentDialogueIndex = "0";
            dialogueBox.dataset.dialogues = JSON.stringify(event.dialogue);
            
            // 如果有多句对话，显示点击指示器
            if (event.dialogue.length > 1) {
                tapIndicator.style.display = "block";
                
                // 确保对话框可以点击
                dialogueBox.style.pointerEvents = "auto";
                
                // 创建新的点击事件处理
                currentDialogClickHandler = function(e) {
                    // 忽略点击选项按钮的情况
                    if (e.target.classList.contains("choice-btn") || e.target.closest(".choice-btn")) {
                        return;
                    }
                    
                    // 获取当前对话索引
                    const currentIndex = parseInt(dialogueBox.dataset.currentDialogueIndex);
                    const dialogues = JSON.parse(dialogueBox.dataset.dialogues);
                    
                    // 如果有下一句对话
                    if (currentIndex < dialogues.length - 1) {
                        const nextIndex = currentIndex + 1;
                        const nextDialogue = dialogues[nextIndex];
                        
                        speakerName.textContent = nextDialogue.speaker;
                        dialogueText.textContent = nextDialogue.text; // 直接显示全文
                        
                        dialogueBox.dataset.currentDialogueIndex = nextIndex;
                    } else {
                        // 如果是最后一句对话，延长显示时间后显示选项
                        if (currentDialogClickHandler) {
                            dialogueBox.removeEventListener('click', currentDialogClickHandler);
                            currentDialogClickHandler = null;
                        }
                        
                        tapIndicator.style.display = "none";
                        
                        setTimeout(() => {
                            if (event.choices && event.choices.length > 0) {
                                displayChoices(event.choices);
                            } else {
                                // 如果没有选择，自动显示当前位置可用事件
                                updateLocationEvents();
                            }
                        }, 3000);
                    }
                };
                
                // 绑定点击事件
                dialogueBox.addEventListener('click', currentDialogClickHandler);
            } else {
                // 如果只有一句对话，延长显示时间
                tapIndicator.style.display = "none";
                
                setTimeout(function() {
                    if (event.choices && event.choices.length > 0) {
                        displayChoices(event.choices);
                    } else {
                        // 如果没有选择，自动显示当前位置可用事件
                        updateLocationEvents();
                    }
                }, 3000);
            }
        }
        
        // 显示选项
        function displayChoices(choices) {
            const choicesContainer = document.getElementById("choices-container");
            choicesContainer.innerHTML = "";
            
            if (!choices || choices.length === 0) {
                return;
            }
            
            choices.forEach(function(choice, index) {
                const choiceBtn = document.createElement("div");
                choiceBtn.className = "choice-btn";
                choiceBtn.textContent = choice.text;
                
                // 添加淡入动画
                choiceBtn.style.opacity = "0";
                choiceBtn.style.transform = "translateY(10px)";
                
                // 添加点击和触摸事件
                const handleClick = function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    
                    // 防止重复点击
                    if (this.dataset.processing === "true") return;
                    this.dataset.processing = "true";
                    
                    // 添加点击视觉反馈
                    this.style.transform = "translateY(2px)";
                    this.style.boxShadow = "0 1px 2px rgba(0, 0, 0, 0.2)";
                    this.style.backgroundColor = "#30363d";
                    
                    setTimeout(() => {
                        this.style.transform = "translateY(0)";
                        this.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";
                        this.style.backgroundColor = "#21262d";
                        
                        if (choice.action) {
                            try {
                                const result = choice.action();
                                if (result) {
                                    processEvent(result);
                                }
                            } catch (err) {
                                console.error("选项执行错误:", err);
                                showNotification("操作执行错误，请尝试其他选项");
                            }
                        }
                        
                        // 重置处理状态
                        setTimeout(() => {
                            this.dataset.processing = "false";
                        }, 500);
                    }, 100);
                };
                
                choiceBtn.addEventListener('click', handleClick);
                
                choicesContainer.appendChild(choiceBtn);
                
                // 错开淡入时间
                setTimeout(() => {
                    choiceBtn.style.opacity = "1";
                    choiceBtn.style.transform = "translateY(0)";
                }, 100 * index);
            });
        }
        
        // 执行当前地点的可用事件
        function executeLocationEvent(eventName) {
            const location = gameData.gameState.location;
            const event = eventsData[eventName];
            
            // 检查事件是否存在
            if (!event) return;
            
            // 判断这个事件是否会减少体力
            const eventReducesStamina = event.execute.toString().includes('changeAttribute("stamina", -');
            
            // 如果会减少体力，检查当前体力是否足够
            if (eventReducesStamina && gameData.player.attributes.stamina <= 10) {
                showNotification("体力不足，请先休息恢复体力");
                return;
            }
            
            // 检查是否有特殊可用条件
            if (event.available && typeof event.available === "function" && !event.available()) {
                showNotification("这个活动暂时不可用");
                return;
            }
            
            // 检查事件要求
            if (!checkEventRequirements(event)) {
                if (event.requirements.attributes) {
                    for (const attr in event.requirements.attributes) {
                        if (gameData.player.attributes[attr] < event.requirements.attributes[attr]) {
                            showNotification(`需要${attributeDisplayName(attr)}达到${event.requirements.attributes[attr]}点`);
                            return;
                        }
                    }
                }
                showNotification("你不满足这个活动的要求");
                return;
            }
            
            // 检查能量是否足够
            if (gameData.gameState.energyLeft < event.energyCost) {
                showNotification("你的精力不足");
                return;
            }
            
            // 执行事件
            consumeEnergy(event.energyCost);
            const result = event.execute();
            
            if (result) {
                processEvent(result);
                // 给玩家额外的时间阅读结果，再推进时间
                setTimeout(() => {
                    advanceTime();
                }, 3000);
            } else {
                // 如果没有结果文本，延迟一下再推进时间
                setTimeout(() => {
                    advanceTime();
                }, 3000);
            }
        }
        
        // 更新地点可用事件
        function updateLocationEvents() {
            const location = gameData.gameState.location;
            const locationData = locationsData[location];
            
            if (!locationData || !locationData.events) {
                return;
            }
            
            const choicesContainer = document.getElementById("choices-container");
            choicesContainer.innerHTML = "";
            
            // 添加当前地点描述
            processEvent({
                dialogue: [
                    {speaker: "系统", text: locationData.description + " 你现在可以:"}
                ]
            });
            
            // 添加可用事件选项
            locationData.events.forEach(function(eventName) {
                const event = eventsData[eventName];
                
                // 检查事件是否存在
                if (!event) {
                    return;
                }
                
                // 检查是否有特殊可用条件
                if (event.available && typeof event.available === "function" && !event.available()) {
                    return;
                }
                
                const choiceBtn = document.createElement("div");
                choiceBtn.className = "choice-btn";
                choiceBtn.textContent = event.name + " (消耗精力: " + event.energyCost + ")";
                
                // 添加事件描述
                if (event.description) {
                    const descriptionSpan = document.createElement("div");
                    descriptionSpan.className = "choice-desc";
                    descriptionSpan.textContent = event.description;
                    choiceBtn.appendChild(descriptionSpan);
                }
                
                // 如果能量不足，禁用按钮
                if (gameData.gameState.energyLeft < event.energyCost) {
                    choiceBtn.classList.add("disabled");
                    choiceBtn.title = "精力不足";
                } else {
                    // 添加点击事件
                    choiceBtn.addEventListener('click', function() {
                        // 视觉反馈
                        if (!choiceBtn.classList.contains("disabled")) {
                            choiceBtn.style.transform = "translateY(2px)";
                            choiceBtn.style.boxShadow = "0 1px 2px rgba(0, 0, 0, 0.2)";
                            choiceBtn.style.backgroundColor = "#30363d";
                            
                            // 延迟执行以显示点击效果
                            setTimeout(() => {
                                choiceBtn.style.transform = "translateY(0)";
                                choiceBtn.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";
                                choiceBtn.style.backgroundColor = "#21262d";
                                executeLocationEvent(eventName);
                            }, 100);
                        }
                    });
                }
                
                choicesContainer.appendChild(choiceBtn);
            });
        }
        
        // 保存游戏
        function saveGame() {
            try {
                localStorage.setItem("guoliangTrapSave", JSON.stringify(gameData));
                showNotification("游戏已保存");
                addToLog("系统", "游戏已成功保存。");
                return true;
            } catch (e) {
                showNotification("保存失败");
                console.error("保存失败:", e);
                return false;
            }
        }
        
        // 加载游戏
        function loadGame() {
            try {
                const savedData = localStorage.getItem("guoliangTrapSave");
                if (savedData) {
                    gameData = JSON.parse(savedData);
                    updateStatusDisplay();
                    updateInventoryDisplay();
                    updateMemoryLogDisplay();
                    updateLogDisplay();
                    updateScene(gameData.gameState.location);
                    showNotification("游戏已加载");
                    addToLog("系统", "游戏已成功加载。");
                    return true;
                }
                showNotification("没有找到存档");
                return false;
            } catch (e) {
                showNotification("加载失败");
                console.error("加载失败:", e);
                return false;
            }
        }
        
        // 添加紧急恢复功能
        function addDebugRecoveryFeatures() {
            // 双击显示恢复按钮
            let lastClick = 0;
            document.addEventListener('click', function(e) {
                const now = new Date().getTime();
                if (now - lastClick < 300) {
                    document.getElementById("recovery-button").style.display = "block";
                    setTimeout(() => {
                        document.getElementById("recovery-button").style.display = "none";
                    }, 5000);
                }
                lastClick = now;
            });
            
            // 恢复按钮点击事件
            document.getElementById("recovery-button").addEventListener("click", function() {
                updateLocationEvents();
                showNotification("已尝试恢复游戏状态");
                this.style.display = "none";
            });
        }
        
        // 确保游戏状态一致性
        function ensureGameConsistency() {
            // 确保游戏状态一致
            if (!gameData.gameState.location) {
                console.warn("位置未定义，重置为公寓");
                gameData.gameState.location = "apartment";
            }
            
            // 确保能量有合理值
            if (gameData.gameState.energyLeft < 0) {
                gameData.gameState.energyLeft = 0;
            }
            
            // 更新UI状态
            updateStatusDisplay();
        }
        
        // 绑定菜单和UI事件
        function bindUIEvents() {
            // 菜单按钮
            document.getElementById("menu-button").addEventListener("click", function(e) {
                e.stopPropagation();
                document.getElementById("game-menu").style.opacity = "1";
                document.getElementById("game-menu").style.visibility = "visible";
            });
            
            // 菜单项
            document.getElementById("close-menu-btn").addEventListener("click", function() {
                hideScreen("game-menu");
            });
            
            document.getElementById("inventory-btn").addEventListener("click", function() {
                hideScreen("game-menu");
                showScreen("inventory-screen");
                updateInventoryDisplay();
            });
            
            document.getElementById("map-btn").addEventListener("click", function() {
                hideScreen("game-menu");
                showScreen("map-screen");
            });
            
            document.getElementById("status-btn").addEventListener("click", function() {
                hideScreen("game-menu");
                showScreen("status-screen");
            });
            
            document.getElementById("memory-btn").addEventListener("click", function() {
                hideScreen("game-menu");
                showScreen("memory-log-screen");
                updateMemoryLogDisplay();
            });
            
            document.getElementById("log-btn").addEventListener("click", function() {
                hideScreen("game-menu");
                showScreen("log-screen");
                updateLogDisplay();
            });
            
            document.getElementById("save-btn").addEventListener("click", function() {
                saveGame();
                hideScreen("game-menu");
            });
            
            // 返回按钮
            const backButtons = document.querySelectorAll(".back-btn");
            backButtons.forEach(function(btn) {
                btn.addEventListener("click", function() {
                    hideAllScreens();
                });
            });
            
            // 地点选择
            const locationItems = document.querySelectorAll(".location-item");
            locationItems.forEach(function(item) {
                item.addEventListener("click", function() {
                    const locationId = this.dataset.location;
                    updateScene(locationId);
                    hideScreen("map-screen");
                });
            });
            
            // 记忆碎片确认按钮
            document.getElementById("continue-btn").addEventListener("click", function() {
                hideScreen("memory-collected");
            });
            
            // 取消物品按钮
            document.getElementById("cancel-item-btn").addEventListener("click", function() {
                document.getElementById("item-detail-modal").style.opacity = "0";
                document.getElementById("item-detail-modal").style.visibility = "hidden";
            });
            
            // 关闭记忆详情
            document.querySelector(".memory-log-close").addEventListener("click", function() {
                document.getElementById("memory-log-modal").style.opacity = "0";
                document.getElementById("memory-log-modal").style.visibility = "hidden";
            });
        }
        
        // 初始化游戏
        function initGame() {
            // 隐藏加载屏幕
            setTimeout(function() {
                document.getElementById("loading-screen").style.opacity = "0";
                setTimeout(function() {
                    document.getElementById("loading-screen").style.display = "none";
                }, 500);
            }, 1500);
            
            // 初始化显示
            updateStatusDisplay();
            updateInventoryDisplay();
            updateMemoryLogDisplay();
            updateLogDisplay();
            
            // 绑定UI事件
            bindUIEvents();
            
            // 添加紧急恢复功能
            addDebugRecoveryFeatures();
            
            // 标题界面按钮
            document.getElementById("start-btn").addEventListener("click", function() {
                hideScreen("title-screen");
                showScreen("game-ui");
                
                // 显示引导对话
                processEvent({
                    dialogue: [
                        {speaker: "系统", text: "欢迎来到《国良诱捕器》！你将扮演结城夏奈，一位商法专业的大二学生。你的目标是追求李国良，大三篮球队的学生教练。"},
                        {speaker: "系统", text: "但随着游戏进程，你会逐渐发现两人之间存在被遗忘的深厚过往。"},
                        {speaker: "系统", text: "游戏中有8个可探索地点，通过执行不同活动提升属性，收集记忆碎片，增加李国良的好感度。"},
                        {speaker: "系统", text: "每天分为上午、下午和晚上三个时段, 每个时段可以进行一项活动。请合理规划你的时间和精力。"},
                        {speaker: "系统", text: "现在，你的冒险即将开始！"}
                    ],
                    choices: [
                        {
                            text: "开始我的校园生活",
                            action: function() {
                                updateScene("apartment");
                                updateLocationEvents();
                                addToLog("系统", "游戏开始！希望你能揭开过去的谜团，追寻真爱。");
                                
                                return {
                                    dialogue: [
                                        {speaker: "夏奈", text: "今天也要努力！首先应该做些什么好呢？"},
                                        {speaker: "系统", text: "提示：尝试去篮球场看看，也许能遇到李国良。"}
                                    ]
                                };
                            }
                        }
                    ]
                });
            });
            
            document.getElementById("load-btn").addEventListener("click", function() {
                // 尝试加载存档
                if (loadGame()) {
                    hideScreen("title-screen");
                    showScreen("game-ui");
                    updateLocationEvents();
                }
            });
            
            document.getElementById("about-btn").addEventListener("click", function() {
                showNotification("《国良诱捕器》是一款校园恋爱模拟游戏");
                setTimeout(() => {
                    showNotification("你将扮演失忆的女主角夏奈，追寻与篮球教练李国良之间被遗忘的过去");
                }, 2500);
                setTimeout(() => {
                    showNotification("收集记忆碎片和提升好感度，揭开过去的真相！");
                }, 5000);
            });
            
            // 防止触摸事件导致缩放
            document.addEventListener('touchmove', function(event) {
                if (event.scale !== 1) { 
                    event.preventDefault();
                }
            }, { passive: false });
            
            // 双击缩放禁用
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }
        
        // 监听页面加载
        document.addEventListener("DOMContentLoaded", initGame);
    </script>
    </body>
    </html>
